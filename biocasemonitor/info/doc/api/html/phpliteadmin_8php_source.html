<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>BioCASe Monitor: config/phpliteadmin.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="biocase-logo.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BioCASe Monitor
   &#160;<span id="projectnumber">2.0</span>
   </div>
   <div id="projectbrief">Monitoring Service for the BioCASe Provider Software</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_9f351d46ce3cc29445a41dc3a31e6919.html">config</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">phpliteadmin.php</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;?php</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//  </span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">//  Project: phpLiteAdmin (https://bitbucket.org/phpliteadmin/public)</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">//  Version: 1.9.6</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">//  Summary: PHP-based admin tool to manage SQLite2 and SQLite3 databases on the web</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//  Last updated: 2015-07-05</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//  Developers:</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//     Dane Iracleous (daneiracleous@gmail.com)</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">//     Ian Aldrighetti (ian.aldrighetti@gmail.com)</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">//     George Flanagin &amp; Digital Gaslight, Inc (george@digitalgaslight.com)</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">//     Christopher Kramer (crazy4chrissi@gmail.com, http://en.christosoft.de)</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">//     Ayman Teryaki (http://havalite.com)</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">//     Dreadnaut (dreadnaut@gmail.com, http://dreadnaut.altervista.org)</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">//  </span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">//  </span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">//  Copyright (C) 2015, phpLiteAdmin</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">//  </span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">//  This program is free software: you can redistribute it and/or modify</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">//  it under the terms of the GNU General Public License as published by</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">//  the Free Software Foundation, either version 3 of the License, or</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">//  (at your option) any later version.</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">//  </span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">//  This program is distributed in the hope that it will be useful,</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">//  but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">//  GNU General Public License for more details.</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">//  </span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">//  You should have received a copy of the GNU General Public License</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">//  along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">//  </span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">//  ////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment">//  </span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">//  Please report any bugs you may encounter to our issue tracker here:</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">//      https://bitbucket.org/phpliteadmin/public/issues?status=new&amp;status=open</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">// This is sample configuration file</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">// You can configure phpliteadmin in one of 2 ways:</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">// 1. Rename phpliteadmin.config.sample.php to phpliteadmin.config.php and change parameters in there.</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">//    You can set only your custom settings in phpliteadmin.config.php. All other settings will be set to defaults.</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">// 2. Change parameters directly in main phpliteadmin.php file</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">// Please see https://bitbucket.org/phpliteadmin/public/wiki/Configuration for more details</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">//password to gain access</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;$password = <span class="stringliteral">&#39;admin&#39;</span>;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">//directory relative to this file to search for databases (if false, manually list databases in the $databases variable)</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;$directory = <span class="charliteral">&#39;.&#39;</span>;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">//whether or not to scan the subdirectories of the above directory infinitely deep</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;$subdirectories = <span class="keyword">false</span>;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">//if the above $directory variable is set to false, you must specify the databases manually in an array as the next variable</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">//if any of the databases do not exist as they are referenced by their path, they will be created automatically</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;$databases = array(</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    array(</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        <span class="stringliteral">&#39;path&#39;</span>=&gt; <span class="stringliteral">&#39;database1.sqlite&#39;</span>,</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        <span class="stringliteral">&#39;name&#39;</span>=&gt; <span class="stringliteral">&#39;Database 1&#39;</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    ),</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    array(</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;        <span class="stringliteral">&#39;path&#39;</span>=&gt; <span class="stringliteral">&#39;database2.sqlite&#39;</span>,</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        <span class="stringliteral">&#39;name&#39;</span>=&gt; <span class="stringliteral">&#39;Database 2&#39;</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    ),</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;);</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">/* ---- Interface settings ---- */</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">// Theme! If you want to change theme, save the CSS file in same folder of phpliteadmin or in folder &quot;themes&quot;</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;$theme = <span class="stringliteral">&#39;phpliteadmin.css&#39;</span>;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">// the default language! If you want to change it, save the language file in same folder of phpliteadmin or in folder &quot;languages&quot;</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">// More about localizations (downloads, how to translate etc.): https://bitbucket.org/phpliteadmin/public/wiki/Localization</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;$language = <span class="stringliteral">&#39;en&#39;</span>;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">// set default number of rows. You need to relog after changing the number</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;$rowsNum = 30;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">// reduce string characters by a number bigger than 10</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;$charsNum = 300;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">// maximum number of SQL queries to save in the history</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;$maxSavedQueries = 10;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">/* ---- Custom functions ---- */</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">//a list of custom functions that can be applied to columns in the databases</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment">//make sure to define every function below if it is not a core PHP function</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;$custom_functions = array(</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="stringliteral">&#39;md5&#39;</span>, <span class="stringliteral">&#39;sha1&#39;</span>, <span class="stringliteral">&#39;time&#39;</span>, <span class="stringliteral">&#39;strtotime&#39;</span>,</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <span class="comment">// add the names of your custom functions to this array</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="comment">/* &#39;leet_text&#39;, */</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;);</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">// define your custom functions here</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">function leet_text($value)</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment">{</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">  return strtr($value, &#39;eaAsSOl&#39;, &#39;344zZ01&#39;);</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">}</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">/* ---- Advanced options ---- */</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment">//changing the following variable allows multiple phpLiteAdmin installs to work under the same domain.</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;$cookie_name = <span class="stringliteral">&#39;pla3412&#39;</span>;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment">//whether or not to put the app in debug mode where errors are outputted</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;$debug = <span class="keyword">false</span>;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">// the user is allowed to create databases with only these extensions</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;$allowed_extensions = array(<span class="stringliteral">&#39;db&#39;</span>,<span class="stringliteral">&#39;db3&#39;</span>,<span class="stringliteral">&#39;sqlite&#39;</span>,<span class="stringliteral">&#39;sqlite3&#39;</span>);</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">// English language-texts.</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">// Read our wiki on how to translate: https://bitbucket.org/phpliteadmin/public/wiki/Localization</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;$lang = array(</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="stringliteral">&quot;direction&quot;</span> =&gt; <span class="stringliteral">&quot;LTR&quot;</span>,</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="stringliteral">&quot;date_format&quot;</span> =&gt; <span class="stringliteral">&#39;g:ia \o\n F j, Y (T)&#39;</span>,  <span class="comment">// see http://php.net/manual/en/function.date.php for what the letters stand for</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="stringliteral">&quot;ver&quot;</span> =&gt; <span class="stringliteral">&quot;version&quot;</span>,</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="stringliteral">&quot;for&quot;</span> =&gt; <span class="stringliteral">&quot;for&quot;</span>,</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="stringliteral">&quot;to&quot;</span> =&gt; <span class="stringliteral">&quot;to&quot;</span>,</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="stringliteral">&quot;go&quot;</span> =&gt; <span class="stringliteral">&quot;Go&quot;</span>,</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="stringliteral">&quot;yes&quot;</span> =&gt; <span class="stringliteral">&quot;Yes&quot;</span>,</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="stringliteral">&quot;no&quot;</span> =&gt; <span class="stringliteral">&quot;No&quot;</span>,</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="stringliteral">&quot;sql&quot;</span> =&gt; <span class="stringliteral">&quot;SQL&quot;</span>,</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="stringliteral">&quot;csv&quot;</span> =&gt; <span class="stringliteral">&quot;CSV&quot;</span>,</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="stringliteral">&quot;csv_tbl&quot;</span> =&gt; <span class="stringliteral">&quot;Table that CSV pertains to&quot;</span>,</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="stringliteral">&quot;srch&quot;</span> =&gt; <span class="stringliteral">&quot;Search&quot;</span>,</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="stringliteral">&quot;srch_again&quot;</span> =&gt; <span class="stringliteral">&quot;Do Another Search&quot;</span>,</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="stringliteral">&quot;login&quot;</span> =&gt; <span class="stringliteral">&quot;Log In&quot;</span>,</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="stringliteral">&quot;logout&quot;</span> =&gt; <span class="stringliteral">&quot;Logout&quot;</span>,</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="stringliteral">&quot;view&quot;</span> =&gt; <span class="stringliteral">&quot;View&quot;</span>,</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="stringliteral">&quot;confirm&quot;</span> =&gt; <span class="stringliteral">&quot;Confirm&quot;</span>,</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="stringliteral">&quot;cancel&quot;</span> =&gt; <span class="stringliteral">&quot;Cancel&quot;</span>,</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="stringliteral">&quot;save_as&quot;</span> =&gt; <span class="stringliteral">&quot;Save As&quot;</span>,</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="stringliteral">&quot;options&quot;</span> =&gt; <span class="stringliteral">&quot;Options&quot;</span>,</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="stringliteral">&quot;no_opt&quot;</span> =&gt; <span class="stringliteral">&quot;No options&quot;</span>,</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="stringliteral">&quot;help&quot;</span> =&gt; <span class="stringliteral">&quot;Help&quot;</span>,</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="stringliteral">&quot;installed&quot;</span> =&gt; <span class="stringliteral">&quot;installed&quot;</span>,</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="stringliteral">&quot;not_installed&quot;</span> =&gt; <span class="stringliteral">&quot;not installed&quot;</span>,</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="stringliteral">&quot;done&quot;</span> =&gt; <span class="stringliteral">&quot;done&quot;</span>,</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="stringliteral">&quot;insert&quot;</span> =&gt; <span class="stringliteral">&quot;Insert&quot;</span>,</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="stringliteral">&quot;export&quot;</span> =&gt; <span class="stringliteral">&quot;Export&quot;</span>,</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="stringliteral">&quot;import&quot;</span> =&gt; <span class="stringliteral">&quot;Import&quot;</span>,</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="stringliteral">&quot;rename&quot;</span> =&gt; <span class="stringliteral">&quot;Rename&quot;</span>,</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="stringliteral">&quot;empty&quot;</span> =&gt; <span class="stringliteral">&quot;Empty&quot;</span>,</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="stringliteral">&quot;drop&quot;</span> =&gt; <span class="stringliteral">&quot;Drop&quot;</span>,</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="stringliteral">&quot;tbl&quot;</span> =&gt; <span class="stringliteral">&quot;Table&quot;</span>,</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="stringliteral">&quot;chart&quot;</span> =&gt; <span class="stringliteral">&quot;Chart&quot;</span>,</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="stringliteral">&quot;err&quot;</span> =&gt; <span class="stringliteral">&quot;ERROR&quot;</span>,</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="stringliteral">&quot;act&quot;</span> =&gt; <span class="stringliteral">&quot;Action&quot;</span>,</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="stringliteral">&quot;rec&quot;</span> =&gt; <span class="stringliteral">&quot;Records&quot;</span>,</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="stringliteral">&quot;col&quot;</span> =&gt; <span class="stringliteral">&quot;Column&quot;</span>,</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="stringliteral">&quot;cols&quot;</span> =&gt; <span class="stringliteral">&quot;Columns&quot;</span>,</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="stringliteral">&quot;rows&quot;</span> =&gt; <span class="stringliteral">&quot;row(s)&quot;</span>,</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="stringliteral">&quot;edit&quot;</span> =&gt; <span class="stringliteral">&quot;Edit&quot;</span>,</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="stringliteral">&quot;del&quot;</span> =&gt; <span class="stringliteral">&quot;Delete&quot;</span>,</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="stringliteral">&quot;add&quot;</span> =&gt; <span class="stringliteral">&quot;Add&quot;</span>,</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="stringliteral">&quot;backup&quot;</span> =&gt; <span class="stringliteral">&quot;Backup database file&quot;</span>,</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="stringliteral">&quot;before&quot;</span> =&gt; <span class="stringliteral">&quot;Before&quot;</span>,</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="stringliteral">&quot;after&quot;</span> =&gt; <span class="stringliteral">&quot;After&quot;</span>,</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="stringliteral">&quot;passwd&quot;</span> =&gt; <span class="stringliteral">&quot;Password&quot;</span>,</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="stringliteral">&quot;passwd_incorrect&quot;</span> =&gt; <span class="stringliteral">&quot;Incorrect password.&quot;</span>,</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="stringliteral">&quot;chk_ext&quot;</span> =&gt; <span class="stringliteral">&quot;Checking supported SQLite PHP extensions&quot;</span>,</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="stringliteral">&quot;autoincrement&quot;</span> =&gt; <span class="stringliteral">&quot;Autoincrement&quot;</span>,</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="stringliteral">&quot;not_null&quot;</span> =&gt; <span class="stringliteral">&quot;Not NULL&quot;</span>,</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="stringliteral">&quot;attention&quot;</span> =&gt; <span class="stringliteral">&quot;Attention&quot;</span>,</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="stringliteral">&quot;none&quot;</span> =&gt; <span class="stringliteral">&quot;None&quot;</span>,</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="stringliteral">&quot;as_defined&quot;</span> =&gt; <span class="stringliteral">&quot;As defined&quot;</span>,</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="stringliteral">&quot;expression&quot;</span> =&gt; <span class="stringliteral">&quot;Expression&quot;</span>,</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    </div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="stringliteral">&quot;sqlite_ext&quot;</span> =&gt; <span class="stringliteral">&quot;SQLite extension&quot;</span>,</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="stringliteral">&quot;sqlite_ext_support&quot;</span> =&gt; <span class="stringliteral">&quot;It appears that none of the supported SQLite library extensions are available in your installation of PHP. You may not use %s until you install at least one of them.&quot;</span>,</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="stringliteral">&quot;sqlite_v&quot;</span> =&gt; <span class="stringliteral">&quot;SQLite version&quot;</span>,</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="stringliteral">&quot;sqlite_v_error&quot;</span> =&gt; <span class="stringliteral">&quot;It appears that your database is of SQLite version %s but your installation of PHP does not contain the necessary extensions to handle this version. To fix the problem, either delete the database and allow %s to create it automatically or recreate it manually as SQLite version %s.&quot;</span>,</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="stringliteral">&quot;report_issue&quot;</span> =&gt; <span class="stringliteral">&quot;The problem cannot be diagnosed properly. Please file an issue report at&quot;</span>,</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="stringliteral">&quot;sqlite_limit&quot;</span> =&gt; <span class="stringliteral">&quot;Due to the limitations of SQLite, only the field name and data type can be modified.&quot;</span>,</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    </div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="stringliteral">&quot;php_v&quot;</span> =&gt; <span class="stringliteral">&quot;PHP version&quot;</span>,</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <span class="stringliteral">&quot;new_version&quot;</span> =&gt; <span class="stringliteral">&quot;There is a new version!&quot;</span>,</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    </div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="stringliteral">&quot;db_dump&quot;</span> =&gt; <span class="stringliteral">&quot;database dump&quot;</span>,</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="stringliteral">&quot;db_f&quot;</span> =&gt; <span class="stringliteral">&quot;database file&quot;</span>,</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="stringliteral">&quot;db_ch&quot;</span> =&gt; <span class="stringliteral">&quot;Change Database&quot;</span>,</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="stringliteral">&quot;db_event&quot;</span> =&gt; <span class="stringliteral">&quot;Database Event&quot;</span>,</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="stringliteral">&quot;db_name&quot;</span> =&gt; <span class="stringliteral">&quot;Database name&quot;</span>,</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="stringliteral">&quot;db_rename&quot;</span> =&gt; <span class="stringliteral">&quot;Rename Database&quot;</span>,</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="stringliteral">&quot;db_renamed&quot;</span> =&gt; <span class="stringliteral">&quot;Database &#39;%s&#39; has been renamed to&quot;</span>,</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="stringliteral">&quot;db_del&quot;</span> =&gt; <span class="stringliteral">&quot;Delete Database&quot;</span>,</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="stringliteral">&quot;db_path&quot;</span> =&gt; <span class="stringliteral">&quot;Path to database&quot;</span>,</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="stringliteral">&quot;db_size&quot;</span> =&gt; <span class="stringliteral">&quot;Size of database&quot;</span>,</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="stringliteral">&quot;db_mod&quot;</span> =&gt; <span class="stringliteral">&quot;Database last modified&quot;</span>,</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="stringliteral">&quot;db_create&quot;</span> =&gt; <span class="stringliteral">&quot;Create New Database&quot;</span>,</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="stringliteral">&quot;db_vac&quot;</span> =&gt; <span class="stringliteral">&quot;The database, &#39;%s&#39;, has been VACUUMed.&quot;</span>,</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="stringliteral">&quot;db_not_writeable&quot;</span> =&gt; <span class="stringliteral">&quot;The database, &#39;%s&#39;, does not exist and cannot be created because the containing directory, &#39;%s&#39;, is not writable. The application is unusable until you make it writable.&quot;</span>,</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <span class="stringliteral">&quot;db_setup&quot;</span> =&gt; <span class="stringliteral">&quot;There was a problem setting up your database, %s. An attempt will be made to find out what&#39;s going on so you can fix the problem more easily&quot;</span>,</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="stringliteral">&quot;db_exists&quot;</span> =&gt; <span class="stringliteral">&quot;A database, other file or directory of the name &#39;%s&#39; already exists.&quot;</span>,</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    </div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="stringliteral">&quot;exported&quot;</span> =&gt; <span class="stringliteral">&quot;Exported&quot;</span>,</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="stringliteral">&quot;struct&quot;</span> =&gt; <span class="stringliteral">&quot;Structure&quot;</span>,</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="stringliteral">&quot;struct_for&quot;</span> =&gt; <span class="stringliteral">&quot;structure for&quot;</span>,</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="stringliteral">&quot;on_tbl&quot;</span> =&gt; <span class="stringliteral">&quot;on table&quot;</span>,</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="stringliteral">&quot;data_dump&quot;</span> =&gt; <span class="stringliteral">&quot;Data dump for&quot;</span>,</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="stringliteral">&quot;backup_hint&quot;</span> =&gt; <span class="stringliteral">&quot;Hint: To backup your database, the easiest way is to %s.&quot;</span>,</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="stringliteral">&quot;backup_hint_linktext&quot;</span> =&gt; <span class="stringliteral">&quot;download the database-file&quot;</span>,</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="stringliteral">&quot;total_rows&quot;</span> =&gt; <span class="stringliteral">&quot;a total of %s rows&quot;</span>,</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="stringliteral">&quot;total&quot;</span> =&gt; <span class="stringliteral">&quot;Total&quot;</span>,</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="stringliteral">&quot;not_dir&quot;</span> =&gt; <span class="stringliteral">&quot;The directory you specified to scan for databases does not exist or is not a directory.&quot;</span>,</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="stringliteral">&quot;bad_php_directive&quot;</span> =&gt; <span class="stringliteral">&quot;It appears that the PHP directive, &#39;register_globals&#39; is enabled. This is bad. You need to disable it before continuing.&quot;</span>,</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="stringliteral">&quot;page_gen&quot;</span> =&gt; <span class="stringliteral">&quot;Page generated in %s seconds.&quot;</span>,</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="stringliteral">&quot;powered&quot;</span> =&gt; <span class="stringliteral">&quot;Powered by&quot;</span>,</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="stringliteral">&quot;free_software&quot;</span> =&gt; <span class="stringliteral">&quot;This is free software.&quot;</span>,</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="stringliteral">&quot;please_donate&quot;</span> =&gt; <span class="stringliteral">&quot;Please donate.&quot;</span>,</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="stringliteral">&quot;remember&quot;</span> =&gt; <span class="stringliteral">&quot;Remember me&quot;</span>,</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <span class="stringliteral">&quot;no_db&quot;</span> =&gt; <span class="stringliteral">&quot;Welcome to %s. It appears that you have selected to scan a directory for databases to manage. However, %s could not find any valid SQLite databases. You may use the form below to create your first database.&quot;</span>,</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <span class="stringliteral">&quot;no_db2&quot;</span> =&gt; <span class="stringliteral">&quot;The directory you specified does not contain any existing databases to manage, and the directory is not writable. This means you can&#39;t create any new databases using %s. Either make the directory writable or manually upload databases to the directory.&quot;</span>,</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    </div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="stringliteral">&quot;create&quot;</span> =&gt; <span class="stringliteral">&quot;Create&quot;</span>,</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="stringliteral">&quot;created&quot;</span> =&gt; <span class="stringliteral">&quot;has been created&quot;</span>,</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="stringliteral">&quot;create_tbl&quot;</span> =&gt; <span class="stringliteral">&quot;Create new table&quot;</span>,</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="stringliteral">&quot;create_tbl_db&quot;</span> =&gt; <span class="stringliteral">&quot;Create new table on database&quot;</span>,</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="stringliteral">&quot;create_trigger&quot;</span> =&gt; <span class="stringliteral">&quot;Creating new trigger on table&quot;</span>,</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="stringliteral">&quot;create_index&quot;</span> =&gt; <span class="stringliteral">&quot;Creating new index on table&quot;</span>,</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="stringliteral">&quot;create_index1&quot;</span> =&gt; <span class="stringliteral">&quot;Create Index&quot;</span>,</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="stringliteral">&quot;create_view&quot;</span> =&gt; <span class="stringliteral">&quot;Create new view on database&quot;</span>,</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    </div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="stringliteral">&quot;trigger&quot;</span> =&gt; <span class="stringliteral">&quot;Trigger&quot;</span>,</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="stringliteral">&quot;triggers&quot;</span> =&gt; <span class="stringliteral">&quot;Triggers&quot;</span>,</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="stringliteral">&quot;trigger_name&quot;</span> =&gt; <span class="stringliteral">&quot;Trigger name&quot;</span>,</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <span class="stringliteral">&quot;trigger_act&quot;</span> =&gt; <span class="stringliteral">&quot;Trigger Action&quot;</span>,</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <span class="stringliteral">&quot;trigger_step&quot;</span> =&gt; <span class="stringliteral">&quot;Trigger Steps (semicolon terminated)&quot;</span>,</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="stringliteral">&quot;when_exp&quot;</span> =&gt; <span class="stringliteral">&quot;WHEN expression (type expression without &#39;WHEN&#39;)&quot;</span>,</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <span class="stringliteral">&quot;index&quot;</span> =&gt; <span class="stringliteral">&quot;Index&quot;</span>,</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="stringliteral">&quot;indexes&quot;</span> =&gt; <span class="stringliteral">&quot;Indexes&quot;</span>,</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="stringliteral">&quot;index_name&quot;</span> =&gt; <span class="stringliteral">&quot;Index name&quot;</span>,</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="stringliteral">&quot;name&quot;</span> =&gt; <span class="stringliteral">&quot;Name&quot;</span>,</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="stringliteral">&quot;unique&quot;</span> =&gt; <span class="stringliteral">&quot;Unique&quot;</span>,</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="stringliteral">&quot;seq_no&quot;</span> =&gt; <span class="stringliteral">&quot;Seq. No.&quot;</span>,</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="stringliteral">&quot;emptied&quot;</span> =&gt; <span class="stringliteral">&quot;has been emptied&quot;</span>,</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="stringliteral">&quot;dropped&quot;</span> =&gt; <span class="stringliteral">&quot;has been dropped&quot;</span>,</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="stringliteral">&quot;renamed&quot;</span> =&gt; <span class="stringliteral">&quot;has been renamed to&quot;</span>,</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <span class="stringliteral">&quot;altered&quot;</span> =&gt; <span class="stringliteral">&quot;has been altered successfully&quot;</span>,</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="stringliteral">&quot;inserted&quot;</span> =&gt; <span class="stringliteral">&quot;inserted&quot;</span>,</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <span class="stringliteral">&quot;deleted&quot;</span> =&gt; <span class="stringliteral">&quot;deleted&quot;</span>,</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <span class="stringliteral">&quot;affected&quot;</span> =&gt; <span class="stringliteral">&quot;affected&quot;</span>,</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="stringliteral">&quot;blank_index&quot;</span> =&gt; <span class="stringliteral">&quot;Index name must not be blank.&quot;</span>,</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <span class="stringliteral">&quot;one_index&quot;</span> =&gt; <span class="stringliteral">&quot;You must specify at least one index column.&quot;</span>,</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <span class="stringliteral">&quot;docu&quot;</span> =&gt; <span class="stringliteral">&quot;Documentation&quot;</span>,</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="stringliteral">&quot;license&quot;</span> =&gt; <span class="stringliteral">&quot;License&quot;</span>,</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="stringliteral">&quot;proj_site&quot;</span> =&gt; <span class="stringliteral">&quot;Project Site&quot;</span>,</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <span class="stringliteral">&quot;bug_report&quot;</span> =&gt; <span class="stringliteral">&quot;This may be a bug that needs to be reported at&quot;</span>,</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="stringliteral">&quot;return&quot;</span> =&gt; <span class="stringliteral">&quot;Return&quot;</span>,</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="stringliteral">&quot;browse&quot;</span> =&gt; <span class="stringliteral">&quot;Browse&quot;</span>,</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <span class="stringliteral">&quot;fld&quot;</span> =&gt; <span class="stringliteral">&quot;Field&quot;</span>,</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <span class="stringliteral">&quot;fld_num&quot;</span> =&gt; <span class="stringliteral">&quot;Number of Fields&quot;</span>,</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="stringliteral">&quot;fields&quot;</span> =&gt; <span class="stringliteral">&quot;Fields&quot;</span>,</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <span class="stringliteral">&quot;type&quot;</span> =&gt; <span class="stringliteral">&quot;Type&quot;</span>,</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="stringliteral">&quot;operator&quot;</span> =&gt; <span class="stringliteral">&quot;Operator&quot;</span>,</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="stringliteral">&quot;val&quot;</span> =&gt; <span class="stringliteral">&quot;Value&quot;</span>,</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="stringliteral">&quot;update&quot;</span> =&gt; <span class="stringliteral">&quot;Update&quot;</span>,</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="stringliteral">&quot;comments&quot;</span> =&gt; <span class="stringliteral">&quot;Comments&quot;</span>,</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    </div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="stringliteral">&quot;specify_fields&quot;</span> =&gt; <span class="stringliteral">&quot;You must specify the number of table fields.&quot;</span>,</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="stringliteral">&quot;specify_tbl&quot;</span> =&gt; <span class="stringliteral">&quot;You must specify a table name.&quot;</span>,</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <span class="stringliteral">&quot;specify_col&quot;</span> =&gt; <span class="stringliteral">&quot;You must specify a column.&quot;</span>,</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    </div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="stringliteral">&quot;tbl_exists&quot;</span> =&gt; <span class="stringliteral">&quot;Table of the same name already exists.&quot;</span>,</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="stringliteral">&quot;show&quot;</span> =&gt; <span class="stringliteral">&quot;Show&quot;</span>,</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="stringliteral">&quot;show_rows&quot;</span> =&gt; <span class="stringliteral">&quot;Showing %s row(s). &quot;</span>,</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="stringliteral">&quot;showing&quot;</span> =&gt; <span class="stringliteral">&quot;Showing&quot;</span>,</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <span class="stringliteral">&quot;showing_rows&quot;</span> =&gt; <span class="stringliteral">&quot;Showing rows&quot;</span>,</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <span class="stringliteral">&quot;query_time&quot;</span> =&gt; <span class="stringliteral">&quot;(Query took %s sec)&quot;</span>,</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    <span class="stringliteral">&quot;syntax_err&quot;</span> =&gt; <span class="stringliteral">&quot;There is a problem with the syntax of your query (Query was not executed)&quot;</span>,</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <span class="stringliteral">&quot;run_sql&quot;</span> =&gt; <span class="stringliteral">&quot;Run SQL query/queries on database &#39;%s&#39;&quot;</span>,</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="stringliteral">&quot;recent_queries&quot;</span> =&gt; <span class="stringliteral">&quot;Recent Queries&quot;</span>,</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <span class="stringliteral">&quot;full_texts&quot;</span> =&gt; <span class="stringliteral">&quot;Show full texts&quot;</span>,</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="stringliteral">&quot;no_full_texts&quot;</span> =&gt; <span class="stringliteral">&quot;Shorten long texts&quot;</span>,</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    </div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="stringliteral">&quot;ques_empty&quot;</span> =&gt; <span class="stringliteral">&quot;Are you sure you want to empty the table &#39;%s&#39;?&quot;</span>,</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="stringliteral">&quot;ques_drop&quot;</span> =&gt; <span class="stringliteral">&quot;Are you sure you want to drop the table &#39;%s&#39;?&quot;</span>,</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <span class="stringliteral">&quot;ques_drop_view&quot;</span> =&gt; <span class="stringliteral">&quot;Are you sure you want to drop the view &#39;%s&#39;?&quot;</span>,</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="stringliteral">&quot;ques_del_rows&quot;</span> =&gt; <span class="stringliteral">&quot;Are you sure you want to delete row(s) %s from table &#39;%s&#39;?&quot;</span>,</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <span class="stringliteral">&quot;ques_del_db&quot;</span> =&gt; <span class="stringliteral">&quot;Are you sure you want to delete the database &#39;%s&#39;?&quot;</span>,</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="stringliteral">&quot;ques_column_delete&quot;</span> =&gt; <span class="stringliteral">&quot;Are you sure you want to delete column(s) %s from table &#39;%s&#39;?&quot;</span>,</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <span class="stringliteral">&quot;ques_del_index&quot;</span> =&gt; <span class="stringliteral">&quot;Are you sure you want to delete index &#39;%s&#39;?&quot;</span>,</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <span class="stringliteral">&quot;ques_del_trigger&quot;</span> =&gt; <span class="stringliteral">&quot;Are you sure you want to delete trigger &#39;%s&#39;?&quot;</span>,</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <span class="stringliteral">&quot;ques_primarykey_add&quot;</span> =&gt; <span class="stringliteral">&quot;Are you sure you want to add a primary key for the column(s) %s in table &#39;%s&#39;?&quot;</span>,</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    </div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <span class="stringliteral">&quot;export_struct&quot;</span> =&gt; <span class="stringliteral">&quot;Export with structure&quot;</span>,</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <span class="stringliteral">&quot;export_data&quot;</span> =&gt; <span class="stringliteral">&quot;Export with data&quot;</span>,</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <span class="stringliteral">&quot;add_drop&quot;</span> =&gt; <span class="stringliteral">&quot;Add DROP TABLE&quot;</span>,</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <span class="stringliteral">&quot;add_transact&quot;</span> =&gt; <span class="stringliteral">&quot;Add TRANSACTION&quot;</span>,</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <span class="stringliteral">&quot;fld_terminated&quot;</span> =&gt; <span class="stringliteral">&quot;Fields terminated by&quot;</span>,</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="stringliteral">&quot;fld_enclosed&quot;</span> =&gt; <span class="stringliteral">&quot;Fields enclosed by&quot;</span>,</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="stringliteral">&quot;fld_escaped&quot;</span> =&gt; <span class="stringliteral">&quot;Fields escaped by&quot;</span>,</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <span class="stringliteral">&quot;fld_names&quot;</span> =&gt; <span class="stringliteral">&quot;Field names in first row&quot;</span>,</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <span class="stringliteral">&quot;rep_null&quot;</span> =&gt; <span class="stringliteral">&quot;Replace NULL by&quot;</span>,</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="stringliteral">&quot;rem_crlf&quot;</span> =&gt; <span class="stringliteral">&quot;Remove CRLF characters within fields&quot;</span>,</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="stringliteral">&quot;put_fld&quot;</span> =&gt; <span class="stringliteral">&quot;Put field names in first row&quot;</span>,</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="stringliteral">&quot;null_represent&quot;</span> =&gt; <span class="stringliteral">&quot;NULL represented by&quot;</span>,</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <span class="stringliteral">&quot;import_suc&quot;</span> =&gt; <span class="stringliteral">&quot;Import was successful.&quot;</span>,</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <span class="stringliteral">&quot;import_into&quot;</span> =&gt; <span class="stringliteral">&quot;Import into&quot;</span>,</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="stringliteral">&quot;import_f&quot;</span> =&gt; <span class="stringliteral">&quot;File to import&quot;</span>,</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <span class="stringliteral">&quot;rename_tbl&quot;</span> =&gt; <span class="stringliteral">&quot;Rename table &#39;%s&#39; to&quot;</span>,</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    </div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="stringliteral">&quot;rows_records&quot;</span> =&gt; <span class="stringliteral">&quot;row(s) starting from record # &quot;</span>,</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="stringliteral">&quot;rows_aff&quot;</span> =&gt; <span class="stringliteral">&quot;row(s) affected. &quot;</span>,</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    </div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="stringliteral">&quot;as_a&quot;</span> =&gt; <span class="stringliteral">&quot;as a&quot;</span>,</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <span class="stringliteral">&quot;readonly_tbl&quot;</span> =&gt; <span class="stringliteral">&quot;&#39;%s&#39; is a view, which means it is a SELECT statement treated as a read-only table. You may not edit or insert records.&quot;</span>,</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <span class="stringliteral">&quot;chk_all&quot;</span> =&gt; <span class="stringliteral">&quot;Check All&quot;</span>,</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="stringliteral">&quot;unchk_all&quot;</span> =&gt; <span class="stringliteral">&quot;Uncheck All&quot;</span>,</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="stringliteral">&quot;with_sel&quot;</span> =&gt; <span class="stringliteral">&quot;With Selected&quot;</span>,</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    </div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <span class="stringliteral">&quot;no_tbl&quot;</span> =&gt; <span class="stringliteral">&quot;No table in database.&quot;</span>,</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <span class="stringliteral">&quot;no_chart&quot;</span> =&gt; <span class="stringliteral">&quot;If you can read this, it means the chart could not be generated. The data you are trying to view may not be appropriate for a chart.&quot;</span>,</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <span class="stringliteral">&quot;no_rows&quot;</span> =&gt; <span class="stringliteral">&quot;There are no rows in the table for the range you selected.&quot;</span>,</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="stringliteral">&quot;no_sel&quot;</span> =&gt; <span class="stringliteral">&quot;You did not select anything.&quot;</span>,</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    </div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    <span class="stringliteral">&quot;chart_type&quot;</span> =&gt; <span class="stringliteral">&quot;Chart Type&quot;</span>,</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <span class="stringliteral">&quot;chart_bar&quot;</span> =&gt; <span class="stringliteral">&quot;Bar Chart&quot;</span>,</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <span class="stringliteral">&quot;chart_pie&quot;</span> =&gt; <span class="stringliteral">&quot;Pie Chart&quot;</span>,</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="stringliteral">&quot;chart_line&quot;</span> =&gt; <span class="stringliteral">&quot;Line Chart&quot;</span>,</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <span class="stringliteral">&quot;lbl&quot;</span> =&gt; <span class="stringliteral">&quot;Labels&quot;</span>,</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="stringliteral">&quot;empty_tbl&quot;</span> =&gt; <span class="stringliteral">&quot;This table is empty.&quot;</span>,</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="stringliteral">&quot;click&quot;</span> =&gt; <span class="stringliteral">&quot;Click here&quot;</span>,</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <span class="stringliteral">&quot;insert_rows&quot;</span> =&gt; <span class="stringliteral">&quot;to insert rows.&quot;</span>,</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <span class="stringliteral">&quot;restart_insert&quot;</span> =&gt; <span class="stringliteral">&quot;Restart insertion with &quot;</span>,</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <span class="stringliteral">&quot;ignore&quot;</span> =&gt; <span class="stringliteral">&quot;Ignore&quot;</span>,</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="stringliteral">&quot;func&quot;</span> =&gt; <span class="stringliteral">&quot;Function&quot;</span>,</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <span class="stringliteral">&quot;new_insert&quot;</span> =&gt; <span class="stringliteral">&quot;Insert As New Row&quot;</span>,</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <span class="stringliteral">&quot;save_ch&quot;</span> =&gt; <span class="stringliteral">&quot;Save Changes&quot;</span>,</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <span class="stringliteral">&quot;def_val&quot;</span> =&gt; <span class="stringliteral">&quot;Default Value&quot;</span>,</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="stringliteral">&quot;prim_key&quot;</span> =&gt; <span class="stringliteral">&quot;Primary Key&quot;</span>,</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <span class="stringliteral">&quot;tbl_end&quot;</span> =&gt; <span class="stringliteral">&quot;field(s) at end of table&quot;</span>,</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <span class="stringliteral">&quot;query_used_table&quot;</span> =&gt; <span class="stringliteral">&quot;Query used to create this table&quot;</span>,</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="stringliteral">&quot;query_used_view&quot;</span> =&gt; <span class="stringliteral">&quot;Query used to create this view&quot;</span>,</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <span class="stringliteral">&quot;create_index2&quot;</span> =&gt; <span class="stringliteral">&quot;Create an index on&quot;</span>,</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="stringliteral">&quot;create_trigger2&quot;</span> =&gt; <span class="stringliteral">&quot;Create a new trigger&quot;</span>,</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <span class="stringliteral">&quot;new_fld&quot;</span> =&gt; <span class="stringliteral">&quot;Adding new field(s) to table &#39;%s&#39;&quot;</span>,</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <span class="stringliteral">&quot;add_flds&quot;</span> =&gt; <span class="stringliteral">&quot;Add Fields&quot;</span>,</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <span class="stringliteral">&quot;edit_col&quot;</span> =&gt; <span class="stringliteral">&quot;Editing column &#39;%s&#39;&quot;</span>,</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <span class="stringliteral">&quot;vac&quot;</span> =&gt; <span class="stringliteral">&quot;Vacuum&quot;</span>,</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <span class="stringliteral">&quot;vac_desc&quot;</span> =&gt; <span class="stringliteral">&quot;Large databases sometimes need to be VACUUMed to reduce their footprint on the server. Click the button below to VACUUM the database &#39;%s&#39;.&quot;</span>,</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="stringliteral">&quot;event&quot;</span> =&gt; <span class="stringliteral">&quot;Event&quot;</span>,</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="stringliteral">&quot;each_row&quot;</span> =&gt; <span class="stringliteral">&quot;For Each Row&quot;</span>,</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <span class="stringliteral">&quot;define_index&quot;</span> =&gt; <span class="stringliteral">&quot;Define index properties&quot;</span>,</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <span class="stringliteral">&quot;dup_val&quot;</span> =&gt; <span class="stringliteral">&quot;Duplicate values&quot;</span>,</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="stringliteral">&quot;allow&quot;</span> =&gt; <span class="stringliteral">&quot;Allowed&quot;</span>,</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <span class="stringliteral">&quot;not_allow&quot;</span> =&gt; <span class="stringliteral">&quot;Not Allowed&quot;</span>,</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="stringliteral">&quot;asc&quot;</span> =&gt; <span class="stringliteral">&quot;Ascending&quot;</span>,</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <span class="stringliteral">&quot;desc&quot;</span> =&gt; <span class="stringliteral">&quot;Descending&quot;</span>,</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <span class="stringliteral">&quot;warn0&quot;</span> =&gt; <span class="stringliteral">&quot;You have been warned.&quot;</span>,</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <span class="stringliteral">&quot;warn_passwd&quot;</span> =&gt; <span class="stringliteral">&quot;You are using the default password, which can be dangerous. You can change it easily at the top of %s.&quot;</span>,</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="stringliteral">&quot;warn_dumbass&quot;</span> =&gt; <span class="stringliteral">&quot;You didn&#39;t change the value dumbass ;-)&quot;</span>,</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <span class="stringliteral">&quot;counting_skipped&quot;</span> =&gt; <span class="stringliteral">&quot;Counting of records has been skipped for some tables because your database is comparably big and some tables don&#39;t have primary keys assigned to them so counting might be slow. Add a primary key to these tables or %sforce counting%s.&quot;</span>,</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <span class="stringliteral">&quot;sel_state&quot;</span> =&gt; <span class="stringliteral">&quot;Select Statement&quot;</span>,</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    <span class="stringliteral">&quot;delimit&quot;</span> =&gt; <span class="stringliteral">&quot;Delimiter&quot;</span>,</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <span class="stringliteral">&quot;back_top&quot;</span> =&gt; <span class="stringliteral">&quot;Back to Top&quot;</span>,</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="stringliteral">&quot;choose_f&quot;</span> =&gt; <span class="stringliteral">&quot;Choose File&quot;</span>,</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="stringliteral">&quot;instead&quot;</span> =&gt; <span class="stringliteral">&quot;Instead of&quot;</span>,</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <span class="stringliteral">&quot;define_in_col&quot;</span> =&gt; <span class="stringliteral">&quot;Define index column(s)&quot;</span>,</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    </div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <span class="stringliteral">&quot;delete_only_managed&quot;</span> =&gt; <span class="stringliteral">&quot;You can only delete databases managed by this tool!&quot;</span>,</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="stringliteral">&quot;rename_only_managed&quot;</span> =&gt; <span class="stringliteral">&quot;You can only rename databases managed by this tool!&quot;</span>,</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <span class="stringliteral">&quot;db_moved_outside&quot;</span> =&gt; <span class="stringliteral">&quot;You either tried to move the database into a directory where it cannot be managed anylonger, or the check if you did this failed because of missing rights.&quot;</span>,</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <span class="stringliteral">&quot;extension_not_allowed&quot;</span> =&gt; <span class="stringliteral">&quot;The extension you provided is not within the list of allowed extensions. Please use one of the following extensions&quot;</span>,</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <span class="stringliteral">&quot;add_allowed_extension&quot;</span> =&gt; <span class="stringliteral">&quot;You can add extensions to this list by adding your extension to \$allowed_extensions in the configuration.&quot;</span>,</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <span class="stringliteral">&quot;directory_not_writable&quot;</span> =&gt; <span class="stringliteral">&quot;The database-file itself is writable, but to write into it, the containing directory needs to be writable as well. This is because SQLite puts temporary files in there for locking.&quot;</span>,</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <span class="stringliteral">&quot;tbl_inexistent&quot;</span> =&gt; <span class="stringliteral">&quot;Table %s does not exist&quot;</span>,</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <span class="comment">// errors that can happen when ALTER TABLE fails. You don&#39;t necessarily have to translate these.</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    <span class="stringliteral">&quot;alter_failed&quot;</span> =&gt; <span class="stringliteral">&quot;Altering of Table %s failed&quot;</span>,</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="stringliteral">&quot;alter_tbl_name_not_replacable&quot;</span> =&gt; <span class="stringliteral">&quot;could not replace the table name with the temporary one&quot;</span>,</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="stringliteral">&quot;alter_no_def&quot;</span> =&gt; <span class="stringliteral">&quot;no ALTER definition&quot;</span>,</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <span class="stringliteral">&quot;alter_parse_failed&quot;</span> =&gt;<span class="stringliteral">&quot;failed to parse ALTER definition&quot;</span>,</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <span class="stringliteral">&quot;alter_action_not_recognized&quot;</span> =&gt; <span class="stringliteral">&quot;ALTER action could not be recognized&quot;</span>,</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <span class="stringliteral">&quot;alter_no_add_col&quot;</span> =&gt; <span class="stringliteral">&quot;no column to add detected in ALTER statement&quot;</span>,</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <span class="stringliteral">&quot;alter_pattern_mismatch&quot;</span>=&gt;<span class="stringliteral">&quot;Pattern did not match on your original CREATE TABLE statement&quot;</span>,</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    <span class="stringliteral">&quot;alter_col_not_recognized&quot;</span> =&gt; <span class="stringliteral">&quot;could not recognize new or old column name&quot;</span>,</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <span class="stringliteral">&quot;alter_unknown_operation&quot;</span> =&gt; <span class="stringliteral">&quot;Unknown ALTER operation!&quot;</span>,</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    </div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <span class="comment">/* Help documentation */</span></div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    <span class="stringliteral">&quot;help_doc&quot;</span> =&gt; <span class="stringliteral">&quot;Help Documentation&quot;</span>,</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    <span class="stringliteral">&quot;help1&quot;</span> =&gt; <span class="stringliteral">&quot;SQLite Library Extensions&quot;</span>,</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <span class="stringliteral">&quot;help1_x&quot;</span> =&gt; <span class="stringliteral">&quot;%s uses PHP library extensions that allow interaction with SQLite databases. Currently, %s supports PDO, SQLite3, and SQLiteDatabase. Both PDO and SQLite3 deal with version 3 of SQLite, while SQLiteDatabase deals with version 2. So, if your PHP installation includes more than one SQLite library extension, PDO and SQLite3 will take precedence to make use of the better technology. However, if you have existing databases that are of version 2 of SQLite, %s will be forced to use SQLiteDatabase for only those databases. Not all databases need to be of the same version. During the database creation, however, the most advanced extension will be used.&quot;</span>,</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    <span class="stringliteral">&quot;help2&quot;</span> =&gt; <span class="stringliteral">&quot;Creating a New Database&quot;</span>,</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <span class="stringliteral">&quot;help2_x&quot;</span> =&gt; <span class="stringliteral">&quot;When you create a new database, the name you entered will be appended with the appropriate file extension (.db, .db3, .sqlite, etc.) if you do not include it yourself. The database will be created in the directory you specified as the \$directory variable.&quot;</span>,</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    <span class="stringliteral">&quot;help3&quot;</span> =&gt; <span class="stringliteral">&quot;Tables vs. Views&quot;</span>,</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    <span class="stringliteral">&quot;help3_x&quot;</span> =&gt; <span class="stringliteral">&quot;On the main database page, there is a list of tables and views. Since views are read-only, certain operations will be disabled. These disabled operations will be apparent by their omission in the location where they should appear on the row for a view. If you want to change the data for a view, you need to drop that view and create a new view with the appropriate SELECT statement that queries other existing tables. For more information, see &lt;a href=&#39;http://en.wikipedia.org/wiki/View_(database)&#39; target=&#39;_blank&#39;&gt;http://en.wikipedia.org/wiki/View_(database)&lt;/a&gt;&quot;</span>,</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <span class="stringliteral">&quot;help4&quot;</span> =&gt; <span class="stringliteral">&quot;Writing a Select Statement for a New View&quot;</span>,</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="stringliteral">&quot;help4_x&quot;</span> =&gt; <span class="stringliteral">&quot;When you create a new view, you must write an SQL SELECT statement that it will use as its data. A view is simply a read-only table that can be accessed and queried like a regular table, except it cannot be modified through insertion, column editing, or row editing. It is only used for conveniently fetching data.&quot;</span>,</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <span class="stringliteral">&quot;help5&quot;</span> =&gt; <span class="stringliteral">&quot;Export Structure to SQL File&quot;</span>,</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <span class="stringliteral">&quot;help5_x&quot;</span> =&gt; <span class="stringliteral">&quot;During the process for exporting to an SQL file, you may choose to include the queries that create the table and columns.&quot;</span>,</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <span class="stringliteral">&quot;help6&quot;</span> =&gt; <span class="stringliteral">&quot;Export Data to SQL File&quot;</span>,</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <span class="stringliteral">&quot;help6_x&quot;</span> =&gt; <span class="stringliteral">&quot;During the process for exporting to an SQL file, you may choose to include the queries that populate the table(s) with the current records of the table(s).&quot;</span>,</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="stringliteral">&quot;help7&quot;</span> =&gt; <span class="stringliteral">&quot;Add Drop Table to Exported SQL File&quot;</span>,</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <span class="stringliteral">&quot;help7_x&quot;</span> =&gt; <span class="stringliteral">&quot;During the process for exporting to an SQL file, you may choose to include queries to DROP the existing tables before adding them so that problems do not occur when trying to create tables that already exist.&quot;</span>,</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <span class="stringliteral">&quot;help8&quot;</span> =&gt; <span class="stringliteral">&quot;Add Transaction to Exported SQL File&quot;</span>,</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <span class="stringliteral">&quot;help8_x&quot;</span> =&gt; <span class="stringliteral">&quot;During the process for exporting to an SQL file, you may choose to wrap the queries around a TRANSACTION so that if an error occurs at any time during the importation process using the exported file, the database can be reverted to its previous state, preventing partially updated data from populating the database.&quot;</span>,</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    <span class="stringliteral">&quot;help9&quot;</span> =&gt; <span class="stringliteral">&quot;Add Comments to Exported SQL File&quot;</span>,</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    <span class="stringliteral">&quot;help9_x&quot;</span> =&gt; <span class="stringliteral">&quot;During the process for exporting to an SQL file, you may choose to include comments that explain each step of the process so that a human can better understand what is happening.&quot;</span></div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;);</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="comment">//there is no reason for the average user to edit anything below this comment</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="comment">//- Initialization</span></div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="comment">// load optional configuration file</span></div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;$config_filename = <span class="stringliteral">&#39;./phpliteadmin.config.php&#39;</span>;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;<span class="keywordflow">if</span> (is_readable($config_filename)) {</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    include_once $config_filename;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;}</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="comment">//constants 1</span></div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;define(<span class="stringliteral">&quot;PROJECT&quot;</span>, <span class="stringliteral">&quot;phpLiteAdmin&quot;</span>);</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;define(<span class="stringliteral">&quot;VERSION&quot;</span>, <span class="stringliteral">&quot;1.9.6&quot;</span>);</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;define(<span class="stringliteral">&quot;PAGE&quot;</span>, basename(__FILE__));</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;define(<span class="stringliteral">&quot;FORCETYPE&quot;</span>, <span class="keyword">false</span>); <span class="comment">//force the extension that will be used (set to false in almost all circumstances except debugging)</span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;define(<span class="stringliteral">&quot;SYSTEMPASSWORD&quot;</span>, $password); <span class="comment">// Makes things easier.</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;define(<span class="stringliteral">&#39;PROJECT_URL&#39;</span>,<span class="stringliteral">&#39;https://bitbucket.org/phpliteadmin/public&#39;</span>);</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;define(<span class="stringliteral">&#39;DONATE_URL&#39;</span>,<span class="stringliteral">&#39;http://phpliteadmin.christosoft.de/donate.php&#39;</span>);</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;define(<span class="stringliteral">&#39;VERSION_CHECK_URL&#39;</span>,<span class="stringliteral">&#39;https://phpliteadmin.christosoft.de/current_version.php&#39;</span>);</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;define(<span class="stringliteral">&#39;PROJECT_BUGTRACKER_LINK&#39;</span>,<span class="stringliteral">&#39;&lt;a href=&quot;https://bitbucket.org/phpliteadmin/public/issues?status=new&amp;status=open&quot; target=&quot;_blank&quot;&gt;https://bitbucket.org/phpliteadmin/public/issues?status=new&amp;status=open&lt;/a&gt;&#39;</span>);</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;define(<span class="stringliteral">&#39;PROJECT_INSTALL_LINK&#39;</span>,<span class="stringliteral">&#39;&lt;a href=&quot;https://bitbucket.org/phpliteadmin/public/wiki/Installation&quot; target=&quot;_blank&quot;&gt;https://bitbucket.org/phpliteadmin/public/wiki/Installation&lt;/a&gt;&#39;</span>);</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="comment">// Resource output (css and javascript files)</span></div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment">// we get out of the main code as soon as possible, without inizializing the session</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="keywordflow">if</span> (isset($_GET[<span class="stringliteral">&#39;resource&#39;</span>])) {</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    Resources::output($_GET[<span class="stringliteral">&#39;resource&#39;</span>]);</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    exit();</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;}</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="comment">// don&#39;t mess with this - required for the login session</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;ini_set(<span class="stringliteral">&#39;session.cookie_httponly&#39;</span>, <span class="charliteral">&#39;1&#39;</span>);</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;session_start();</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="keywordflow">if</span>($debug==<span class="keyword">true</span>)</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;{</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    ini_set(<span class="stringliteral">&quot;display_errors&quot;</span>, 1);</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    error_reporting(E_STRICT | E_ALL);</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;} <span class="keywordflow">else</span></div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;{</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    @ini_set(<span class="stringliteral">&quot;display_errors&quot;</span>, 0);</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;}</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;<span class="comment">// start the timer to record page load time</span></div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;$pageTimer = <span class="keyword">new</span> MicroTimer();</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="comment">// load language file</span></div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="keywordflow">if</span>($language != <span class="stringliteral">&#39;en&#39;</span>) {</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    $temp_lang=$lang;</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <span class="keywordflow">if</span>(is_file(<span class="stringliteral">&#39;languages/lang_&#39;</span>.$language.<span class="stringliteral">&#39;.php&#39;</span>))</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        include(<span class="stringliteral">&#39;languages/lang_&#39;</span>.$language.<span class="stringliteral">&#39;.php&#39;</span>);</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    elseif(is_file(<span class="stringliteral">&#39;lang_&#39;</span>.$language.<span class="stringliteral">&#39;.php&#39;</span>))</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;        include(&#39;lang_&#39;.$language.&#39;.php&#39;);</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    $lang = array_merge($temp_lang, $lang);</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    unset($temp_lang);</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;}</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="comment">// version-number added so after updating, old session-data is not used anylonger</span></div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="comment">// cookies names cannot contain symbols, except underscores</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;define(&quot;COOKIENAME&quot;, preg_replace(&#39;/[^a-zA-Z0-9_]/&#39;, &#39;_&#39;, $cookie_name . &#39;_&#39; . VERSION) );</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;<span class="comment">// stripslashes if MAGIC QUOTES is turned on</span></div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;<span class="comment">// This is only a workaround. Please better turn off magic quotes!</span></div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="comment">// This code is from http://php.net/manual/en/security.magicquotes.disabling.php</span></div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;if (get_magic_quotes_gpc()) {</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    $process = array(&amp;$_GET, &amp;$_POST, &amp;$_COOKIE, &amp;$_REQUEST);</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <span class="keywordflow">while</span> (list($key, $val) = each($process)) {</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;        <span class="keywordflow">foreach</span> ($val as $k =&gt; $v) {</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;            unset($process[$key][$k]);</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;            <span class="keywordflow">if</span> (is_array($v)) {</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;                $process[$key][stripslashes($k)] = $v;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                $process[] = &amp;$process[$key][stripslashes($k)];</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                $process[$key][stripslashes($k)] = stripslashes($v);</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;            }</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;        }</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    }</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    unset($process);</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;}</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;<span class="comment">//data types array</span></div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;$sqlite_datatypes = array(<span class="stringliteral">&quot;INTEGER&quot;</span>, <span class="stringliteral">&quot;REAL&quot;</span>, <span class="stringliteral">&quot;TEXT&quot;</span>, <span class="stringliteral">&quot;BLOB&quot;</span>,<span class="stringliteral">&quot;NUMERIC&quot;</span>,<span class="stringliteral">&quot;BOOLEAN&quot;</span>,<span class="stringliteral">&quot;DATETIME&quot;</span>);</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="comment">//available SQLite functions array (don&#39;t add anything here or there will be problems)</span></div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;$sqlite_functions = array(<span class="stringliteral">&quot;abs&quot;</span>, <span class="stringliteral">&quot;hex&quot;</span>, <span class="stringliteral">&quot;length&quot;</span>, <span class="stringliteral">&quot;lower&quot;</span>, <span class="stringliteral">&quot;ltrim&quot;</span>, <span class="stringliteral">&quot;random&quot;</span>, <span class="stringliteral">&quot;round&quot;</span>, <span class="stringliteral">&quot;rtrim&quot;</span>, <span class="stringliteral">&quot;trim&quot;</span>, <span class="stringliteral">&quot;typeof&quot;</span>, <span class="stringliteral">&quot;upper&quot;</span>);</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="comment">//- Support functions</span></div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;<span class="comment">//function that allows SQL delimiter to be ignored inside comments or strings</span></div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;<span class="keyword">function</span> explode_sql($delimiter, $sql)</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;{</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    $ign = array(<span class="charliteral">&#39;&quot;&#39;</span> =&gt; <span class="charliteral">&#39;&quot;&#39;</span>, <span class="stringliteral">&quot;&#39;&quot;</span> =&gt; <span class="stringliteral">&quot;&#39;&quot;</span>, <span class="stringliteral">&quot;/*&quot;</span> =&gt; <span class="stringliteral">&quot;*/&quot;</span>, <span class="stringliteral">&quot;--&quot;</span> =&gt; <span class="stringliteral">&quot;\n&quot;</span>); <span class="comment">// Ignore sequences.</span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    $out = array();</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    $last = 0;</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    $slen = strlen($sql);</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    $dlen = strlen($delimiter);</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    $i = 0;</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <span class="keywordflow">while</span>($i &lt; $slen)</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    {</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        <span class="comment">// Split on delimiter</span></div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        <span class="keywordflow">if</span>($slen - $i &gt;= $dlen &amp;&amp; substr($sql, $i, $dlen) == $delimiter)</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        {</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;            array_push($out, substr($sql, $last, $i - $last));</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;            $last = $i + $dlen;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;            $i += $dlen;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        }</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        <span class="comment">// Eat comments and string literals</span></div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        <span class="keywordflow">foreach</span>($ign as $start =&gt; $end)</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;        {</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;            $ilen = strlen($start);</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;            <span class="keywordflow">if</span>($slen - $i &gt;= $ilen &amp;&amp; substr($sql, $i, $ilen) == $start)</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;            {</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;                $i+=strlen($start);</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;                $elen = strlen($end);</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;                <span class="keywordflow">while</span>($i &lt; $slen)</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;                {</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;                    <span class="keywordflow">if</span>($slen - $i &gt;= $elen &amp;&amp; substr($sql, $i, $elen) == $end)</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;                    {</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;                        <span class="comment">// SQL comment characters can be escaped by doubling the character. This recognizes and skips those.</span></div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                        <span class="keywordflow">if</span>($start == $end &amp;&amp; $slen - $i &gt;= $elen*2 &amp;&amp; substr($sql, $i, $elen*2) == $end.$end)</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;                        {</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;                            $i += $elen * 2;</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;                            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;                        }</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;                        <span class="keywordflow">else</span></div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;                        {</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;                            $i += $elen;</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                            <span class="keywordflow">continue</span> 3;</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;                        }</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;                    }</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;                    $i++;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;                }</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;                <span class="keywordflow">continue</span> 2;</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;            }       </div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;        }</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;        $i++;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    }</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    <span class="keywordflow">if</span>($last &lt; $slen)</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;        array_push($out, substr($sql, $last, $slen - $last));</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    <span class="keywordflow">return</span> $out;</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;}</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;<span class="comment">//function to scan entire directory tree and subdirectories</span></div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;<span class="keyword">function</span> dir_tree($dir)</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;{</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    $path = <span class="stringliteral">&#39;&#39;</span>;</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    $stack[] = $dir;</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    <span class="keywordflow">while</span>($stack)</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    {</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;        $thisdir = array_pop($stack);</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;        <span class="keywordflow">if</span>($dircont = scandir($thisdir))</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;        {</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;            $i=0;</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;            <span class="keywordflow">while</span>(isset($dircont[$i]))</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;            {</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;                <span class="keywordflow">if</span>($dircont[$i] !== <span class="charliteral">&#39;.&#39;</span> &amp;&amp; $dircont[$i] !== <span class="stringliteral">&#39;..&#39;</span>)</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;                {</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;                    $current_file = $thisdir.DIRECTORY_SEPARATOR.$dircont[$i];</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;                    <span class="keywordflow">if</span>(is_file($current_file))</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;                    {</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;                        $path[] = $thisdir.DIRECTORY_SEPARATOR.$dircont[$i];</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;                    }</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;                    elseif (is_dir($current_file))</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;                    {</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;                        $path[] = $thisdir.DIRECTORY_SEPARATOR.$dircont[$i];</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;                        $stack[] = $current_file;</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;                    }</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;                }</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;                $i++;</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;            }</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;        }</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    }</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    <span class="keywordflow">return</span> $path;</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;}</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;<span class="comment">//the function echo the help [?] links to the documentation</span></div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;<span class="keyword">function</span> helpLink($name)</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;{</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    global $lang;</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;&lt;a href=&#39;?help=1&#39; onclick=&#39;openHelp(\&quot;&quot;</span>.$name.<span class="stringliteral">&quot;\&quot;); return false;&#39; class=&#39;helpq&#39; title=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;help&#39;</span>].<span class="stringliteral">&quot;: &quot;</span>.$name.<span class="stringliteral">&quot;&#39; target=&#39;_blank&#39;&gt;&lt;span&gt;[?]&lt;/span&gt;&lt;/a&gt;&quot;</span>;    </div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;}</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="comment">// function to encode value into HTML just like htmlentities, but with adjusted default settings</span></div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="keyword">function</span> htmlencode($value, $flags=ENT_QUOTES, $encoding =<span class="stringliteral">&quot;UTF-8&quot;</span>)</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;{</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    <span class="keywordflow">return</span> htmlentities($value, $flags, $encoding);</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;}</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;<span class="comment">// 22 August 2011: gkf added this function to support display of</span></div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;<span class="comment">//                 default values in the form used to INSERT new data.</span></div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;<span class="keyword">function</span> deQuoteSQL($s)</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;{</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    <span class="keywordflow">return</span> trim(trim($s), <span class="stringliteral">&quot;&#39;&quot;</span>);</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;}</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;<span class="comment">// reduce string chars</span></div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;<span class="keyword">function</span> subString($str)</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;{</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    global $charsNum;</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    <span class="keywordflow">if</span>($charsNum &gt; 10 &amp;&amp; !$_SESSION[COOKIENAME.<span class="stringliteral">&#39;fulltexts&#39;</span>] &amp;&amp; strlen($str)&gt;$charsNum)</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    {</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        $str = substr($str, 0, $charsNum).<span class="stringliteral">&#39;...&#39;</span>;</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    }</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    <span class="keywordflow">return</span> $str;</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;}</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;<span class="comment">// checks the (new) name of a database file  </span></div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;<span class="keyword">function</span> checkDbName($name)</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;{</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    global $allowed_extensions;</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    $info = pathinfo($name);</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    <span class="keywordflow">if</span>(isset($info[<span class="stringliteral">&#39;extension&#39;</span>]) &amp;&amp; !in_array($info[<span class="stringliteral">&#39;extension&#39;</span>], $allowed_extensions))</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    {</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    } <span class="keywordflow">else</span></div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    {</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;        <span class="keywordflow">return</span> (!is_file($name) &amp;&amp; !is_dir($name));</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    }</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;}</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;<span class="comment">// check whether a path is a db managed by this tool</span></div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;<span class="comment">// requires that $databases is already filled!</span></div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;<span class="comment">// returns the key of the db if managed, false otherwise.</span></div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;<span class="keyword">function</span> isManagedDB($path)</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;{</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    global $databases;</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    <span class="keywordflow">foreach</span>($databases as $db_key =&gt; $database)</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    {</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;        <span class="keywordflow">if</span>($path == $database[<span class="stringliteral">&#39;path&#39;</span>])</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;        {</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;            <span class="comment">// a db we manage. Thats okay.</span></div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;            <span class="comment">// return the key.</span></div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;            <span class="keywordflow">return</span> $db_key;</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;        }</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    }</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    <span class="comment">// not a db we manage!</span></div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;}</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;<span class="comment">// from a typename of a colun, get the type of the column&#39;s affinty</span></div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;<span class="comment">// see http://www.sqlite.org/datatype3.html section 2.1 for rules</span></div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;<span class="keyword">function</span> get_type_affinity($type)</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;{</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&quot;/INT/i&quot;</span>, $type))</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;INTEGER&quot;</span>;</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&quot;/(?:CHAR|CLOB|TEXT)/i&quot;</span>, $type))</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;TEXT&quot;</span>;</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&quot;/BLOB/i&quot;</span>, $type) || $type==<span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;NONE&quot;</span>;</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&quot;/(?:REAL|FLOA|DOUB)/i&quot;</span>, $type))</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;REAL&quot;</span>;</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;NUMERIC&quot;</span>;</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;}</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;<span class="comment">//- Check user authentication, login and logout</span></div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;$auth = <span class="keyword">new</span> Authorization(); <span class="comment">//create authorization object</span></div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;<span class="comment">// check if user has attempted to log out</span></div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;<span class="keywordflow">if</span> (isset($_POST[<span class="stringliteral">&#39;logout&#39;</span>]))</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    $auth-&gt;revoke();</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;<span class="comment">// check if user has attempted to log in</span></div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;<span class="keywordflow">else</span> <span class="keywordflow">if</span> (isset($_POST[<span class="stringliteral">&#39;login&#39;</span>]) &amp;&amp; isset($_POST[<span class="stringliteral">&#39;password&#39;</span>]))</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    $auth-&gt;attemptGrant($_POST[<span class="stringliteral">&#39;password&#39;</span>], isset($_POST[<span class="stringliteral">&#39;remember&#39;</span>]));</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;<span class="comment">//- Actions on database files and bulk data</span></div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;<span class="keywordflow">if</span> ($auth-&gt;isAuthorized())</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;{</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    <span class="comment">//- Create a new database</span></div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    <span class="keywordflow">if</span>(isset($_POST[<span class="stringliteral">&#39;new_dbname&#39;</span>]))</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    {</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;        <span class="keywordflow">if</span>($_POST[<span class="stringliteral">&#39;new_dbname&#39;</span>]==<span class="stringliteral">&#39;&#39;</span>)</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;        {</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;            <span class="comment">// TODO: Display an error message (do NOT echo here. echo below in the html-body!)</span></div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;        }</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;        {</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;            $str = preg_replace(<span class="stringliteral">&#39;@[^\w-.]@&#39;</span>,<span class="stringliteral">&#39;&#39;</span>, $_POST[<span class="stringliteral">&#39;new_dbname&#39;</span>]);</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;            $dbname = $str;</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;            $dbpath = $str;</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;            <span class="keywordflow">if</span>(checkDbName($dbname))</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;            {</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;                $tdata = array();   </div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;                $tdata[<span class="stringliteral">&#39;name&#39;</span>] = $dbname;</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;                $tdata[<span class="stringliteral">&#39;path&#39;</span>] = $directory.DIRECTORY_SEPARATOR.$dbpath;</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;                $td = <span class="keyword">new</span> Database($tdata);</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;                $td-&gt;query(<span class="stringliteral">&quot;VACUUM&quot;</span>);</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;            } <span class="keywordflow">else</span></div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;            {</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;                <span class="keywordflow">if</span>(is_file($dbname) || is_dir($dbname)) $dbexists = <span class="keyword">true</span>;</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;                <span class="keywordflow">else</span> $extension_not_allowed=<span class="keyword">true</span>;</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;            }</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;        }</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    }</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    </div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    <span class="comment">//- Scan a directory for databases</span></div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    <span class="keywordflow">if</span>($directory!==<span class="keyword">false</span>)</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    {</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;        <span class="keywordflow">if</span>($directory[strlen($directory)-1]==DIRECTORY_SEPARATOR) <span class="comment">//if user has a trailing slash in the directory, remove it</span></div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;            $directory = substr($directory, 0, strlen($directory)-1);</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;            </div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;        <span class="keywordflow">if</span>(is_dir($directory)) <span class="comment">//make sure the directory is valid</span></div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;        {</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;            <span class="keywordflow">if</span>($subdirectories===<span class="keyword">true</span>)</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;                $arr = dir_tree($directory);</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;                $arr = scandir($directory);</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;            $databases = array();</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;            $j = 0;</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;            <span class="keywordflow">for</span>($i=0; $i&lt;<span class="keyword">sizeof</span>($arr); $i++) <span class="comment">//iterate through all the files in the databases</span></div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;            {</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;                <span class="keywordflow">if</span>($subdirectories===<span class="keyword">false</span>)</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;                    $arr[$i] = $directory.DIRECTORY_SEPARATOR.$arr[$i];</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;                </div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;                <span class="keywordflow">if</span>(@!is_file($arr[$i])) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;                $con = file_get_contents($arr[$i], NULL, NULL, 0, 60);</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;                <span class="keywordflow">if</span>(strpos($con, <span class="stringliteral">&quot;** This file contains an SQLite 2.1 database **&quot;</span>, 0)!==<span class="keyword">false</span> || strpos($con, <span class="stringliteral">&quot;SQLite format 3&quot;</span>, 0)!==<span class="keyword">false</span>)</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;                {</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;                    $databases[$j][<span class="stringliteral">&#39;path&#39;</span>] = $arr[$i];</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;                    <span class="keywordflow">if</span>($subdirectories===<span class="keyword">false</span>)</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;                        $databases[$j][<span class="stringliteral">&#39;name&#39;</span>] = basename($arr[$i]);</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;                    <span class="keywordflow">else</span></div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;                        $databases[$j][<span class="stringliteral">&#39;name&#39;</span>] = $arr[$i];</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;                    $databases[$j][<span class="stringliteral">&#39;writable&#39;</span>] = is_writable($databases[$j][<span class="stringliteral">&#39;path&#39;</span>]);</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;                    $databases[$j][<span class="stringliteral">&#39;writable_dir&#39;</span>] = is_writable(dirname($databases[$j][<span class="stringliteral">&#39;path&#39;</span>]));</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;                    $databases[$j][<span class="stringliteral">&#39;readable&#39;</span>] = is_readable($databases[$j][<span class="stringliteral">&#39;path&#39;</span>]);</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;                    $j++;</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;                }</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;            }</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;            <span class="comment">// 22 August 2011: gkf fixed bug #50.</span></div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;            sort($databases);</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;            <span class="keywordflow">if</span>(isset($tdata))</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;            {</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;                <span class="keywordflow">foreach</span>($databases as $db_id =&gt; $database)</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;                {</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;                    <span class="keywordflow">if</span>($database[<span class="stringliteral">&#39;path&#39;</span>] == $tdata[<span class="stringliteral">&#39;path&#39;</span>])</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;                    {</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;                        $_SESSION[COOKIENAME.<span class="stringliteral">&#39;currentDB&#39;</span>] = $database;</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;                    }</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;                }</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;            }</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;        }</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;        <span class="keywordflow">else</span> <span class="comment">//the directory is not valid - display error and exit</span></div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;        {</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;            echo <span class="stringliteral">&quot;&lt;div class=&#39;confirm&#39; style=&#39;margin:20px;&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;not_dir&#39;</span>].<span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;            exit();</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;        }</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;    }</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    {</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;        <span class="keywordflow">for</span>($i=0; $i&lt;<span class="keyword">sizeof</span>($databases); $i++)</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;        {</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;            <span class="keywordflow">if</span>(!file_exists($databases[$i][<span class="stringliteral">&#39;path&#39;</span>]))</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;                <span class="keywordflow">continue</span>; <span class="comment">//skip if file not found ! - probably a warning can be displayed - later</span></div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;            $databases[$i][<span class="stringliteral">&#39;writable&#39;</span>] = is_writable($databases[$i][<span class="stringliteral">&#39;path&#39;</span>]);</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;            $databases[$i][<span class="stringliteral">&#39;writable_dir&#39;</span>] = is_writable(dirname($databases[$i][<span class="stringliteral">&#39;path&#39;</span>]));</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;            $databases[$i][<span class="stringliteral">&#39;readable&#39;</span>] = is_readable($databases[$i][<span class="stringliteral">&#39;path&#39;</span>]);</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;        }</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;        sort($databases);</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;    }</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;    <span class="comment">// we now have the $databases array set. Check whethet currentDB is a managed Db (is in this array)</span></div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    <span class="keywordflow">if</span>(isset($_SESSION[COOKIENAME.<span class="stringliteral">&#39;currentDB&#39;</span>]) &amp;&amp; isManagedDB($_SESSION[COOKIENAME.<span class="stringliteral">&#39;currentDB&#39;</span>][<span class="stringliteral">&#39;path&#39;</span>]) === <span class="keyword">false</span>)</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;        unset($_SESSION[COOKIENAME.<span class="stringliteral">&#39;currentDB&#39;</span>]);</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    </div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    <span class="comment">//- Delete an existing database</span></div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    <span class="keywordflow">if</span>(isset($_GET[<span class="stringliteral">&#39;database_delete&#39;</span>]))</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    {</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;        $dbpath = $_POST[<span class="stringliteral">&#39;database_delete&#39;</span>];</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;        <span class="comment">// check whether $dbpath really is a db we manage</span></div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;        $checkDB = isManagedDB($dbpath);</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;        <span class="keywordflow">if</span>($checkDB !== <span class="keyword">false</span>)</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;        {</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;            unlink($dbpath);</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;            unset($_SESSION[COOKIENAME.<span class="stringliteral">&#39;currentDB&#39;</span>]);</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;            unset($databases[$checkDB]);</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;        } <span class="keywordflow">else</span> die($lang[<span class="stringliteral">&#39;err&#39;</span>].<span class="stringliteral">&#39;: &#39;</span>.$lang[<span class="stringliteral">&#39;delete_only_managed&#39;</span>]);</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    }</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    </div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    <span class="comment">//- Rename an existing database</span></div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    <span class="keywordflow">if</span>(isset($_GET[<span class="stringliteral">&#39;database_rename&#39;</span>]))</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;    {</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;        $oldpath = $_POST[<span class="stringliteral">&#39;oldname&#39;</span>];</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;        $newpath = $_POST[<span class="stringliteral">&#39;newname&#39;</span>];</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;        $oldpath_parts = pathinfo($oldpath);</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;        $newpath_parts = pathinfo($newpath);</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;        <span class="comment">// only rename?</span></div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;        $newpath = $oldpath_parts[<span class="stringliteral">&#39;dirname&#39;</span>].DIRECTORY_SEPARATOR.basename($_POST[<span class="stringliteral">&#39;newname&#39;</span>]);</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;        <span class="keywordflow">if</span>($newpath != $_POST[<span class="stringliteral">&#39;newname&#39;</span>] &amp;&amp; $subdirectories)</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;        {</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;            <span class="comment">// it seems that the file should not only be renamed but additionally moved.</span></div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;            <span class="comment">// we need to make sure it stays within $directory...</span></div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;            $new_realpath = realpath($newpath_parts[<span class="stringliteral">&#39;dirname&#39;</span>]).DIRECTORY_SEPARATOR;</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;            $directory_realpath = realpath($directory).DIRECTORY_SEPARATOR;</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;            <span class="keywordflow">if</span>(strpos($new_realpath, $directory_realpath)===0)</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;            {</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;                <span class="comment">// its okay, the new directory is within $directory</span></div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;                $newpath =  $_POST[<span class="stringliteral">&#39;newname&#39;</span>];</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;            }</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;            <span class="keywordflow">else</span> die($lang[<span class="stringliteral">&#39;err&#39;</span>].<span class="stringliteral">&#39;: &#39;</span>.$lang[<span class="stringliteral">&#39;db_moved_outside&#39;</span>]);</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;        }</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;        </div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;        <span class="keywordflow">if</span>(checkDbName($newpath))</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;        {</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;            $checkDB = isManagedDB($oldpath);</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;            <span class="keywordflow">if</span>($checkDB !==<span class="keyword">false</span> )</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;            {</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;                rename($oldpath, $newpath);</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;                $databases[$checkDB][<span class="stringliteral">&#39;path&#39;</span>] = $newpath;</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;                $databases[$checkDB][<span class="stringliteral">&#39;name&#39;</span>] = basename($newpath);</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;                $_SESSION[COOKIENAME.<span class="stringliteral">&#39;currentDB&#39;</span>] = $databases[$checkDB]; </div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;                $justrenamed = <span class="keyword">true</span>;</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;            }</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;            <span class="keywordflow">else</span> die($lang[<span class="stringliteral">&#39;err&#39;</span>].<span class="stringliteral">&#39;: &#39;</span>.$lang[<span class="stringliteral">&#39;rename_only_managed&#39;</span>]);</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;        }</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;        {</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;            <span class="keywordflow">if</span>(is_file($newpath) || is_dir($newpath)) $dbexists = <span class="keyword">true</span>;</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;            <span class="keywordflow">else</span> $extension_not_allowed = <span class="keyword">true</span>; </div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;        }</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    }</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    </div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    <span class="comment">//- Export (download a dump) an existing database</span></div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    <span class="keywordflow">if</span>(isset($_POST[<span class="stringliteral">&#39;export&#39;</span>]))</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;    {</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;        $export_filename = str_replace(array(<span class="stringliteral">&quot;\r&quot;</span>, <span class="stringliteral">&quot;\n&quot;</span>), <span class="stringliteral">&#39;&#39;</span>,$_POST[<span class="stringliteral">&#39;filename&#39;</span>]); <span class="comment">// against http header injection (php &lt; 5.1.2 only)</span></div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;        <span class="keywordflow">if</span>($_POST[<span class="stringliteral">&#39;export_type&#39;</span>]==<span class="stringliteral">&quot;sql&quot;</span>)</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;        {</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;            header(<span class="stringliteral">&#39;Content-Type: text/sql&#39;</span>);</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;            header(<span class="stringliteral">&#39;Content-Disposition: attachment; filename=&quot;&#39;</span>.$export_filename.<span class="charliteral">&#39;.&#39;</span>.$_POST[<span class="stringliteral">&#39;export_type&#39;</span>].<span class="stringliteral">&#39;&quot;;&#39;</span>);</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;            <span class="keywordflow">if</span>(isset($_POST[<span class="stringliteral">&#39;tables&#39;</span>]))</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;                $tables = $_POST[<span class="stringliteral">&#39;tables&#39;</span>];</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;            {</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;                $tables = array();</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;                $tables[0] = $_POST[<span class="stringliteral">&#39;single_table&#39;</span>];</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;            }</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;            $drop = isset($_POST[<span class="stringliteral">&#39;drop&#39;</span>]);</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;            $structure = isset($_POST[<span class="stringliteral">&#39;structure&#39;</span>]);</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;            $data = isset($_POST[<span class="stringliteral">&#39;data&#39;</span>]);</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;            $transaction = isset($_POST[<span class="stringliteral">&#39;transaction&#39;</span>]);</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;            $comments = isset($_POST[<span class="stringliteral">&#39;comments&#39;</span>]);</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;            <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a> = <span class="keyword">new</span> Database($_SESSION[COOKIENAME.<span class="stringliteral">&#39;currentDB&#39;</span>]);</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;            echo <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;export_sql($tables, $drop, $structure, $data, $transaction, $comments);</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;        }</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>($_POST[<span class="stringliteral">&#39;export_type&#39;</span>]==<span class="stringliteral">&quot;csv&quot;</span>)</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;        {</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;            header(<span class="stringliteral">&quot;Content-type: application/csv&quot;</span>);</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;            header(<span class="stringliteral">&#39;Content-Disposition: attachment; filename=&quot;&#39;</span>.$export_filename.<span class="charliteral">&#39;.&#39;</span>.$_POST[<span class="stringliteral">&#39;export_type&#39;</span>].<span class="stringliteral">&#39;&quot;;&#39;</span>);</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;            header(<span class="stringliteral">&quot;Pragma: no-cache&quot;</span>);</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;            header(<span class="stringliteral">&quot;Expires: 0&quot;</span>);</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;            <span class="keywordflow">if</span>(isset($_POST[<span class="stringliteral">&#39;tables&#39;</span>]))</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;                $tables = $_POST[<span class="stringliteral">&#39;tables&#39;</span>];</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;            {</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;                $tables = array();</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;                $tables[0] = $_POST[<span class="stringliteral">&#39;single_table&#39;</span>];</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;            }</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;            $field_terminate = $_POST[<span class="stringliteral">&#39;export_csv_fieldsterminated&#39;</span>];</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;            $field_enclosed = $_POST[<span class="stringliteral">&#39;export_csv_fieldsenclosed&#39;</span>];</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;            $field_escaped = $_POST[<span class="stringliteral">&#39;export_csv_fieldsescaped&#39;</span>];</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;            $null = $_POST[<span class="stringliteral">&#39;export_csv_replacenull&#39;</span>];</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;            $crlf = isset($_POST[<span class="stringliteral">&#39;export_csv_crlf&#39;</span>]);</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;            $fields_in_first_row = isset($_POST[<span class="stringliteral">&#39;export_csv_fieldnames&#39;</span>]);</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;            <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a> = <span class="keyword">new</span> Database($_SESSION[COOKIENAME.<span class="stringliteral">&#39;currentDB&#39;</span>]);</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;            echo <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;export_csv($tables, $field_terminate, $field_enclosed, $field_escaped, $null, $crlf, $fields_in_first_row);</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;        }</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;        exit();</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    }</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;    </div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    <span class="comment">//- Import a file into an existing database</span></div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    <span class="keywordflow">if</span>(isset($_POST[<span class="stringliteral">&#39;import&#39;</span>]))</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;    {</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;        <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a> = <span class="keyword">new</span> Database($_SESSION[COOKIENAME.<span class="stringliteral">&#39;currentDB&#39;</span>]);</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;        <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;registerUserFunction($custom_functions);</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;        <span class="keywordflow">if</span>($_POST[<span class="stringliteral">&#39;import_type&#39;</span>]==<span class="stringliteral">&quot;sql&quot;</span>)</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;        {</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;            $data = file_get_contents($_FILES[<span class="stringliteral">&quot;file&quot;</span>][<span class="stringliteral">&quot;tmp_name&quot;</span>]);</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;            $importSuccess = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;import_sql($data);</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;        }</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;        {</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;            $field_terminate = $_POST[<span class="stringliteral">&#39;import_csv_fieldsterminated&#39;</span>];</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;            $field_enclosed = $_POST[<span class="stringliteral">&#39;import_csv_fieldsenclosed&#39;</span>];</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;            $field_escaped = $_POST[<span class="stringliteral">&#39;import_csv_fieldsescaped&#39;</span>];</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;            $null = $_POST[<span class="stringliteral">&#39;import_csv_replacenull&#39;</span>];</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;            $fields_in_first_row = isset($_POST[<span class="stringliteral">&#39;import_csv_fieldnames&#39;</span>]);</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;            $importSuccess = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;import_csv($_FILES[<span class="stringliteral">&quot;file&quot;</span>][<span class="stringliteral">&quot;tmp_name&quot;</span>], $_POST[<span class="stringliteral">&#39;single_table&#39;</span>], $field_terminate, $field_enclosed, $field_escaped, $null, $fields_in_first_row);</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;        }</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    }</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;    <span class="comment">//- Download (backup) a database file (as SQLite file, not as dump)</span></div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;    <span class="keywordflow">if</span>(isset($_GET[<span class="stringliteral">&#39;download&#39;</span>]) &amp;&amp; isManagedDB($_GET[<span class="stringliteral">&#39;download&#39;</span>])!==<span class="keyword">false</span>)</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;    {</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;        header(<span class="stringliteral">&quot;Content-type: application/octet-stream&quot;</span>);</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;        header(<span class="stringliteral">&#39;Content-Disposition: attachment; filename=&quot;&#39;</span>.basename($_GET[<span class="stringliteral">&#39;download&#39;</span>]).<span class="stringliteral">&#39;&quot;;&#39;</span>);</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;        header(<span class="stringliteral">&quot;Pragma: no-cache&quot;</span>);</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;        header(<span class="stringliteral">&quot;Expires: 0&quot;</span>);</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;        readfile($_GET[<span class="stringliteral">&#39;download&#39;</span>]);</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;        exit;</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;    }</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;}</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;<span class="comment">//- HTML: output starts here</span></div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;header(<span class="stringliteral">&#39;Content-Type: text/html; charset=utf-8&#39;</span>);</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;?&gt;</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;&lt;!DOCTYPE html PUBLIC <span class="stringliteral">&quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;</span> <span class="stringliteral">&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;</span>&gt;</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;&lt;html xmlns=<span class="stringliteral">&quot;http://www.w3.org/1999/xhtml&quot;</span> xml:lang=<span class="stringliteral">&quot;en&quot;</span> lang=<span class="stringliteral">&quot;en&quot;</span>&gt;</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;&lt;head&gt;</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;&lt;!-- Copyright &lt;?php echo date(<span class="stringliteral">&quot;Y&quot;</span>).<span class="charliteral">&#39; &#39;</span>.PROJECT.<span class="stringliteral">&#39; (&#39;</span>.PROJECT_URL.<span class="charliteral">&#39;)&#39;</span>; ?&gt; --&gt;</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;&lt;meta http-equiv=<span class="stringliteral">&#39;Content-Type&#39;</span> content=<span class="stringliteral">&#39;text/html; charset=UTF-8&#39;</span> /&gt;</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;&lt;link rel=<span class="stringliteral">&quot;shortcut icon&quot;</span> href=<span class="stringliteral">&quot;?resource=favicon&quot;</span> /&gt;</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;&lt;title&gt;&lt;?php echo PROJECT ?&gt;&lt;/title&gt;</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;&lt;?php</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;<span class="comment">//- HTML: css/theme include</span></div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;<span class="keywordflow">if</span>(isset($_GET[<span class="stringliteral">&#39;theme&#39;</span>])) $theme = basename($_GET[<span class="stringliteral">&#39;theme&#39;</span>]);</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;<span class="comment">// allow themes to be dropped in subfolder &quot;themes&quot;</span></div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;<span class="keywordflow">if</span>(is_file(<span class="stringliteral">&#39;themes/&#39;</span>.$theme)) $theme = <span class="stringliteral">&#39;themes/&#39;</span>.$theme;</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;<span class="keywordflow">if</span> (file_exists($theme))</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;    <span class="comment">// an external stylesheet exists - import it</span></div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;    echo <span class="stringliteral">&quot;&lt;link href=&#39;{$theme}&#39; rel=&#39;stylesheet&#39; type=&#39;text/css&#39; /&gt;&quot;</span>, PHP_EOL;</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;<span class="keywordflow">else</span></div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;    <span class="comment">// only use the default stylesheet if an external one does not exist</span></div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;    echo <span class="stringliteral">&quot;&lt;link href=&#39;?resource=css&#39; rel=&#39;stylesheet&#39; type=&#39;text/css&#39; /&gt;&quot;</span>, PHP_EOL;</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;<span class="comment">// HTML: output help text, then exit</span></div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;<span class="keywordflow">if</span>(isset($_GET[<span class="stringliteral">&#39;help&#39;</span>]))</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;{</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    <span class="comment">//help section array</span></div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;    $help = array</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;    (</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;        $lang[<span class="stringliteral">&#39;help1&#39;</span>] =&gt; sprintf($lang[<span class="stringliteral">&#39;help1_x&#39;</span>], PROJECT, PROJECT, PROJECT), $lang[<span class="stringliteral">&#39;help2&#39;</span>] =&gt; $lang[<span class="stringliteral">&#39;help2_x&#39;</span>], $lang[<span class="stringliteral">&#39;help3&#39;</span>] =&gt; $lang[<span class="stringliteral">&#39;help3_x&#39;</span>], </div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;        $lang[<span class="stringliteral">&#39;help4&#39;</span>] =&gt; $lang[<span class="stringliteral">&#39;help4_x&#39;</span>], $lang[<span class="stringliteral">&#39;help5&#39;</span>] =&gt; $lang[<span class="stringliteral">&#39;help5_x&#39;</span>], $lang[<span class="stringliteral">&#39;help6&#39;</span>] =&gt; $lang[<span class="stringliteral">&#39;help6_x&#39;</span>],</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;        $lang[<span class="stringliteral">&#39;help7&#39;</span>] =&gt; $lang[<span class="stringliteral">&#39;help7_x&#39;</span>], $lang[<span class="stringliteral">&#39;help8&#39;</span>] =&gt; $lang[<span class="stringliteral">&#39;help8_x&#39;</span>], $lang[<span class="stringliteral">&#39;help9&#39;</span>] =&gt; $lang[<span class="stringliteral">&#39;help9_x&#39;</span>]</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;    );</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;    ?&gt;</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;    &lt;/head&gt;</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    &lt;body style=<span class="stringliteral">&quot;direction:&lt;?php echo $lang[&#39;direction&#39;]; ?&gt;;&quot;</span>&gt;</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;    &lt;div <span class="keywordtype">id</span>=<span class="stringliteral">&#39;help_container&#39;</span>&gt;</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;    &lt;?php</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;    echo <span class="stringliteral">&quot;&lt;div class=&#39;help_list&#39;&gt;&quot;</span>;</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;    echo <span class="stringliteral">&quot;&lt;span style=&#39;font-size:18px;&#39;&gt;&quot;</span>.PROJECT.<span class="stringliteral">&quot; v&quot;</span>.VERSION.<span class="stringliteral">&quot; &quot;</span>.$lang[<span class="stringliteral">&#39;help_doc&#39;</span>].<span class="stringliteral">&quot;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;    <span class="keywordflow">foreach</span>((array)$help as $key =&gt; $val)</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;    {</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;        echo <span class="stringliteral">&quot;&lt;a href=&#39;#&quot;</span>.$key.<span class="stringliteral">&quot;&#39;&gt;&quot;</span>.$key.<span class="stringliteral">&quot;&lt;/a&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    }</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;    echo <span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;    echo <span class="stringliteral">&quot;&lt;br/&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;    <span class="keywordflow">foreach</span>((array)$help as $key =&gt; $val)</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;    {</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;        echo <span class="stringliteral">&quot;&lt;div class=&#39;help_outer&#39;&gt;&quot;</span>;</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;        echo <span class="stringliteral">&quot;&lt;a class=&#39;headd&#39; name=&#39;&quot;</span>.$key.<span class="stringliteral">&quot;&#39;&gt;&quot;</span>.$key.<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;        echo <span class="stringliteral">&quot;&lt;div class=&#39;help_inner&#39;&gt;&quot;</span>;</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;        echo $val;</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;        echo <span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;        echo <span class="stringliteral">&quot;&lt;a class=&#39;help_top&#39; href=&#39;#top&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;back_top&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>; </div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;        echo <span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;    }</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;    ?&gt;</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    &lt;/div&gt;</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;    &lt;/body&gt;</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;    &lt;/html&gt;</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;    &lt;?php</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;    exit();     </div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;}</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;<span class="comment">//- Javascript include</span></div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;?&gt;</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;&lt;!-- JavaScript Support --&gt;</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;&lt;script type=<span class="stringliteral">&#39;text/javascript&#39;</span> src=<span class="stringliteral">&#39;?resource=javascript&#39;</span>&gt;&lt;/script&gt;</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;&lt;/head&gt;</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;&lt;body style=<span class="stringliteral">&quot;direction:&lt;?php echo $lang[&#39;direction&#39;]; ?&gt;;&quot;</span>&gt;</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;&lt;?php</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;<span class="keywordflow">if</span>(ini_get(<span class="stringliteral">&quot;register_globals&quot;</span>) == <span class="stringliteral">&quot;on&quot;</span> || ini_get(<span class="stringliteral">&quot;register_globals&quot;</span>)==<span class="stringliteral">&quot;1&quot;</span>) <span class="comment">//check whether register_globals is turned on - if it is, we need to not continue</span></div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;{</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;    echo <span class="stringliteral">&quot;&lt;div class=&#39;confirm&#39; style=&#39;margin:20px;&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;bad_php_directive&#39;</span>].<span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;    echo <span class="stringliteral">&quot;&lt;/body&gt;&lt;/html&gt;&quot;</span>;</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;    exit();</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;}</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;<span class="comment">//- HTML: login screen if not authorized, exit</span></div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;<span class="keywordflow">if</span>(!$auth-&gt;isAuthorized())</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;{</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;    echo <span class="stringliteral">&quot;&lt;div id=&#39;loginBox&#39;&gt;&quot;</span>;</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;    echo <span class="stringliteral">&quot;&lt;h1&gt;&lt;span id=&#39;logo&#39;&gt;&quot;</span>.PROJECT.<span class="stringliteral">&quot;&lt;/span&gt; &lt;span id=&#39;version&#39;&gt;v&quot;</span>.VERSION.<span class="stringliteral">&quot;&lt;/span&gt;&lt;/h1&gt;&quot;</span>;</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;    echo <span class="stringliteral">&quot;&lt;div style=&#39;padding:15px; text-align:center;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;    <span class="keywordflow">if</span> ($auth-&gt;isFailedLogin())</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;        echo <span class="stringliteral">&quot;&lt;span class=&#39;warning&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;passwd_incorrect&#39;</span>].<span class="stringliteral">&quot;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;    echo <span class="stringliteral">&quot;&lt;form action=&#39;&quot;</span>.PAGE.<span class="stringliteral">&quot;&#39; method=&#39;post&#39;&gt;&quot;</span>;</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;    echo $lang[<span class="stringliteral">&#39;passwd&#39;</span>].<span class="stringliteral">&quot;: &lt;input type=&#39;password&#39; name=&#39;password&#39;/&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;    echo <span class="stringliteral">&quot;&lt;label&gt;&lt;input type=&#39;checkbox&#39; name=&#39;remember&#39; value=&#39;yes&#39; checked=&#39;checked&#39;/&gt; &quot;</span>.$lang[<span class="stringliteral">&#39;remember&#39;</span>].<span class="stringliteral">&quot;&lt;/label&gt;&lt;br/&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;    echo <span class="stringliteral">&quot;&lt;input type=&#39;submit&#39; value=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;login&#39;</span>].<span class="stringliteral">&quot;&#39; class=&#39;btn&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;    echo <span class="stringliteral">&quot;&lt;input type=&#39;hidden&#39; name=&#39;login&#39; value=&#39;true&#39; /&gt;&quot;</span>;</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;    echo <span class="stringliteral">&quot;&lt;/form&gt;&quot;</span>;</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;    echo <span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;    echo <span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;    echo <span class="stringliteral">&quot;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;    echo <span class="stringliteral">&quot;&lt;div style=&#39;text-align:center;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;    echo <span class="stringliteral">&quot;&lt;span style=&#39;font-size:11px;&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;powered&#39;</span>].<span class="stringliteral">&quot; &lt;a href=&#39;&quot;</span>.PROJECT_URL.<span class="stringliteral">&quot;&#39; target=&#39;_blank&#39; style=&#39;font-size:11px;&#39;&gt;&quot;</span>.PROJECT.<span class="stringliteral">&quot;&lt;/a&gt; | &quot;</span>; </div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;    printf($lang[<span class="stringliteral">&#39;page_gen&#39;</span>], $pageTimer);</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;    echo <span class="stringliteral">&quot;&lt;/span&gt;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;    echo <span class="stringliteral">&quot;&lt;/body&gt;&lt;/html&gt;&quot;</span>;</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;    exit();</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;}</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;<span class="comment">//- User is authorized, display the main application</span></div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;<span class="comment">//- Select database (from session or first available)</span></div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;<span class="keywordflow">if</span>(!isset($_SESSION[COOKIENAME.<span class="stringliteral">&#39;currentDB&#39;</span>]) &amp;&amp; count($databases)&gt;0)</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;{</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;    <span class="comment">//set the current database to the first existing one in the array (default)</span></div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;    $_SESSION[COOKIENAME.<span class="stringliteral">&#39;currentDB&#39;</span>] = reset($databases);</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;}</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;<span class="keywordflow">if</span>(<span class="keyword">sizeof</span>($databases)&gt;0)</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;    $currentDB = $_SESSION[COOKIENAME.<span class="stringliteral">&#39;currentDB&#39;</span>];</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;<span class="keywordflow">else</span> <span class="comment">// the database array is empty, offer to create a new database</span></div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;{</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;    <span class="comment">//- HTML: form to create a new database, exit</span></div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;    <span class="keywordflow">if</span>($directory!==<span class="keyword">false</span> &amp;&amp; is_writable($directory))</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;    {</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;        echo <span class="stringliteral">&quot;&lt;div class=&#39;confirm&#39; style=&#39;margin:20px;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;        printf($lang[<span class="stringliteral">&#39;no_db&#39;</span>], PROJECT, PROJECT);</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;        echo <span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;  </div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;        <span class="keywordflow">if</span>(isset($extension_not_allowed))</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;        {</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;            echo <span class="stringliteral">&quot;&lt;div class=&#39;confirm&#39; style=&#39;margin:10px 20px;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;            echo $lang[<span class="stringliteral">&#39;err&#39;</span>].<span class="stringliteral">&#39;: &#39;</span>.$lang[<span class="stringliteral">&#39;extension_not_allowed&#39;</span>].<span class="stringliteral">&#39;: &#39;</span>;</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;            echo implode(<span class="stringliteral">&#39;, &#39;</span>, array_map(<span class="stringliteral">&#39;htmlencode&#39;</span>, $allowed_extensions));</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;            echo <span class="stringliteral">&#39;&lt;br /&gt;&#39;</span>.$lang[<span class="stringliteral">&#39;add_allowed_extension&#39;</span>];</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;            echo <span class="stringliteral">&quot;&lt;/div&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;        }           </div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;        echo <span class="stringliteral">&quot;&lt;fieldset style=&#39;margin:15px;&#39;&gt;&lt;legend&gt;&lt;b&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;db_create&#39;</span>].<span class="stringliteral">&quot;&lt;/b&gt;&lt;/legend&gt;&quot;</span>;</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;        echo <span class="stringliteral">&quot;&lt;form name=&#39;create_database&#39; method=&#39;post&#39; action=&#39;&quot;</span>.PAGE.<span class="stringliteral">&quot;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;        echo <span class="stringliteral">&quot;&lt;input type=&#39;text&#39; name=&#39;new_dbname&#39; style=&#39;width:150px;&#39;/&gt; &lt;input type=&#39;submit&#39; value=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;create&#39;</span>].<span class="stringliteral">&quot;&#39; class=&#39;btn&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;        echo <span class="stringliteral">&quot;&lt;/form&gt;&quot;</span>;</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;        echo <span class="stringliteral">&quot;&lt;/fieldset&gt;&quot;</span>;</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;    }</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;    {</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;        echo <span class="stringliteral">&quot;&lt;div class=&#39;confirm&#39; style=&#39;margin:20px;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;        echo $lang[<span class="stringliteral">&#39;err&#39;</span>].<span class="stringliteral">&quot;: &quot;</span>.sprintf($lang[<span class="stringliteral">&#39;no_db2&#39;</span>], PROJECT);</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;        echo <span class="stringliteral">&quot;&lt;/div&gt;&lt;br/&gt;&quot;</span>; </div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;    }</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;    exit();</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;}</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;<span class="comment">//- Switch to a different database with drop-down menu</span></div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;<span class="keywordflow">if</span>(isset($_POST[<span class="stringliteral">&#39;database_switch&#39;</span>]))</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;{</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;    <span class="keywordflow">foreach</span>($databases as $db_id =&gt; $database)</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    {</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;        <span class="keywordflow">if</span>($database[<span class="stringliteral">&#39;path&#39;</span>] == $_POST[<span class="stringliteral">&#39;database_switch&#39;</span>])</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;        {</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;            $_SESSION[COOKIENAME.<span class="stringliteral">&quot;currentDB&quot;</span>] = $database;</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;        }</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;    }</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;    $currentDB = $_SESSION[COOKIENAME.<span class="stringliteral">&#39;currentDB&#39;</span>];</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;}</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;<span class="keywordflow">else</span> <span class="keywordflow">if</span>(isset($_GET[<span class="stringliteral">&#39;switchdb&#39;</span>]))</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;{</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;    <span class="keywordflow">foreach</span>($databases as $db_id =&gt; $database)</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;    {</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;        <span class="keywordflow">if</span>($database[<span class="stringliteral">&#39;path&#39;</span>] == $_GET[<span class="stringliteral">&#39;switchdb&#39;</span>])</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;        {</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;            $_SESSION[COOKIENAME.<span class="stringliteral">&quot;currentDB&quot;</span>] = $database;</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;        }</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;    }</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;    $currentDB = $_SESSION[COOKIENAME.<span class="stringliteral">&#39;currentDB&#39;</span>];</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;}</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;<span class="keywordflow">if</span>(isset($_SESSION[COOKIENAME.<span class="stringliteral">&#39;currentDB&#39;</span>]) &amp;&amp; in_array($_SESSION[COOKIENAME.<span class="stringliteral">&#39;currentDB&#39;</span>], $databases))</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;    $currentDB = $_SESSION[COOKIENAME.<span class="stringliteral">&#39;currentDB&#39;</span>];</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;<span class="comment">//- Open database (creates a Database object)</span></div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;<a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a> = <span class="keyword">new</span> Database($currentDB); <span class="comment">//create the Database object</span></div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;<a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;registerUserFunction($custom_functions);</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;<span class="comment">// collect parameters early, just once</span></div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;$target_table = isset($_GET[<span class="stringliteral">&#39;table&#39;</span>]) ? $_GET[<span class="stringliteral">&#39;table&#39;</span>] : null;</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;<span class="comment">//- Switch on $_GET[&#39;action&#39;] for operations without output</span></div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;<span class="keywordflow">if</span>(isset($_GET[<span class="stringliteral">&#39;action&#39;</span>]) &amp;&amp; isset($_GET[<span class="stringliteral">&#39;confirm&#39;</span>]))</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;{</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;    <span class="keywordflow">switch</span>($_GET[<span class="stringliteral">&#39;action&#39;</span>])</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;    {</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;    <span class="comment">//- Table actions</span></div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;        <span class="comment">//- Create table (=table_create)</span></div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;        <span class="keywordflow">case</span> <span class="stringliteral">&quot;table_create&quot;</span>:</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;            $num = intval($_POST[<span class="stringliteral">&#39;rows&#39;</span>]);</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;            $name = $_POST[<span class="stringliteral">&#39;tablename&#39;</span>];</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;            $primary_keys = array();</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;            <span class="keywordflow">for</span>($i=0; $i&lt;$num; $i++)</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;            {</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;                <span class="keywordflow">if</span>($_POST[$i.<span class="stringliteral">&#39;_field&#39;</span>]!=<span class="stringliteral">&quot;&quot;</span> &amp;&amp; isset($_POST[$i.<span class="stringliteral">&#39;_primarykey&#39;</span>]))</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;                {</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;                    $primary_keys[] = $_POST[$i.<span class="stringliteral">&#39;_field&#39;</span>];</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;                }</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;            }</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;            $query = <span class="stringliteral">&quot;CREATE TABLE &quot;</span>.$db-&gt;quote($name).<span class="stringliteral">&quot; (&quot;</span>;</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;            <span class="keywordflow">for</span>($i=0; $i&lt;$num; $i++)</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;            {</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;                <span class="keywordflow">if</span>($_POST[$i.<span class="stringliteral">&#39;_field&#39;</span>]!=<span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;                {</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;                    $query .= <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;quote($_POST[$i.<span class="stringliteral">&#39;_field&#39;</span>]).<span class="stringliteral">&quot; &quot;</span>;</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;                    $query .= $_POST[$i.<span class="stringliteral">&#39;_type&#39;</span>].<span class="stringliteral">&quot; &quot;</span>;</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;                    <span class="keywordflow">if</span>(isset($_POST[$i.<span class="stringliteral">&#39;_primarykey&#39;</span>]))</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;                    {</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;                        <span class="keywordflow">if</span>(count($primary_keys)==1)</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;                        {</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;                            $query .= <span class="stringliteral">&quot;PRIMARY KEY &quot;</span>; </div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;                            <span class="keywordflow">if</span>(isset($_POST[$i.<span class="stringliteral">&#39;_autoincrement&#39;</span>]) &amp;&amp; <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;getType() != <span class="stringliteral">&quot;SQLiteDatabase&quot;</span>)</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;                                $query .=  <span class="stringliteral">&quot;AUTOINCREMENT &quot;</span>;</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;                        }</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;                        $query .= <span class="stringliteral">&quot;NOT NULL &quot;</span>;</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;                    }</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;                    <span class="keywordflow">if</span>(!isset($_POST[$i.<span class="stringliteral">&#39;_primarykey&#39;</span>]) &amp;&amp; isset($_POST[$i.<span class="stringliteral">&#39;_notnull&#39;</span>]))</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;                        $query .= <span class="stringliteral">&quot;NOT NULL &quot;</span>;</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;                    <span class="keywordflow">if</span>($_POST[$i.<span class="stringliteral">&#39;_defaultoption&#39;</span>]!=<span class="stringliteral">&#39;defined&#39;</span> &amp;&amp; $_POST[$i.<span class="stringliteral">&#39;_defaultoption&#39;</span>]!=<span class="stringliteral">&#39;none&#39;</span> &amp;&amp; $_POST[$i.<span class="stringliteral">&#39;_defaultoption&#39;</span>]!=<span class="stringliteral">&#39;expr&#39;</span>)</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;                        $query .= <span class="stringliteral">&quot;DEFAULT &quot;</span>.$_POST[$i.<span class="stringliteral">&#39;_defaultoption&#39;</span>].<span class="stringliteral">&quot; &quot;</span>;</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;                    elseif($_POST[$i.<span class="stringliteral">&#39;_defaultoption&#39;</span>]==<span class="stringliteral">&#39;expr&#39;</span>)</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;                        $query .= &quot;DEFAULT (&quot;.$_POST[$i.&#39;_defaultvalue&#39;].&quot;) &quot;;</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;                    elseif(isset($_POST[$i.&#39;_defaultvalue&#39;]) &amp;&amp; $_POST[$i.&#39;_defaultoption&#39;]==&#39;defined&#39;)</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;                    {</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;                        $typeAffinity = get_type_affinity($_POST[$i.<span class="stringliteral">&#39;_type&#39;</span>]);</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;                        <span class="keywordflow">if</span>(($typeAffinity==<span class="stringliteral">&quot;INTEGER&quot;</span> || $typeAffinity==<span class="stringliteral">&quot;REAL&quot;</span> || $typeAffinity==<span class="stringliteral">&quot;NUMERIC&quot;</span>) &amp;&amp; is_numeric($_POST[$i.<span class="stringliteral">&#39;_defaultvalue&#39;</span>]))</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;                            $query .= <span class="stringliteral">&quot;DEFAULT &quot;</span>.$_POST[$i.<span class="stringliteral">&#39;_defaultvalue&#39;</span>].<span class="stringliteral">&quot;  &quot;</span>;</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;                        <span class="keywordflow">else</span></div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;                            $query .= <span class="stringliteral">&quot;DEFAULT &quot;</span>.$db-&gt;quote($_POST[$i.<span class="stringliteral">&#39;_defaultvalue&#39;</span>]).<span class="stringliteral">&quot; &quot;</span>;</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;                    }</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;                    $query = substr($query, 0, <span class="keyword">sizeof</span>($query)-2);</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;                    $query .= <span class="stringliteral">&quot;, &quot;</span>;</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;                }</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;            }</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;            <span class="keywordflow">if</span> (count($primary_keys)&gt;1)</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;            {</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;                $compound_key = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;                <span class="keywordflow">foreach</span> ($primary_keys as $primary_key)</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;                {</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;                    $compound_key .= ($compound_key==<span class="stringliteral">&quot;&quot;</span> ? <span class="stringliteral">&quot;&quot;</span> : <span class="stringliteral">&quot;, &quot;</span>) . <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;quote($primary_key);</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;                }</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;                $query .= <span class="stringliteral">&quot;PRIMARY KEY (&quot;</span>.$compound_key.<span class="stringliteral">&quot;), &quot;</span>;</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;            }</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;            $query = substr($query, 0, <span class="keyword">sizeof</span>($query)-3);</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;            $query .= <span class="stringliteral">&quot;)&quot;</span>;</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;            $result = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;query($query);</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;            <span class="keywordflow">if</span>($result===<span class="keyword">false</span>)</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;                $error = <span class="keyword">true</span>;</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;            $completed = $lang[<span class="stringliteral">&#39;tbl&#39;</span>].<span class="stringliteral">&quot; &#39;&quot;</span>.htmlencode($_POST[<span class="stringliteral">&#39;tablename&#39;</span>]).<span class="stringliteral">&quot;&#39; &quot;</span>.$lang[<span class="stringliteral">&#39;created&#39;</span>].<span class="stringliteral">&quot;.&lt;br/&gt;&lt;span style=&#39;font-size:11px;&#39;&gt;&quot;</span>.htmlencode($query).<span class="stringliteral">&quot;&lt;/span&gt;&quot;</span>;</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;            $backlinkParameters = <span class="stringliteral">&quot;&amp;amp;action=column_view&amp;amp;table=&quot;</span>.urlencode($name);</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;        <span class="comment">//- Empty table (=table_empty)</span></div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;        <span class="keywordflow">case</span> <span class="stringliteral">&quot;table_empty&quot;</span>:</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;            $query = <span class="stringliteral">&quot;DELETE FROM &quot;</span>.$db-&gt;quote_id($_POST[<span class="stringliteral">&#39;tablename&#39;</span>]);</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;            $result = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;query($query);</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;            <span class="keywordflow">if</span>($result===<span class="keyword">false</span>)</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;                $error = <span class="keyword">true</span>;</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;            $query = <span class="stringliteral">&quot;VACUUM&quot;</span>;</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;            $result = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;query($query);</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;            <span class="keywordflow">if</span>($result===<span class="keyword">false</span>)</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;                $error = <span class="keyword">true</span>;</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;            $completed = $lang[<span class="stringliteral">&#39;tbl&#39;</span>].<span class="stringliteral">&quot; &#39;&quot;</span>.htmlencode($_POST[<span class="stringliteral">&#39;tablename&#39;</span>]).<span class="stringliteral">&quot;&#39; &quot;</span>.$lang[<span class="stringliteral">&#39;emptied&#39;</span>].<span class="stringliteral">&quot;.&lt;br/&gt;&lt;span style=&#39;font-size:11px;&#39;&gt;&quot;</span>.htmlencode($query).<span class="stringliteral">&quot;&lt;/span&gt;&quot;</span>;</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;            $backlinkParameters = <span class="stringliteral">&quot;&amp;amp;action=row_view&amp;amp;table=&quot;</span>.urlencode($name);</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;        <span class="comment">//- Create view (=view_create)</span></div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;        <span class="keywordflow">case</span> <span class="stringliteral">&quot;view_create&quot;</span>:</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;            $query = <span class="stringliteral">&quot;CREATE VIEW &quot;</span>.$db-&gt;quote($_POST[<span class="stringliteral">&#39;viewname&#39;</span>]).<span class="stringliteral">&quot; AS &quot;</span>.$_POST[<span class="stringliteral">&#39;select&#39;</span>];</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;            $result = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;query($query);</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;            <span class="keywordflow">if</span>($result===<span class="keyword">false</span>)</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;                $error = <span class="keyword">true</span>;</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;            $completed = $lang[<span class="stringliteral">&#39;view&#39;</span>].<span class="stringliteral">&quot; &#39;&quot;</span>.htmlencode($_POST[<span class="stringliteral">&#39;viewname&#39;</span>]).<span class="stringliteral">&quot;&#39; &quot;</span>.$lang[<span class="stringliteral">&#39;created&#39;</span>].<span class="stringliteral">&quot;.&lt;br/&gt;&lt;span style=&#39;font-size:11px;&#39;&gt;&quot;</span>.htmlencode($query).<span class="stringliteral">&quot;&lt;/span&gt;&quot;</span>;</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;            $backlinkParameters = <span class="stringliteral">&quot;&amp;amp;action=column_view&amp;amp;table=&quot;</span>.urlencode($_POST[<span class="stringliteral">&#39;viewname&#39;</span>]);</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;        <span class="comment">//- Drop table (=table_drop)</span></div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;        <span class="keywordflow">case</span> <span class="stringliteral">&quot;table_drop&quot;</span>:</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;            $query = <span class="stringliteral">&quot;DROP TABLE &quot;</span>.$db-&gt;quote_id($_POST[<span class="stringliteral">&#39;tablename&#39;</span>]);</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;            $result=<a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;query($query);</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;            <span class="keywordflow">if</span>($result===<span class="keyword">false</span>)</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;                $error = <span class="keyword">true</span>;</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;            $completed = $lang[<span class="stringliteral">&#39;tbl&#39;</span>].<span class="stringliteral">&quot; &#39;&quot;</span>.htmlencode($_POST[<span class="stringliteral">&#39;tablename&#39;</span>]).<span class="stringliteral">&quot;&#39; &quot;</span>.$lang[<span class="stringliteral">&#39;dropped&#39;</span>].<span class="stringliteral">&quot;.&quot;</span>;</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;            $backlinkParameters = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;        <span class="comment">//- Drop view (=view_drop)</span></div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;        <span class="keywordflow">case</span> <span class="stringliteral">&quot;view_drop&quot;</span>:</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;            $query = <span class="stringliteral">&quot;DROP VIEW &quot;</span>.$db-&gt;quote_id($_POST[<span class="stringliteral">&#39;viewname&#39;</span>]);</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;            $result=<a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;query($query);</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;            <span class="keywordflow">if</span>($result===<span class="keyword">false</span>)</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;                $error = <span class="keyword">true</span>;</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;            $completed = $lang[<span class="stringliteral">&#39;view&#39;</span>].<span class="stringliteral">&quot; &#39;&quot;</span>.htmlencode($_POST[<span class="stringliteral">&#39;viewname&#39;</span>]).<span class="stringliteral">&quot;&#39; &quot;</span>.$lang[<span class="stringliteral">&#39;dropped&#39;</span>].<span class="stringliteral">&quot;.&quot;</span>;</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;            $backlinkParameters = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;        <span class="comment">//- Rename table (=table_rename)</span></div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;        <span class="keywordflow">case</span> <span class="stringliteral">&quot;table_rename&quot;</span>:</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;            $query = <span class="stringliteral">&quot;ALTER TABLE &quot;</span>.$db-&gt;quote_id($_POST[<span class="stringliteral">&#39;oldname&#39;</span>]).<span class="stringliteral">&quot; RENAME TO &quot;</span>.<a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;quote($_POST[<span class="stringliteral">&#39;newname&#39;</span>]);</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;getVersion()==3)</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;                $result = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;query($query, <span class="keyword">true</span>);</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;                $result = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;query($query, <span class="keyword">false</span>);</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;            <span class="keywordflow">if</span>($result===<span class="keyword">false</span>)</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;                $error = <span class="keyword">true</span>;</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;            $completed = $lang[<span class="stringliteral">&#39;tbl&#39;</span>].<span class="stringliteral">&quot; &#39;&quot;</span>.htmlencode($_POST[<span class="stringliteral">&#39;oldname&#39;</span>]).<span class="stringliteral">&quot;&#39; &quot;</span>.$lang[<span class="stringliteral">&#39;renamed&#39;</span>].<span class="stringliteral">&quot; &#39;&quot;</span>.htmlencode($_POST[<span class="stringliteral">&#39;newname&#39;</span>]).<span class="stringliteral">&quot;&#39;.&lt;br/&gt;&lt;span style=&#39;font-size:11px;&#39;&gt;&quot;</span>.htmlencode($query).<span class="stringliteral">&quot;&lt;/span&gt;&quot;</span>;</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;            $backlinkParameters = <span class="stringliteral">&quot;&amp;amp;action=row_view&amp;amp;table=&quot;</span>.urlencode($_POST[<span class="stringliteral">&#39;newname&#39;</span>]);</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;    <span class="comment">//- Row actions</span></div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;        <span class="comment">//- Create row (=row_create)</span></div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;        <span class="keywordflow">case</span> <span class="stringliteral">&quot;row_create&quot;</span>:</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;            $completed = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;            $num = $_POST[<span class="stringliteral">&#39;numRows&#39;</span>];</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;            $fields = explode(<span class="stringliteral">&quot;:&quot;</span>, $_POST[<span class="stringliteral">&#39;fields&#39;</span>]);</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;            $z = 0;</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;            </div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;            $query = <span class="stringliteral">&quot;PRAGMA table_info(&quot;</span>.$db-&gt;quote_id($target_table).<span class="stringliteral">&quot;)&quot;</span>;</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;            $result = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;selectArray($query);</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;            </div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;            <span class="keywordflow">for</span>($i=0; $i&lt;$num; $i++)</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;            {</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;                <span class="keywordflow">if</span>(!isset($_POST[$i.<span class="stringliteral">&quot;:ignore&quot;</span>]))</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;                {</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;                    $query_cols = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;                    $query_vals = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;                    $all_default = <span class="keyword">true</span>;</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;                    <span class="keywordflow">for</span>($j=0; $j&lt;<span class="keyword">sizeof</span>($fields); $j++)</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;                    {</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;                        <span class="comment">// PHP replaces space with underscore</span></div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;                        $fields[$j] = str_replace(<span class="stringliteral">&quot; &quot;</span>,<span class="stringliteral">&quot;_&quot;</span>,$fields[$j]);</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;                        </div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;                        $null = isset($_POST[$i.<span class="stringliteral">&quot;:&quot;</span>.$fields[$j].<span class="stringliteral">&quot;_null&quot;</span>]);</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;                        <span class="keywordflow">if</span>(!$null)</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;                        {</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;                            <span class="keywordflow">if</span>(!isset($_POST[$i.<span class="stringliteral">&quot;:&quot;</span>.$fields[$j]]) &amp;&amp; $debug)</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;                            {</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;                                echo <span class="stringliteral">&quot;MISSING POST INDEX (&quot;</span>.$i.<span class="stringliteral">&quot;:&quot;</span>.$fields[$j].<span class="stringliteral">&quot;)&lt;br&gt;&lt;pre /&gt;&quot;</span>;</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;                                var_dump($_POST);</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;                                echo <span class="stringliteral">&quot;&lt;/pre&gt;&lt;hr /&gt;&quot;</span>;</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;                            } </div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;                            $value = $_POST[$i.<span class="stringliteral">&quot;:&quot;</span>.$fields[$j]];</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;                        }</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;                        <span class="keywordflow">else</span></div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;                            $value = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;                        <span class="keywordflow">if</span>($value===$result[$j][<span class="stringliteral">&#39;dflt_value&#39;</span>])</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;                        {</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;                            <span class="comment">// if the value is the default value, skip it</span></div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;                            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;                        } <span class="keywordflow">else</span></div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;                            $all_default = <span class="keyword">false</span>;</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;                        $query_cols .= <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;quote_id($fields[$j]).<span class="stringliteral">&quot;,&quot;</span>;</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;                        </div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;                        $type = $result[$j][<span class="stringliteral">&#39;type&#39;</span>];</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;                        $typeAffinity = get_type_affinity($type);</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;                        $function = $_POST[<span class="stringliteral">&quot;function_&quot;</span>.$i.<span class="stringliteral">&quot;_&quot;</span>.$fields[$j]];</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;                        <span class="keywordflow">if</span>($function!=<span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;                            $query_vals .= $function.<span class="stringliteral">&quot;(&quot;</span>;</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;                        <span class="keywordflow">if</span>(($typeAffinity==<span class="stringliteral">&quot;TEXT&quot;</span> || $typeAffinity==<span class="stringliteral">&quot;NONE&quot;</span>) &amp;&amp; !$null)</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;                            $query_vals .= <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;quote($value);</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;                        elseif(($typeAffinity==<span class="stringliteral">&quot;INTEGER&quot;</span> || $typeAffinity==<span class="stringliteral">&quot;REAL&quot;</span>|| $typeAffinity==<span class="stringliteral">&quot;NUMERIC&quot;</span>) &amp;&amp; $value==<span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;                            $query_vals .= &quot;NULL&quot;;</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;                        elseif($null)</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;                            $query_vals .= &quot;NULL&quot;;</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;                        else</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;                            $query_vals .= <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;quote($value);</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;                        if($function!=&quot;&quot;)</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;                            $query_vals .= &quot;)&quot;;</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;                        $query_vals .= &quot;,&quot;;</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;                    }</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;                    $query = &quot;INSERT INTO &quot;.<a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;quote_id($target_table);</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;                    if(!$all_default)</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;                    {</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;                        $query_cols = substr($query_cols, 0, strlen($query_cols)-1);</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;                        $query_vals = substr($query_vals, 0, strlen($query_vals)-1);</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;                    </div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;                        $query.=<span class="stringliteral">&quot; (&quot;</span>. $query_cols . <span class="stringliteral">&quot;) VALUES (&quot;</span>. $query_vals. <span class="stringliteral">&quot;)&quot;</span>;</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;                    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;                        $query .= <span class="stringliteral">&quot; DEFAULT VALUES&quot;</span>;</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;                    }</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;                    $result1 = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;query($query);</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;                    <span class="keywordflow">if</span>($result1===<span class="keyword">false</span>)</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;                        $error = <span class="keyword">true</span>;</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;                    $completed .= <span class="stringliteral">&quot;&lt;span style=&#39;font-size:11px;&#39;&gt;&quot;</span>.htmlencode($query).<span class="stringliteral">&quot;&lt;/span&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;                    $z++;</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;                }</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;            }</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;            $completed = $z.<span class="stringliteral">&quot; &quot;</span>.$lang[<span class="stringliteral">&#39;rows&#39;</span>].<span class="stringliteral">&quot; &quot;</span>.$lang[<span class="stringliteral">&#39;inserted&#39;</span>].<span class="stringliteral">&quot;.&lt;br/&gt;&lt;br/&gt;&quot;</span>.$completed;</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;            $backlinkParameters = <span class="stringliteral">&quot;&amp;amp;action=column_view&amp;amp;table=&quot;</span>.urlencode($target_table);</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;        <span class="comment">//- Delete row (=row_delete)</span></div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;        <span class="keywordflow">case</span> <span class="stringliteral">&quot;row_delete&quot;</span>:</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;            $pks = json_decode($_GET[<span class="stringliteral">&#39;pk&#39;</span>]);</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;            </div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;            $query = <span class="stringliteral">&quot;DELETE FROM &quot;</span>.$db-&gt;quote_id($target_table).<span class="stringliteral">&quot; WHERE (&quot;</span>.<a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;wherePK($target_table,json_decode($pks[0])).<span class="stringliteral">&quot;)&quot;</span>;</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;            <span class="keywordflow">for</span>($i=1; $i&lt;<span class="keyword">sizeof</span>($pks); $i++)</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;            {</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;                $query .= <span class="stringliteral">&quot; OR (&quot;</span>.$db-&gt;wherePK($target_table,json_decode($pks[$i])).<span class="stringliteral">&quot;)&quot;</span>;</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;            }</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;            $result = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;query($query);</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;            <span class="keywordflow">if</span>($result===<span class="keyword">false</span>)</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;                $error = <span class="keyword">true</span>;</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;            $completed = <span class="keyword">sizeof</span>($pks).<span class="stringliteral">&quot; &quot;</span>.$lang[<span class="stringliteral">&#39;rows&#39;</span>].<span class="stringliteral">&quot; &quot;</span>.$lang[<span class="stringliteral">&#39;deleted&#39;</span>].<span class="stringliteral">&quot;.&lt;br/&gt;&lt;span style=&#39;font-size:11px;&#39;&gt;&quot;</span>.htmlencode($query).<span class="stringliteral">&quot;&lt;/span&gt;&quot;</span>;</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;            $backlinkParameters = <span class="stringliteral">&quot;&amp;amp;action=row_view&amp;amp;table=&quot;</span>.urlencode($target_table);</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;        <span class="comment">//- Edit row (=row_edit)</span></div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;        <span class="keywordflow">case</span> <span class="stringliteral">&quot;row_edit&quot;</span>:</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;            $pks = json_decode($_GET[<span class="stringliteral">&#39;pk&#39;</span>]);</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;            $fields = explode(<span class="stringliteral">&quot;:&quot;</span>, $_POST[<span class="stringliteral">&#39;fieldArray&#39;</span>]);</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;            </div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;            $z = 0;</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;            </div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;            $query = <span class="stringliteral">&quot;PRAGMA table_info(&quot;</span>.$db-&gt;quote_id($target_table).<span class="stringliteral">&quot;)&quot;</span>;</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;            $result = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;selectArray($query);</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;            </div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;            <span class="keywordflow">if</span>(isset($_POST[<span class="stringliteral">&#39;new_row&#39;</span>]))</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;                $completed = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;                $completed = <span class="keyword">sizeof</span>($pks).<span class="stringliteral">&quot; &quot;</span>.$lang[<span class="stringliteral">&#39;rows&#39;</span>].<span class="stringliteral">&quot; &quot;</span>.$lang[<span class="stringliteral">&#39;affected&#39;</span>].<span class="stringliteral">&quot;.&lt;br/&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;            <span class="keywordflow">for</span>($i=0; $i&lt;<span class="keyword">sizeof</span>($pks); $i++)</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;            {</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;                <span class="keywordflow">if</span>(isset($_POST[<span class="stringliteral">&#39;new_row&#39;</span>]))</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;                {</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;                    $query_cols = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;                    $query_vals = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;                    $all_default = <span class="keyword">true</span>;</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;                    <span class="keywordflow">for</span>($j=0; $j&lt;<span class="keyword">sizeof</span>($fields); $j++)</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;                    {</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;                        <span class="comment">// PHP replaces space with underscore</span></div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;                        $fields[$j] = str_replace(<span class="stringliteral">&quot; &quot;</span>,<span class="stringliteral">&quot;_&quot;</span>,$fields[$j]);</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;                        </div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;                        $null = isset($_POST[$fields[$j].<span class="stringliteral">&quot;_null&quot;</span>][$i]);</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;                        <span class="keywordflow">if</span>(!$null)</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;                        {</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;                            $value = $_POST[$fields[$j]][$i];</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;                        }</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;                        <span class="keywordflow">else</span></div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;                            $value = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;                        <span class="keywordflow">if</span>($value===$result[$j][<span class="stringliteral">&#39;dflt_value&#39;</span>])</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;                        {</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;                            <span class="comment">// if the value is the default value, skip it</span></div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;                            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;                        } <span class="keywordflow">else</span></div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;                            $all_default = <span class="keyword">false</span>;</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;                        $query_cols .= <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;quote_id($fields[$j]).<span class="stringliteral">&quot;,&quot;</span>;</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;                        </div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;                        $type = $result[$j][<span class="stringliteral">&#39;type&#39;</span>];</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;                        $typeAffinity = get_type_affinity($type);</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;                        $function = $_POST[<span class="stringliteral">&quot;function_&quot;</span>.$fields[$j]][$i];</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;                        <span class="keywordflow">if</span>($function!=<span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;                            $query_vals .= $function.<span class="stringliteral">&quot;(&quot;</span>;</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;                        <span class="keywordflow">if</span>(($typeAffinity==<span class="stringliteral">&quot;TEXT&quot;</span> || $typeAffinity==<span class="stringliteral">&quot;NONE&quot;</span>) &amp;&amp; !$null)</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;                            $query_vals .= <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;quote($value);</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;                        elseif(($typeAffinity==<span class="stringliteral">&quot;INTEGER&quot;</span> || $typeAffinity==<span class="stringliteral">&quot;REAL&quot;</span>|| $typeAffinity==<span class="stringliteral">&quot;NUMERIC&quot;</span>) &amp;&amp; $value==<span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;                            $query_vals .= &quot;NULL&quot;;</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;                        elseif($null)</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;                            $query_vals .= &quot;NULL&quot;;</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;                        else</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;                            $query_vals .= <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;quote($value);</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;                        if($function!=&quot;&quot;)</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;                            $query_vals .= &quot;)&quot;;</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;                        $query_vals .= &quot;,&quot;;</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;                    }</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;                    $query = &quot;INSERT INTO &quot;.<a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;quote_id($target_table);</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;                    if(!$all_default)</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;                    {</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;                        $query_cols = substr($query_cols, 0, strlen($query_cols)-1);</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;                        $query_vals = substr($query_vals, 0, strlen($query_vals)-1);</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;                    </div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;                        $query.=<span class="stringliteral">&quot; (&quot;</span>. $query_cols . <span class="stringliteral">&quot;) VALUES (&quot;</span>. $query_vals. <span class="stringliteral">&quot;)&quot;</span>;</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;                    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;                        $query .= <span class="stringliteral">&quot; DEFAULT VALUES&quot;</span>;</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;                    }</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;                    $result1 = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;query($query);</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;                    <span class="keywordflow">if</span>($result1===<span class="keyword">false</span>)</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;                        $error = <span class="keyword">true</span>;</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;                    $z++;</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;                }</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;                {</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;                    $query = <span class="stringliteral">&quot;UPDATE &quot;</span>.$db-&gt;quote_id($target_table).<span class="stringliteral">&quot; SET &quot;</span>;</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;                    <span class="keywordflow">for</span>($j=0; $j&lt;<span class="keyword">sizeof</span>($fields); $j++)</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;                    {</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;                        $field_index = str_replace(<span class="stringliteral">&quot; &quot;</span>,<span class="stringliteral">&quot;_&quot;</span>,$fields[$j]);</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;                        $function = $_POST[<span class="stringliteral">&quot;function_&quot;</span>.$field_index][$i];</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;                        $null = isset($_POST[$field_index.<span class="stringliteral">&quot;_null&quot;</span>][$i]);</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;                        $query .= <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;quote_id($fields[$j]).<span class="stringliteral">&quot;=&quot;</span>;</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;                        <span class="keywordflow">if</span>($function!=<span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;                            $query .= $function.<span class="stringliteral">&quot;(&quot;</span>;</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;                        <span class="keywordflow">if</span>($null)</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;                            $query .= <span class="stringliteral">&quot;NULL&quot;</span>;</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;                        <span class="keywordflow">else</span></div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;                            $query .= <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;quote($_POST[$field_index][$i]);</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;                        <span class="keywordflow">if</span>($function!=<span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;                            $query .= <span class="stringliteral">&quot;)&quot;</span>;</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;                        $query .= <span class="stringliteral">&quot;, &quot;</span>;</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;                    }</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;                    $query = substr($query, 0, <span class="keyword">sizeof</span>($query)-3);</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;                    $query .= <span class="stringliteral">&quot; WHERE &quot;</span>.$db-&gt;wherePK($target_table, json_decode($pks[$i]));</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;                    $result1 = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;query($query);</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;                    <span class="keywordflow">if</span>($result1===<span class="keyword">false</span>)</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;                    {</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;                        $error = <span class="keyword">true</span>;</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;                    }</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;                }</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;                $completed .= <span class="stringliteral">&quot;&lt;span style=&#39;font-size:11px;&#39;&gt;&quot;</span>.htmlencode($query).<span class="stringliteral">&quot;&lt;/span&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;            }</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;            <span class="keywordflow">if</span>(isset($_POST[<span class="stringliteral">&#39;new_row&#39;</span>]))</div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;                $completed = $z.<span class="stringliteral">&quot; &quot;</span>.$lang[<span class="stringliteral">&#39;rows&#39;</span>].<span class="stringliteral">&quot; &quot;</span>.$lang[<span class="stringliteral">&#39;inserted&#39;</span>].<span class="stringliteral">&quot;.&lt;br/&gt;&lt;br/&gt;&quot;</span>.$completed;</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;            $backlinkParameters = <span class="stringliteral">&quot;&amp;amp;action=row_view&amp;amp;table=&quot;</span>.urlencode($target_table);</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;    <span class="comment">//- Column actions</span></div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;        <span class="comment">//- Create column (=column_create)</span></div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;        <span class="keywordflow">case</span> <span class="stringliteral">&quot;column_create&quot;</span>:</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;            $num = intval($_POST[<span class="stringliteral">&#39;rows&#39;</span>]);</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;            <span class="keywordflow">for</span>($i=0; $i&lt;$num; $i++)</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;            {</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;                <span class="keywordflow">if</span>($_POST[$i.<span class="stringliteral">&#39;_field&#39;</span>]!=<span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;                {</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;                    $query = <span class="stringliteral">&quot;ALTER TABLE &quot;</span>.$db-&gt;quote_id($target_table).<span class="stringliteral">&quot; ADD &quot;</span>.<a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;quote($_POST[$i.<span class="stringliteral">&#39;_field&#39;</span>]).<span class="stringliteral">&quot; &quot;</span>;</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;                    $query .= $_POST[$i.<span class="stringliteral">&#39;_type&#39;</span>].<span class="stringliteral">&quot; &quot;</span>;</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;                    <span class="keywordflow">if</span>(isset($_POST[$i.<span class="stringliteral">&#39;_primarykey&#39;</span>]))</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;                        $query .= <span class="stringliteral">&quot;PRIMARY KEY &quot;</span>;</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;                    <span class="keywordflow">if</span>(isset($_POST[$i.<span class="stringliteral">&#39;_notnull&#39;</span>]))</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;                        $query .= <span class="stringliteral">&quot;NOT NULL &quot;</span>;</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;                    <span class="keywordflow">if</span>($_POST[$i.<span class="stringliteral">&#39;_defaultoption&#39;</span>]!=<span class="stringliteral">&#39;defined&#39;</span> &amp;&amp; $_POST[$i.<span class="stringliteral">&#39;_defaultoption&#39;</span>]!=<span class="stringliteral">&#39;none&#39;</span> &amp;&amp; $_POST[$i.<span class="stringliteral">&#39;_defaultoption&#39;</span>]!=<span class="stringliteral">&#39;expr&#39;</span>)</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;                        $query .= <span class="stringliteral">&quot;DEFAULT &quot;</span>.$_POST[$i.<span class="stringliteral">&#39;_defaultoption&#39;</span>].<span class="stringliteral">&quot; &quot;</span>;</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;                    elseif($_POST[$i.<span class="stringliteral">&#39;_defaultoption&#39;</span>]==<span class="stringliteral">&#39;expr&#39;</span>)</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;                        $query .= &quot;DEFAULT (&quot;.$_POST[$i.&#39;_defaultvalue&#39;].&quot;) &quot;;</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;                    elseif(isset($_POST[$i.&#39;_defaultvalue&#39;]) &amp;&amp; $_POST[$i.&#39;_defaultoption&#39;]==&#39;defined&#39;)</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;                    {</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;                        $typeAffinity = get_type_affinity($_POST[$i.<span class="stringliteral">&#39;_type&#39;</span>]);</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;                        <span class="keywordflow">if</span>(($typeAffinity==<span class="stringliteral">&quot;INTEGER&quot;</span> || $typeAffinity==<span class="stringliteral">&quot;REAL&quot;</span> || $typeAffinity==<span class="stringliteral">&quot;NUMERIC&quot;</span>) &amp;&amp; is_numeric($_POST[$i.<span class="stringliteral">&#39;_defaultvalue&#39;</span>]))</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;                            $query .= <span class="stringliteral">&quot;DEFAULT &quot;</span>.$_POST[$i.<span class="stringliteral">&#39;_defaultvalue&#39;</span>].<span class="stringliteral">&quot;  &quot;</span>;</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;                        <span class="keywordflow">else</span></div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;                            $query .= <span class="stringliteral">&quot;DEFAULT &quot;</span>.$db-&gt;quote($_POST[$i.<span class="stringliteral">&#39;_defaultvalue&#39;</span>]).<span class="stringliteral">&quot; &quot;</span>;</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;                    }</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;                    <span class="keywordflow">if</span>(<a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;getVersion()==3 &amp;&amp;</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;                        ($_POST[$i.<span class="stringliteral">&#39;_defaultoption&#39;</span>]==<span class="stringliteral">&#39;defined&#39;</span> || $_POST[$i.<span class="stringliteral">&#39;_defaultoption&#39;</span>]==<span class="stringliteral">&#39;none&#39;</span> || $_POST[$i.<span class="stringliteral">&#39;_defaultoption&#39;</span>]==<span class="stringliteral">&#39;NULL&#39;</span>)</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;                        <span class="comment">// Sqlite3 cannot add columns with default values that are not constant, so use AlterTable-workaround</span></div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;                        &amp;&amp; !isset($_POST[$i.<span class="stringliteral">&#39;_primarykey&#39;</span>])) <span class="comment">// sqlite3 cannot add primary key columns</span></div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;                        $result = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;query($query, <span class="keyword">true</span>);</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;                    <span class="keywordflow">else</span></div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;                        $result = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;query($query, <span class="keyword">false</span>);</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;                    <span class="keywordflow">if</span>($result===<span class="keyword">false</span>)</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;                        $error = <span class="keyword">true</span>;</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;                }</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;            }</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;            $completed = $lang[<span class="stringliteral">&#39;tbl&#39;</span>].<span class="stringliteral">&quot; &#39;&quot;</span>.htmlencode($target_table).<span class="stringliteral">&quot;&#39; &quot;</span>.$lang[<span class="stringliteral">&#39;altered&#39;</span>].<span class="stringliteral">&quot;.&quot;</span>;</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;            $backlinkParameters = <span class="stringliteral">&quot;&amp;amp;action=column_view&amp;amp;table=&quot;</span>.urlencode($target_table);</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;        <span class="comment">//- Delete column (=column_delete)</span></div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;        <span class="keywordflow">case</span> <span class="stringliteral">&quot;column_delete&quot;</span>:</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;            $pks = explode(<span class="stringliteral">&quot;:&quot;</span>, $_GET[<span class="stringliteral">&#39;pk&#39;</span>]);</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;            $query = <span class="stringliteral">&quot;ALTER TABLE &quot;</span>.$db-&gt;quote_id($target_table).<span class="stringliteral">&#39; DROP &#39;</span>.<a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;quote_id($pks[0]);</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;            <span class="keywordflow">for</span>($i=1; $i&lt;<span class="keyword">sizeof</span>($pks); $i++)</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;            {</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;                $query .= <span class="stringliteral">&quot;, DROP &quot;</span>.$db-&gt;quote_id($pks[$i]);</div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;            }</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;            $result = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;query($query);</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;            <span class="keywordflow">if</span>($result===<span class="keyword">false</span>)</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;                $error = <span class="keyword">true</span>;</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;            $completed = $lang[<span class="stringliteral">&#39;tbl&#39;</span>].<span class="stringliteral">&quot; &#39;&quot;</span>.htmlencode($target_table).<span class="stringliteral">&quot;&#39; &quot;</span>.$lang[<span class="stringliteral">&#39;altered&#39;</span>].<span class="stringliteral">&quot;.&quot;</span>;</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;            $backlinkParameters = <span class="stringliteral">&quot;&amp;amp;action=column_view&amp;amp;table=&quot;</span>.urlencode($target_table);</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;        <span class="comment">//- Add a primary key (=primarykey_add)</span></div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;        <span class="keywordflow">case</span> <span class="stringliteral">&quot;primarykey_add&quot;</span>:</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;            $pks = explode(<span class="stringliteral">&quot;:&quot;</span>, $_GET[<span class="stringliteral">&#39;pk&#39;</span>]);</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;            $query = <span class="stringliteral">&quot;ALTER TABLE &quot;</span>.$db-&gt;quote_id($target_table).<span class="stringliteral">&#39; ADD PRIMARY KEY (&#39;</span>.<a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;quote_id($pks[0]);</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;            <span class="keywordflow">for</span>($i=1; $i&lt;<span class="keyword">sizeof</span>($pks); $i++)</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;            {</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;                $query .= <span class="stringliteral">&quot;, &quot;</span>.$db-&gt;quote_id($pks[$i]);</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;            }</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;            $query .= <span class="stringliteral">&quot;)&quot;</span>;</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;            $result = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;query($query);</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;            <span class="keywordflow">if</span>($result===<span class="keyword">false</span>)</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;                $error = <span class="keyword">true</span>;</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;            $completed = $lang[<span class="stringliteral">&#39;tbl&#39;</span>].<span class="stringliteral">&quot; &#39;&quot;</span>.htmlencode($target_table).<span class="stringliteral">&quot;&#39; &quot;</span>.$lang[<span class="stringliteral">&#39;altered&#39;</span>].<span class="stringliteral">&quot;.&quot;</span>;</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;            $backlinkParameters = <span class="stringliteral">&quot;&amp;amp;action=column_view&amp;amp;table=&quot;</span>.urlencode($target_table);</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;        <span class="comment">//- Edit column (=column_edit)</span></div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;        <span class="keywordflow">case</span> <span class="stringliteral">&quot;column_edit&quot;</span>:</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;            $query = <span class="stringliteral">&quot;ALTER TABLE &quot;</span>.$db-&gt;quote_id($target_table).<span class="stringliteral">&#39; CHANGE &#39;</span>.<a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;quote_id($_POST[<span class="stringliteral">&#39;oldvalue&#39;</span>]).<span class="stringliteral">&quot; &quot;</span>.<a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;quote($_POST[<span class="stringliteral">&#39;0_field&#39;</span>]).<span class="stringliteral">&quot; &quot;</span>.$_POST[<span class="stringliteral">&#39;0_type&#39;</span>];</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;            $result = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;query($query);</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;            <span class="keywordflow">if</span>($result===<span class="keyword">false</span>)</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;                $error = <span class="keyword">true</span>;</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;            $completed = $lang[<span class="stringliteral">&#39;tbl&#39;</span>].<span class="stringliteral">&quot; &#39;&quot;</span>.htmlencode($target_table).<span class="stringliteral">&quot;&#39; &quot;</span>.$lang[<span class="stringliteral">&#39;altered&#39;</span>].<span class="stringliteral">&quot;.&quot;</span>;</div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;            $backlinkParameters = <span class="stringliteral">&quot;&amp;amp;action=column_view&amp;amp;table=&quot;</span>.urlencode($target_table);</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;        <span class="comment">//- Delete trigger (=trigger_delete)</span></div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;        <span class="keywordflow">case</span> <span class="stringliteral">&quot;trigger_delete&quot;</span>:</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;            $query = <span class="stringliteral">&quot;DROP TRIGGER &quot;</span>.$db-&gt;quote_id($_GET[<span class="stringliteral">&#39;pk&#39;</span>]);</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;            $result = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;query($query);</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;            <span class="keywordflow">if</span>($result===<span class="keyword">false</span>)</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;                $error = <span class="keyword">true</span>;</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;            $completed = $lang[<span class="stringliteral">&#39;trigger&#39;</span>].<span class="stringliteral">&quot; &#39;&quot;</span>.htmlencode($_GET[<span class="stringliteral">&#39;pk&#39;</span>]).<span class="stringliteral">&quot;&#39; &quot;</span>.$lang[<span class="stringliteral">&#39;deleted&#39;</span>].<span class="stringliteral">&quot;.&lt;br/&gt;&lt;span style=&#39;font-size:11px;&#39;&gt;&quot;</span>.htmlencode($query).<span class="stringliteral">&quot;&lt;/span&gt;&quot;</span>;</div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;            $backlinkParameters = <span class="stringliteral">&quot;&amp;amp;action=column_view&amp;amp;table=&quot;</span>.urlencode($target_table);</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;        <span class="comment">//- Delete index (=index_delete)</span></div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;        <span class="keywordflow">case</span> <span class="stringliteral">&quot;index_delete&quot;</span>:</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;            $query = <span class="stringliteral">&quot;DROP INDEX &quot;</span>.$db-&gt;quote_id($_GET[<span class="stringliteral">&#39;pk&#39;</span>]);</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;            $result = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;query($query);</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;            <span class="keywordflow">if</span>($result===<span class="keyword">false</span>)</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;                $error = <span class="keyword">true</span>;</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;            $completed = $lang[<span class="stringliteral">&#39;index&#39;</span>].<span class="stringliteral">&quot; &#39;&quot;</span>.htmlencode($_GET[<span class="stringliteral">&#39;pk&#39;</span>]).<span class="stringliteral">&quot;&#39; &quot;</span>.$lang[<span class="stringliteral">&#39;deleted&#39;</span>].<span class="stringliteral">&quot;.&lt;br/&gt;&lt;span style=&#39;font-size:11px;&#39;&gt;&quot;</span>.htmlencode($query).<span class="stringliteral">&quot;&lt;/span&gt;&quot;</span>;</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;            $backlinkParameters = <span class="stringliteral">&quot;&amp;amp;action=column_view&amp;amp;table=&quot;</span>.urlencode($target_table);</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;</div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;        <span class="comment">//- Create trigger (=trigger_create)</span></div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;        <span class="keywordflow">case</span> <span class="stringliteral">&quot;trigger_create&quot;</span>:</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;            $str = <span class="stringliteral">&quot;CREATE TRIGGER &quot;</span>.$db-&gt;quote($_POST[<span class="stringliteral">&#39;trigger_name&#39;</span>]);</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;            <span class="keywordflow">if</span>($_POST[<span class="stringliteral">&#39;beforeafter&#39;</span>]!=<span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;                $str .= <span class="stringliteral">&quot; &quot;</span>.$_POST[<span class="stringliteral">&#39;beforeafter&#39;</span>];</div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;            $str .= <span class="stringliteral">&quot; &quot;</span>.$_POST[<span class="stringliteral">&#39;event&#39;</span>].<span class="stringliteral">&quot; ON &quot;</span>.<a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;quote_id($target_table);</div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;            <span class="keywordflow">if</span>(isset($_POST[<span class="stringliteral">&#39;foreachrow&#39;</span>]))</div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;                $str .= <span class="stringliteral">&quot; FOR EACH ROW&quot;</span>;</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;            <span class="keywordflow">if</span>($_POST[<span class="stringliteral">&#39;whenexpression&#39;</span>]!=<span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;                $str .= <span class="stringliteral">&quot; WHEN &quot;</span>.$_POST[<span class="stringliteral">&#39;whenexpression&#39;</span>];</div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;            $str .= <span class="stringliteral">&quot; BEGIN&quot;</span>;</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;            $str .= <span class="stringliteral">&quot; &quot;</span>.$_POST[<span class="stringliteral">&#39;triggersteps&#39;</span>];</div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;            $str .= <span class="stringliteral">&quot; END&quot;</span>;</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;            $query = $str;</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;            $result = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;query($query);</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;            <span class="keywordflow">if</span>($result===<span class="keyword">false</span>)</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;                $error = <span class="keyword">true</span>;</div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;            $completed = $lang[<span class="stringliteral">&#39;trigger&#39;</span>].<span class="stringliteral">&quot; &quot;</span>.$lang[<span class="stringliteral">&#39;created&#39;</span>].<span class="stringliteral">&quot;.&lt;br/&gt;&lt;span style=&#39;font-size:11px;&#39;&gt;&quot;</span>.htmlencode($query).<span class="stringliteral">&quot;&lt;/span&gt;&quot;</span>;</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;            $backlinkParameters = <span class="stringliteral">&quot;&amp;amp;action=column_view&amp;amp;table=&quot;</span>.urlencode($target_table);</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;        <span class="comment">//- Create index (=index_create)</span></div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;        <span class="keywordflow">case</span> <span class="stringliteral">&quot;index_create&quot;</span>:</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;            $num = $_POST[<span class="stringliteral">&#39;num&#39;</span>];</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;            <span class="keywordflow">if</span>($_POST[<span class="stringliteral">&#39;name&#39;</span>]==<span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;            {</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;                $completed = $lang[<span class="stringliteral">&#39;blank_index&#39;</span>];</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;            }</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span>($_POST[<span class="stringliteral">&#39;0_field&#39;</span>]==<span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;            {</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;                $completed = $lang[<span class="stringliteral">&#39;one_index&#39;</span>];</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;            }</div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;            {</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;                $str = <span class="stringliteral">&quot;CREATE &quot;</span>;</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;                <span class="keywordflow">if</span>($_POST[<span class="stringliteral">&#39;duplicate&#39;</span>]==<span class="stringliteral">&quot;no&quot;</span>)</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;                    $str .= <span class="stringliteral">&quot;UNIQUE &quot;</span>;</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;                $str .= <span class="stringliteral">&quot;INDEX &quot;</span>.$db-&gt;quote($_POST[<span class="stringliteral">&#39;name&#39;</span>]).<span class="stringliteral">&quot; ON &quot;</span>.<a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;quote_id($target_table).<span class="stringliteral">&quot; (&quot;</span>;</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;                $str .= <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;quote_id($_POST[<span class="stringliteral">&#39;0_field&#39;</span>]).$_POST[<span class="stringliteral">&#39;0_order&#39;</span>];</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;                <span class="keywordflow">for</span>($i=1; $i&lt;$num; $i++)</div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;                {</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;                    <span class="keywordflow">if</span>($_POST[$i.<span class="stringliteral">&#39;_field&#39;</span>]!=<span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;                        $str .= <span class="stringliteral">&quot;, &quot;</span>.$db-&gt;quote_id($_POST[$i.<span class="stringliteral">&#39;_field&#39;</span>]).$_POST[$i.<span class="stringliteral">&#39;_order&#39;</span>];</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;                }</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;                $str .= <span class="stringliteral">&quot;)&quot;</span>;</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;                $query = $str;</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;                $result = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;query($query);</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;                <span class="keywordflow">if</span>($result===<span class="keyword">false</span>)</div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;                    $error = <span class="keyword">true</span>;</div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;                $completed = $lang[<span class="stringliteral">&#39;index&#39;</span>].<span class="stringliteral">&quot; &quot;</span>.$lang[<span class="stringliteral">&#39;created&#39;</span>].<span class="stringliteral">&quot;.&lt;br/&gt;&lt;span style=&#39;font-size:11px;&#39;&gt;&quot;</span>.htmlencode($query).<span class="stringliteral">&quot;&lt;/span&gt;&quot;</span>;</div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;            }</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;            $backlinkParameters = <span class="stringliteral">&quot;&amp;amp;action=column_view&amp;amp;table=&quot;</span>.urlencode($target_table);</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;    }</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;}</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;<span class="comment">// are we working on a view? let&#39;s check once here</span></div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;$target_table_type = $target_table ? <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;getTypeOfTable($target_table) : null;</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;</div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;<span class="comment">//- HTML: sidebar</span></div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;echo <span class="stringliteral">&#39;&lt;table class=&quot;body_tbl&quot; width=&quot;100%&quot; border=&quot;0&quot; cellspacing=&quot;0&quot; cellpadding=&quot;0&quot;&gt;&lt;tr&gt;&lt;td valign=&quot;top&quot; class=&quot;left_td&quot; style=&quot;width:100px; padding:9px 2px 9px 9px;&quot;&gt;&#39;</span>;</div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;echo <span class="stringliteral">&quot;&lt;div id=&#39;leftNav&#39;&gt;&quot;</span>;</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;echo <span class="stringliteral">&quot;&lt;h1&gt;&lt;a href=&#39;&quot;</span>.PAGE.<span class="stringliteral">&quot;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;echo <span class="stringliteral">&quot;&lt;span id=&#39;logo&#39;&gt;&quot;</span>.PROJECT.<span class="stringliteral">&quot;&lt;/span&gt; &lt;span id=&#39;version&#39;&gt;v&quot;</span>.VERSION.<span class="stringliteral">&quot;&lt;/span&gt;&quot;</span>;</div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;echo <span class="stringliteral">&quot;&lt;/a&gt;&lt;/h1&gt;&quot;</span>;</div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;echo <span class="stringliteral">&quot;&lt;div id=&#39;headerlinks&#39;&gt;&quot;</span>;</div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;echo <span class="stringliteral">&quot;&lt;a href=&#39;javascript:void&#39; onclick=&#39;openHelp(\&quot;top\&quot;);&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;docu&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt; | &quot;</span>;</div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;echo <span class="stringliteral">&quot;&lt;a href=&#39;http://www.gnu.org/licenses/gpl.html&#39; target=&#39;_blank&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;license&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt; | &quot;</span>;</div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;echo <span class="stringliteral">&quot;&lt;a href=&#39;&quot;</span>.PROJECT_URL.<span class="stringliteral">&quot;&#39; target=&#39;_blank&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;proj_site&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;echo <span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;</div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;<span class="comment">//- HTML: database list</span></div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;echo <span class="stringliteral">&quot;&lt;fieldset style=&#39;margin:15px;&#39;&gt;&lt;legend&gt;&lt;b&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;db_ch&#39;</span>].<span class="stringliteral">&quot;&lt;/b&gt;&lt;/legend&gt;&quot;</span>;</div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;<span class="keywordflow">if</span>(<span class="keyword">sizeof</span>($databases)&lt;10) <span class="comment">//if there aren&#39;t a lot of databases, just show them as a list of links instead of drop down menu</span></div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;{</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;    $i=0;</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;    <span class="keywordflow">foreach</span>($databases as $database)</div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;    {</div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;        $i++;</div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;        echo <span class="charliteral">&#39;[&#39;</span> . ($database[<span class="stringliteral">&#39;readable&#39;</span>] ? <span class="charliteral">&#39;r&#39;</span>:<span class="charliteral">&#39; &#39;</span> ) . ($database[<span class="stringliteral">&#39;writable&#39;</span>] &amp;&amp; $database[<span class="stringliteral">&#39;writable_dir&#39;</span>] ? <span class="charliteral">&#39;w&#39;</span>:<span class="charliteral">&#39; &#39;</span> ) . <span class="stringliteral">&#39;] &#39;</span>;</div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;        <span class="keywordflow">if</span>($database == $_SESSION[COOKIENAME.<span class="stringliteral">&#39;currentDB&#39;</span>])</div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;            echo <span class="stringliteral">&quot;&lt;a href=&#39;?switchdb=&quot;</span>.urlencode($database[<span class="stringliteral">&#39;path&#39;</span>]).<span class="stringliteral">&quot;&#39; class=&#39;active_db&#39;&gt;&quot;</span>.htmlencode($database[<span class="stringliteral">&#39;name&#39;</span>]).<span class="stringliteral">&quot;&lt;/a&gt;  (&lt;a href=&#39;?download=&quot;</span>.urlencode($database[<span class="stringliteral">&#39;path&#39;</span>]).<span class="stringliteral">&quot;&#39; title=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;backup&#39;</span>].<span class="stringliteral">&quot;&#39;&gt;&amp;darr;&lt;/a&gt;)&quot;</span>;</div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;            echo <span class="stringliteral">&quot;&lt;a href=&#39;?switchdb=&quot;</span>.urlencode($database[<span class="stringliteral">&#39;path&#39;</span>]).<span class="stringliteral">&quot;&#39;&gt;&quot;</span>.htmlencode($database[<span class="stringliteral">&#39;name&#39;</span>]).<span class="stringliteral">&quot;&lt;/a&gt;  (&lt;a href=&#39;?download=&quot;</span>.urlencode($database[<span class="stringliteral">&#39;path&#39;</span>]).<span class="stringliteral">&quot;&#39; title=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;backup&#39;</span>].<span class="stringliteral">&quot;&#39;&gt;&amp;darr;&lt;/a&gt;)&quot;</span>;</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;        <span class="keywordflow">if</span>($i&lt;<span class="keyword">sizeof</span>($databases))</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;            echo <span class="stringliteral">&quot;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;    }</div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;}</div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;<span class="keywordflow">else</span> <span class="comment">//there are a lot of databases - show a drop down menu</span></div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;{</div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;    echo <span class="stringliteral">&quot;&lt;form action=&#39;&quot;</span>.PAGE.<span class="stringliteral">&quot;&#39; method=&#39;post&#39;&gt;&quot;</span>;</div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;    echo <span class="stringliteral">&quot;&lt;select name=&#39;database_switch&#39;&gt;&quot;</span>;</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;    <span class="keywordflow">foreach</span>($databases as $database)</div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;    {</div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;        $perms_string = htmlencode(<span class="charliteral">&#39;[&#39;</span> . ($database[<span class="stringliteral">&#39;readable&#39;</span>] ? <span class="charliteral">&#39;r&#39;</span>:<span class="charliteral">&#39; &#39;</span> ) . ($database[<span class="stringliteral">&#39;writable&#39;</span>] &amp;&amp; $database[<span class="stringliteral">&#39;writable_dir&#39;</span>] ? <span class="charliteral">&#39;w&#39;</span>:<span class="charliteral">&#39; &#39;</span> ) . <span class="stringliteral">&#39;] &#39;</span>);</div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;        <span class="keywordflow">if</span>($database == $_SESSION[COOKIENAME.<span class="stringliteral">&#39;currentDB&#39;</span>])</div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;            echo <span class="stringliteral">&quot;&lt;option value=&#39;&quot;</span>.htmlencode($database[<span class="stringliteral">&#39;path&#39;</span>]).<span class="stringliteral">&quot;&#39; selected=&#39;selected&#39;&gt;&quot;</span>.$perms_string.htmlencode($database[<span class="stringliteral">&#39;name&#39;</span>]).<span class="stringliteral">&quot;&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;            echo <span class="stringliteral">&quot;&lt;option value=&#39;&quot;</span>.htmlencode($database[<span class="stringliteral">&#39;path&#39;</span>]).<span class="stringliteral">&quot;&#39;&gt;&quot;</span>.$perms_string.htmlencode($database[<span class="stringliteral">&#39;name&#39;</span>]).<span class="stringliteral">&quot;&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;    }</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;    echo <span class="stringliteral">&quot;&lt;/select&gt; &quot;</span>;</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;    echo <span class="stringliteral">&quot;&lt;input type=&#39;submit&#39; value=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;go&#39;</span>].<span class="stringliteral">&quot;&#39; class=&#39;btn&#39;&gt;&quot;</span>;</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;    echo <span class="stringliteral">&quot;&lt;/form&gt;&quot;</span>;</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;}</div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;echo <span class="stringliteral">&quot;&lt;/fieldset&gt;&quot;</span>;</div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;echo <span class="stringliteral">&quot;&lt;fieldset style=&#39;margin:15px;&#39;&gt;&lt;legend&gt;&quot;</span>;</div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;echo <span class="stringliteral">&quot;&lt;a href=&#39;&quot;</span>.PAGE.<span class="stringliteral">&quot;&#39;&quot;</span>;</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;<span class="keywordflow">if</span> (!$target_table)</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;    echo <span class="stringliteral">&quot; class=&#39;active_table&#39;&quot;</span>;</div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;echo <span class="stringliteral">&quot;&gt;&quot;</span>.htmlencode($currentDB[<span class="stringliteral">&#39;name&#39;</span>]).<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;echo <span class="stringliteral">&quot;&lt;/legend&gt;&quot;</span>;</div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;</div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;<span class="comment">//- HTML: table list</span></div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;$query = <span class="stringliteral">&quot;SELECT type, name FROM sqlite_master WHERE type=&#39;table&#39; OR type=&#39;view&#39; ORDER BY name&quot;</span>;</div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;$result = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;selectArray($query);</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;$j=0;</div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;<span class="keywordflow">for</span>($i=0; $i&lt;<span class="keyword">sizeof</span>($result); $i++)</div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;{</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;    <span class="keywordflow">if</span>(substr($result[$i][<span class="stringliteral">&#39;name&#39;</span>], 0, 7)!=<span class="stringliteral">&quot;sqlite_&quot;</span> &amp;&amp; $result[$i][<span class="stringliteral">&#39;name&#39;</span>]!=<span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;    {</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;        echo <span class="stringliteral">&quot;&lt;span class=&#39;sidebar_table&#39;&gt;[&quot;</span>.$lang[$result[$i][<span class="stringliteral">&#39;type&#39;</span>]==<span class="stringliteral">&#39;table&#39;</span>?<span class="stringliteral">&#39;tbl&#39;</span>:<span class="stringliteral">&#39;view&#39;</span>].<span class="stringliteral">&quot;]&lt;/span&gt; &quot;</span>;</div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;        echo <span class="stringliteral">&quot;&lt;a href=&#39;?action=row_view&amp;amp;table=&quot;</span>.urlencode($result[$i][<span class="stringliteral">&#39;name&#39;</span>]).<span class="stringliteral">&quot;&#39;&quot;</span>;</div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;        <span class="keywordflow">if</span> ($target_table == $result[$i][<span class="stringliteral">&#39;name&#39;</span>])</div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;            echo <span class="stringliteral">&quot; class=&#39;active_table&#39;&quot;</span>;</div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;        echo <span class="stringliteral">&quot;&gt;&quot;</span>.htmlencode($result[$i][<span class="stringliteral">&#39;name&#39;</span>]).<span class="stringliteral">&quot;&lt;/a&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;        $j++;</div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;    }</div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;}</div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;<span class="keywordflow">if</span>($j==0)</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;    echo $lang[<span class="stringliteral">&#39;no_tbl&#39;</span>];</div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;echo <span class="stringliteral">&quot;&lt;/fieldset&gt;&quot;</span>;</div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;</div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;<span class="comment">//- HTML: form to create a new database</span></div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;<span class="keywordflow">if</span>($directory!==<span class="keyword">false</span> &amp;&amp; is_writable($directory))</div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;{</div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;    echo <span class="stringliteral">&quot;&lt;fieldset style=&#39;margin:15px;&#39;&gt;&lt;legend&gt;&lt;b&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;db_create&#39;</span>].<span class="stringliteral">&quot;&lt;/b&gt; &quot;</span>.helpLink($lang[<span class="stringliteral">&#39;help2&#39;</span>]).<span class="stringliteral">&quot;&lt;/legend&gt;&quot;</span>; </div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;    echo <span class="stringliteral">&quot;&lt;form name=&#39;create_database&#39; method=&#39;post&#39; action=&#39;&quot;</span>.PAGE.<span class="stringliteral">&quot;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;    echo <span class="stringliteral">&quot;&lt;input type=&#39;text&#39; name=&#39;new_dbname&#39; style=&#39;width:150px;&#39;/&gt; &lt;input type=&#39;submit&#39; value=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;create&#39;</span>].<span class="stringliteral">&quot;&#39; class=&#39;btn&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;    echo <span class="stringliteral">&quot;&lt;/form&gt;&quot;</span>;</div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;    echo <span class="stringliteral">&quot;&lt;/fieldset&gt;&quot;</span>;</div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;}</div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;echo <span class="stringliteral">&quot;&lt;div style=&#39;text-align:center;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;echo <span class="stringliteral">&quot;&lt;form action=&#39;&quot;</span>.PAGE.<span class="stringliteral">&quot;&#39; method=&#39;post&#39;&gt;&quot;</span>;</div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;echo <span class="stringliteral">&quot;&lt;input type=&#39;submit&#39; value=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;logout&#39;</span>].<span class="stringliteral">&quot;&#39; name=&#39;logout&#39; class=&#39;btn&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;echo <span class="stringliteral">&quot;&lt;/form&gt;&quot;</span>;</div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;echo <span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;echo <span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;echo <span class="stringliteral">&#39;&lt;/td&gt;&lt;td valign=&quot;top&quot; id=&quot;main_column&quot; class=&quot;right_td&quot; style=&quot;padding:9px 2px 9px 9px;&quot;&gt;&#39;</span>;</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;</div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;<span class="comment">//- HTML: breadcrumb navigation</span></div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;echo <span class="stringliteral">&quot;&lt;a href=&#39;&quot;</span>.PAGE.<span class="stringliteral">&quot;&#39;&gt;&quot;</span>.htmlencode($currentDB[<span class="stringliteral">&#39;name&#39;</span>]).<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;<span class="keywordflow">if</span> ($target_table)</div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;    echo <span class="stringliteral">&quot; &amp;rarr; &lt;a href=&#39;?table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&amp;amp;action=row_view&#39;&gt;&quot;</span>.htmlencode($target_table).<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;echo <span class="stringliteral">&quot;&lt;br/&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;</div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;<span class="comment">//- HTML: confirmation panel</span></div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;<span class="comment">//if the user has performed some action, show the resulting message</span></div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;<span class="keywordflow">if</span>(isset($_GET[<span class="stringliteral">&#39;confirm&#39;</span>]))</div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;{</div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;    echo <span class="stringliteral">&quot;&lt;div id=&#39;main&#39;&gt;&quot;</span>;</div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;    echo <span class="stringliteral">&quot;&lt;div class=&#39;confirm&#39;&gt;&quot;</span>;</div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;    <span class="keywordflow">if</span>(isset($error) &amp;&amp; $error) <span class="comment">//an error occured during the action, so show an error message</span></div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;        echo $lang[<span class="stringliteral">&#39;err&#39;</span>].<span class="stringliteral">&quot;: &quot;</span>.<a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;getError().<span class="stringliteral">&quot;&lt;br/&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;bug_report&#39;</span>].<span class="charliteral">&#39; &#39;</span>.PROJECT_BUGTRACKER_LINK;</div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;    <span class="keywordflow">else</span> <span class="comment">//action was performed successfully - show success message</span></div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;        echo $completed;</div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;    echo <span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;    <span class="keywordflow">if</span>($_GET[<span class="stringliteral">&#39;action&#39;</span>]==<span class="stringliteral">&quot;row_delete&quot;</span> || $_GET[<span class="stringliteral">&#39;action&#39;</span>]==<span class="stringliteral">&quot;row_create&quot;</span> || $_GET[<span class="stringliteral">&#39;action&#39;</span>]==<span class="stringliteral">&quot;row_edit&quot;</span>)</div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;        echo <span class="stringliteral">&quot;&lt;br/&gt;&lt;br/&gt;&lt;a href=&#39;?table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&amp;amp;action=row_view&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;return&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>($_GET[<span class="stringliteral">&#39;action&#39;</span>]==<span class="stringliteral">&quot;column_create&quot;</span> || $_GET[<span class="stringliteral">&#39;action&#39;</span>]==<span class="stringliteral">&quot;column_delete&quot;</span> || $_GET[<span class="stringliteral">&#39;action&#39;</span>]==<span class="stringliteral">&quot;column_edit&quot;</span> || $_GET[<span class="stringliteral">&#39;action&#39;</span>]==<span class="stringliteral">&quot;index_create&quot;</span> || $_GET[<span class="stringliteral">&#39;action&#39;</span>]==<span class="stringliteral">&quot;index_delete&quot;</span> || $_GET[<span class="stringliteral">&#39;action&#39;</span>]==<span class="stringliteral">&quot;trigger_delete&quot;</span> || $_GET[<span class="stringliteral">&#39;action&#39;</span>]==<span class="stringliteral">&quot;trigger_create&quot;</span>)</div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;        echo <span class="stringliteral">&quot;&lt;br/&gt;&lt;br/&gt;&lt;a href=&#39;?table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&amp;amp;action=column_view&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;return&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;        echo <span class="stringliteral">&quot;&lt;br/&gt;&lt;br/&gt;&lt;a href=&#39;&quot;</span>.PAGE.(isset($backlinkParameters)?<span class="stringliteral">&quot;?&quot;</span>.$backlinkParameters:<span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&quot;&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;return&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;    echo <span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;}</div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;</div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;<span class="comment">//- Show the various tab views for a table</span></div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;<span class="keywordflow">if</span>(!isset($_GET[<span class="stringliteral">&#39;confirm&#39;</span>]) &amp;&amp; $target_table &amp;&amp; isset($_GET[<span class="stringliteral">&#39;action&#39;</span>]) &amp;&amp; ($_GET[<span class="stringliteral">&#39;action&#39;</span>]==<span class="stringliteral">&quot;table_export&quot;</span> || $_GET[<span class="stringliteral">&#39;action&#39;</span>]==<span class="stringliteral">&quot;table_import&quot;</span> || $_GET[<span class="stringliteral">&#39;action&#39;</span>]==<span class="stringliteral">&quot;table_sql&quot;</span> || $_GET[<span class="stringliteral">&#39;action&#39;</span>]==<span class="stringliteral">&quot;row_view&quot;</span> || $_GET[<span class="stringliteral">&#39;action&#39;</span>]==<span class="stringliteral">&quot;row_create&quot;</span> || $_GET[<span class="stringliteral">&#39;action&#39;</span>]==<span class="stringliteral">&quot;column_view&quot;</span> || $_GET[<span class="stringliteral">&#39;action&#39;</span>]==<span class="stringliteral">&quot;table_rename&quot;</span> || $_GET[<span class="stringliteral">&#39;action&#39;</span>]==<span class="stringliteral">&quot;table_search&quot;</span> || $_GET[<span class="stringliteral">&#39;action&#39;</span>]==<span class="stringliteral">&quot;table_triggers&quot;</span>))</div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;{</div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;    <span class="comment">//- HTML: tabs for tables</span></div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;    <span class="keywordflow">if</span>($target_table_type == <span class="stringliteral">&#39;table&#39;</span>)</div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;    {</div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;        echo <span class="stringliteral">&quot;&lt;a href=&#39;?table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&amp;amp;action=row_view&#39; &quot;</span>;</div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;        <span class="keywordflow">if</span>($_GET[<span class="stringliteral">&#39;action&#39;</span>]==<span class="stringliteral">&quot;row_view&quot;</span>)</div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;            echo <span class="stringliteral">&quot;class=&#39;tab_pressed&#39;&quot;</span>;</div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;            echo <span class="stringliteral">&quot;class=&#39;tab&#39;&quot;</span>;</div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;        echo <span class="stringliteral">&quot;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;browse&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;        echo <span class="stringliteral">&quot;&lt;a href=&#39;?table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&amp;amp;action=column_view&#39; &quot;</span>;</div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;        <span class="keywordflow">if</span>($_GET[<span class="stringliteral">&#39;action&#39;</span>]==<span class="stringliteral">&quot;column_view&quot;</span>)</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;            echo <span class="stringliteral">&quot;class=&#39;tab_pressed&#39;&quot;</span>;</div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;            echo <span class="stringliteral">&quot;class=&#39;tab&#39;&quot;</span>;</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;        echo <span class="stringliteral">&quot;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;struct&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;        echo <span class="stringliteral">&quot;&lt;a href=&#39;?table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&amp;amp;action=table_sql&#39; &quot;</span>;</div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;        <span class="keywordflow">if</span>($_GET[<span class="stringliteral">&#39;action&#39;</span>]==<span class="stringliteral">&quot;table_sql&quot;</span>)</div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;            echo <span class="stringliteral">&quot;class=&#39;tab_pressed&#39;&quot;</span>;</div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;            echo <span class="stringliteral">&quot;class=&#39;tab&#39;&quot;</span>;</div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;        echo <span class="stringliteral">&quot;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;sql&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;        echo <span class="stringliteral">&quot;&lt;a href=&#39;?table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&amp;amp;action=table_search&#39; &quot;</span>;</div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;        <span class="keywordflow">if</span>($_GET[<span class="stringliteral">&#39;action&#39;</span>]==<span class="stringliteral">&quot;table_search&quot;</span>)</div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;            echo <span class="stringliteral">&quot;class=&#39;tab_pressed&#39;&quot;</span>;</div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;            echo <span class="stringliteral">&quot;class=&#39;tab&#39;&quot;</span>;</div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;        echo <span class="stringliteral">&quot;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;srch&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;        echo <span class="stringliteral">&quot;&lt;a href=&#39;?table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&amp;amp;action=row_create&#39; &quot;</span>;</div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;        <span class="keywordflow">if</span>($_GET[<span class="stringliteral">&#39;action&#39;</span>]==<span class="stringliteral">&quot;row_create&quot;</span>)</div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;            echo <span class="stringliteral">&quot;class=&#39;tab_pressed&#39;&quot;</span>;</div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;            echo <span class="stringliteral">&quot;class=&#39;tab&#39;&quot;</span>;</div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;        echo <span class="stringliteral">&quot;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;insert&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;        echo <span class="stringliteral">&quot;&lt;a href=&#39;?table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&amp;amp;action=table_export&#39; &quot;</span>;</div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;        <span class="keywordflow">if</span>($_GET[<span class="stringliteral">&#39;action&#39;</span>]==<span class="stringliteral">&quot;table_export&quot;</span>)</div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;            echo <span class="stringliteral">&quot;class=&#39;tab_pressed&#39;&quot;</span>;</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;            echo <span class="stringliteral">&quot;class=&#39;tab&#39;&quot;</span>;</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;        echo <span class="stringliteral">&quot;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;export&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;        echo <span class="stringliteral">&quot;&lt;a href=&#39;?table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&amp;amp;action=table_import&#39; &quot;</span>;</div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;        <span class="keywordflow">if</span>($_GET[<span class="stringliteral">&#39;action&#39;</span>]==<span class="stringliteral">&quot;table_import&quot;</span>)</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;            echo <span class="stringliteral">&quot;class=&#39;tab_pressed&#39;&quot;</span>;</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;            echo <span class="stringliteral">&quot;class=&#39;tab&#39;&quot;</span>;</div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;        echo <span class="stringliteral">&quot;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;import&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;        echo <span class="stringliteral">&quot;&lt;a href=&#39;?table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&amp;amp;action=table_rename&#39; &quot;</span>;</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;        <span class="keywordflow">if</span>($_GET[<span class="stringliteral">&#39;action&#39;</span>]==<span class="stringliteral">&quot;table_rename&quot;</span>)</div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;            echo <span class="stringliteral">&quot;class=&#39;tab_pressed&#39;&quot;</span>;</div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;            echo <span class="stringliteral">&quot;class=&#39;tab&#39;&quot;</span>;</div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;        echo <span class="stringliteral">&quot;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;rename&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;        echo <span class="stringliteral">&quot;&lt;a href=&#39;?action=table_empty&amp;amp;table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&#39; &quot;</span>;</div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;        echo <span class="stringliteral">&quot;class=&#39;tab empty&#39;&quot;</span>;</div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;        echo <span class="stringliteral">&quot;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;empty&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;        echo <span class="stringliteral">&quot;&lt;a href=&#39;?action=table_drop&amp;amp;table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&#39; &quot;</span>;</div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;        echo <span class="stringliteral">&quot;class=&#39;tab drop&#39;&quot;</span>;</div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;        echo <span class="stringliteral">&quot;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;drop&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;        echo <span class="stringliteral">&quot;&lt;div style=&#39;clear:both;&#39;&gt;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;    }</div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;    <span class="comment">//- HTML: tabs for views</span></div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;    {</div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;        echo <span class="stringliteral">&quot;&lt;a href=&#39;?table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&amp;amp;action=row_view&#39; &quot;</span>;</div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;        <span class="keywordflow">if</span>($_GET[<span class="stringliteral">&#39;action&#39;</span>]==<span class="stringliteral">&quot;row_view&quot;</span>)</div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;            echo <span class="stringliteral">&quot;class=&#39;tab_pressed&#39;&quot;</span>;</div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;            echo <span class="stringliteral">&quot;class=&#39;tab&#39;&quot;</span>;</div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;        echo <span class="stringliteral">&quot;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;browse&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;        echo <span class="stringliteral">&quot;&lt;a href=&#39;?table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&amp;amp;action=column_view&#39; &quot;</span>;</div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;        <span class="keywordflow">if</span>($_GET[<span class="stringliteral">&#39;action&#39;</span>]==<span class="stringliteral">&quot;column_view&quot;</span>)</div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;            echo <span class="stringliteral">&quot;class=&#39;tab_pressed&#39;&quot;</span>;</div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;            echo <span class="stringliteral">&quot;class=&#39;tab&#39;&quot;</span>;</div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;        echo <span class="stringliteral">&quot;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;struct&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;        echo <span class="stringliteral">&quot;&lt;a href=&#39;?table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&amp;amp;action=table_sql&#39; &quot;</span>;</div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;        <span class="keywordflow">if</span>($_GET[<span class="stringliteral">&#39;action&#39;</span>]==<span class="stringliteral">&quot;table_sql&quot;</span>)</div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;            echo <span class="stringliteral">&quot;class=&#39;tab_pressed&#39;&quot;</span>;</div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;            echo <span class="stringliteral">&quot;class=&#39;tab&#39;&quot;</span>;</div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;        echo <span class="stringliteral">&quot;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;sql&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;        echo <span class="stringliteral">&quot;&lt;a href=&#39;?table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&amp;amp;action=table_search&#39; &quot;</span>;</div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;        <span class="keywordflow">if</span>($_GET[<span class="stringliteral">&#39;action&#39;</span>]==<span class="stringliteral">&quot;table_search&quot;</span>)</div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;            echo <span class="stringliteral">&quot;class=&#39;tab_pressed&#39;&quot;</span>;</div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;            echo <span class="stringliteral">&quot;class=&#39;tab&#39;&quot;</span>;</div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;        echo <span class="stringliteral">&quot;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;srch&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;        echo <span class="stringliteral">&quot;&lt;a href=&#39;?table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&amp;amp;action=table_export&#39; &quot;</span>;</div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;        <span class="keywordflow">if</span>($_GET[<span class="stringliteral">&#39;action&#39;</span>]==<span class="stringliteral">&quot;table_export&quot;</span>)</div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;            echo <span class="stringliteral">&quot;class=&#39;tab_pressed&#39;&quot;</span>;</div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;            echo <span class="stringliteral">&quot;class=&#39;tab&#39;&quot;</span>;</div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;        echo <span class="stringliteral">&quot;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;export&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;        echo <span class="stringliteral">&quot;&lt;a href=&#39;?action=view_drop&amp;amp;table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&#39; &quot;</span>;</div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;        echo <span class="stringliteral">&quot;class=&#39;tab drop&#39;&quot;</span>;</div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;        echo <span class="stringliteral">&quot;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;drop&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;        echo <span class="stringliteral">&quot;&lt;div style=&#39;clear:both;&#39;&gt;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;    }</div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;}</div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;</div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;<span class="comment">//- Switch on $_GET[&#39;action&#39;] for operations with output</span></div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;<span class="keywordflow">if</span>(isset($_GET[<span class="stringliteral">&#39;action&#39;</span>]) &amp;&amp; !isset($_GET[<span class="stringliteral">&#39;confirm&#39;</span>]))</div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;{</div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;    echo <span class="stringliteral">&quot;&lt;div id=&#39;main&#39;&gt;&quot;</span>;</div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;    <span class="keywordflow">switch</span>($_GET[<span class="stringliteral">&#39;action&#39;</span>])</div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;    {</div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;    <span class="comment">//- Table actions</span></div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;</div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;        <span class="comment">//- Create table (=table_create)</span></div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;        <span class="keywordflow">case</span> <span class="stringliteral">&quot;table_create&quot;</span>:</div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;            $query = <span class="stringliteral">&quot;SELECT name FROM sqlite_master WHERE type=&#39;table&#39; AND name=&quot;</span>.$db-&gt;quote($_POST[<span class="stringliteral">&#39;tablename&#39;</span>]);</div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;            $results = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;selectArray($query);</div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;            <span class="keywordflow">if</span>(<span class="keyword">sizeof</span>($results)&gt;0)</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;                $exists = <span class="keyword">true</span>;</div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;                $exists = <span class="keyword">false</span>;</div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;            echo <span class="stringliteral">&quot;&lt;h2&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;create_tbl&#39;</span>].<span class="stringliteral">&quot;: &#39;&quot;</span>.htmlencode($_POST[<span class="stringliteral">&#39;tablename&#39;</span>]).<span class="stringliteral">&quot;&#39;&lt;/h2&gt;&quot;</span>;</div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;            <span class="keywordflow">if</span>($_POST[<span class="stringliteral">&#39;tablefields&#39;</span>]==<span class="stringliteral">&quot;&quot;</span> || intval($_POST[<span class="stringliteral">&#39;tablefields&#39;</span>])&lt;=0)</div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;                echo $lang[<span class="stringliteral">&#39;specify_fields&#39;</span>];</div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span>($_POST[<span class="stringliteral">&#39;tablename&#39;</span>]==<span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;                echo $lang[<span class="stringliteral">&#39;specify_tbl&#39;</span>];</div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span>($exists)</div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;                echo $lang[<span class="stringliteral">&#39;tbl_exists&#39;</span>];</div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;            {</div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;                $num = intval($_POST[<span class="stringliteral">&#39;tablefields&#39;</span>]);</div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;                $name = $_POST[<span class="stringliteral">&#39;tablename&#39;</span>];</div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;                echo <span class="stringliteral">&quot;&lt;form action=&#39;?action=table_create&amp;amp;confirm=1&#39; method=&#39;post&#39;&gt;&quot;</span>;</div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;                echo <span class="stringliteral">&quot;&lt;input type=&#39;hidden&#39; name=&#39;tablename&#39; value=&#39;&quot;</span>.htmlencode($name).<span class="stringliteral">&quot;&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;                echo <span class="stringliteral">&quot;&lt;input type=&#39;hidden&#39; name=&#39;rows&#39; value=&#39;&quot;</span>.$num.<span class="stringliteral">&quot;&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;                echo <span class="stringliteral">&quot;&lt;table border=&#39;0&#39; cellpadding=&#39;2&#39; cellspacing=&#39;1&#39; class=&#39;viewTable&#39;&gt;&quot;</span>;</div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;                echo <span class="stringliteral">&quot;&lt;tr&gt;&quot;</span>;</div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;                $headings = array($lang[<span class="stringliteral">&#39;fld&#39;</span>], $lang[<span class="stringliteral">&#39;type&#39;</span>], $lang[<span class="stringliteral">&#39;prim_key&#39;</span>]);</div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;                <span class="keywordflow">if</span>(<a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;getType() != <span class="stringliteral">&quot;SQLiteDatabase&quot;</span>) $headings[] = $lang[<span class="stringliteral">&#39;autoincrement&#39;</span>];</div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;                $headings[] = $lang[<span class="stringliteral">&#39;not_null&#39;</span>];</div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;                $headings[] = $lang[<span class="stringliteral">&#39;def_val&#39;</span>];</div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;                <span class="keywordflow">for</span>($k=0; $k&lt;count($headings); $k++)</div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;                    echo <span class="stringliteral">&quot;&lt;td class=&#39;tdheader&#39;&gt;&quot;</span> . $headings[$k] . <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;                echo <span class="stringliteral">&quot;&lt;/tr&gt;&quot;</span>;</div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;</div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;                <span class="keywordflow">for</span>($i=0; $i&lt;$num; $i++)</div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;                {</div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;                    $tdWithClass = <span class="stringliteral">&quot;&lt;td class=&#39;td&quot;</span> . ($i%2 ? <span class="stringliteral">&quot;1&quot;</span> : <span class="stringliteral">&quot;2&quot;</span>) . <span class="stringliteral">&quot;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;                    echo <span class="stringliteral">&quot;&lt;tr&gt;&quot;</span>;</div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;                    echo $tdWithClass;</div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;                    echo <span class="stringliteral">&quot;&lt;input type=&#39;text&#39; name=&#39;&quot;</span>.$i.<span class="stringliteral">&quot;_field&#39; style=&#39;width:200px;&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;                    echo $tdWithClass;</div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;                    echo <span class="stringliteral">&quot;&lt;select name=&#39;&quot;</span>.$i.<span class="stringliteral">&quot;_type&#39; id=&#39;i&quot;</span>.$i.<span class="stringliteral">&quot;_type&#39; onchange=&#39;toggleAutoincrement(&quot;</span>.$i.<span class="stringliteral">&quot;);&#39;&gt;&quot;</span>;</div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;                    <span class="keywordflow">foreach</span> ($sqlite_datatypes as $t) {</div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;                        echo <span class="stringliteral">&quot;&lt;option value=&#39;&quot;</span>.htmlencode($t).<span class="stringliteral">&quot;&#39;&gt;&quot;</span>.htmlencode($t).<span class="stringliteral">&quot;&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;                    }</div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/select&gt;&quot;</span>;</div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;                    echo $tdWithClass;</div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;                    echo <span class="stringliteral">&quot;&lt;label&gt;&lt;input type=&#39;checkbox&#39; name=&#39;&quot;</span>.$i.<span class="stringliteral">&quot;_primarykey&#39; id=&#39;i&quot;</span>.$i.<span class="stringliteral">&quot;_primarykey&#39; onclick=&#39;toggleNull(&quot;</span>.$i.<span class="stringliteral">&quot;); toggleAutoincrement(&quot;</span>.$i.<span class="stringliteral">&quot;);&#39;/&gt; &quot;</span>.$lang[<span class="stringliteral">&#39;yes&#39;</span>].<span class="stringliteral">&quot;&lt;/label&gt;&quot;</span>;</div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;                    <span class="keywordflow">if</span>(<a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;getType() != <span class="stringliteral">&quot;SQLiteDatabase&quot;</span>)</div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;                    {</div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;                        echo $tdWithClass;</div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;                        echo <span class="stringliteral">&quot;&lt;label&gt;&lt;input type=&#39;checkbox&#39; name=&#39;&quot;</span>.$i.<span class="stringliteral">&quot;_autoincrement&#39; id=&#39;i&quot;</span>.$i.<span class="stringliteral">&quot;_autoincrement&#39;/&gt; &quot;</span>.$lang[<span class="stringliteral">&#39;yes&#39;</span>].<span class="stringliteral">&quot;&lt;/label&gt;&quot;</span>;</div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;                        echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;                    }</div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;                    echo $tdWithClass;</div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;                    echo <span class="stringliteral">&quot;&lt;label&gt;&lt;input type=&#39;checkbox&#39; name=&#39;&quot;</span>.$i.<span class="stringliteral">&quot;_notnull&#39; id=&#39;i&quot;</span>.$i.<span class="stringliteral">&quot;_notnull&#39;/&gt; &quot;</span>.$lang[<span class="stringliteral">&#39;yes&#39;</span>].<span class="stringliteral">&quot;&lt;/label&gt;&quot;</span>;</div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;                    echo $tdWithClass;</div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;                    echo <span class="stringliteral">&quot;&lt;select name=&#39;&quot;</span>.$i.<span class="stringliteral">&quot;_defaultoption&#39; id=&#39;i&quot;</span>.$i.<span class="stringliteral">&quot;_defaultoption&#39; onchange=\&quot;if(this.value!=&#39;defined&#39; &amp;&amp; this.value!=&#39;expr&#39;) document.getElementById(&#39;i&quot;</span>.$i.<span class="stringliteral">&quot;_defaultvalue&#39;).value=&#39;&#39;;\&quot;&gt;&quot;</span>;</div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;                    echo <span class="stringliteral">&quot;&lt;option value=&#39;none&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;none&#39;</span>].<span class="stringliteral">&quot;&lt;/option&gt;&lt;option value=&#39;defined&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;as_defined&#39;</span>].<span class="stringliteral">&quot;:&lt;/option&gt;&lt;option&gt;NULL&lt;/option&gt;&lt;option&gt;CURRENT_TIME&lt;/option&gt;&lt;option&gt;CURRENT_DATE&lt;/option&gt;&lt;option&gt;CURRENT_TIMESTAMP&lt;/option&gt;&lt;option value=&#39;expr&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;expression&#39;</span>].<span class="stringliteral">&quot;:&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/select&gt;&quot;</span>;</div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;                    echo <span class="stringliteral">&quot;&lt;input type=&#39;text&#39; name=&#39;&quot;</span>.$i.<span class="stringliteral">&quot;_defaultvalue&#39; id=&#39;i&quot;</span>.$i.<span class="stringliteral">&quot;_defaultvalue&#39; style=&#39;width:100px;&#39; onchange=\&quot;if(document.getElementById(&#39;i&quot;</span>.$i.<span class="stringliteral">&quot;_defaultoption&#39;).value!=&#39;expr&#39;) document.getElementById(&#39;i&quot;</span>.$i.<span class="stringliteral">&quot;_defaultoption&#39;).value=&#39;defined&#39;;\&quot;/&gt;&quot;</span>;</div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/tr&gt;&quot;</span>;</div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;                }</div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;                echo <span class="stringliteral">&quot;&lt;tr&gt;&quot;</span>;</div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;                echo <span class="stringliteral">&quot;&lt;td class=&#39;tdheader&#39; style=&#39;text-align:right;&#39; colspan=&#39;6&#39;&gt;&quot;</span>;</div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;                echo <span class="stringliteral">&quot;&lt;input type=&#39;submit&#39; value=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;create&#39;</span>].<span class="stringliteral">&quot;&#39; class=&#39;btn&#39;/&gt; &quot;</span>;</div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;                echo <span class="stringliteral">&quot;&lt;a href=&#39;&quot;</span>.PAGE.<span class="stringliteral">&quot;&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;cancel&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;                echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;                echo <span class="stringliteral">&quot;&lt;/tr&gt;&quot;</span>;</div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;                echo <span class="stringliteral">&quot;&lt;/table&gt;&quot;</span>;</div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;                echo <span class="stringliteral">&quot;&lt;/form&gt;&quot;</span>;</div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;                <span class="keywordflow">if</span>(<a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;getType() != <span class="stringliteral">&quot;SQLiteDatabase&quot;</span>) echo <span class="stringliteral">&quot;&lt;script type=&#39;text/javascript&#39;&gt;window.onload=initAutoincrement;&lt;/script&gt;&quot;</span>;</div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;            }</div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;</div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;        <span class="comment">//- Perform SQL query on table (=table_sql)</span></div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;        <span class="keywordflow">case</span> <span class="stringliteral">&quot;table_sql&quot;</span>:</div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;            $isSelect = <span class="keyword">false</span>;</div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;            <span class="keywordflow">if</span>(isset($_POST[<span class="stringliteral">&#39;query&#39;</span>]) &amp;&amp; $_POST[<span class="stringliteral">&#39;query&#39;</span>]!=<span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;            {</div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;                $delimiter = $_POST[<span class="stringliteral">&#39;delimiter&#39;</span>];</div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;                $queryStr = $_POST[<span class="stringliteral">&#39;queryval&#39;</span>];</div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;                <span class="comment">//save the queries in history if necessary</span></div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;                <span class="keywordflow">if</span>($maxSavedQueries!=0 &amp;&amp; $maxSavedQueries!=<span class="keyword">false</span>)</div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;                {</div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;                    <span class="keywordflow">if</span>(!isset($_SESSION[<span class="stringliteral">&#39;query_history&#39;</span>]))</div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;                        $_SESSION[<span class="stringliteral">&#39;query_history&#39;</span>] = array();</div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;                    $_SESSION[<span class="stringliteral">&#39;query_history&#39;</span>][md5(strtolower($queryStr))] = $queryStr;</div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;                    <span class="keywordflow">if</span>(<span class="keyword">sizeof</span>($_SESSION[<span class="stringliteral">&#39;query_history&#39;</span>]) &gt; $maxSavedQueries)</div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;                        array_shift($_SESSION[<span class="stringliteral">&#39;query_history&#39;</span>]);</div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;                }</div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;                $query = explode_sql($delimiter, $queryStr); <span class="comment">//explode the query string into individual queries based on the delimiter</span></div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;</div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;                <span class="keywordflow">for</span>($i=0; $i&lt;<span class="keyword">sizeof</span>($query); $i++) <span class="comment">//iterate through the queries exploded by the delimiter</span></div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;                {</div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;                    <span class="keywordflow">if</span>(str_replace(<span class="stringliteral">&quot; &quot;</span>, <span class="stringliteral">&quot;&quot;</span>, str_replace(<span class="stringliteral">&quot;\n&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, str_replace(<span class="stringliteral">&quot;\r&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, $query[$i])))!=<span class="stringliteral">&quot;&quot;</span>) <span class="comment">//make sure this query is not an empty string</span></div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;                    {</div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;                        $queryTimer = <span class="keyword">new</span> MicroTimer();</div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;                        $result = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;selectArray($query[$i], <span class="stringliteral">&quot;assoc&quot;</span>);</div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;                        $queryTimer-&gt;stop();</div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;</div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;                        echo <span class="stringliteral">&quot;&lt;div class=&#39;confirm&#39;&gt;&quot;</span>;</div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;                        echo <span class="stringliteral">&quot;&lt;b&gt;&quot;</span>;</div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;                        </div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;                        <span class="keywordflow">if</span>($result !== NULL)</div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;                        {</div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;                        </div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;                            <span class="keywordflow">if</span>(<span class="keyword">sizeof</span>($result)&gt;0 || <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;getAffectedRows()==0)</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;                            {</div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;                                printf($lang[<span class="stringliteral">&#39;show_rows&#39;</span>], <span class="keyword">sizeof</span>($result));</div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;                            }</div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;                            <span class="keywordflow">if</span>(<a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;getAffectedRows()&gt;0 || <span class="keyword">sizeof</span>($result)==0)</div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;                            {</div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;                                echo <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;getAffectedRows().<span class="stringliteral">&quot; &quot;</span>.$lang[<span class="stringliteral">&#39;rows_aff&#39;</span>].<span class="stringliteral">&quot; &quot;</span>;</div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;                            }</div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;                            printf($lang[<span class="stringliteral">&#39;query_time&#39;</span>], $queryTimer);</div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;                            echo <span class="stringliteral">&quot;&lt;/b&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;                        }</div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;                        <span class="keywordflow">else</span></div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;                        {</div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;                            echo $lang[<span class="stringliteral">&#39;err&#39;</span>].<span class="stringliteral">&quot;: &quot;</span>.<a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;getError().<span class="stringliteral">&quot;&lt;/b&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;                        }</div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;                        </div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;                        echo <span class="stringliteral">&quot;&lt;span style=&#39;font-size:11px;&#39;&gt;&quot;</span>.htmlencode($query[$i]).<span class="stringliteral">&quot;&lt;/span&gt;&quot;</span>;</div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;                        echo <span class="stringliteral">&quot;&lt;/div&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;                        <span class="keywordflow">if</span>(<span class="keyword">sizeof</span>($result)&gt;0)</div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;                        {</div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;                            $headers = array_keys($result[0]);</div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;</div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;                            echo <span class="stringliteral">&quot;&lt;table border=&#39;0&#39; cellpadding=&#39;2&#39; cellspacing=&#39;1&#39; class=&#39;viewTable&#39;&gt;&quot;</span>;</div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;                            echo <span class="stringliteral">&quot;&lt;tr&gt;&quot;</span>;</div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;                            <span class="keywordflow">for</span>($j=0; $j&lt;<span class="keyword">sizeof</span>($headers); $j++)</div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;                            {</div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;                                echo <span class="stringliteral">&quot;&lt;td class=&#39;tdheader&#39;&gt;&quot;</span>;</div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;                                echo htmlencode($headers[$j]);</div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;                                echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;                            }</div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;                            echo <span class="stringliteral">&quot;&lt;/tr&gt;&quot;</span>;</div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;                            <span class="keywordflow">for</span>($j=0; $j&lt;<span class="keyword">sizeof</span>($result); $j++)</div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;                            {</div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;                                $tdWithClass = <span class="stringliteral">&quot;&lt;td class=&#39;td&quot;</span>.($j%2 ? <span class="stringliteral">&quot;1&quot;</span> : <span class="stringliteral">&quot;2&quot;</span>).<span class="stringliteral">&quot;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;                                echo <span class="stringliteral">&quot;&lt;tr&gt;&quot;</span>;</div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;                                <span class="keywordflow">for</span>($z=0; $z&lt;<span class="keyword">sizeof</span>($headers); $z++)</div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;                                {</div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;                                    echo $tdWithClass;</div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;                                    <span class="keywordflow">if</span>($result[$j][$headers[$z]]===<span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;                                        echo <span class="stringliteral">&quot;&amp;nbsp;&quot;</span>;</div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;                                    elseif($result[$j][$headers[$z]]===NULL)</div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;                                        echo &quot;&lt;i class=&#39;null&#39;&gt;NULL&lt;/i&gt;&quot;;</div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;                                    else</div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;                                        echo htmlencode(subString($result[$j][$headers[$z]]));</div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;                                    echo &quot;&lt;/td&gt;&quot;;</div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;                                }</div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;                                echo &quot;&lt;/tr&gt;&quot;;</div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;                            }</div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;                            echo &quot;&lt;/table&gt;&lt;br/&gt;&lt;br/&gt;&quot;;</div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;                        }</div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;                    }</div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;                }</div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;            }</div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;            else</div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;            {</div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;                $delimiter = <span class="stringliteral">&quot;;&quot;</span>;</div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;                $queryStr = <span class="stringliteral">&quot;SELECT * FROM &quot;</span>.$db-&gt;quote_id($target_table).<span class="stringliteral">&quot; WHERE 1&quot;</span>;</div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;            }</div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;</div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;            echo <span class="stringliteral">&quot;&lt;fieldset&gt;&quot;</span>;</div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;            echo <span class="stringliteral">&quot;&lt;legend&gt;&lt;b&gt;&quot;</span>.sprintf($lang[<span class="stringliteral">&#39;run_sql&#39;</span>],htmlencode(<a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;getName())).<span class="stringliteral">&quot;&lt;/b&gt;&lt;/legend&gt;&quot;</span>;</div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;            echo <span class="stringliteral">&quot;&lt;form action=&#39;?table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&amp;amp;action=table_sql&#39; method=&#39;post&#39;&gt;&quot;</span>;</div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;            <span class="keywordflow">if</span>(isset($_SESSION[<span class="stringliteral">&#39;query_history&#39;</span>]) &amp;&amp; <span class="keyword">sizeof</span>($_SESSION[<span class="stringliteral">&#39;query_history&#39;</span>])&gt;0)</div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;            {</div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;                echo <span class="stringliteral">&quot;&lt;b&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;recent_queries&#39;</span>].<span class="stringliteral">&quot;&lt;/b&gt;&lt;ul&gt;&quot;</span>;</div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;                <span class="keywordflow">foreach</span>($_SESSION[<span class="stringliteral">&#39;query_history&#39;</span>] as $key =&gt; $value)</div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;                    echo <span class="stringliteral">&quot;&lt;li&gt;&lt;a onclick=&#39;document.getElementById(\&quot;queryval\&quot;).value = this.textContent&#39; href=&#39;#&#39;&gt;&quot;</span>.htmlencode($value).<span class="stringliteral">&quot;&lt;/a&gt;&lt;/li&gt;&quot;</span>;</div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;                echo <span class="stringliteral">&quot;&lt;/ul&gt;&lt;br/&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;            }</div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;            echo <span class="stringliteral">&quot;&lt;div style=&#39;float:left; width:70%;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;            echo <span class="stringliteral">&quot;&lt;textarea style=&#39;width:97%; height:300px;&#39; name=&#39;queryval&#39; id=&#39;queryval&#39; cols=&#39;50&#39; rows=&#39;8&#39;&gt;&quot;</span>.htmlencode($queryStr).<span class="stringliteral">&quot;&lt;/textarea&gt;&quot;</span>;</div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;            echo <span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;            echo <span class="stringliteral">&quot;&lt;div style=&#39;float:left; width:28%; padding-left:10px;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;            echo $lang[<span class="stringliteral">&#39;fields&#39;</span>].<span class="stringliteral">&quot;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;            echo <span class="stringliteral">&quot;&lt;select multiple=&#39;multiple&#39; style=&#39;width:100%;&#39; id=&#39;fieldcontainer&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;            $query = <span class="stringliteral">&quot;PRAGMA table_info(&quot;</span>.$db-&gt;quote_id($target_table).<span class="stringliteral">&quot;)&quot;</span>;</div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;            $result = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;selectArray($query);</div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;            <span class="keywordflow">for</span>($i=0; $i&lt;<span class="keyword">sizeof</span>($result); $i++)</div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;            {</div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;                echo <span class="stringliteral">&quot;&lt;option value=&#39;&quot;</span>.htmlencode($result[$i][1]).<span class="stringliteral">&quot;&#39;&gt;&quot;</span>.htmlencode($result[$i][1]).<span class="stringliteral">&quot;&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;            }</div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;            echo <span class="stringliteral">&quot;&lt;/select&gt;&quot;</span>;</div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;            echo <span class="stringliteral">&quot;&lt;input type=&#39;button&#39; value=&#39;&amp;lt;&amp;lt;&#39; onclick=&#39;moveFields();&#39; class=&#39;btn&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;            echo <span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;            echo <span class="stringliteral">&quot;&lt;div style=&#39;clear:both;&#39;&gt;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;            echo $lang[<span class="stringliteral">&#39;delimit&#39;</span>].<span class="stringliteral">&quot; &lt;input type=&#39;text&#39; name=&#39;delimiter&#39; value=&#39;&quot;</span>.htmlencode($delimiter).<span class="stringliteral">&quot;&#39; style=&#39;width:50px;&#39;/&gt; &quot;</span>;</div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;            echo <span class="stringliteral">&quot;&lt;input type=&#39;submit&#39; name=&#39;query&#39; value=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;go&#39;</span>].<span class="stringliteral">&quot;&#39; class=&#39;btn&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;            echo <span class="stringliteral">&quot;&lt;/form&gt;&quot;</span>;</div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;            echo <span class="stringliteral">&quot;&lt;/fieldset&gt;&quot;</span>;</div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;</div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;        <span class="comment">//- Empty table (=table_empty)</span></div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;        <span class="keywordflow">case</span> <span class="stringliteral">&quot;table_empty&quot;</span>:</div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;            echo <span class="stringliteral">&quot;&lt;form action=&#39;?action=table_empty&amp;amp;confirm=1&#39; method=&#39;post&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;            echo <span class="stringliteral">&quot;&lt;input type=&#39;hidden&#39; name=&#39;tablename&#39; value=&#39;&quot;</span>.htmlencode($target_table).<span class="stringliteral">&quot;&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;            echo <span class="stringliteral">&quot;&lt;div class=&#39;confirm&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;            echo sprintf($lang[<span class="stringliteral">&#39;ques_empty&#39;</span>], htmlencode($target_table)).<span class="stringliteral">&quot;&lt;br/&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;            echo <span class="stringliteral">&quot;&lt;input type=&#39;submit&#39; value=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;confirm&#39;</span>].<span class="stringliteral">&quot;&#39; class=&#39;btn&#39;/&gt; &quot;</span>;</div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;            echo <span class="stringliteral">&quot;&lt;a href=&#39;&quot;</span>.PAGE.<span class="stringliteral">&quot;&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;cancel&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;            echo <span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;</div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;        <span class="comment">//- Drop table (=table_drop)</span></div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;        <span class="keywordflow">case</span> <span class="stringliteral">&quot;table_drop&quot;</span>:</div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;            echo <span class="stringliteral">&quot;&lt;form action=&#39;?action=table_drop&amp;amp;confirm=1&#39; method=&#39;post&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;            echo <span class="stringliteral">&quot;&lt;input type=&#39;hidden&#39; name=&#39;tablename&#39; value=&#39;&quot;</span>.htmlencode($target_table).<span class="stringliteral">&quot;&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;            echo <span class="stringliteral">&quot;&lt;div class=&#39;confirm&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;            echo sprintf($lang[<span class="stringliteral">&#39;ques_drop&#39;</span>], htmlencode($target_table)).<span class="stringliteral">&quot;&lt;br/&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;            echo <span class="stringliteral">&quot;&lt;input type=&#39;submit&#39; value=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;confirm&#39;</span>].<span class="stringliteral">&quot;&#39; class=&#39;btn&#39;/&gt; &quot;</span>;</div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;            echo <span class="stringliteral">&quot;&lt;a href=&#39;&quot;</span>.PAGE.<span class="stringliteral">&quot;&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;cancel&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;            echo <span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;</div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;        <span class="comment">//- Drop view (=view_drop)</span></div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;        <span class="keywordflow">case</span> <span class="stringliteral">&quot;view_drop&quot;</span>:</div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;            echo <span class="stringliteral">&quot;&lt;form action=&#39;?action=view_drop&amp;amp;confirm=1&#39; method=&#39;post&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;            echo <span class="stringliteral">&quot;&lt;input type=&#39;hidden&#39; name=&#39;viewname&#39; value=&#39;&quot;</span>.htmlencode($target_table).<span class="stringliteral">&quot;&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;            echo <span class="stringliteral">&quot;&lt;div class=&#39;confirm&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;            echo sprintf($lang[<span class="stringliteral">&#39;ques_drop_view&#39;</span>], htmlencode($target_table)).<span class="stringliteral">&quot;&lt;br/&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;            echo <span class="stringliteral">&quot;&lt;input type=&#39;submit&#39; value=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;confirm&#39;</span>].<span class="stringliteral">&quot;&#39; class=&#39;btn&#39;/&gt; &quot;</span>;</div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;            echo <span class="stringliteral">&quot;&lt;a href=&#39;&quot;</span>.PAGE.<span class="stringliteral">&quot;&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;cancel&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;            echo <span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;</div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;        <span class="comment">//- Export table (=table_export)</span></div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;        <span class="keywordflow">case</span> <span class="stringliteral">&quot;table_export&quot;</span>:</div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;            echo <span class="stringliteral">&quot;&lt;form method=&#39;post&#39; action=&#39;&quot;</span>.PAGE.<span class="stringliteral">&quot;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;            echo <span class="stringliteral">&quot;&lt;fieldset style=&#39;float:left; width:260px; margin-right:20px;&#39;&gt;&lt;legend&gt;&lt;b&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;export&#39;</span>].<span class="stringliteral">&quot;&lt;/b&gt;&lt;/legend&gt;&quot;</span>;</div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;            echo <span class="stringliteral">&quot;&lt;input type=&#39;hidden&#39; value=&#39;&quot;</span>.htmlencode($target_table).<span class="stringliteral">&quot;&#39; name=&#39;single_table&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;            echo <span class="stringliteral">&quot;&lt;label&gt;&lt;input type=&#39;radio&#39; name=&#39;export_type&#39; checked=&#39;checked&#39; value=&#39;sql&#39; onclick=&#39;toggleExports(\&quot;sql\&quot;);&#39;/&gt; &quot;</span>.$lang[<span class="stringliteral">&#39;sql&#39;</span>].<span class="stringliteral">&quot;&lt;/label&gt;&quot;</span>;</div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;            echo <span class="stringliteral">&quot;&lt;br/&gt;&lt;label&gt;&lt;input type=&#39;radio&#39; name=&#39;export_type&#39; value=&#39;csv&#39; onclick=&#39;toggleExports(\&quot;csv\&quot;);&#39;/&gt; &quot;</span>.$lang[<span class="stringliteral">&#39;csv&#39;</span>].<span class="stringliteral">&quot;&lt;/label&gt;&quot;</span>;</div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;            echo <span class="stringliteral">&quot;&lt;/fieldset&gt;&quot;</span>;</div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;            </div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;            echo <span class="stringliteral">&quot;&lt;fieldset style=&#39;float:left; max-width:350px;&#39; id=&#39;exportoptions_sql&#39;&gt;&lt;legend&gt;&lt;b&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;options&#39;</span>].<span class="stringliteral">&quot;&lt;/b&gt;&lt;/legend&gt;&quot;</span>;</div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;            echo <span class="stringliteral">&quot;&lt;label&gt;&lt;input type=&#39;checkbox&#39; checked=&#39;checked&#39; name=&#39;structure&#39;/&gt; &quot;</span>.$lang[<span class="stringliteral">&#39;export_struct&#39;</span>].<span class="stringliteral">&quot;&lt;/label&gt; &quot;</span>.helpLink($lang[<span class="stringliteral">&#39;help5&#39;</span>]).<span class="stringliteral">&quot;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;            echo <span class="stringliteral">&quot;&lt;label&gt;&lt;input type=&#39;checkbox&#39; checked=&#39;checked&#39; name=&#39;data&#39;/&gt; &quot;</span>.$lang[<span class="stringliteral">&#39;export_data&#39;</span>].<span class="stringliteral">&quot;&lt;/label&gt; &quot;</span>.helpLink($lang[<span class="stringliteral">&#39;help6&#39;</span>]).<span class="stringliteral">&quot;&lt;br/&gt;&quot;</span>; </div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;            echo <span class="stringliteral">&quot;&lt;label&gt;&lt;input type=&#39;checkbox&#39; name=&#39;drop&#39;/&gt; &quot;</span>.$lang[<span class="stringliteral">&#39;add_drop&#39;</span>].<span class="stringliteral">&quot;&lt;/label&gt; &quot;</span>.helpLink($lang[<span class="stringliteral">&#39;help7&#39;</span>]).<span class="stringliteral">&quot;&lt;br/&gt;&quot;</span>; </div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;            echo <span class="stringliteral">&quot;&lt;label&gt;&lt;input type=&#39;checkbox&#39; checked=&#39;checked&#39; name=&#39;transaction&#39;/&gt; &quot;</span>.$lang[<span class="stringliteral">&#39;add_transact&#39;</span>].<span class="stringliteral">&quot;&lt;/label&gt; &quot;</span>.helpLink($lang[<span class="stringliteral">&#39;help8&#39;</span>]).<span class="stringliteral">&quot;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;            echo <span class="stringliteral">&quot;&lt;label&gt;&lt;input type=&#39;checkbox&#39; checked=&#39;checked&#39; name=&#39;comments&#39;/&gt; &quot;</span>.$lang[<span class="stringliteral">&#39;comments&#39;</span>].<span class="stringliteral">&quot;&lt;/label&gt; &quot;</span>.helpLink($lang[<span class="stringliteral">&#39;help9&#39;</span>]).<span class="stringliteral">&quot;&lt;br/&gt;&quot;</span>; </div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;            echo <span class="stringliteral">&quot;&lt;/fieldset&gt;&quot;</span>;</div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;            </div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;            echo <span class="stringliteral">&quot;&lt;fieldset style=&#39;float:left; max-width:350px; display:none;&#39; id=&#39;exportoptions_csv&#39;&gt;&lt;legend&gt;&lt;b&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;options&#39;</span>].<span class="stringliteral">&quot;&lt;/b&gt;&lt;/legend&gt;&quot;</span>;</div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;            echo <span class="stringliteral">&quot;&lt;div style=&#39;float:left;&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;fld_terminated&#39;</span>].<span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;            echo <span class="stringliteral">&quot;&lt;input type=&#39;text&#39; value=&#39;;&#39; name=&#39;export_csv_fieldsterminated&#39; style=&#39;float:right;&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;            echo <span class="stringliteral">&quot;&lt;div style=&#39;clear:both;&#39;&gt;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;            echo <span class="stringliteral">&quot;&lt;div style=&#39;float:left;&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;fld_enclosed&#39;</span>].<span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;            echo <span class="stringliteral">&quot;&lt;input type=&#39;text&#39; value=&#39;\&quot;&#39; name=&#39;export_csv_fieldsenclosed&#39; style=&#39;float:right;&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;            echo <span class="stringliteral">&quot;&lt;div style=&#39;clear:both;&#39;&gt;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;            echo <span class="stringliteral">&quot;&lt;div style=&#39;float:left;&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;fld_escaped&#39;</span>].<span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;            echo <span class="stringliteral">&quot;&lt;input type=&#39;text&#39; value=&#39;\&#39; name=&#39;export_csv_fieldsescaped&#39; style=&#39;float:right;&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;            echo <span class="stringliteral">&quot;&lt;div style=&#39;clear:both;&#39;&gt;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;            echo <span class="stringliteral">&quot;&lt;div style=&#39;float:left;&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;rep_null&#39;</span>].<span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;            echo <span class="stringliteral">&quot;&lt;input type=&#39;text&#39; value=&#39;NULL&#39; name=&#39;export_csv_replacenull&#39; style=&#39;float:right;&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;            echo <span class="stringliteral">&quot;&lt;div style=&#39;clear:both;&#39;&gt;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;            echo <span class="stringliteral">&quot;&lt;label&gt;&lt;input type=&#39;checkbox&#39; name=&#39;export_csv_crlf&#39;/&gt; &quot;</span>.$lang[<span class="stringliteral">&#39;rem_crlf&#39;</span>].<span class="stringliteral">&quot;&lt;/label&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;            echo <span class="stringliteral">&quot;&lt;label&gt;&lt;input type=&#39;checkbox&#39; checked=&#39;checked&#39; name=&#39;export_csv_fieldnames&#39;/&gt; &quot;</span>.$lang[<span class="stringliteral">&#39;put_fld&#39;</span>].<span class="stringliteral">&quot;&lt;/label&gt;&quot;</span>;</div><div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;            echo <span class="stringliteral">&quot;&lt;/fieldset&gt;&quot;</span>;</div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;            </div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;            echo <span class="stringliteral">&quot;&lt;div style=&#39;clear:both;&#39;&gt;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;            echo <span class="stringliteral">&quot;&lt;br/&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;            echo <span class="stringliteral">&quot;&lt;fieldset&gt;&lt;legend&gt;&lt;b&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;save_as&#39;</span>].<span class="stringliteral">&quot;&lt;/b&gt;&lt;/legend&gt;&quot;</span>;</div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;            $file = pathinfo(<a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;getPath());</div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;            $name = $file[<span class="stringliteral">&#39;filename&#39;</span>];</div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;            echo <span class="stringliteral">&quot;&lt;input type=&#39;text&#39; name=&#39;filename&#39; value=&#39;&quot;</span>.htmlencode($name).<span class="stringliteral">&quot;_&quot;</span>.htmlencode($target_table).<span class="stringliteral">&quot;_&quot;</span>.date(<span class="stringliteral">&quot;Y-m-d&quot;</span>).<span class="stringliteral">&quot;.dump&#39; style=&#39;width:400px;&#39;/&gt; &lt;input type=&#39;submit&#39; name=&#39;export&#39; value=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;export&#39;</span>].<span class="stringliteral">&quot;&#39; class=&#39;btn&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;            echo <span class="stringliteral">&quot;&lt;/fieldset&gt;&quot;</span>;</div><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;            echo <span class="stringliteral">&quot;&lt;/form&gt;&quot;</span>;</div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;            echo <span class="stringliteral">&quot;&lt;div class=&#39;confirm&#39; style=&#39;margin-top: 2em&#39;&gt;&quot;</span>.sprintf($lang[<span class="stringliteral">&#39;backup_hint&#39;</span>], <span class="stringliteral">&quot;&lt;a href=&#39;?download=&quot;</span>.urlencode($currentDB[<span class="stringliteral">&#39;path&#39;</span>]).<span class="stringliteral">&quot;&#39; title=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;backup&#39;</span>].<span class="stringliteral">&quot;&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&quot;backup_hint_linktext&quot;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>).<span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;</div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;        <span class="comment">//- Import table (=table_import)</span></div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;        <span class="keywordflow">case</span> <span class="stringliteral">&quot;table_import&quot;</span>:</div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;            <span class="keywordflow">if</span>(isset($_POST[<span class="stringliteral">&#39;import&#39;</span>]))</div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;            {</div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;                echo <span class="stringliteral">&quot;&lt;div class=&#39;confirm&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;                <span class="keywordflow">if</span>($importSuccess===<span class="keyword">true</span>)</div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;                    echo $lang[<span class="stringliteral">&#39;import_suc&#39;</span>];</div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;                    echo $lang[<span class="stringliteral">&#39;err&#39;</span>].<span class="stringliteral">&#39;: &#39;</span>.$importSuccess;</div><div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;                echo <span class="stringliteral">&quot;&lt;/div&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;            }</div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;            echo <span class="stringliteral">&quot;&lt;form method=&#39;post&#39; action=&#39;?table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&amp;amp;action=table_import&#39; enctype=&#39;multipart/form-data&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;            echo <span class="stringliteral">&quot;&lt;fieldset style=&#39;float:left; width:260px; margin-right:20px;&#39;&gt;&lt;legend&gt;&lt;b&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;import_into&#39;</span>].<span class="stringliteral">&quot; &quot;</span>.htmlencode($target_table).<span class="stringliteral">&quot;&lt;/b&gt;&lt;/legend&gt;&quot;</span>;</div><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;            echo <span class="stringliteral">&quot;&lt;label&gt;&lt;input type=&#39;radio&#39; name=&#39;import_type&#39; checked=&#39;checked&#39; value=&#39;sql&#39; onclick=&#39;toggleImports(\&quot;sql\&quot;);&#39;/&gt; &quot;</span>.$lang[<span class="stringliteral">&#39;sql&#39;</span>].<span class="stringliteral">&quot;&lt;/label&gt;&quot;</span>;</div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;            echo <span class="stringliteral">&quot;&lt;br/&gt;&lt;label&gt;&lt;input type=&#39;radio&#39; name=&#39;import_type&#39; value=&#39;csv&#39; onclick=&#39;toggleImports(\&quot;csv\&quot;);&#39;/&gt; &quot;</span>.$lang[<span class="stringliteral">&#39;csv&#39;</span>].<span class="stringliteral">&quot;&lt;/label&gt;&quot;</span>;</div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;            echo <span class="stringliteral">&quot;&lt;/fieldset&gt;&quot;</span>;</div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;            </div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;            echo <span class="stringliteral">&quot;&lt;fieldset style=&#39;float:left; max-width:350px;&#39; id=&#39;importoptions_sql&#39;&gt;&lt;legend&gt;&lt;b&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;options&#39;</span>].<span class="stringliteral">&quot;&lt;/b&gt;&lt;/legend&gt;&quot;</span>;</div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;            echo $lang[<span class="stringliteral">&#39;no_opt&#39;</span>];</div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;            echo <span class="stringliteral">&quot;&lt;/fieldset&gt;&quot;</span>;</div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;            </div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;            echo <span class="stringliteral">&quot;&lt;fieldset style=&#39;float:left; max-width:350px; display:none;&#39; id=&#39;importoptions_csv&#39;&gt;&lt;legend&gt;&lt;b&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;options&#39;</span>].<span class="stringliteral">&quot;&lt;/b&gt;&lt;/legend&gt;&quot;</span>;</div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;            echo <span class="stringliteral">&quot;&lt;input type=&#39;hidden&#39; value=&#39;&quot;</span>.htmlencode($target_table).<span class="stringliteral">&quot;&#39; name=&#39;single_table&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;            echo <span class="stringliteral">&quot;&lt;div style=&#39;float:left;&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;fld_terminated&#39;</span>].<span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;            echo <span class="stringliteral">&quot;&lt;input type=&#39;text&#39; value=&#39;;&#39; name=&#39;import_csv_fieldsterminated&#39; style=&#39;float:right;&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;            echo <span class="stringliteral">&quot;&lt;div style=&#39;clear:both;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;            echo <span class="stringliteral">&quot;&lt;div style=&#39;float:left;&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;fld_enclosed&#39;</span>].<span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;            echo <span class="stringliteral">&quot;&lt;input type=&#39;text&#39; value=&#39;\&quot;&#39; name=&#39;import_csv_fieldsenclosed&#39; style=&#39;float:right;&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;            echo <span class="stringliteral">&quot;&lt;div style=&#39;clear:both;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;            echo <span class="stringliteral">&quot;&lt;div style=&#39;float:left;&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;fld_escaped&#39;</span>].<span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;            echo <span class="stringliteral">&quot;&lt;input type=&#39;text&#39; value=&#39;\&#39; name=&#39;import_csv_fieldsescaped&#39; style=&#39;float:right;&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;            echo <span class="stringliteral">&quot;&lt;div style=&#39;clear:both;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;            echo <span class="stringliteral">&quot;&lt;div style=&#39;float:left;&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;rep_null&#39;</span>].<span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;            echo <span class="stringliteral">&quot;&lt;input type=&#39;text&#39; value=&#39;NULL&#39; name=&#39;import_csv_replacenull&#39; style=&#39;float:right;&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;            echo <span class="stringliteral">&quot;&lt;div style=&#39;clear:both;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;            echo <span class="stringliteral">&quot;&lt;label&gt;&lt;input type=&#39;checkbox&#39; checked=&#39;checked&#39; name=&#39;import_csv_fieldnames&#39;/&gt; &quot;</span>.$lang[<span class="stringliteral">&#39;fld_names&#39;</span>].<span class="stringliteral">&quot;&lt;/label&gt;&quot;</span>;</div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;            echo <span class="stringliteral">&quot;&lt;/fieldset&gt;&quot;</span>;</div><div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;            </div><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;            echo <span class="stringliteral">&quot;&lt;div style=&#39;clear:both;&#39;&gt;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;            echo <span class="stringliteral">&quot;&lt;br/&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;            </div><div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;            echo <span class="stringliteral">&quot;&lt;fieldset&gt;&lt;legend&gt;&lt;b&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;import_f&#39;</span>].<span class="stringliteral">&quot;&lt;/b&gt;&lt;/legend&gt;&quot;</span>;</div><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;            echo <span class="stringliteral">&quot;&lt;input type=&#39;file&#39; value=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;choose_f&#39;</span>].<span class="stringliteral">&quot;&#39; name=&#39;file&#39; style=&#39;background-color:transparent; border-style:none;&#39;/&gt; &lt;input type=&#39;submit&#39; value=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;import&#39;</span>].<span class="stringliteral">&quot;&#39; name=&#39;import&#39; class=&#39;btn&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;            echo <span class="stringliteral">&quot;&lt;/fieldset&gt;&quot;</span>;</div><div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;</div><div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;        <span class="comment">//- Rename table (=table_rename)</span></div><div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;        <span class="keywordflow">case</span> <span class="stringliteral">&quot;table_rename&quot;</span>:</div><div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;            echo <span class="stringliteral">&quot;&lt;form action=&#39;?action=table_rename&amp;amp;confirm=1&#39; method=&#39;post&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;            echo <span class="stringliteral">&quot;&lt;input type=&#39;hidden&#39; name=&#39;oldname&#39; value=&#39;&quot;</span>.htmlencode($target_table).<span class="stringliteral">&quot;&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;            printf($lang[<span class="stringliteral">&#39;rename_tbl&#39;</span>], htmlencode($target_table));</div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;            echo <span class="stringliteral">&quot; &lt;input type=&#39;text&#39; name=&#39;newname&#39; style=&#39;width:200px;&#39;/&gt; &lt;input type=&#39;submit&#39; value=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;rename&#39;</span>].<span class="stringliteral">&quot;&#39; name=&#39;rename&#39; class=&#39;btn&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;            echo <span class="stringliteral">&quot;&lt;/form&gt;&quot;</span>;</div><div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;</div><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;        <span class="comment">//- Search table (=table_search)</span></div><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;        <span class="keywordflow">case</span> <span class="stringliteral">&quot;table_search&quot;</span>:</div><div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;            $searchValues = array();</div><div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;            <span class="keywordflow">if</span>(isset($_GET[<span class="stringliteral">&#39;done&#39;</span>]))</div><div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;            {</div><div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;                $query = <span class="stringliteral">&quot;PRAGMA table_info(&quot;</span>.$db-&gt;quote_id($target_table).<span class="stringliteral">&quot;)&quot;</span>;</div><div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;                $result = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;selectArray($query);</div><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;                $primary_key = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;getPrimaryKey($target_table);</div><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;                $j = 0;</div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;                $arr = array();</div><div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;                <span class="keywordflow">for</span>($i=0; $i&lt;<span class="keyword">sizeof</span>($result); $i++)</div><div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;                {</div><div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;                    $field = $result[$i][1];</div><div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;                    $field_index = str_replace(<span class="stringliteral">&quot; &quot;</span>,<span class="stringliteral">&quot;_&quot;</span>,$field);</div><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;                    $operator = $_POST[$field_index.<span class="stringliteral">&quot;:operator&quot;</span>];</div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;                    $value = $_POST[$field_index];</div><div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;                    <span class="keywordflow">if</span>($value!=<span class="stringliteral">&quot;&quot;</span> || $operator==<span class="stringliteral">&quot;!= &#39;&#39;&quot;</span> || $operator==<span class="stringliteral">&quot;= &#39;&#39;&quot;</span>)</div><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;                    {</div><div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;                        <span class="keywordflow">if</span>($operator==<span class="stringliteral">&quot;= &#39;&#39;&quot;</span> || $operator==<span class="stringliteral">&quot;!= &#39;&#39;&quot;</span>)</div><div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;                            $arr[$j] = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;quote_id($field).<span class="stringliteral">&quot; &quot;</span>.$operator;</div><div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;                        </div><div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;                        <span class="keywordflow">else</span>{</div><div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;                            <span class="keywordflow">if</span>($operator == <span class="stringliteral">&quot;LIKE%&quot;</span>){ </div><div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;                                $operator = <span class="stringliteral">&quot;LIKE&quot;</span>;</div><div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;                                <span class="keywordflow">if</span>(!preg_match(<span class="stringliteral">&#39;/(^%)|(%$)/&#39;</span>, $value)) $value = <span class="charliteral">&#39;%&#39;</span>.$value.<span class="charliteral">&#39;%&#39;</span>;</div><div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;                            }</div><div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;                            $searchValues[$field] = $value;</div><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;                            $arr[$j] = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;quote_id($field).<span class="stringliteral">&quot; &quot;</span>.$operator.<span class="stringliteral">&quot; &quot;</span>.<a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;quote($value);</div><div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;                        }</div><div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;                        $j++;</div><div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;                    }</div><div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;                }</div><div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;                $query = <span class="stringliteral">&quot;SELECT *&quot;</span>;</div><div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;                <span class="comment">// select the primary key column(s) last (ROWID if there is no PK).</span></div><div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;                <span class="comment">// this will be used to identify rows, e.g. when editing/deleting rows</span></div><div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;                $primary_key = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;getPrimaryKey($target_table);</div><div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;                <span class="keywordflow">foreach</span>($primary_key as $pk)</div><div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;                {</div><div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;                    $query.= <span class="stringliteral">&#39;, &#39;</span>.$db-&gt;quote_id($pk);</div><div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;                    $query.= <span class="stringliteral">&#39;, typeof(&#39;</span>.$db-&gt;quote_id($pk).<span class="charliteral">&#39;)&#39;</span>;</div><div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;                }</div><div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;                $query .= <span class="stringliteral">&quot; FROM &quot;</span>.$db-&gt;quote_id($target_table);</div><div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;                $whereTo = <span class="stringliteral">&#39;&#39;</span>;</div><div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;                <span class="keywordflow">if</span>(<span class="keyword">sizeof</span>($arr)&gt;0)</div><div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;                {</div><div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;                    $whereTo .= <span class="stringliteral">&quot; WHERE &quot;</span>.$arr[0];</div><div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;                    <span class="keywordflow">for</span>($i=1; $i&lt;<span class="keyword">sizeof</span>($arr); $i++)</div><div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;                    {</div><div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;                        $whereTo .= <span class="stringliteral">&quot; AND &quot;</span>.$arr[$i];</div><div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;                    }</div><div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;                }</div><div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;                $query .= $whereTo;</div><div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;                $query_disp = <span class="stringliteral">&quot;SELECT * FROM &quot;</span> . <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;quote_id($target_table) . $whereTo;</div><div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;                $queryTimer = <span class="keyword">new</span> MicroTimer();</div><div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;                $arr = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;selectArray($query);</div><div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;                $queryTimer-&gt;stop();</div><div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;</div><div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;                echo <span class="stringliteral">&quot;&lt;div class=&#39;confirm&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;                echo <span class="stringliteral">&quot;&lt;b&gt;&quot;</span>;</div><div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;                <span class="keywordflow">if</span>($arr!==<span class="keyword">false</span>)</div><div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;                {</div><div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;                    $affected = <span class="keyword">sizeof</span>($arr);</div><div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;                    echo $lang[<span class="stringliteral">&#39;showing&#39;</span>].<span class="stringliteral">&quot; &quot;</span>.$affected.<span class="stringliteral">&quot; &quot;</span>.$lang[<span class="stringliteral">&#39;rows&#39;</span>].<span class="stringliteral">&quot;. &quot;</span>;</div><div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;                    printf($lang[<span class="stringliteral">&#39;query_time&#39;</span>], $queryTimer);</div><div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/b&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;                }</div><div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;                {</div><div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;                    echo $lang[<span class="stringliteral">&#39;err&#39;</span>].<span class="stringliteral">&quot;: &quot;</span>.<a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;getError().<span class="stringliteral">&quot;.&lt;/b&gt;&lt;br/&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;bug_report&#39;</span>].<span class="charliteral">&#39; &#39;</span>.PROJECT_BUGTRACKER_LINK.<span class="stringliteral">&#39;&lt;br/&gt;&#39;</span>;</div><div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;                }</div><div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;                echo <span class="stringliteral">&quot;&lt;span style=&#39;font-size:11px;&#39;&gt;&quot;</span>.htmlencode($query_disp).<span class="stringliteral">&quot;&lt;/span&gt;&quot;</span>;</div><div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;                echo <span class="stringliteral">&quot;&lt;/div&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;</div><div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;                <span class="keywordflow">if</span>(<span class="keyword">sizeof</span>($arr)&gt;0)</div><div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;                {</div><div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;                    <span class="keywordflow">if</span>($target_table_type == <span class="stringliteral">&#39;view&#39;</span>)</div><div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;                    {</div><div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;                        echo sprintf($lang[<span class="stringliteral">&#39;readonly_tbl&#39;</span>], htmlencode($target_table)).<span class="stringliteral">&quot; &lt;a href=&#39;http://en.wikipedia.org/wiki/View_(database)&#39; target=&#39;_blank&#39;&gt;http://en.wikipedia.org/wiki/View_(database)&lt;/a&gt;&quot;</span>; </div><div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;                        echo <span class="stringliteral">&quot;&lt;br/&gt;&lt;br/&gt;&quot;</span>;  </div><div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;                    }</div><div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;</div><div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;                    echo <span class="stringliteral">&quot;&lt;table border=&#39;0&#39; cellpadding=&#39;2&#39; cellspacing=&#39;1&#39; class=&#39;viewTable&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;                    echo <span class="stringliteral">&quot;&lt;tr&gt;&quot;</span>;</div><div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;                    <span class="keywordflow">if</span>($target_table_type == <span class="stringliteral">&#39;table&#39;</span>)</div><div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;                    {</div><div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;                        echo <span class="stringliteral">&quot;&lt;td colspan=&#39;2&#39; class=&#39;tdheader&#39; style=&#39;text-align:center&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;<span class="preprocessor">                        #todo: make sure the search keywords are kept</span></div><div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;<span class="preprocessor">                        #echo &quot;&lt;a href=&#39;?action=table_search&amp;amp;done=1&amp;amp;table=&quot;.$target_table.&quot;&amp;amp;fulltexts=&quot;.($_SESSION[COOKIENAME.&#39;fulltexts&#39;]?0:1).&quot;&#39; title=&#39;&quot;.$lang[($_SESSION[COOKIENAME.&#39;fulltexts&#39;]?&#39;no_full_texts&#39;:&#39;full_texts&#39;)].&quot;&#39;&gt;&quot;;</span></div><div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;<span class="preprocessor">                        #echo &quot;&lt;b&gt;&amp;&quot;.($_SESSION[COOKIENAME.&#39;fulltexts&#39;]?&#39;r&#39;:&#39;l&#39;).&quot;arr;&lt;/b&gt; T &lt;b&gt;&amp;&quot;.($_SESSION[COOKIENAME.&#39;fulltexts&#39;]?&#39;l&#39;:&#39;r&#39;).&quot;arr;&lt;/b&gt;&lt;/a&gt;&quot;;</span></div><div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;                        echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;                    }</div><div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;                    </div><div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;                    $header = array();</div><div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;                    <span class="keywordflow">for</span>($j=0; $j&lt;<span class="keyword">sizeof</span>($result); $j++)</div><div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;                    {</div><div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;                        $headers[$j]=$result[$j][<span class="stringliteral">&#39;name&#39;</span>];</div><div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;                        echo <span class="stringliteral">&quot;&lt;td class=&#39;tdheader&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;                        echo htmlencode($headers[$j]);</div><div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;                        echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;                    }</div><div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/tr&gt;&quot;</span>;</div><div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;                    </div><div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;                    $pkFirstCol = <span class="keyword">sizeof</span>($result)+1;</div><div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;                    <span class="keywordflow">for</span>($j=0; $j&lt;<span class="keyword">sizeof</span>($arr); $j++)</div><div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;                    {</div><div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;                        <span class="comment">// -g-&gt; $pk will always be the last columns in each row of the array because we are doing &quot;SELECT *, PK_1, typeof(PK_1), PK2, typeof(PK_2), ... FROM ...&quot;</span></div><div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;                        $pk_arr = array();</div><div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;                        <span class="keywordflow">for</span>($col = $pkFirstCol; array_key_exists($col, $arr[$j]); $col=$col+2)</div><div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;                        {</div><div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;                            <span class="comment">// in $col we have the type and in $col-1 the value</span></div><div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;                            <span class="keywordflow">if</span>($arr[$j][$col]==<span class="stringliteral">&#39;integer&#39;</span> || $arr[$j][$col]==<span class="stringliteral">&#39;real&#39;</span>)</div><div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;                                <span class="comment">// json encode as int or float, not string</span></div><div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;                                $pk_arr[] = $arr[$j][$col-1]+0;</div><div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;                            <span class="keywordflow">else</span></div><div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;                                <span class="comment">// encode as json string</span></div><div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;                                $pk_arr[] = $arr[$j][$col-1]; </div><div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;                        }</div><div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;                        $pk = json_encode($pk_arr);</div><div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;                        $tdWithClass = <span class="stringliteral">&quot;&lt;td class=&#39;td&quot;</span>.($j%2 ? <span class="stringliteral">&quot;1&quot;</span> : <span class="stringliteral">&quot;2&quot;</span>).<span class="stringliteral">&quot;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;                        echo <span class="stringliteral">&quot;&lt;tr&gt;&quot;</span>;</div><div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;                        <span class="keywordflow">if</span>($target_table_type == <span class="stringliteral">&#39;table&#39;</span>)</div><div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;                        {</div><div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;                            echo $tdWithClass.<span class="stringliteral">&quot;&lt;a href=&#39;?table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&amp;amp;action=row_editordelete&amp;amp;pk=&quot;</span>.urlencode($pk).<span class="stringliteral">&quot;&amp;amp;type=edit&#39; title=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;edit&#39;</span>].<span class="stringliteral">&quot;&#39; class=&#39;edit&#39;&gt;&lt;span&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;edit&#39;</span>].<span class="stringliteral">&quot;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;&quot;</span>; </div><div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;                            echo $tdWithClass.<span class="stringliteral">&quot;&lt;a href=&#39;?table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&amp;amp;action=row_editordelete&amp;amp;pk=&quot;</span>.urlencode($pk).<span class="stringliteral">&quot;&amp;amp;type=delete&#39; title=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;del&#39;</span>].<span class="stringliteral">&quot;&#39; class=&#39;delete&#39;&gt;&lt;span&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;del&#39;</span>].<span class="stringliteral">&quot;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;                        }</div><div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;                        <span class="keywordflow">for</span>($z=0; $z&lt;<span class="keyword">sizeof</span>($result); $z++)</div><div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;                        {</div><div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;                            echo $tdWithClass;</div><div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;                            $fldResult = $arr[$j][$headers[$z]];</div><div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;                            <span class="keywordflow">if</span>(isset($searchValues[$headers[$z]]))</div><div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;                            {</div><div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;                                $foundVal = str_replace(<span class="charliteral">&#39;%&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $searchValues[$headers[$z]]);</div><div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;                                $fldResult = str_ireplace($foundVal, <span class="stringliteral">&#39;[fnd]&#39;</span>.$foundVal.<span class="stringliteral">&#39;[/fnd]&#39;</span>, $fldResult);</div><div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;                                <span class="comment">// we replace with [fnd] first because we need to htmlencode _afterwards_ without breaking the found-markers</span></div><div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;                                <span class="comment">// htmlencoing _before_ would mean we might highlight stuff inside of htmlcode thus breaking it</span></div><div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;                            }</div><div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;                            echo str_replace(array(<span class="stringliteral">&#39;[fnd]&#39;</span>, <span class="stringliteral">&#39;[/fnd]&#39;</span>), array(<span class="stringliteral">&#39;&lt;u class=&quot;found&quot;&gt;&#39;</span>, <span class="stringliteral">&#39;&lt;/u&gt;&#39;</span>), htmlencode($fldResult));</div><div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;                            echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;                        }</div><div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;                        echo <span class="stringliteral">&quot;&lt;/tr&gt;&quot;</span>;</div><div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;                    }</div><div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/table&gt;&lt;br/&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;                }</div><div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;                </div><div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;                echo <span class="stringliteral">&quot;&lt;a href=&#39;?table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&amp;amp;action=table_search&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;srch_again&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;            }</div><div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;            {</div><div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;                $query = <span class="stringliteral">&quot;PRAGMA table_info(&quot;</span>.$db-&gt;quote_id($target_table).<span class="stringliteral">&quot;)&quot;</span>;</div><div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;                $result = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;selectArray($query);</div><div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;                </div><div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;                echo <span class="stringliteral">&quot;&lt;form action=&#39;?table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&amp;amp;action=table_search&amp;amp;done=1&#39; method=&#39;post&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;                    </div><div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;                echo <span class="stringliteral">&quot;&lt;table border=&#39;0&#39; cellpadding=&#39;2&#39; cellspacing=&#39;1&#39; class=&#39;viewTable&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;                echo <span class="stringliteral">&quot;&lt;tr&gt;&quot;</span>;</div><div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;                echo <span class="stringliteral">&quot;&lt;td class=&#39;tdheader&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;fld&#39;</span>].<span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;                echo <span class="stringliteral">&quot;&lt;td class=&#39;tdheader&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;type&#39;</span>].<span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;                echo <span class="stringliteral">&quot;&lt;td class=&#39;tdheader&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;operator&#39;</span>].<span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;                echo <span class="stringliteral">&quot;&lt;td class=&#39;tdheader&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;val&#39;</span>].<span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;                echo <span class="stringliteral">&quot;&lt;/tr&gt;&quot;</span>;</div><div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;</div><div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;                <span class="keywordflow">for</span>($i=0; $i&lt;<span class="keyword">sizeof</span>($result); $i++)</div><div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;                {</div><div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;                    $field = $result[$i][1];</div><div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;                    $type = $result[$i][<span class="stringliteral">&#39;type&#39;</span>];</div><div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;                    $typeAffinity = get_type_affinity($type);</div><div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;                    $tdWithClass = <span class="stringliteral">&quot;&lt;td class=&#39;td&quot;</span>.($i%2 ? <span class="stringliteral">&quot;1&quot;</span> : <span class="stringliteral">&quot;2&quot;</span>).<span class="stringliteral">&quot;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;                    $tdWithClassLeft = <span class="stringliteral">&quot;&lt;td class=&#39;td&quot;</span>.($i%2 ? <span class="stringliteral">&quot;1&quot;</span> : <span class="stringliteral">&quot;2&quot;</span>).<span class="stringliteral">&quot;&#39; style=&#39;text-align:left;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;                    echo <span class="stringliteral">&quot;&lt;tr&gt;&quot;</span>;</div><div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;                    echo $tdWithClassLeft;</div><div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;                    echo htmlencode($field);</div><div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;                    echo $tdWithClassLeft;</div><div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;                    echo htmlencode($type);</div><div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;                    echo $tdWithClassLeft;</div><div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;                    echo <span class="stringliteral">&quot;&lt;select name=&#39;&quot;</span>.htmlencode($field).<span class="stringliteral">&quot;:operator&#39; onchange=&#39;checkLike(\&quot;&quot;</span>.htmlencode($field).<span class="stringliteral">&quot;_search\&quot;, this.options[this.selectedIndex].value); &#39;&gt;&quot;</span>;</div><div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;                    echo <span class="stringliteral">&quot;&lt;option value=&#39;=&#39;&gt;=&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;                    <span class="keywordflow">if</span>($typeAffinity==<span class="stringliteral">&quot;INTEGER&quot;</span> || $typeAffinity==<span class="stringliteral">&quot;REAL&quot;</span> || $typeAffinity==<span class="stringliteral">&quot;NUMERIC&quot;</span>)</div><div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;                    {</div><div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;                        echo <span class="stringliteral">&quot;&lt;option value=&#39;&amp;gt;&#39;&gt;&amp;gt;&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;                        echo <span class="stringliteral">&quot;&lt;option value=&#39;&amp;gt;=&#39;&gt;&amp;gt;=&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;                        echo <span class="stringliteral">&quot;&lt;option value=&#39;&amp;lt;&#39;&gt;&amp;lt;&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;                        echo <span class="stringliteral">&quot;&lt;option value=&#39;&amp;lt;=&#39;&gt;&amp;lt;=&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;                    }</div><div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;                    <span class="keywordflow">else</span> <span class="keywordflow">if</span>($typeAffinity==<span class="stringliteral">&quot;TEXT&quot;</span> || $typeAffinity==<span class="stringliteral">&quot;NONE&quot;</span>)</div><div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;                    {</div><div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;                        echo <span class="stringliteral">&quot;&lt;option value=&#39;= &#39;&#39;&#39;&gt;= &#39;&#39;&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;                        echo <span class="stringliteral">&quot;&lt;option value=&#39;!= &#39;&#39;&#39;&gt;!= &#39;&#39;&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;                    }</div><div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;                    echo <span class="stringliteral">&quot;&lt;option value=&#39;!=&#39;&gt;!=&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;                    <span class="keywordflow">if</span>($typeAffinity==<span class="stringliteral">&quot;TEXT&quot;</span> || $typeAffinity==<span class="stringliteral">&quot;NONE&quot;</span>)</div><div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;                        echo <span class="stringliteral">&quot;&lt;option value=&#39;LIKE&#39; selected=&#39;selected&#39;&gt;LIKE&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;                    <span class="keywordflow">else</span></div><div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;                        echo <span class="stringliteral">&quot;&lt;option value=&#39;LIKE&#39;&gt;LIKE&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;                    echo <span class="stringliteral">&quot;&lt;option value=&#39;LIKE%&#39;&gt;LIKE %...%&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;                    echo <span class="stringliteral">&quot;&lt;option value=&#39;NOT LIKE&#39;&gt;NOT LIKE&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/select&gt;&quot;</span>;</div><div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;                    echo $tdWithClassLeft;</div><div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;                    <span class="keywordflow">if</span>($typeAffinity==<span class="stringliteral">&quot;INTEGER&quot;</span> || $typeAffinity==<span class="stringliteral">&quot;REAL&quot;</span> || $typeAffinity==<span class="stringliteral">&quot;NUMERIC&quot;</span>)</div><div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;                        echo <span class="stringliteral">&quot;&lt;input type=&#39;text&#39; id=&#39;&quot;</span>.htmlencode($field).<span class="stringliteral">&quot;_search&#39; name=&#39;&quot;</span>.htmlencode($field).<span class="stringliteral">&quot;&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;                    <span class="keywordflow">else</span></div><div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;                        echo <span class="stringliteral">&quot;&lt;textarea id=&#39;&quot;</span>.htmlencode($field).<span class="stringliteral">&quot;_search&#39; name=&#39;&quot;</span>.htmlencode($field).<span class="stringliteral">&quot;&#39; rows=&#39;1&#39; cols=&#39;60&#39;&gt;&lt;/textarea&gt;&quot;</span>;</div><div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/tr&gt;&quot;</span>;</div><div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;                }</div><div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;                echo <span class="stringliteral">&quot;&lt;tr&gt;&quot;</span>;</div><div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;                echo <span class="stringliteral">&quot;&lt;td class=&#39;tdheader&#39; style=&#39;text-align:right;&#39; colspan=&#39;4&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;                echo <span class="stringliteral">&quot;&lt;input type=&#39;submit&#39; value=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;srch&#39;</span>].<span class="stringliteral">&quot;&#39; class=&#39;btn&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;                echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;                echo <span class="stringliteral">&quot;&lt;/tr&gt;&quot;</span>;</div><div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;                echo <span class="stringliteral">&quot;&lt;/table&gt;&quot;</span>;</div><div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;                echo <span class="stringliteral">&quot;&lt;/form&gt;&quot;</span>;</div><div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;            }</div><div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;</div><div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;    <span class="comment">//- Row actions</span></div><div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;</div><div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;        <span class="comment">//- View row (=row_view)</span></div><div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;        <span class="keywordflow">case</span> <span class="stringliteral">&quot;row_view&quot;</span>:</div><div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;            <span class="keywordflow">if</span>(!isset($_POST[<span class="stringliteral">&#39;startRow&#39;</span>]))</div><div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;                $_POST[<span class="stringliteral">&#39;startRow&#39;</span>] = 0;</div><div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;</div><div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;            <span class="keywordflow">if</span>(isset($_POST[<span class="stringliteral">&#39;numRows&#39;</span>]))</div><div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;                $_SESSION[COOKIENAME.<span class="stringliteral">&#39;numRows&#39;</span>] = $_POST[<span class="stringliteral">&#39;numRows&#39;</span>];</div><div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;</div><div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;            <span class="keywordflow">if</span>(!isset($_SESSION[COOKIENAME.<span class="stringliteral">&#39;numRows&#39;</span>]))</div><div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;                $_SESSION[COOKIENAME.<span class="stringliteral">&#39;numRows&#39;</span>] = $rowsNum;</div><div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;            </div><div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;            <span class="keywordflow">if</span>(isset($_GET[<span class="stringliteral">&#39;fulltexts&#39;</span>]))</div><div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;                $_SESSION[COOKIENAME.<span class="stringliteral">&#39;fulltexts&#39;</span>] = $_GET[<span class="stringliteral">&#39;fulltexts&#39;</span>];</div><div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;</div><div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;            <span class="keywordflow">if</span>(!isset($_SESSION[COOKIENAME.<span class="stringliteral">&#39;fulltexts&#39;</span>]))</div><div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;                $_SESSION[COOKIENAME.<span class="stringliteral">&#39;fulltexts&#39;</span>] = <span class="keyword">false</span>;</div><div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;</div><div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;            <span class="keywordflow">if</span>(isset($_SESSION[COOKIENAME.<span class="stringliteral">&#39;currentTable&#39;</span>]) &amp;&amp; $_SESSION[COOKIENAME.<span class="stringliteral">&#39;currentTable&#39;</span>]!=$target_table)</div><div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;            {</div><div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;                unset($_SESSION[COOKIENAME.<span class="stringliteral">&#39;sortRows&#39;</span>]);</div><div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;                unset($_SESSION[COOKIENAME.<span class="stringliteral">&#39;orderRows&#39;</span>]);   </div><div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;            }</div><div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;            <span class="keywordflow">if</span>(isset($_POST[<span class="stringliteral">&#39;viewtype&#39;</span>]))</div><div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;            {</div><div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;                $_SESSION[COOKIENAME.<span class="stringliteral">&#39;viewtype&#39;</span>] = $_POST[<span class="stringliteral">&#39;viewtype&#39;</span>];  </div><div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;            }</div><div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;            </div><div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;            $rowCount = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;numRows($target_table);</div><div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;            $lastPage = intval($rowCount / $_SESSION[COOKIENAME.<span class="stringliteral">&#39;numRows&#39;</span>]);</div><div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;            $remainder = intval($rowCount % $_SESSION[COOKIENAME.<span class="stringliteral">&#39;numRows&#39;</span>]);</div><div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;            <span class="keywordflow">if</span>($remainder==0)</div><div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;                $remainder = $_SESSION[COOKIENAME.<span class="stringliteral">&#39;numRows&#39;</span>];</div><div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;            </div><div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;            <span class="comment">//- HTML: pagination buttons</span></div><div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;            echo <span class="stringliteral">&quot;&lt;div style=&#39;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;            <span class="comment">//previous button</span></div><div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;            <span class="keywordflow">if</span>($_POST[<span class="stringliteral">&#39;startRow&#39;</span>]&gt;0)</div><div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;            {</div><div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;                echo <span class="stringliteral">&quot;&lt;div style=&#39;float:left;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;                echo <span class="stringliteral">&quot;&lt;form action=&#39;?action=row_view&amp;amp;table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&#39; method=&#39;post&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;                echo <span class="stringliteral">&quot;&lt;input type=&#39;hidden&#39; name=&#39;startRow&#39; value=&#39;0&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;                echo <span class="stringliteral">&quot;&lt;input type=&#39;hidden&#39; name=&#39;numRows&#39; value=&#39;&quot;</span>.$_SESSION[COOKIENAME.<span class="stringliteral">&#39;numRows&#39;</span>].<span class="stringliteral">&quot;&#39;/&gt; &quot;</span>;</div><div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;                echo <span class="stringliteral">&quot;&lt;input type=&#39;submit&#39; value=&#39;&amp;larr;&amp;larr;&#39; name=&#39;previous&#39; class=&#39;btn&#39;/&gt; &quot;</span>;</div><div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;                echo <span class="stringliteral">&quot;&lt;/form&gt;&quot;</span>;</div><div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;                echo <span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;                echo <span class="stringliteral">&quot;&lt;div style=&#39;float:left; overflow:hidden; margin-right:20px;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;                echo <span class="stringliteral">&quot;&lt;form action=&#39;?action=row_view&amp;amp;table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&#39; method=&#39;post&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;                echo <span class="stringliteral">&quot;&lt;input type=&#39;hidden&#39; name=&#39;startRow&#39; value=&#39;&quot;</span>.max(0,intval($_POST[<span class="stringliteral">&#39;startRow&#39;</span>]-$_SESSION[COOKIENAME.<span class="stringliteral">&#39;numRows&#39;</span>])).<span class="stringliteral">&quot;&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;                echo <span class="stringliteral">&quot;&lt;input type=&#39;hidden&#39; name=&#39;numRows&#39; value=&#39;&quot;</span>.$_SESSION[COOKIENAME.<span class="stringliteral">&#39;numRows&#39;</span>].<span class="stringliteral">&quot;&#39;/&gt; &quot;</span>;</div><div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;                echo <span class="stringliteral">&quot;&lt;input type=&#39;submit&#39; value=&#39;&amp;larr;&#39; name=&#39;previous_full&#39; class=&#39;btn&#39;/&gt; &quot;</span>;</div><div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;                echo <span class="stringliteral">&quot;&lt;/form&gt;&quot;</span>;</div><div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;                echo <span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;            }</div><div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;            </div><div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;            <span class="comment">//show certain number buttons</span></div><div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;            echo <span class="stringliteral">&quot;&lt;div style=&#39;float:left;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;            echo <span class="stringliteral">&quot;&lt;form action=&#39;?action=row_view&amp;amp;table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&#39; method=&#39;post&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;            echo <span class="stringliteral">&quot;&lt;input type=&#39;submit&#39; value=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;show&#39;</span>].<span class="stringliteral">&quot; : &#39; name=&#39;show&#39; class=&#39;btn&#39;/&gt; &quot;</span>;</div><div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;            echo <span class="stringliteral">&quot;&lt;input type=&#39;text&#39; name=&#39;numRows&#39; style=&#39;width:50px;&#39; value=&#39;&quot;</span>.$_SESSION[COOKIENAME.<span class="stringliteral">&#39;numRows&#39;</span>].<span class="stringliteral">&quot;&#39;/&gt; &quot;</span>;</div><div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;            echo $lang[<span class="stringliteral">&#39;rows_records&#39;</span>];</div><div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;</div><div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;            <span class="keywordflow">if</span>(intval($_POST[<span class="stringliteral">&#39;startRow&#39;</span>]+$_SESSION[COOKIENAME.<span class="stringliteral">&#39;numRows&#39;</span>]) &lt; $rowCount)</div><div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;                echo <span class="stringliteral">&quot;&lt;input type=&#39;text&#39; name=&#39;startRow&#39; style=&#39;width:90px;&#39; value=&#39;&quot;</span>.intval($_POST[<span class="stringliteral">&#39;startRow&#39;</span>]+$_SESSION[COOKIENAME.<span class="stringliteral">&#39;numRows&#39;</span>]).<span class="stringliteral">&quot;&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;                echo <span class="stringliteral">&quot;&lt;input type=&#39;text&#39; name=&#39;startRow&#39; style=&#39;width:90px;&#39; value=&#39;0&#39;/&gt; &quot;</span>;</div><div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;            echo $lang[<span class="stringliteral">&#39;as_a&#39;</span>];</div><div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;            echo <span class="stringliteral">&quot; &lt;select name=&#39;viewtype&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;            <span class="keywordflow">if</span>(!isset($_SESSION[COOKIENAME.<span class="stringliteral">&#39;viewtype&#39;</span>]) || $_SESSION[COOKIENAME.<span class="stringliteral">&#39;viewtype&#39;</span>]==<span class="stringliteral">&quot;table&quot;</span>)</div><div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;            {</div><div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;                echo <span class="stringliteral">&quot;&lt;option value=&#39;table&#39; selected=&#39;selected&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;tbl&#39;</span>].<span class="stringliteral">&quot;&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;                echo <span class="stringliteral">&quot;&lt;option value=&#39;chart&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;chart&#39;</span>].<span class="stringliteral">&quot;&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;            }</div><div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;            {</div><div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;                echo <span class="stringliteral">&quot;&lt;option value=&#39;table&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;tbl&#39;</span>].<span class="stringliteral">&quot;&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;                echo <span class="stringliteral">&quot;&lt;option value=&#39;chart&#39; selected=&#39;selected&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;chart&#39;</span>].<span class="stringliteral">&quot;&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;            }</div><div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;            echo <span class="stringliteral">&quot;&lt;/select&gt;&quot;</span>;</div><div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;            echo <span class="stringliteral">&quot;&lt;/form&gt;&quot;</span>;</div><div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;            echo <span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;            </div><div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;            <span class="comment">//next button</span></div><div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;            <span class="keywordflow">if</span>(intval($_POST[<span class="stringliteral">&#39;startRow&#39;</span>]+$_SESSION[COOKIENAME.<span class="stringliteral">&#39;numRows&#39;</span>])&lt;$rowCount)</div><div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;            {</div><div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;                echo <span class="stringliteral">&quot;&lt;div style=&#39;float:left; margin-left:20px; &#39;&gt;&quot;</span>;</div><div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;                echo <span class="stringliteral">&quot;&lt;form action=&#39;?action=row_view&amp;amp;table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&#39; method=&#39;post&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;                echo <span class="stringliteral">&quot;&lt;input type=&#39;hidden&#39; name=&#39;startRow&#39; value=&#39;&quot;</span>.intval($_POST[<span class="stringliteral">&#39;startRow&#39;</span>]+$_SESSION[COOKIENAME.<span class="stringliteral">&#39;numRows&#39;</span>]).<span class="stringliteral">&quot;&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;                echo <span class="stringliteral">&quot;&lt;input type=&#39;hidden&#39; name=&#39;numRows&#39; value=&#39;&quot;</span>.$_SESSION[COOKIENAME.<span class="stringliteral">&#39;numRows&#39;</span>].<span class="stringliteral">&quot;&#39;/&gt; &quot;</span>;</div><div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;                echo <span class="stringliteral">&quot;&lt;input type=&#39;submit&#39; value=&#39;&amp;rarr;&#39; name=&#39;next&#39; class=&#39;btn&#39;/&gt; &quot;</span>;</div><div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;                echo <span class="stringliteral">&quot;&lt;/form&gt;&quot;</span>;</div><div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;                echo <span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;                echo <span class="stringliteral">&quot;&lt;div style=&#39;float:left; &#39;&gt;&quot;</span>;</div><div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;                echo <span class="stringliteral">&quot;&lt;form action=&#39;?action=row_view&amp;amp;table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&#39; method=&#39;post&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;                echo <span class="stringliteral">&quot;&lt;input type=&#39;hidden&#39; name=&#39;startRow&#39; value=&#39;&quot;</span>.intval($rowCount-$remainder).<span class="stringliteral">&quot;&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;                echo <span class="stringliteral">&quot;&lt;input type=&#39;hidden&#39; name=&#39;numRows&#39; value=&#39;&quot;</span>.$_SESSION[COOKIENAME.<span class="stringliteral">&#39;numRows&#39;</span>].<span class="stringliteral">&quot;&#39;/&gt; &quot;</span>;</div><div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;                echo <span class="stringliteral">&quot;&lt;input type=&#39;submit&#39; value=&#39;&amp;rarr;&amp;rarr;&#39; name=&#39;next_full&#39; class=&#39;btn&#39;/&gt; &quot;</span>;</div><div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;                echo <span class="stringliteral">&quot;&lt;/form&gt;&quot;</span>;</div><div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;                echo <span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;            }</div><div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;            echo <span class="stringliteral">&quot;&lt;div style=&#39;clear:both;&#39;&gt;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;            echo <span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;</div><div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;            <span class="comment">//- Query execution</span></div><div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;            <span class="keywordflow">if</span>(!isset($_GET[<span class="stringliteral">&#39;sort&#39;</span>]))</div><div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;                $_GET[<span class="stringliteral">&#39;sort&#39;</span>] = NULL;</div><div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;            <span class="keywordflow">if</span>(!isset($_GET[<span class="stringliteral">&#39;order&#39;</span>]))</div><div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;                $_GET[<span class="stringliteral">&#39;order&#39;</span>] = NULL;</div><div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;</div><div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;            $numRows = $_SESSION[COOKIENAME.<span class="stringliteral">&#39;numRows&#39;</span>];</div><div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;            $startRow = $_POST[<span class="stringliteral">&#39;startRow&#39;</span>];</div><div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;            <span class="keywordflow">if</span>(isset($_GET[<span class="stringliteral">&#39;sort&#39;</span>]))</div><div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;            {</div><div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;                $_SESSION[COOKIENAME.<span class="stringliteral">&#39;sortRows&#39;</span>] = $_GET[<span class="stringliteral">&#39;sort&#39;</span>];</div><div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;                $_SESSION[COOKIENAME.<span class="stringliteral">&#39;currentTable&#39;</span>] = $target_table;</div><div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;            }</div><div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;            <span class="keywordflow">if</span>(isset($_GET[<span class="stringliteral">&#39;order&#39;</span>]))</div><div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;            {</div><div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;                $_SESSION[COOKIENAME.<span class="stringliteral">&#39;orderRows&#39;</span>] = $_GET[<span class="stringliteral">&#39;order&#39;</span>];</div><div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;                $_SESSION[COOKIENAME.<span class="stringliteral">&#39;currentTable&#39;</span>] = $target_table;</div><div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;            }</div><div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;            $_SESSION[COOKIENAME.<span class="stringliteral">&#39;numRows&#39;</span>] = $numRows;</div><div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;            $query = <span class="stringliteral">&quot;SELECT * &quot;</span>;</div><div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;            <span class="comment">// select the primary key column(s) last (ROWID if there is no PK).</span></div><div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;            <span class="comment">// this will be used to identify rows, e.g. when editing/deleting rows</span></div><div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;            $primary_key = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;getPrimaryKey($target_table);</div><div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;            <span class="keywordflow">foreach</span>($primary_key as $pk)</div><div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;            {</div><div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;                $query.= <span class="stringliteral">&#39;, &#39;</span>.$db-&gt;quote_id($pk);</div><div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;                $query.= <span class="stringliteral">&#39;, typeof(&#39;</span>.$db-&gt;quote_id($pk).<span class="charliteral">&#39;)&#39;</span>;</div><div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;            }</div><div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;            $query .= <span class="stringliteral">&quot; FROM &quot;</span>.$db-&gt;quote_id($target_table);</div><div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;            $queryDisp = <span class="stringliteral">&quot;SELECT * FROM &quot;</span>.$db-&gt;quote_id($target_table);</div><div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;            $queryAdd = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;            <span class="keywordflow">if</span>(isset($_SESSION[COOKIENAME.<span class="stringliteral">&#39;sortRows&#39;</span>]))</div><div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;                $queryAdd .= <span class="stringliteral">&quot; ORDER BY &quot;</span>.$db-&gt;quote_id($_SESSION[COOKIENAME.<span class="stringliteral">&#39;sortRows&#39;</span>]);</div><div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;            <span class="keywordflow">if</span>(isset($_SESSION[COOKIENAME.<span class="stringliteral">&#39;orderRows&#39;</span>]))</div><div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;                $queryAdd .= <span class="stringliteral">&quot; &quot;</span>.$_SESSION[COOKIENAME.<span class="stringliteral">&#39;orderRows&#39;</span>];</div><div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;            $queryAdd .= <span class="stringliteral">&quot; LIMIT &quot;</span>.$startRow.<span class="stringliteral">&quot;, &quot;</span>.$numRows;</div><div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;            $query .= $queryAdd;</div><div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;            $queryDisp .= $queryAdd;</div><div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;            $queryTimer = <span class="keyword">new</span> MicroTimer();</div><div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;            $arr = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;selectArray($query);</div><div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;            $queryTimer-&gt;stop();</div><div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;</div><div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;            <span class="comment">//- Show results</span></div><div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;            <span class="keywordflow">if</span>(<span class="keyword">sizeof</span>($arr)&gt;0)</div><div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;            {</div><div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;                echo <span class="stringliteral">&quot;&lt;br/&gt;&lt;div class=&#39;confirm&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;                echo <span class="stringliteral">&quot;&lt;b&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;showing_rows&#39;</span>].<span class="stringliteral">&quot; &quot;</span>.$startRow.<span class="stringliteral">&quot; - &quot;</span>.($startRow + <span class="keyword">sizeof</span>($arr)-1).<span class="stringliteral">&quot;, &quot;</span>.$lang[<span class="stringliteral">&#39;total&#39;</span>].<span class="stringliteral">&quot;: &quot;</span>.$rowCount.<span class="stringliteral">&quot; &quot;</span>;</div><div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;                printf($lang[<span class="stringliteral">&#39;query_time&#39;</span>], $queryTimer);</div><div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;                echo <span class="stringliteral">&quot;&lt;/b&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;                echo <span class="stringliteral">&quot;&lt;span style=&#39;font-size:11px;&#39;&gt;&quot;</span>.htmlencode($queryDisp).<span class="stringliteral">&quot;&lt;/span&gt;&quot;</span>;</div><div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;                echo <span class="stringliteral">&quot;&lt;/div&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;                </div><div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;                <span class="keywordflow">if</span>($target_table_type == <span class="stringliteral">&#39;view&#39;</span>)</div><div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;                {</div><div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;                    echo sprintf($lang[<span class="stringliteral">&#39;readonly_tbl&#39;</span>], htmlencode($target_table)).<span class="stringliteral">&quot; &lt;a href=&#39;http://en.wikipedia.org/wiki/View_(database)&#39; target=&#39;_blank&#39;&gt;http://en.wikipedia.org/wiki/View_(database)&lt;/a&gt;&quot;</span>; </div><div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;                    echo <span class="stringliteral">&quot;&lt;br/&gt;&lt;br/&gt;&quot;</span>;  </div><div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;                }</div><div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;                </div><div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;                $query = <span class="stringliteral">&quot;PRAGMA table_info(&quot;</span>.$db-&gt;quote_id($target_table).<span class="stringliteral">&quot;)&quot;</span>;</div><div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;                $result = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;selectArray($query);</div><div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;                $pkFirstCol = <span class="keyword">sizeof</span>($result)+1;</div><div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;                <span class="comment">//- Table view</span></div><div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;                <span class="keywordflow">if</span>(!isset($_SESSION[COOKIENAME.<span class="stringliteral">&#39;viewtype&#39;</span>]) || $_SESSION[COOKIENAME.<span class="stringliteral">&#39;viewtype&#39;</span>]==<span class="stringliteral">&quot;table&quot;</span>)</div><div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;                {</div><div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;                    echo <span class="stringliteral">&quot;&lt;form action=&#39;?action=row_editordelete&amp;amp;table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&#39; method=&#39;post&#39; name=&#39;checkForm&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;                    echo <span class="stringliteral">&quot;&lt;table border=&#39;0&#39; cellpadding=&#39;2&#39; cellspacing=&#39;1&#39; class=&#39;viewTable&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;                    echo <span class="stringliteral">&quot;&lt;tr&gt;&quot;</span>;</div><div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;                    <span class="keywordflow">if</span>($target_table_type == <span class="stringliteral">&#39;table&#39;</span>)</div><div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;                    {</div><div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;                        echo <span class="stringliteral">&quot;&lt;td colspan=&#39;3&#39; class=&#39;tdheader&#39; style=&#39;text-align:center&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;                        echo <span class="stringliteral">&quot;&lt;a href=&#39;?action=row_view&amp;amp;table=&quot;</span>.$target_table.<span class="stringliteral">&quot;&amp;amp;fulltexts=&quot;</span>.($_SESSION[COOKIENAME.<span class="stringliteral">&#39;fulltexts&#39;</span>]?0:1).<span class="stringliteral">&quot;&#39; title=&#39;&quot;</span>.$lang[($_SESSION[COOKIENAME.<span class="stringliteral">&#39;fulltexts&#39;</span>]?<span class="stringliteral">&#39;no_full_texts&#39;</span>:<span class="stringliteral">&#39;full_texts&#39;</span>)].<span class="stringliteral">&quot;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;                        echo <span class="stringliteral">&quot;&lt;b&gt;&amp;&quot;</span>.($_SESSION[COOKIENAME.<span class="stringliteral">&#39;fulltexts&#39;</span>]?<span class="charliteral">&#39;r&#39;</span>:<span class="charliteral">&#39;l&#39;</span>).<span class="stringliteral">&quot;arr;&lt;/b&gt; T &lt;b&gt;&amp;&quot;</span>.($_SESSION[COOKIENAME.<span class="stringliteral">&#39;fulltexts&#39;</span>]?<span class="charliteral">&#39;l&#39;</span>:<span class="charliteral">&#39;r&#39;</span>).<span class="stringliteral">&quot;arr;&lt;/b&gt;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;                        echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;                    }</div><div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;</div><div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;                    <span class="keywordflow">for</span>($i=0; $i&lt;<span class="keyword">sizeof</span>($result); $i++)</div><div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;                    {</div><div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;                        echo <span class="stringliteral">&quot;&lt;td class=&#39;tdheader&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;                        echo <span class="stringliteral">&quot;&lt;a href=&#39;?action=row_view&amp;amp;table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&amp;amp;sort=&quot;</span>.urlencode($result[$i][<span class="stringliteral">&#39;name&#39;</span>]);</div><div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;                        <span class="keywordflow">if</span>(isset($_SESSION[COOKIENAME.<span class="stringliteral">&#39;sortRows&#39;</span>]))</div><div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;                            $orderTag = ($_SESSION[COOKIENAME.<span class="stringliteral">&#39;sortRows&#39;</span>]==$result[$i][<span class="stringliteral">&#39;name&#39;</span>] &amp;&amp; $_SESSION[COOKIENAME.<span class="stringliteral">&#39;orderRows&#39;</span>]==<span class="stringliteral">&quot;ASC&quot;</span>) ? <span class="stringliteral">&quot;DESC&quot;</span> : <span class="stringliteral">&quot;ASC&quot;</span>;</div><div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;                        <span class="keywordflow">else</span></div><div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;                            $orderTag = <span class="stringliteral">&quot;ASC&quot;</span>;</div><div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;                        echo <span class="stringliteral">&quot;&amp;amp;order=&quot;</span>.$orderTag;</div><div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;                        echo <span class="stringliteral">&quot;&#39;&gt;&quot;</span>.htmlencode($result[$i][<span class="stringliteral">&#39;name&#39;</span>]).<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;                        <span class="keywordflow">if</span>(isset($_SESSION[COOKIENAME.<span class="stringliteral">&#39;sortRows&#39;</span>]) &amp;&amp; $_SESSION[COOKIENAME.<span class="stringliteral">&#39;sortRows&#39;</span>]==$result[$i][<span class="stringliteral">&#39;name&#39;</span>])</div><div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;                            echo (($_SESSION[COOKIENAME.<span class="stringliteral">&#39;orderRows&#39;</span>]==<span class="stringliteral">&quot;ASC&quot;</span>) ? <span class="stringliteral">&quot; &lt;b&gt;&amp;uarr;&lt;/b&gt;&quot;</span> : <span class="stringliteral">&quot; &lt;b&gt;&amp;darr;&lt;/b&gt;&quot;</span>);</div><div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;                        echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;                    }</div><div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/tr&gt;&quot;</span>;</div><div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;</div><div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;                    <span class="keywordflow">for</span>($i=0; $i&lt;<span class="keyword">sizeof</span>($arr); $i++)</div><div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;                    {</div><div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;                        <span class="comment">// -g-&gt; $pk will always be the last columns in each row of the array because we are doing &quot;SELECT *, PK_1, typeof(PK_1), PK2, typeof(PK_2), ... FROM ...&quot;</span></div><div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;                        $pk_arr = array();</div><div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;                        <span class="keywordflow">for</span>($col = $pkFirstCol; array_key_exists($col, $arr[$i]); $col=$col+2)</div><div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;                        {</div><div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;                            <span class="comment">// in $col we have the type and in $col-1 the value</span></div><div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;                            <span class="keywordflow">if</span>($arr[$i][$col]==<span class="stringliteral">&#39;integer&#39;</span> || $arr[$i][$col]==<span class="stringliteral">&#39;real&#39;</span>)</div><div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;                                <span class="comment">// json encode as int or float, not string</span></div><div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;                                $pk_arr[] = $arr[$i][$col-1]+0;</div><div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;                            <span class="keywordflow">else</span></div><div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;                                <span class="comment">// encode as json string</span></div><div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;                                $pk_arr[] = $arr[$i][$col-1]; </div><div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;                        }</div><div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;                        $pk = json_encode($pk_arr);</div><div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;                        $tdWithClass = <span class="stringliteral">&quot;&lt;td class=&#39;td&quot;</span>.($i%2 ? <span class="stringliteral">&quot;1&quot;</span> : <span class="stringliteral">&quot;2&quot;</span>).<span class="stringliteral">&quot;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;                        $tdWithClassLeft = <span class="stringliteral">&quot;&lt;td class=&#39;td&quot;</span>.($i%2 ? <span class="stringliteral">&quot;1&quot;</span> : <span class="stringliteral">&quot;2&quot;</span>).<span class="stringliteral">&quot;&#39; style=&#39;text-align:left;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;                        echo <span class="stringliteral">&quot;&lt;tr&gt;&quot;</span>;</div><div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;                        <span class="keywordflow">if</span>($target_table_type == <span class="stringliteral">&#39;table&#39;</span>)</div><div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;                        {</div><div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;                            echo $tdWithClass;</div><div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;                            echo <span class="stringliteral">&quot;&lt;input type=&#39;checkbox&#39; name=&#39;check[]&#39; value=&#39;&quot;</span>.htmlencode($pk).<span class="stringliteral">&quot;&#39; id=&#39;check_&quot;</span>.htmlencode($i).<span class="stringliteral">&quot;&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;                            echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;                            echo $tdWithClass;</div><div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;                            <span class="comment">// -g-&gt; Here, we need to put the PK in as the link for both the edit and delete.</span></div><div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;                            echo <span class="stringliteral">&quot;&lt;a href=&#39;?table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&amp;amp;action=row_editordelete&amp;amp;pk=&quot;</span>.urlencode($pk).<span class="stringliteral">&quot;&amp;amp;type=edit&#39; title=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;edit&#39;</span>].<span class="stringliteral">&quot;&#39; class=&#39;edit&#39;&gt;&lt;span&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;edit&#39;</span>].<span class="stringliteral">&quot;&lt;/span&gt;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;                            echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;                            echo $tdWithClass;</div><div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;                            echo <span class="stringliteral">&quot;&lt;a href=&#39;?table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&amp;amp;action=row_editordelete&amp;amp;pk=&quot;</span>.urlencode($pk).<span class="stringliteral">&quot;&amp;amp;type=delete&#39; title=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;del&#39;</span>].<span class="stringliteral">&quot;&#39; class=&#39;delete&#39;&gt;&lt;span&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;del&#39;</span>].<span class="stringliteral">&quot;&lt;/span&gt;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;                            echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;                        }</div><div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;                        <span class="keywordflow">for</span>($j=0; $j&lt;<span class="keyword">sizeof</span>($result); $j++)</div><div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;                        {</div><div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;                            $typeAffinity = get_type_affinity($result[$j][<span class="stringliteral">&#39;type&#39;</span>]);</div><div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;                            <span class="keywordflow">if</span>($typeAffinity==<span class="stringliteral">&quot;INTEGER&quot;</span> || $typeAffinity==<span class="stringliteral">&quot;REAL&quot;</span> || $typeAffinity==<span class="stringliteral">&quot;NUMERIC&quot;</span>)</div><div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;                                echo $tdWithClass;</div><div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;                            <span class="keywordflow">else</span></div><div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;                                echo $tdWithClassLeft;</div><div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;                            <span class="keywordflow">if</span>($arr[$i][$j]===<span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;                                echo <span class="stringliteral">&quot;&amp;nbsp;&quot;</span>;</div><div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;                            elseif($arr[$i][$j]===NULL)</div><div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;                                echo &quot;&lt;i class=&#39;null&#39;&gt;NULL&lt;/i&gt;&quot;;</div><div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;                            else</div><div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;                                echo htmlencode(subString($arr[$i][$j]));</div><div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;                            echo &quot;&lt;/td&gt;&quot;;</div><div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;                        }</div><div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;                        echo &quot;&lt;/tr&gt;&quot;;</div><div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;                    }</div><div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;                    echo &quot;&lt;/table&gt;&quot;;</div><div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;                    if($target_table_type == &#39;table&#39;)</div><div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;                    {</div><div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;                        echo <span class="stringliteral">&quot;&lt;a onclick=&#39;checkAll()&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;chk_all&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt; / &lt;a onclick=&#39;uncheckAll()&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;unchk_all&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt; &lt;i&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;with_sel&#39;</span>].<span class="stringliteral">&quot;:&lt;/i&gt; &quot;</span>;</div><div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;                        echo <span class="stringliteral">&quot;&lt;select name=&#39;type&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;                        echo <span class="stringliteral">&quot;&lt;option value=&#39;edit&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;edit&#39;</span>].<span class="stringliteral">&quot;&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;                        echo <span class="stringliteral">&quot;&lt;option value=&#39;delete&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;del&#39;</span>].<span class="stringliteral">&quot;&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;                        echo <span class="stringliteral">&quot;&lt;/select&gt; &quot;</span>;</div><div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;                        echo <span class="stringliteral">&quot;&lt;input type=&#39;submit&#39; value=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;go&#39;</span>].<span class="stringliteral">&quot;&#39; name=&#39;massGo&#39; class=&#39;btn&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;                    }</div><div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/form&gt;&quot;</span>;</div><div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;                }</div><div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;                <span class="comment">//- Chart view</span></div><div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;                {</div><div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;                    <span class="keywordflow">if</span>(!isset($_SESSION[COOKIENAME.$target_table.<span class="stringliteral">&#39;chartlabels&#39;</span>]))</div><div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;                    {</div><div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;                        <span class="comment">// No label-column set. Try to pick a text-column as label-column.</span></div><div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;                        <span class="keywordflow">for</span>($i=0; $i&lt;<span class="keyword">sizeof</span>($result); $i++)</div><div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;                        {</div><div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;                            <span class="keywordflow">if</span>(get_type_affinity($result[$i][<span class="stringliteral">&#39;type&#39;</span>])==<span class="stringliteral">&#39;TEXT&#39;</span>)</div><div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;                            {</div><div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;                                $_SESSION[COOKIENAME.$target_table.<span class="stringliteral">&#39;chartlabels&#39;</span>] = $i;</div><div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;                                <span class="keywordflow">break</span>;</div><div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;                            }</div><div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;                        }</div><div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;                    }</div><div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;                    <span class="keywordflow">if</span>(!isset($_SESSION[COOKIENAME.<span class="stringliteral">&#39;chartlabels&#39;</span>]))</div><div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;                        <span class="comment">// no text column found, use the first column</span></div><div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;                        $_SESSION[COOKIENAME.<span class="stringliteral">&#39;chartlabels&#39;</span>] = 0;</div><div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;                        </div><div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;                    <span class="keywordflow">if</span>(!isset($_SESSION[COOKIENAME.$target_table.<span class="stringliteral">&#39;chartvalues&#39;</span>]))</div><div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;                    {</div><div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;                        <span class="comment">// No value-column set. Pick the first numeric column if possible.</span></div><div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;                        <span class="comment">// If not possible, pick the first column that is not the label-column.</span></div><div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;                        </div><div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;                        $potential_value_column = null;</div><div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;                        <span class="keywordflow">for</span>($i=0; $i&lt;<span class="keyword">sizeof</span>($result); $i++)</div><div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;                        {</div><div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;                            <span class="keywordflow">if</span>($potential_value_column===null &amp;&amp; $i != $_SESSION[COOKIENAME.$target_table.<span class="stringliteral">&#39;chartlabels&#39;</span>])</div><div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;                                <span class="comment">// the first column (of any type) that is not the label-column</span></div><div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;                                $potential_value_column = $i;</div><div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;                            <span class="comment">// check if the col is numeric</span></div><div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;                            $typeAffinity = get_type_affinity($result[$i][<span class="stringliteral">&#39;type&#39;</span>]);  </div><div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;                            <span class="keywordflow">if</span>($typeAffinity==<span class="stringliteral">&#39;INTEGER&#39;</span> || $typeAffinity==<span class="stringliteral">&#39;REAL&#39;</span> || $typeAffinity==<span class="stringliteral">&#39;NUMERIC&#39;</span>)</div><div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;                            {</div><div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;                                <span class="comment">// this is defined as a numeric column, so prefer this as a value column over $potential_value_column</span></div><div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;                                $_SESSION[COOKIENAME.$target_table.<span class="stringliteral">&#39;chartvalues&#39;</span>] = $i;</div><div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;                                <span class="keywordflow">break</span>;</div><div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;                            }</div><div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;                        }</div><div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;                        <span class="keywordflow">if</span>(!isset($_SESSION[COOKIENAME.$target_table.<span class="stringliteral">&#39;chartvalues&#39;</span>]))</div><div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;                        {</div><div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;                            <span class="comment">// we did not find a numeric column</span></div><div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;                            <span class="keywordflow">if</span>($potential_value_column!==null)</div><div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;                                <span class="comment">// use the $potential_value_column, i.e. the second column which is not the label-column</span></div><div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;                                $_SESSION[COOKIENAME.$target_table.<span class="stringliteral">&#39;chartvalues&#39;</span>] = $potential_value_column;</div><div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;                            <span class="keywordflow">else</span></div><div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;                                <span class="comment">// it&#39;s hopeless, there is only 1 column</span></div><div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;                                $_SESSION[COOKIENAME.$target_table.<span class="stringliteral">&#39;chartvalues&#39;</span>] = 0;  </div><div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;                        }</div><div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;                    }</div><div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;                    </div><div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;                    <span class="keywordflow">if</span>(!isset($_SESSION[COOKIENAME.<span class="stringliteral">&#39;charttype&#39;</span>]))</div><div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;                        $_SESSION[COOKIENAME.<span class="stringliteral">&#39;charttype&#39;</span>] = <span class="stringliteral">&#39;bar&#39;</span>;</div><div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;                        </div><div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;                    <span class="keywordflow">if</span>(isset($_POST[<span class="stringliteral">&#39;chartsettings&#39;</span>]))</div><div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;                    {</div><div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;                        $_SESSION[COOKIENAME.<span class="stringliteral">&#39;charttype&#39;</span>] = $_POST[<span class="stringliteral">&#39;charttype&#39;</span>];    </div><div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;                        $_SESSION[COOKIENAME.$target_table.<span class="stringliteral">&#39;chartlabels&#39;</span>] = $_POST[<span class="stringliteral">&#39;chartlabels&#39;</span>];</div><div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;                        $_SESSION[COOKIENAME.$target_table.<span class="stringliteral">&#39;chartvalues&#39;</span>] = $_POST[<span class="stringliteral">&#39;chartvalues&#39;</span>];</div><div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;                    }</div><div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;                    <span class="comment">//- Chart javascript code</span></div><div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;                    ?&gt;</div><div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;                    &lt;script type=<span class="stringliteral">&#39;text/javascript&#39;</span> src=<span class="stringliteral">&#39;https://www.google.com/jsapi&#39;</span>&gt;&lt;/script&gt;</div><div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;                    &lt;script type=<span class="stringliteral">&#39;text/javascript&#39;</span>&gt;</div><div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;                    google.load(<span class="stringliteral">&#39;visualization&#39;</span>, <span class="stringliteral">&#39;1.0&#39;</span>, {<span class="stringliteral">&#39;packages&#39;</span>:[<span class="stringliteral">&#39;corechart&#39;</span>]});</div><div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;                    google.setOnLoadCallback(drawChart);</div><div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;                    <span class="keyword">function</span> drawChart()</div><div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;                    {</div><div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;                        var data = <span class="keyword">new</span> google.visualization.DataTable();</div><div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;                        data.addColumn(<span class="stringliteral">&#39;string&#39;</span>, <span class="stringliteral">&#39;&lt;?php echo $result[$_SESSION[COOKIENAME.$target_table.&#39;</span>chartlabels<span class="stringliteral">&#39;]][&#39;</span>name<span class="stringliteral">&#39;]; ?&gt;&#39;</span>);</div><div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;                        data.addColumn(<span class="stringliteral">&#39;number&#39;</span>, <span class="stringliteral">&#39;&lt;?php echo $result[$_SESSION[COOKIENAME.$target_table.&#39;</span>chartvalues<span class="stringliteral">&#39;]][&#39;</span>name<span class="stringliteral">&#39;]; ?&gt;&#39;</span>);</div><div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;                        data.addRows([</div><div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;                        &lt;?php</div><div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;                        <span class="keywordflow">for</span>($i=0; $i&lt;<span class="keyword">sizeof</span>($arr); $i++)</div><div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;                        {</div><div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;                            $label = str_replace(<span class="stringliteral">&quot;&#39;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, htmlencode($arr[$i][$_SESSION[COOKIENAME.$target_table.<span class="stringliteral">&#39;chartlabels&#39;</span>]]));</div><div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;                            $value = htmlencode($arr[$i][$_SESSION[COOKIENAME.$target_table.<span class="stringliteral">&#39;chartvalues&#39;</span>]]);</div><div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;                            </div><div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;                            <span class="keywordflow">if</span>($value==NULL || $value==<span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;                                $value = 0;</div><div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;                                </div><div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;                            echo <span class="stringliteral">&quot;[&#39;&quot;</span>.$label.<span class="stringliteral">&quot;&#39;, &quot;</span>.$value.<span class="stringliteral">&quot;]&quot;</span>;</div><div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;                            <span class="keywordflow">if</span>($i&lt;<span class="keyword">sizeof</span>($arr)-1)</div><div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;                                echo <span class="stringliteral">&quot;,&quot;</span>;</div><div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;                        }</div><div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;                        $height = (<span class="keyword">sizeof</span>($arr)+1) * 30;</div><div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;                        <span class="keywordflow">if</span>($height&gt;1000)</div><div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;                            $height = 1000;</div><div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;                        <span class="keywordflow">else</span> <span class="keywordflow">if</span>($height&lt;300)</div><div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;                            $height = 300;</div><div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;                        <span class="keywordflow">if</span>($_SESSION[COOKIENAME.<span class="stringliteral">&#39;charttype&#39;</span>]==<span class="stringliteral">&quot;pie&quot;</span>)</div><div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;                            $height = 800;</div><div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;                        ?&gt;</div><div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;                        ]);</div><div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;                        var chartWidth = document.getElementById(<span class="stringliteral">&quot;main_column&quot;</span>).offsetWidth - document.getElementById(<span class="stringliteral">&quot;chartsettingsbox&quot;</span>).offsetWidth - 100;</div><div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;                        <span class="keywordflow">if</span>(chartWidth&gt;1000)</div><div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;                            chartWidth = 1000;</div><div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;                            </div><div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;                        var options = </div><div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;                        {</div><div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;                            <span class="stringliteral">&#39;width&#39;</span>:chartWidth,</div><div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;                            <span class="stringliteral">&#39;height&#39;</span>:&lt;?php echo $height; ?&gt;,</div><div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;                            <span class="stringliteral">&#39;title&#39;</span>:<span class="stringliteral">&#39;&lt;?php echo $result[$_SESSION[COOKIENAME.$target_table.&#39;</span>chartlabels<span class="stringliteral">&#39;]][&#39;</span>name<span class="stringliteral">&#39;].&quot; vs &quot;.$result[$_SESSION[COOKIENAME.$target_table.&#39;</span>chartvalues<span class="stringliteral">&#39;]][&#39;</span>name<span class="stringliteral">&#39;]; ?&gt;&#39;</span></div><div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;                        };</div><div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;                        &lt;?php</div><div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;                        <span class="keywordflow">if</span>($_SESSION[COOKIENAME.<span class="stringliteral">&#39;charttype&#39;</span>]==<span class="stringliteral">&quot;bar&quot;</span>)</div><div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;                            echo <span class="stringliteral">&quot;var chart = new google.visualization.BarChart(document.getElementById(&#39;chart_div&#39;));&quot;</span>;</div><div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;                        <span class="keywordflow">else</span> <span class="keywordflow">if</span>($_SESSION[COOKIENAME.<span class="stringliteral">&#39;charttype&#39;</span>]==<span class="stringliteral">&quot;pie&quot;</span>)</div><div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;                            echo <span class="stringliteral">&quot;var chart = new google.visualization.PieChart(document.getElementById(&#39;chart_div&#39;));&quot;</span>;</div><div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;                        <span class="keywordflow">else</span></div><div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;                            echo <span class="stringliteral">&quot;var chart = new google.visualization.LineChart(document.getElementById(&#39;chart_div&#39;));&quot;</span>;</div><div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;                        ?&gt;</div><div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;                        chart.draw(data, options);</div><div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;                    }</div><div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;                    &lt;/script&gt;</div><div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;                    &lt;div <span class="keywordtype">id</span>=<span class="stringliteral">&quot;chart_div&quot;</span> style=<span class="stringliteral">&quot;float:left;&quot;</span>&gt;&lt;?php echo $lang[<span class="stringliteral">&#39;no_chart&#39;</span>]; ?&gt;&lt;/div&gt;</div><div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;                    &lt;?php</div><div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;                    echo <span class="stringliteral">&quot;&lt;fieldset style=&#39;float:right; text-align:center;&#39; id=&#39;chartsettingsbox&#39;&gt;&lt;legend&gt;&lt;b&gt;Chart Settings&lt;/b&gt;&lt;/legend&gt;&quot;</span>;</div><div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;                    echo <span class="stringliteral">&quot;&lt;form action=&#39;?action=row_view&amp;amp;table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&#39; method=&#39;post&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;                    echo $lang[<span class="stringliteral">&#39;chart_type&#39;</span>].<span class="stringliteral">&quot;: &lt;select name=&#39;charttype&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;                    echo <span class="stringliteral">&quot;&lt;option value=&#39;bar&#39;&quot;</span>;</div><div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;                    <span class="keywordflow">if</span>($_SESSION[COOKIENAME.<span class="stringliteral">&#39;charttype&#39;</span>]==<span class="stringliteral">&quot;bar&quot;</span>)</div><div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;                        echo <span class="stringliteral">&quot; selected=&#39;selected&#39;&quot;</span>;</div><div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;                    echo <span class="stringliteral">&quot;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;chart_bar&#39;</span>].<span class="stringliteral">&quot;&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;                    echo <span class="stringliteral">&quot;&lt;option value=&#39;pie&#39;&quot;</span>;</div><div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;                    <span class="keywordflow">if</span>($_SESSION[COOKIENAME.<span class="stringliteral">&#39;charttype&#39;</span>]==<span class="stringliteral">&quot;pie&quot;</span>)</div><div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;                        echo <span class="stringliteral">&quot; selected=&#39;selected&#39;&quot;</span>;</div><div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;                    echo <span class="stringliteral">&quot;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;chart_pie&#39;</span>].<span class="stringliteral">&quot;&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;                    echo <span class="stringliteral">&quot;&lt;option value=&#39;line&#39;&quot;</span>;</div><div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;                    <span class="keywordflow">if</span>($_SESSION[COOKIENAME.<span class="stringliteral">&#39;charttype&#39;</span>]==<span class="stringliteral">&quot;line&quot;</span>)</div><div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;                        echo <span class="stringliteral">&quot; selected=&#39;selected&#39;&quot;</span>;</div><div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;                    echo <span class="stringliteral">&quot;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;chart_line&#39;</span>].<span class="stringliteral">&quot;&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/select&gt;&quot;</span>;</div><div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;                    echo <span class="stringliteral">&quot;&lt;br/&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;                    echo $lang[<span class="stringliteral">&#39;lbl&#39;</span>].<span class="stringliteral">&quot;: &lt;select name=&#39;chartlabels&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;                    <span class="keywordflow">for</span>($i=0; $i&lt;<span class="keyword">sizeof</span>($result); $i++)</div><div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;                    {</div><div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;                        <span class="keywordflow">if</span>(isset($_SESSION[COOKIENAME.$target_table.<span class="stringliteral">&#39;chartlabels&#39;</span>]) &amp;&amp; $_SESSION[COOKIENAME.$target_table.<span class="stringliteral">&#39;chartlabels&#39;</span>]==$i)</div><div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;                            echo <span class="stringliteral">&quot;&lt;option value=&#39;&quot;</span>.$i.<span class="stringliteral">&quot;&#39; selected=&#39;selected&#39;&gt;&quot;</span>.htmlencode($result[$i][<span class="stringliteral">&#39;name&#39;</span>]).<span class="stringliteral">&quot;&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;                        <span class="keywordflow">else</span></div><div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;                            echo <span class="stringliteral">&quot;&lt;option value=&#39;&quot;</span>.$i.<span class="stringliteral">&quot;&#39;&gt;&quot;</span>.htmlencode($result[$i][<span class="stringliteral">&#39;name&#39;</span>]).<span class="stringliteral">&quot;&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;                    }</div><div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/select&gt;&quot;</span>;</div><div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;                    echo <span class="stringliteral">&quot;&lt;br/&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;                    echo $lang[<span class="stringliteral">&#39;val&#39;</span>].<span class="stringliteral">&quot;: &lt;select name=&#39;chartvalues&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;                    <span class="keywordflow">for</span>($i=0; $i&lt;<span class="keyword">sizeof</span>($result); $i++)</div><div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;                    {</div><div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;                        <span class="keywordflow">if</span>(isset($_SESSION[COOKIENAME.$target_table.<span class="stringliteral">&#39;chartvalues&#39;</span>]) &amp;&amp; $_SESSION[COOKIENAME.$target_table.<span class="stringliteral">&#39;chartvalues&#39;</span>]==$i)</div><div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;                            echo <span class="stringliteral">&quot;&lt;option value=&#39;&quot;</span>.$i.<span class="stringliteral">&quot;&#39; selected=&#39;selected&#39;&gt;&quot;</span>.htmlencode($result[$i][<span class="stringliteral">&#39;name&#39;</span>]).<span class="stringliteral">&quot;&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;                        <span class="keywordflow">else</span></div><div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;                            echo <span class="stringliteral">&quot;&lt;option value=&#39;&quot;</span>.$i.<span class="stringliteral">&quot;&#39;&gt;&quot;</span>.htmlencode($result[$i][<span class="stringliteral">&#39;name&#39;</span>]).<span class="stringliteral">&quot;&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;                    }</div><div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/select&gt;&quot;</span>;</div><div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;                    echo <span class="stringliteral">&quot;&lt;br/&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;                    echo <span class="stringliteral">&quot;&lt;input type=&#39;submit&#39; name=&#39;chartsettings&#39; value=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;update&#39;</span>].<span class="stringliteral">&quot;&#39; class=&#39;btn&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/form&gt;&quot;</span>;</div><div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/fieldset&gt;&quot;</span>;</div><div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;                    echo <span class="stringliteral">&quot;&lt;div style=&#39;clear:both;&#39;&gt;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;                    <span class="comment">//end chart view</span></div><div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;                }</div><div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;            }</div><div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span>($rowCount&gt;0)<span class="comment">//no rows - do nothing</span></div><div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;            {</div><div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;                echo <span class="stringliteral">&quot;&lt;br/&gt;&lt;br/&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;no_rows&#39;</span>];</div><div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;            }</div><div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;            elseif($target_table_type == <span class="stringliteral">&#39;table&#39;</span>)</div><div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;            {</div><div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;                echo <span class="stringliteral">&quot;&lt;br/&gt;&lt;br/&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;empty_tbl&#39;</span>].<span class="stringliteral">&quot; &lt;a href=&#39;?table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&amp;amp;action=row_create&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;click&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt; &quot;</span>.$lang[<span class="stringliteral">&#39;insert_rows&#39;</span>];</div><div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;            }</div><div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;</div><div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;</div><div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;        <span class="comment">//- Create new row (=row_create)</span></div><div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;        <span class="keywordflow">case</span> <span class="stringliteral">&quot;row_create&quot;</span>:</div><div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;            $fieldStr = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;            echo <span class="stringliteral">&quot;&lt;form action=&#39;?table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&amp;amp;action=row_create&#39; method=&#39;post&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;            echo $lang[<span class="stringliteral">&#39;restart_insert&#39;</span>];</div><div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;            echo <span class="stringliteral">&quot; &lt;select name=&#39;num&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;            <span class="keywordflow">for</span>($i=1; $i&lt;=40; $i++)</div><div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;            {</div><div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;                <span class="keywordflow">if</span>(isset($_POST[<span class="stringliteral">&#39;num&#39;</span>]) &amp;&amp; $_POST[<span class="stringliteral">&#39;num&#39;</span>]==$i)</div><div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;                    echo <span class="stringliteral">&quot;&lt;option value=&#39;&quot;</span>.$i.<span class="stringliteral">&quot;&#39; selected=&#39;selected&#39;&gt;&quot;</span>.$i.<span class="stringliteral">&quot;&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;                    echo <span class="stringliteral">&quot;&lt;option value=&#39;&quot;</span>.$i.<span class="stringliteral">&quot;&#39;&gt;&quot;</span>.$i.<span class="stringliteral">&quot;&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;            }</div><div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;            echo <span class="stringliteral">&quot;&lt;/select&gt; &quot;</span>;</div><div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;            echo $lang[<span class="stringliteral">&#39;rows&#39;</span>];</div><div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;            echo <span class="stringliteral">&quot; &lt;input type=&#39;submit&#39; value=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;go&#39;</span>].<span class="stringliteral">&quot;&#39; class=&#39;btn&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;            echo <span class="stringliteral">&quot;&lt;/form&gt;&quot;</span>;</div><div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;            echo <span class="stringliteral">&quot;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;            $query = <span class="stringliteral">&quot;PRAGMA table_info(&quot;</span>.$db-&gt;quote_id($target_table).<span class="stringliteral">&quot;)&quot;</span>;</div><div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;            $result = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;selectArray($query);</div><div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;            echo <span class="stringliteral">&quot;&lt;form action=&#39;?table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&amp;amp;action=row_create&amp;amp;confirm=1&#39; method=&#39;post&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;            <span class="keywordflow">if</span>(isset($_POST[<span class="stringliteral">&#39;num&#39;</span>]))</div><div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;                $num = $_POST[<span class="stringliteral">&#39;num&#39;</span>];</div><div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;                $num = 1;</div><div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;            echo <span class="stringliteral">&quot;&lt;input type=&#39;hidden&#39; name=&#39;numRows&#39; value=&#39;&quot;</span>.$num.<span class="stringliteral">&quot;&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;            <span class="keywordflow">for</span>($j=0; $j&lt;$num; $j++)</div><div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;            {</div><div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;                <span class="keywordflow">if</span>($j&gt;0)</div><div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;                    echo <span class="stringliteral">&quot;&lt;label&gt;&lt;input type=&#39;checkbox&#39; value=&#39;ignore&#39; name=&#39;&quot;</span>.$j.<span class="stringliteral">&quot;:ignore&#39; id=&#39;row_&quot;</span>.$j.<span class="stringliteral">&quot;_ignore&#39; checked=&#39;checked&#39;/&gt; &quot;</span>.$lang[<span class="stringliteral">&#39;ignore&#39;</span>].<span class="stringliteral">&quot;&lt;/label&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;                echo <span class="stringliteral">&quot;&lt;table border=&#39;0&#39; cellpadding=&#39;2&#39; cellspacing=&#39;1&#39; class=&#39;viewTable&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;                echo <span class="stringliteral">&quot;&lt;tr&gt;&quot;</span>;</div><div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;                echo <span class="stringliteral">&quot;&lt;td class=&#39;tdheader&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;fld&#39;</span>].<span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;                echo <span class="stringliteral">&quot;&lt;td class=&#39;tdheader&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;type&#39;</span>].<span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;                echo <span class="stringliteral">&quot;&lt;td class=&#39;tdheader&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;func&#39;</span>].<span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;                echo <span class="stringliteral">&quot;&lt;td class=&#39;tdheader&#39;&gt;Null&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;                echo <span class="stringliteral">&quot;&lt;td class=&#39;tdheader&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;val&#39;</span>].<span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;                echo <span class="stringliteral">&quot;&lt;/tr&gt;&quot;</span>;</div><div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;</div><div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;                <span class="keywordflow">for</span>($i=0; $i&lt;<span class="keyword">sizeof</span>($result); $i++)</div><div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;                {</div><div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;                    $field = $result[$i][<span class="stringliteral">&#39;name&#39;</span>];</div><div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;                    $field_html = htmlencode($field);</div><div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;                    <span class="keywordflow">if</span>($j==0)</div><div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;                        $fieldStr .= <span class="stringliteral">&quot;:&quot;</span>.$field;</div><div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;                    $type = strtolower($result[$i][<span class="stringliteral">&#39;type&#39;</span>]);</div><div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;                    $typeAffinity = get_type_affinity($type);</div><div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;                    $tdWithClass = <span class="stringliteral">&quot;&lt;td class=&#39;td&quot;</span>.($i%2 ? <span class="stringliteral">&quot;1&quot;</span> : <span class="stringliteral">&quot;2&quot;</span>).<span class="stringliteral">&quot;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;                    $tdWithClassLeft = <span class="stringliteral">&quot;&lt;td class=&#39;td&quot;</span>.($i%2 ? <span class="stringliteral">&quot;1&quot;</span> : <span class="stringliteral">&quot;2&quot;</span>).<span class="stringliteral">&quot;&#39; style=&#39;text-align:left;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;                    echo <span class="stringliteral">&quot;&lt;tr&gt;&quot;</span>;</div><div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;                    echo $tdWithClassLeft;</div><div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;                    echo $field_html;</div><div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;                    echo $tdWithClassLeft;</div><div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;                    echo htmlencode($type);</div><div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;                    echo $tdWithClassLeft;</div><div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;                    echo <span class="stringliteral">&quot;&lt;select name=&#39;function_&quot;</span>.$j.<span class="stringliteral">&quot;_&quot;</span>.$field_html.<span class="stringliteral">&quot;&#39; onchange=&#39;notNull(\&quot;row_&quot;</span>.$j.<span class="stringliteral">&quot;_field_&quot;</span>.$i.<span class="stringliteral">&quot;_null\&quot;);&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;                    echo <span class="stringliteral">&quot;&lt;option value=&#39;&#39;&gt;&amp;nbsp;&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;                    <span class="keywordflow">foreach</span> (array_merge($sqlite_functions, $custom_functions) as $f) {</div><div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;                        echo <span class="stringliteral">&quot;&lt;option value=&#39;&quot;</span>.htmlencode($f).<span class="stringliteral">&quot;&#39;&gt;&quot;</span>.htmlencode($f).<span class="stringliteral">&quot;&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;                    }</div><div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/select&gt;&quot;</span>;</div><div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;                    <span class="comment">//we need to have a column dedicated to nulls -di</span></div><div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;                    echo $tdWithClassLeft;</div><div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;                    <span class="keywordflow">if</span>($result[$i][<span class="stringliteral">&#39;notnull&#39;</span>]==0)</div><div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;                    {</div><div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;                        <span class="keywordflow">if</span>($result[$i][<span class="stringliteral">&#39;dflt_value&#39;</span>]===<span class="stringliteral">&quot;NULL&quot;</span>)</div><div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;                            echo <span class="stringliteral">&quot;&lt;input type=&#39;checkbox&#39; name=&#39;&quot;</span>.$j.<span class="stringliteral">&quot;:&quot;</span>.$field_html.<span class="stringliteral">&quot;_null&#39; id=&#39;row_&quot;</span>.$j.<span class="stringliteral">&quot;_field_&quot;</span>.$i.<span class="stringliteral">&quot;_null&#39; checked=&#39;checked&#39; onclick=&#39;disableText(this, \&quot;row_&quot;</span>.$j.<span class="stringliteral">&quot;_field_&quot;</span>.$i.<span class="stringliteral">&quot;_value\&quot;);&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;                        <span class="keywordflow">else</span></div><div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;                            echo <span class="stringliteral">&quot;&lt;input type=&#39;checkbox&#39; name=&#39;&quot;</span>.$j.<span class="stringliteral">&quot;:&quot;</span>.$field_html.<span class="stringliteral">&quot;_null&#39; id=&#39;row_&quot;</span>.$j.<span class="stringliteral">&quot;_field_&quot;</span>.$i.<span class="stringliteral">&quot;_null&#39; onclick=&#39;disableText(this, \&quot;row_&quot;</span>.$j.<span class="stringliteral">&quot;_field_&quot;</span>.$i.<span class="stringliteral">&quot;_value\&quot;);&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;                    }</div><div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;                    echo $tdWithClassLeft;</div><div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;                    <span class="keywordflow">if</span>($result[$i][<span class="stringliteral">&#39;dflt_value&#39;</span>] === <span class="stringliteral">&quot;NULL&quot;</span>)</div><div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;                        $dflt_value = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;                    <span class="keywordflow">else</span></div><div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;                        $dflt_value = htmlencode(deQuoteSQL($result[$i][<span class="stringliteral">&#39;dflt_value&#39;</span>]));</div><div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;                    </div><div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;                    <span class="keywordflow">if</span>($typeAffinity==<span class="stringliteral">&quot;INTEGER&quot;</span> || $typeAffinity==<span class="stringliteral">&quot;REAL&quot;</span> || $typeAffinity==<span class="stringliteral">&quot;NUMERIC&quot;</span>)</div><div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;                        echo <span class="stringliteral">&quot;&lt;input type=&#39;text&#39; id=&#39;row_&quot;</span>.$j.<span class="stringliteral">&quot;_field_&quot;</span>.$i.<span class="stringliteral">&quot;_value&#39; name=&#39;&quot;</span>.$j.<span class="stringliteral">&quot;:&quot;</span>.$field_html.<span class="stringliteral">&quot;&#39; value=&#39;&quot;</span>.$dflt_value.<span class="stringliteral">&quot;&#39; onblur=&#39;changeIgnore(this, \&quot;row_&quot;</span>.$j.<span class="stringliteral">&quot;_ignore\&quot;);&#39; onclick=&#39;notNull(\&quot;row_&quot;</span>.$j.<span class="stringliteral">&quot;_field_&quot;</span>.$i.<span class="stringliteral">&quot;_null\&quot;);&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;                    <span class="keywordflow">else</span></div><div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;                        echo <span class="stringliteral">&quot;&lt;textarea id=&#39;row_&quot;</span>.$j.<span class="stringliteral">&quot;_field_&quot;</span>.$i.<span class="stringliteral">&quot;_value&#39; name=&#39;&quot;</span>.$j.<span class="stringliteral">&quot;:&quot;</span>.$field_html.<span class="stringliteral">&quot;&#39; rows=&#39;5&#39; cols=&#39;60&#39; onclick=&#39;notNull(\&quot;row_&quot;</span>.$j.<span class="stringliteral">&quot;_field_&quot;</span>.$i.<span class="stringliteral">&quot;_null\&quot;);&#39; onblur=&#39;changeIgnore(this, \&quot;row_&quot;</span>.$j.<span class="stringliteral">&quot;_ignore\&quot;);&#39;&gt;&quot;</span>.$dflt_value.<span class="stringliteral">&quot;&lt;/textarea&gt;&quot;</span>;</div><div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;                echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;                echo <span class="stringliteral">&quot;&lt;/tr&gt;&quot;</span>;</div><div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;                }</div><div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;                echo <span class="stringliteral">&quot;&lt;tr&gt;&quot;</span>;</div><div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;                echo <span class="stringliteral">&quot;&lt;td class=&#39;tdheader&#39; style=&#39;text-align:right;&#39; colspan=&#39;5&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;                echo <span class="stringliteral">&quot;&lt;input type=&#39;submit&#39; value=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;insert&#39;</span>].<span class="stringliteral">&quot;&#39; class=&#39;btn&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;                echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;                echo <span class="stringliteral">&quot;&lt;/tr&gt;&quot;</span>;</div><div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;                echo <span class="stringliteral">&quot;&lt;/table&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;            }</div><div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;            $fieldStr = substr($fieldStr, 1);</div><div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;            echo <span class="stringliteral">&quot;&lt;input type=&#39;hidden&#39; name=&#39;fields&#39; value=&#39;&quot;</span>.htmlencode($fieldStr).<span class="stringliteral">&quot;&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;            echo <span class="stringliteral">&quot;&lt;/form&gt;&quot;</span>;</div><div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;</div><div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;        <span class="comment">//- Edit or delete row (=row_editordelete)</span></div><div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;        <span class="keywordflow">case</span> <span class="stringliteral">&quot;row_editordelete&quot;</span>:</div><div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;            <span class="keywordflow">if</span>(isset($_POST[<span class="stringliteral">&#39;check&#39;</span>]))</div><div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;                $pks = $_POST[<span class="stringliteral">&#39;check&#39;</span>];</div><div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span>(isset($_GET[<span class="stringliteral">&#39;pk&#39;</span>]))</div><div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;                $pks = array($_GET[<span class="stringliteral">&#39;pk&#39;</span>]);</div><div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;            <span class="keywordflow">else</span> $pks[0] = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;            $str = $pks[0];</div><div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;            <span class="keywordflow">for</span>($i=1; $i&lt;<span class="keyword">sizeof</span>($pks); $i++)</div><div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;            {</div><div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;                $str .= <span class="stringliteral">&quot;, &quot;</span>.$pks[$i];</div><div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;            }</div><div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;            <span class="keywordflow">if</span>($str==<span class="stringliteral">&quot;&quot;</span>) <span class="comment">//nothing was selected so show an error</span></div><div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;            {</div><div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;                echo <span class="stringliteral">&quot;&lt;div class=&#39;confirm&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;                echo $lang[<span class="stringliteral">&#39;err&#39;</span>].<span class="stringliteral">&quot;: &quot;</span>.$lang[<span class="stringliteral">&#39;no_sel&#39;</span>];</div><div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;                echo <span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;                echo <span class="stringliteral">&quot;&lt;br/&gt;&lt;br/&gt;&lt;a href=&#39;?table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&amp;amp;action=row_view&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;return&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;            }</div><div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;            {</div><div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;                <span class="keywordflow">if</span>((isset($_POST[<span class="stringliteral">&#39;type&#39;</span>]) &amp;&amp; $_POST[<span class="stringliteral">&#39;type&#39;</span>]==<span class="stringliteral">&quot;edit&quot;</span>) || (isset($_GET[<span class="stringliteral">&#39;type&#39;</span>]) &amp;&amp; $_GET[<span class="stringliteral">&#39;type&#39;</span>]==<span class="stringliteral">&quot;edit&quot;</span>)) <span class="comment">//edit</span></div><div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;                {</div><div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;                    echo <span class="stringliteral">&quot;&lt;form action=&#39;?table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&amp;amp;action=row_edit&amp;amp;confirm=1&amp;amp;pk=&quot;</span>.urlencode(json_encode($pks)).<span class="stringliteral">&quot;&#39; method=&#39;post&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;                    $query = <span class="stringliteral">&quot;PRAGMA table_info(&quot;</span>.$db-&gt;quote_id($target_table).<span class="stringliteral">&quot;)&quot;</span>;</div><div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;                    $result = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;selectArray($query);</div><div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;</div><div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;                    <span class="comment">//build the POST array of fields</span></div><div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;                    $fieldStr = $result[0][1];</div><div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;                    <span class="keywordflow">for</span>($j=1; $j&lt;<span class="keyword">sizeof</span>($result); $j++)</div><div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;                        $fieldStr .= <span class="stringliteral">&quot;:&quot;</span>.$result[$j][1];</div><div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;                        </div><div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;                    $primary_key = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;getPrimaryKey($target_table);</div><div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;                    </div><div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;                    echo <span class="stringliteral">&quot;&lt;input type=&#39;hidden&#39; name=&#39;fieldArray&#39; value=&#39;&quot;</span>.htmlencode($fieldStr).<span class="stringliteral">&quot;&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;</div><div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;                    <span class="keywordflow">for</span>($j=0; $j&lt;<span class="keyword">sizeof</span>($pks); $j++)</div><div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;                    {</div><div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;                        $query = <span class="stringliteral">&quot;SELECT * FROM &quot;</span>.$db-&gt;quote_id($target_table).<span class="stringliteral">&quot; WHERE &quot;</span> . <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;wherePK($target_table, json_decode($pks[$j]));</div><div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;                        $result1 = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;select($query);</div><div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;</div><div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;                        echo <span class="stringliteral">&quot;&lt;table border=&#39;0&#39; cellpadding=&#39;2&#39; cellspacing=&#39;1&#39; class=&#39;viewTable&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;                        echo <span class="stringliteral">&quot;&lt;tr&gt;&quot;</span>;</div><div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;                        echo <span class="stringliteral">&quot;&lt;td class=&#39;tdheader&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;fld&#39;</span>].<span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;                        echo <span class="stringliteral">&quot;&lt;td class=&#39;tdheader&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;type&#39;</span>].<span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;                        echo <span class="stringliteral">&quot;&lt;td class=&#39;tdheader&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;func&#39;</span>].<span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;                        echo <span class="stringliteral">&quot;&lt;td class=&#39;tdheader&#39;&gt;Null&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;                        echo <span class="stringliteral">&quot;&lt;td class=&#39;tdheader&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;val&#39;</span>].<span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;                        echo <span class="stringliteral">&quot;&lt;/tr&gt;&quot;</span>;</div><div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;</div><div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;                        <span class="keywordflow">for</span>($i=0; $i&lt;<span class="keyword">sizeof</span>($result); $i++)</div><div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;                        {</div><div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;                            $field = $result[$i][1];</div><div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;                            $type = $result[$i][<span class="stringliteral">&#39;type&#39;</span>];</div><div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;                            $typeAffinity = get_type_affinity($type);</div><div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;                            $value = $result1[$i];</div><div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;                            $tdWithClass = <span class="stringliteral">&quot;&lt;td class=&#39;td&quot;</span>.($i%2 ? <span class="stringliteral">&quot;1&quot;</span> : <span class="stringliteral">&quot;2&quot;</span>).<span class="stringliteral">&quot;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;                            $tdWithClassLeft = <span class="stringliteral">&quot;&lt;td class=&#39;td&quot;</span>.($i%2 ? <span class="stringliteral">&quot;1&quot;</span> : <span class="stringliteral">&quot;2&quot;</span>).<span class="stringliteral">&quot;&#39; style=&#39;text-align:left;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;                            echo <span class="stringliteral">&quot;&lt;tr&gt;&quot;</span>;</div><div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;                            echo $tdWithClass;</div><div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;                            echo htmlencode($field);</div><div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;                            echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;                            echo $tdWithClass;</div><div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;                            echo htmlencode($type);</div><div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;                            echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;                            echo $tdWithClassLeft;</div><div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;                            echo <span class="stringliteral">&quot;&lt;select name=&#39;function_&quot;</span>.htmlencode($field).<span class="stringliteral">&quot;[]&#39; onchange=&#39;notNull(\&quot;&quot;</span>.htmlencode($pks[$j]).<span class="stringliteral">&quot;:&quot;</span>.htmlencode($field).<span class="stringliteral">&quot;_null\&quot;);&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;                            echo <span class="stringliteral">&quot;&lt;option value=&#39;&#39;&gt;&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;                            <span class="keywordflow">foreach</span> (array_merge($sqlite_functions, $custom_functions) as $f) {</div><div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;                                echo <span class="stringliteral">&quot;&lt;option value=&#39;&quot;</span>.htmlencode($f).<span class="stringliteral">&quot;&#39;&gt;&quot;</span>.htmlencode($f).<span class="stringliteral">&quot;&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;                            }</div><div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;                            echo <span class="stringliteral">&quot;&lt;/select&gt;&quot;</span>;</div><div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;                            echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;                            echo $tdWithClassLeft;</div><div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;                            <span class="keywordflow">if</span>($result[$i][3]==0)</div><div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;                            {</div><div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;                                <span class="keywordflow">if</span>($value===NULL)</div><div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;                                    echo <span class="stringliteral">&quot;&lt;input type=&#39;checkbox&#39; name=&#39;&quot;</span>.htmlencode($field).<span class="stringliteral">&quot;_null[]&#39; id=&#39;&quot;</span>.htmlencode($pks[$j]).<span class="stringliteral">&quot;:&quot;</span>.htmlencode($field).<span class="stringliteral">&quot;_null&#39; checked=&#39;checked&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;                                <span class="keywordflow">else</span></div><div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;                                    echo <span class="stringliteral">&quot;&lt;input type=&#39;checkbox&#39; name=&#39;&quot;</span>.htmlencode($field).<span class="stringliteral">&quot;_null[]&#39; id=&#39;&quot;</span>.htmlencode($pks[$j]).<span class="stringliteral">&quot;:&quot;</span>.htmlencode($field).<span class="stringliteral">&quot;_null&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;                            }</div><div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;                            echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;                            echo $tdWithClassLeft;</div><div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;                            <span class="keywordflow">if</span>($typeAffinity==<span class="stringliteral">&quot;INTEGER&quot;</span> || $typeAffinity==<span class="stringliteral">&quot;REAL&quot;</span> || $typeAffinity==<span class="stringliteral">&quot;NUMERIC&quot;</span>)</div><div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;                                echo <span class="stringliteral">&quot;&lt;input type=&#39;text&#39; name=&#39;&quot;</span>.htmlencode($field).<span class="stringliteral">&quot;[]&#39; value=&#39;&quot;</span>.htmlencode($value).<span class="stringliteral">&quot;&#39; onblur=&#39;changeIgnore(this, \&quot;&quot;</span>.$j.<span class="stringliteral">&quot;\&quot;, \&quot;&quot;</span>.htmlencode($pks[$j]).<span class="stringliteral">&quot;:&quot;</span>.htmlencode($field).<span class="stringliteral">&quot;_null\&quot;)&#39; /&gt;&quot;</span>;</div><div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;                            <span class="keywordflow">else</span></div><div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;                                echo <span class="stringliteral">&quot;&lt;textarea name=&#39;&quot;</span>.htmlencode($field).<span class="stringliteral">&quot;[]&#39; rows=&#39;1&#39; cols=&#39;60&#39; class=&#39;&quot;</span>.htmlencode($field).<span class="stringliteral">&quot;_textarea&#39; onblur=&#39;changeIgnore(this, \&quot;&quot;</span>.$j.<span class="stringliteral">&quot;\&quot;, \&quot;&quot;</span>.htmlencode($pks[$j]).<span class="stringliteral">&quot;:&quot;</span>.htmlencode($field).<span class="stringliteral">&quot;_null\&quot;)&#39;&gt;&quot;</span>.htmlencode($value).<span class="stringliteral">&quot;&lt;/textarea&gt;&quot;</span>;</div><div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;                            echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;                            echo <span class="stringliteral">&quot;&lt;/tr&gt;&quot;</span>;</div><div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;                        }</div><div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;                        echo <span class="stringliteral">&quot;&lt;tr&gt;&quot;</span>;</div><div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;                        echo <span class="stringliteral">&quot;&lt;td class=&#39;tdheader&#39; style=&#39;text-align:right;&#39; colspan=&#39;5&#39;&gt;&quot;</span>;</div><div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;                        <span class="comment">// Note: the &#39;Save changes&#39; button must be first in the code so it is the one used when submitting the form with the Enter key (issue #215)</span></div><div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;                        echo <span class="stringliteral">&quot;&lt;input type=&#39;submit&#39; value=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;save_ch&#39;</span>].<span class="stringliteral">&quot;&#39; class=&#39;btn&#39;/&gt; &quot;</span>;</div><div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;                        echo <span class="stringliteral">&quot;&lt;input type=&#39;submit&#39; name=&#39;new_row&#39; value=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;new_insert&#39;</span>].<span class="stringliteral">&quot;&#39; class=&#39;btn&#39;/&gt; &quot;</span>;</div><div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;                        echo <span class="stringliteral">&quot;&lt;a href=&#39;?table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&amp;amp;action=row_view&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;cancel&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;                        echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;                        echo <span class="stringliteral">&quot;&lt;/tr&gt;&quot;</span>;</div><div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;                        echo <span class="stringliteral">&quot;&lt;/table&gt;&quot;</span>;</div><div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;                        echo <span class="stringliteral">&quot;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;                    }</div><div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/form&gt;&quot;</span>;</div><div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;                }</div><div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;                <span class="keywordflow">else</span> <span class="comment">//delete</span></div><div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;                {</div><div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;                    echo <span class="stringliteral">&quot;&lt;form action=&#39;?table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&amp;amp;action=row_delete&amp;amp;confirm=1&amp;amp;pk=&quot;</span>.urlencode(json_encode($pks)).<span class="stringliteral">&quot;&#39; method=&#39;post&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;                    echo <span class="stringliteral">&quot;&lt;div class=&#39;confirm&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;                    printf($lang[<span class="stringliteral">&#39;ques_del_rows&#39;</span>], htmlencode($str), htmlencode($target_table));</div><div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;                    echo <span class="stringliteral">&quot;&lt;br/&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;                    echo <span class="stringliteral">&quot;&lt;input type=&#39;submit&#39; value=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;confirm&#39;</span>].<span class="stringliteral">&quot;&#39; class=&#39;btn&#39;/&gt; &quot;</span>;</div><div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;                    echo <span class="stringliteral">&quot;&lt;a href=&#39;?table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&amp;amp;action=row_view&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;cancel&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;                }</div><div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;            }</div><div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;</div><div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;    <span class="comment">//- Column actions</span></div><div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;</div><div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;        <span class="comment">//- View table structure (=column_view)</span></div><div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;        <span class="keywordflow">case</span> <span class="stringliteral">&quot;column_view&quot;</span>:</div><div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;            $query = <span class="stringliteral">&quot;PRAGMA table_info(&quot;</span>.$db-&gt;quote_id($target_table).<span class="stringliteral">&quot;)&quot;</span>;</div><div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;            $result = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;selectArray($query);</div><div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;</div><div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;            echo <span class="stringliteral">&quot;&lt;form action=&#39;?table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&amp;amp;action=column_confirm&#39; method=&#39;post&#39; name=&#39;checkForm&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;            echo <span class="stringliteral">&quot;&lt;table border=&#39;0&#39; cellpadding=&#39;2&#39; cellspacing=&#39;1&#39; class=&#39;viewTable&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;            echo <span class="stringliteral">&quot;&lt;tr&gt;&quot;</span>;</div><div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;            <span class="keywordflow">if</span>($target_table_type == <span class="stringliteral">&#39;table&#39;</span>)</div><div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;                echo <span class="stringliteral">&quot;&lt;td colspan=&#39;3&#39;&gt;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;            echo <span class="stringliteral">&quot;&lt;td class=&#39;tdheader&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;col&#39;</span>].<span class="stringliteral">&quot; #&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;            echo <span class="stringliteral">&quot;&lt;td class=&#39;tdheader&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;fld&#39;</span>].<span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;            echo <span class="stringliteral">&quot;&lt;td class=&#39;tdheader&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;type&#39;</span>].<span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;            echo <span class="stringliteral">&quot;&lt;td class=&#39;tdheader&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;not_null&#39;</span>].<span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;            echo <span class="stringliteral">&quot;&lt;td class=&#39;tdheader&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;def_val&#39;</span>].<span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;            echo <span class="stringliteral">&quot;&lt;td class=&#39;tdheader&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;prim_key&#39;</span>].<span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;            echo <span class="stringliteral">&quot;&lt;/tr&gt;&quot;</span>;</div><div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;</div><div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;            $noPrimaryKey = <span class="keyword">true</span>;</div><div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;            </div><div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;            <span class="keywordflow">for</span>($i=0; $i&lt;<span class="keyword">sizeof</span>($result); $i++)</div><div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;            {</div><div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;                $colVal = $result[$i][0];</div><div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;                $fieldVal = $result[$i][1];</div><div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;                $typeVal = $result[$i][<span class="stringliteral">&#39;type&#39;</span>];</div><div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;                $notnullVal = $result[$i][3];</div><div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;                $defaultVal = $result[$i][4];</div><div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;                $primarykeyVal = $result[$i][5];</div><div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;</div><div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;                <span class="keywordflow">if</span>(intval($notnullVal)!=0)</div><div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;                    $notnullVal = $lang[<span class="stringliteral">&#39;yes&#39;</span>];</div><div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;                    $notnullVal = $lang[<span class="stringliteral">&#39;no&#39;</span>];</div><div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;                <span class="keywordflow">if</span>(intval($primarykeyVal)!=0)</div><div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;                {</div><div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;                    $primarykeyVal = $lang[<span class="stringliteral">&#39;yes&#39;</span>];</div><div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;                    $noPrimaryKey = <span class="keyword">false</span>;</div><div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;                }</div><div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;                    $primarykeyVal = $lang[<span class="stringliteral">&#39;no&#39;</span>];</div><div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;</div><div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;                $tdWithClass = <span class="stringliteral">&quot;&lt;td class=&#39;td&quot;</span>.($i%2 ? <span class="stringliteral">&quot;1&quot;</span> : <span class="stringliteral">&quot;2&quot;</span>).<span class="stringliteral">&quot;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;                $tdWithClassLeft = <span class="stringliteral">&quot;&lt;td class=&#39;td&quot;</span>.($i%2 ? <span class="stringliteral">&quot;1&quot;</span> : <span class="stringliteral">&quot;2&quot;</span>).<span class="stringliteral">&quot;&#39; style=&#39;text-align:left;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;                echo <span class="stringliteral">&quot;&lt;tr&gt;&quot;</span>;</div><div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;                <span class="keywordflow">if</span>($target_table_type == <span class="stringliteral">&#39;table&#39;</span>)</div><div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;                {</div><div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;                    echo $tdWithClass;</div><div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;                    echo <span class="stringliteral">&quot;&lt;input type=&#39;checkbox&#39; name=&#39;check[]&#39; value=&#39;&quot;</span>.htmlencode($fieldVal).<span class="stringliteral">&quot;&#39; id=&#39;check_&quot;</span>.$i.<span class="stringliteral">&quot;&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;                    echo $tdWithClass;</div><div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;                    echo <span class="stringliteral">&quot;&lt;a href=&#39;?table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&amp;amp;action=column_edit&amp;amp;pk=&quot;</span>.urlencode($fieldVal).<span class="stringliteral">&quot;&#39; title=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;edit&#39;</span>].<span class="stringliteral">&quot;&#39; class=&#39;edit&#39;&gt;&lt;span&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;edit&#39;</span>].<span class="stringliteral">&quot;&lt;/span&gt;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;                    echo $tdWithClass;</div><div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;                    echo <span class="stringliteral">&quot;&lt;a href=&#39;?table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&amp;amp;action=column_confirm&amp;amp;action2=column_delete&amp;amp;pk=&quot;</span>.urlencode($fieldVal).<span class="stringliteral">&quot;&#39; title=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;del&#39;</span>].<span class="stringliteral">&quot;&#39; class=&#39;delete&#39;&gt;&lt;span&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;del&#39;</span>].<span class="stringliteral">&quot;&lt;/span&gt;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;                }</div><div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;                echo $tdWithClass;</div><div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;                echo htmlencode($colVal);</div><div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;                echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;                echo $tdWithClassLeft;</div><div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;                echo htmlencode($fieldVal);</div><div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;                echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;                echo $tdWithClassLeft;</div><div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;                echo htmlencode($typeVal);</div><div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;                echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;                echo $tdWithClassLeft;</div><div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;                echo htmlencode($notnullVal);</div><div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;                echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;                echo $tdWithClassLeft;</div><div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;                <span class="keywordflow">if</span>($defaultVal===NULL)</div><div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;                    echo <span class="stringliteral">&quot;&lt;i class=&#39;null&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;none&#39;</span>].<span class="stringliteral">&quot;&lt;/i&gt;&quot;</span>;</div><div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;                elseif($defaultVal===<span class="stringliteral">&quot;NULL&quot;</span>)</div><div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;                    echo &quot;&lt;i class=&#39;null&#39;&gt;NULL&lt;/i&gt;&quot;;</div><div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;                else</div><div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;                    echo htmlencode($defaultVal);</div><div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;                echo &quot;&lt;/td&gt;&quot;;</div><div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;                echo $tdWithClassLeft;</div><div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;                echo htmlencode($primarykeyVal);</div><div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;                echo &quot;&lt;/td&gt;&quot;;</div><div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;                echo &quot;&lt;/tr&gt;&quot;;</div><div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;            }</div><div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;</div><div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;            echo &quot;&lt;/table&gt;&quot;;</div><div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;            if($target_table_type == &#39;table&#39;)</div><div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;            {</div><div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;                echo <span class="stringliteral">&quot;&lt;a onclick=&#39;checkAll()&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;chk_all&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt; / &lt;a onclick=&#39;uncheckAll()&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;unchk_all&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt; &lt;i&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;with_sel&#39;</span>].<span class="stringliteral">&quot;:&lt;/i&gt; &quot;</span>;</div><div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;                echo <span class="stringliteral">&quot;&lt;select name=&#39;action2&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;                <span class="comment">//echo &quot;&lt;option value=&#39;edit&#39;&gt;&quot;.$lang[&#39;edit&#39;].&quot;&lt;/option&gt;&quot;;</span></div><div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;                echo <span class="stringliteral">&quot;&lt;option value=&#39;column_delete&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;del&#39;</span>].<span class="stringliteral">&quot;&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;                <span class="keywordflow">if</span>($noPrimaryKey)</div><div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;                    echo <span class="stringliteral">&quot;&lt;option value=&#39;primarykey_add&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;prim_key&#39;</span>].<span class="stringliteral">&quot;&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;                echo <span class="stringliteral">&quot;&lt;/select&gt; &quot;</span>;</div><div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;                echo <span class="stringliteral">&quot;&lt;input type=&#39;submit&#39; value=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;go&#39;</span>].<span class="stringliteral">&quot;&#39; name=&#39;massGo&#39; class=&#39;btn&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;            }</div><div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;            echo <span class="stringliteral">&quot;&lt;/form&gt;&quot;</span>;</div><div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;            <span class="keywordflow">if</span>($target_table_type == <span class="stringliteral">&#39;table&#39;</span>)</div><div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;            {</div><div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;                echo <span class="stringliteral">&quot;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;                echo <span class="stringliteral">&quot;&lt;form action=&#39;?table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&amp;amp;action=column_create&#39; method=&#39;post&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;                echo <span class="stringliteral">&quot;&lt;input type=&#39;hidden&#39; name=&#39;tablename&#39; value=&#39;&quot;</span>.htmlencode($target_table).<span class="stringliteral">&quot;&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;                echo $lang[<span class="stringliteral">&#39;add&#39;</span>].<span class="stringliteral">&quot; &lt;input type=&#39;text&#39; name=&#39;tablefields&#39; style=&#39;width:30px;&#39; value=&#39;1&#39;/&gt; &quot;</span>.$lang[<span class="stringliteral">&#39;tbl_end&#39;</span>].<span class="stringliteral">&quot; &lt;input type=&#39;submit&#39; value=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;go&#39;</span>].<span class="stringliteral">&quot;&#39; name=&#39;addfields&#39; class=&#39;btn&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;                echo <span class="stringliteral">&quot;&lt;/form&gt;&quot;</span>;</div><div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;            }</div><div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;            </div><div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;            $query = <span class="stringliteral">&quot;SELECT sql FROM sqlite_master WHERE name=&quot;</span>.$db-&gt;quote($target_table);</div><div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;            $master = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;selectArray($query);</div><div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;            </div><div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;            echo <span class="stringliteral">&quot;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;            echo <span class="stringliteral">&quot;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;            echo <span class="stringliteral">&quot;&lt;div class=&#39;confirm&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;            echo <span class="stringliteral">&quot;&lt;b&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;query_used_&#39;</span>.$target_table_type].<span class="stringliteral">&quot;&lt;/b&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;            echo <span class="stringliteral">&quot;&lt;span style=&#39;font-size:11px;&#39;&gt;&quot;</span>.htmlencode($master[0][<span class="stringliteral">&#39;sql&#39;</span>]).<span class="stringliteral">&quot;&lt;/span&gt;&quot;</span>;</div><div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;            echo <span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;            echo <span class="stringliteral">&quot;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;            <span class="keywordflow">if</span>($target_table_type == <span class="stringliteral">&#39;view&#39;</span>)</div><div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;            {</div><div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;                echo <span class="stringliteral">&quot;&lt;br/&gt;&lt;hr/&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;                <span class="comment">//$query = &quot;SELECT * FROM sqlite_master WHERE type=&#39;index&#39; AND tbl_name=&#39;&quot;.$target_table.&quot;&#39;&quot;;</span></div><div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;                $query = <span class="stringliteral">&quot;PRAGMA index_list(&quot;</span>.$db-&gt;quote_id($target_table).<span class="stringliteral">&quot;)&quot;</span>;</div><div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;                $result = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;selectArray($query);</div><div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;                <span class="keywordflow">if</span>(<span class="keyword">sizeof</span>($result)&gt;0)</div><div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;                {</div><div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;                    echo <span class="stringliteral">&quot;&lt;h2&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;indexes&#39;</span>].<span class="stringliteral">&quot;:&lt;/h2&gt;&quot;</span>;</div><div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;                    echo <span class="stringliteral">&quot;&lt;table border=&#39;0&#39; cellpadding=&#39;2&#39; cellspacing=&#39;1&#39; class=&#39;viewTable&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;                    echo <span class="stringliteral">&quot;&lt;tr&gt;&quot;</span>;</div><div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;                    echo <span class="stringliteral">&quot;&lt;td colspan=&#39;1&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;                    echo <span class="stringliteral">&quot;&lt;td class=&#39;tdheader&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;name&#39;</span>].<span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;                    echo <span class="stringliteral">&quot;&lt;td class=&#39;tdheader&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;unique&#39;</span>].<span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;                    echo <span class="stringliteral">&quot;&lt;td class=&#39;tdheader&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;seq_no&#39;</span>].<span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;                    echo <span class="stringliteral">&quot;&lt;td class=&#39;tdheader&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;col&#39;</span>].<span class="stringliteral">&quot; #&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;                    echo <span class="stringliteral">&quot;&lt;td class=&#39;tdheader&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;fld&#39;</span>].<span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/tr&gt;&quot;</span>;</div><div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;                    <span class="keywordflow">for</span>($i=0; $i&lt;<span class="keyword">sizeof</span>($result); $i++)</div><div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;                    {</div><div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;                        <span class="keywordflow">if</span>($result[$i][<span class="stringliteral">&#39;unique&#39;</span>]==0)</div><div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;                            $unique = $lang[<span class="stringliteral">&#39;no&#39;</span>];</div><div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;                        <span class="keywordflow">else</span></div><div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;                            $unique = $lang[<span class="stringliteral">&#39;yes&#39;</span>];</div><div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;</div><div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;                        $query = <span class="stringliteral">&quot;PRAGMA index_info(&quot;</span>.$db-&gt;quote_id($result[$i][<span class="stringliteral">&#39;name&#39;</span>]).<span class="stringliteral">&quot;)&quot;</span>;</div><div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;                        $info = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;selectArray($query);</div><div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;                        $span = <span class="keyword">sizeof</span>($info);</div><div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;</div><div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;                        $tdWithClass = <span class="stringliteral">&quot;&lt;td class=&#39;td&quot;</span>.($i%2 ? <span class="stringliteral">&quot;1&quot;</span> : <span class="stringliteral">&quot;2&quot;</span>).<span class="stringliteral">&quot;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;                        $tdWithClassLeft = <span class="stringliteral">&quot;&lt;td class=&#39;td&quot;</span>.($i%2 ? <span class="stringliteral">&quot;1&quot;</span> : <span class="stringliteral">&quot;2&quot;</span>).<span class="stringliteral">&quot;&#39; style=&#39;text-align:left;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;                        $tdWithClassSpan = <span class="stringliteral">&quot;&lt;td class=&#39;td&quot;</span>.($i%2 ? <span class="stringliteral">&quot;1&quot;</span> : <span class="stringliteral">&quot;2&quot;</span>).<span class="stringliteral">&quot;&#39; rowspan=&#39;&quot;</span>.$span.<span class="stringliteral">&quot;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;                        $tdWithClassLeftSpan = <span class="stringliteral">&quot;&lt;td class=&#39;td&quot;</span>.($i%2 ? <span class="stringliteral">&quot;1&quot;</span> : <span class="stringliteral">&quot;2&quot;</span>).<span class="stringliteral">&quot;&#39; style=&#39;text-align:left;&#39; rowspan=&#39;&quot;</span>.$span.<span class="stringliteral">&quot;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;                        echo <span class="stringliteral">&quot;&lt;tr&gt;&quot;</span>;</div><div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;                        echo $tdWithClassSpan;</div><div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;                        echo <span class="stringliteral">&quot;&lt;a href=&#39;?table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&amp;amp;action=index_delete&amp;amp;pk=&quot;</span>.urlencode($result[$i][<span class="stringliteral">&#39;name&#39;</span>]).<span class="stringliteral">&quot;&#39; title=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;del&#39;</span>].<span class="stringliteral">&quot;&#39; class=&#39;delete&#39;&gt;&lt;span&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;del&#39;</span>].<span class="stringliteral">&quot;&lt;/span&gt;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;                        echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;                        echo $tdWithClassLeftSpan;</div><div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;                        echo $result[$i][<span class="stringliteral">&#39;name&#39;</span>];</div><div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;                        echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;                        echo $tdWithClassLeftSpan;</div><div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;                        echo $unique;</div><div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;                        echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;                        <span class="keywordflow">for</span>($j=0; $j&lt;$span; $j++)</div><div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;                        {</div><div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;                            <span class="keywordflow">if</span>($j!=0)</div><div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;                                echo <span class="stringliteral">&quot;&lt;tr&gt;&quot;</span>;</div><div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;                            echo $tdWithClassLeft;</div><div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;                            echo htmlencode($info[$j][<span class="stringliteral">&#39;seqno&#39;</span>]);</div><div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;                            echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;                            echo $tdWithClassLeft;</div><div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;                            echo htmlencode($info[$j][<span class="stringliteral">&#39;cid&#39;</span>]);</div><div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;                            echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;                            echo $tdWithClassLeft;</div><div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;                            echo htmlencode($info[$j][<span class="stringliteral">&#39;name&#39;</span>]);</div><div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;                            echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;                            echo <span class="stringliteral">&quot;&lt;/tr&gt;&quot;</span>;</div><div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;                        }</div><div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;                    }</div><div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/table&gt;&lt;br/&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;                }</div><div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;                </div><div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;                $query = <span class="stringliteral">&quot;SELECT * FROM sqlite_master WHERE type=&#39;trigger&#39; AND tbl_name=&quot;</span>.$db-&gt;quote($target_table).<span class="stringliteral">&quot; ORDER BY name&quot;</span>;</div><div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;                $result = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;selectArray($query);</div><div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;                <span class="comment">//print_r($result);</span></div><div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;                <span class="keywordflow">if</span>(<span class="keyword">sizeof</span>($result)&gt;0)</div><div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;                {</div><div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;                    echo <span class="stringliteral">&quot;&lt;h2&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;triggers&#39;</span>].<span class="stringliteral">&quot;:&lt;/h2&gt;&quot;</span>;</div><div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;                    echo <span class="stringliteral">&quot;&lt;table border=&#39;0&#39; cellpadding=&#39;2&#39; cellspacing=&#39;1&#39; class=&#39;viewTable&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;                    echo <span class="stringliteral">&quot;&lt;tr&gt;&quot;</span>;</div><div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;                    echo <span class="stringliteral">&quot;&lt;td colspan=&#39;1&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;                    echo <span class="stringliteral">&quot;&lt;td class=&#39;tdheader&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;name&#39;</span>].<span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;                    echo <span class="stringliteral">&quot;&lt;td class=&#39;tdheader&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;sql&#39;</span>].<span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/tr&gt;&quot;</span>;</div><div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;                    <span class="keywordflow">for</span>($i=0; $i&lt;<span class="keyword">sizeof</span>($result); $i++)</div><div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;                    {</div><div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;                        $tdWithClass = <span class="stringliteral">&quot;&lt;td class=&#39;td&quot;</span>.($i%2 ? <span class="stringliteral">&quot;1&quot;</span> : <span class="stringliteral">&quot;2&quot;</span>).<span class="stringliteral">&quot;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;                        echo <span class="stringliteral">&quot;&lt;tr&gt;&quot;</span>;</div><div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;                        echo $tdWithClass;</div><div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;                        echo <span class="stringliteral">&quot;&lt;a href=&#39;?table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&amp;amp;action=trigger_delete&amp;amp;pk=&quot;</span>.urlencode($result[$i][<span class="stringliteral">&#39;name&#39;</span>]).<span class="stringliteral">&quot;&#39; title=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;del&#39;</span>].<span class="stringliteral">&quot;&#39; class=&#39;delete&#39;&gt;&lt;span&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;del&#39;</span>].<span class="stringliteral">&quot;&lt;/span&gt;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;                        echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;                        echo $tdWithClass;</div><div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;                        echo htmlencode($result[$i][<span class="stringliteral">&#39;name&#39;</span>]);</div><div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;                        echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;                        echo $tdWithClass;</div><div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;                        echo htmlencode($result[$i][<span class="stringliteral">&#39;sql&#39;</span>]);</div><div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;                        echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;                    }</div><div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/table&gt;&lt;br/&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;                }</div><div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;                </div><div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;                echo <span class="stringliteral">&quot;&lt;form action=&#39;?table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&amp;amp;action=index_create&#39; method=&#39;post&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;                echo <span class="stringliteral">&quot;&lt;input type=&#39;hidden&#39; name=&#39;tablename&#39; value=&#39;&quot;</span>.htmlencode($target_table).<span class="stringliteral">&quot;&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;                echo <span class="stringliteral">&quot;&lt;br/&gt;&lt;div class=&#39;tdheader&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;                echo $lang[<span class="stringliteral">&#39;create_index2&#39;</span>].<span class="stringliteral">&quot; &lt;input type=&#39;text&#39; name=&#39;numcolumns&#39; style=&#39;width:30px;&#39; value=&#39;1&#39;/&gt; &quot;</span>.$lang[<span class="stringliteral">&#39;cols&#39;</span>].<span class="stringliteral">&quot; &lt;input type=&#39;submit&#39; value=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;go&#39;</span>].<span class="stringliteral">&quot;&#39; name=&#39;addindex&#39; class=&#39;btn&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;                echo <span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;                echo <span class="stringliteral">&quot;&lt;/form&gt;&quot;</span>;</div><div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;                </div><div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;                echo <span class="stringliteral">&quot;&lt;form action=&#39;?table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&amp;amp;action=trigger_create&#39; method=&#39;post&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;                echo <span class="stringliteral">&quot;&lt;input type=&#39;hidden&#39; name=&#39;tablename&#39; value=&#39;&quot;</span>.htmlencode($target_table).<span class="stringliteral">&quot;&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;                echo <span class="stringliteral">&quot;&lt;br/&gt;&lt;div class=&#39;tdheader&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;                echo $lang[<span class="stringliteral">&#39;create_trigger2&#39;</span>].<span class="stringliteral">&quot; &lt;input type=&#39;submit&#39; value=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;go&#39;</span>].<span class="stringliteral">&quot;&#39; name=&#39;addindex&#39; class=&#39;btn&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;                echo <span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;                echo <span class="stringliteral">&quot;&lt;/form&gt;&quot;</span>;</div><div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;            }</div><div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;</div><div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;        <span class="comment">//- Create column (=column_create)</span></div><div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;        <span class="keywordflow">case</span> <span class="stringliteral">&quot;column_create&quot;</span>:</div><div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;            echo <span class="stringliteral">&quot;&lt;h2&gt;&quot;</span>.sprintf($lang[<span class="stringliteral">&#39;new_fld&#39;</span>],htmlencode($_POST[<span class="stringliteral">&#39;tablename&#39;</span>])).<span class="stringliteral">&quot;&lt;/h2&gt;&quot;</span>;</div><div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;            <span class="keywordflow">if</span>($_POST[<span class="stringliteral">&#39;tablefields&#39;</span>]==<span class="stringliteral">&quot;&quot;</span> || intval($_POST[<span class="stringliteral">&#39;tablefields&#39;</span>])&lt;=0)</div><div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;                echo $lang[<span class="stringliteral">&#39;specify_fields&#39;</span>];</div><div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span>($_POST[<span class="stringliteral">&#39;tablename&#39;</span>]==<span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;                echo $lang[<span class="stringliteral">&#39;specify_tbl&#39;</span>];</div><div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;            {</div><div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;                $num = intval($_POST[<span class="stringliteral">&#39;tablefields&#39;</span>]);</div><div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;                $name = $_POST[<span class="stringliteral">&#39;tablename&#39;</span>];</div><div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;                echo <span class="stringliteral">&quot;&lt;form action=&#39;?table=&quot;</span>.urlencode($_POST[<span class="stringliteral">&#39;tablename&#39;</span>]).<span class="stringliteral">&quot;&amp;amp;action=column_create&amp;amp;confirm=1&#39; method=&#39;post&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;                echo <span class="stringliteral">&quot;&lt;input type=&#39;hidden&#39; name=&#39;tablename&#39; value=&#39;&quot;</span>.htmlencode($name).<span class="stringliteral">&quot;&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;                echo <span class="stringliteral">&quot;&lt;input type=&#39;hidden&#39; name=&#39;rows&#39; value=&#39;&quot;</span>.$num.<span class="stringliteral">&quot;&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;                echo <span class="stringliteral">&quot;&lt;table border=&#39;0&#39; cellpadding=&#39;2&#39; cellspacing=&#39;1&#39; class=&#39;viewTable&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;                echo <span class="stringliteral">&quot;&lt;tr&gt;&quot;</span>;</div><div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;                $headings = array($lang[<span class="stringliteral">&quot;fld&quot;</span>], $lang[<span class="stringliteral">&quot;type&quot;</span>], $lang[<span class="stringliteral">&quot;prim_key&quot;</span>]);    </div><div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;                <span class="keywordflow">if</span>(<a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;getType() != <span class="stringliteral">&quot;SQLiteDatabase&quot;</span>) $headings[] = $lang[<span class="stringliteral">&quot;autoincrement&quot;</span>];</div><div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160;                $headings[] = $lang[<span class="stringliteral">&quot;not_null&quot;</span>];</div><div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;                $headings[] = $lang[<span class="stringliteral">&quot;def_val&quot;</span>];</div><div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;                </div><div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;                <span class="keywordflow">for</span>($k=0; $k&lt;count($headings); $k++)</div><div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;                    echo <span class="stringliteral">&quot;&lt;td class=&#39;tdheader&#39;&gt;&quot;</span> . $headings[$k] . <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;                echo <span class="stringliteral">&quot;&lt;/tr&gt;&quot;</span>;</div><div class="line"><a name="l03266"></a><span class="lineno"> 3266</span>&#160;</div><div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160;                <span class="keywordflow">for</span>($i=0; $i&lt;$num; $i++)</div><div class="line"><a name="l03268"></a><span class="lineno"> 3268</span>&#160;                {</div><div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;                    $tdWithClass = <span class="stringliteral">&quot;&lt;td class=&#39;td&quot;</span> . ($i%2 ? <span class="stringliteral">&quot;1&quot;</span> : <span class="stringliteral">&quot;2&quot;</span>) . <span class="stringliteral">&quot;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;                    echo <span class="stringliteral">&quot;&lt;tr&gt;&quot;</span>;</div><div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;                    echo $tdWithClass;</div><div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160;                    echo <span class="stringliteral">&quot;&lt;input type=&#39;text&#39; name=&#39;&quot;</span>.$i.<span class="stringliteral">&quot;_field&#39; style=&#39;width:200px;&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l03273"></a><span class="lineno"> 3273</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;                    echo $tdWithClass;</div><div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;                    echo <span class="stringliteral">&quot;&lt;select name=&#39;&quot;</span>.$i.<span class="stringliteral">&quot;_type&#39; id=&#39;i&quot;</span>.$i.<span class="stringliteral">&quot;_type&#39; onchange=&#39;toggleAutoincrement(&quot;</span>.$i.<span class="stringliteral">&quot;);&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;                    <span class="keywordflow">foreach</span> ($sqlite_datatypes as $t) {</div><div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;                        echo <span class="stringliteral">&quot;&lt;option value=&#39;&quot;</span>.htmlencode($t).<span class="stringliteral">&quot;&#39;&gt;&quot;</span>.htmlencode($t).<span class="stringliteral">&quot;&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;                    }</div><div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/select&gt;&quot;</span>;</div><div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;                    echo $tdWithClass;</div><div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;                    echo <span class="stringliteral">&quot;&lt;label&gt;&lt;input type=&#39;checkbox&#39; name=&#39;&quot;</span>.$i.<span class="stringliteral">&quot;_primarykey&#39;/&gt; &quot;</span>.$lang[<span class="stringliteral">&#39;yes&#39;</span>].<span class="stringliteral">&quot;&lt;/label&gt;&quot;</span>;</div><div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;                    <span class="keywordflow">if</span>(<a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;getType() != <span class="stringliteral">&quot;SQLiteDatabase&quot;</span>)</div><div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;                    {</div><div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;                        echo $tdWithClass;</div><div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;                        echo <span class="stringliteral">&quot;&lt;label&gt;&lt;input type=&#39;checkbox&#39; name=&#39;&quot;</span>.$i.<span class="stringliteral">&quot;_autoincrement&#39; id=&#39;i&quot;</span>.$i.<span class="stringliteral">&quot;_autoincrement&#39;/&gt; &quot;</span>.$lang[<span class="stringliteral">&#39;yes&#39;</span>].<span class="stringliteral">&quot;&lt;/label&gt;&quot;</span>;</div><div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;                        echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;                    }</div><div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;                    echo $tdWithClass;</div><div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;                    echo <span class="stringliteral">&quot;&lt;label&gt;&lt;input type=&#39;checkbox&#39; name=&#39;&quot;</span>.$i.<span class="stringliteral">&quot;_notnull&#39;/&gt; &quot;</span>.$lang[<span class="stringliteral">&#39;yes&#39;</span>].<span class="stringliteral">&quot;&lt;/label&gt;&quot;</span>;</div><div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;                    echo $tdWithClass;</div><div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160;                    echo <span class="stringliteral">&quot;&lt;select name=&#39;&quot;</span>.$i.<span class="stringliteral">&quot;_defaultoption&#39; id=&#39;i&quot;</span>.$i.<span class="stringliteral">&quot;_defaultoption&#39; onchange=\&quot;if(this.value!=&#39;defined&#39; &amp;&amp; this.value!=&#39;expr&#39;) document.getElementById(&#39;i&quot;</span>.$i.<span class="stringliteral">&quot;_defaultvalue&#39;).value=&#39;&#39;;\&quot;&gt;&quot;</span>;</div><div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;                    echo <span class="stringliteral">&quot;&lt;option value=&#39;none&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;none&#39;</span>].<span class="stringliteral">&quot;&lt;/option&gt;&lt;option value=&#39;defined&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;as_defined&#39;</span>].<span class="stringliteral">&quot;:&lt;/option&gt;&lt;option&gt;NULL&lt;/option&gt;&lt;option&gt;CURRENT_TIME&lt;/option&gt;&lt;option&gt;CURRENT_DATE&lt;/option&gt;&lt;option&gt;CURRENT_TIMESTAMP&lt;/option&gt;&lt;option value=&#39;expr&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;expression&#39;</span>].<span class="stringliteral">&quot;:&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/select&gt;&quot;</span>;</div><div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;                    echo <span class="stringliteral">&quot;&lt;input type=&#39;text&#39; name=&#39;&quot;</span>.$i.<span class="stringliteral">&quot;_defaultvalue&#39; id=&#39;i&quot;</span>.$i.<span class="stringliteral">&quot;_defaultvalue&#39; style=&#39;width:100px;&#39; onchange=\&quot;if(document.getElementById(&#39;i&quot;</span>.$i.<span class="stringliteral">&quot;_defaultoption&#39;).value!=&#39;expr&#39;) document.getElementById(&#39;i&quot;</span>.$i.<span class="stringliteral">&quot;_defaultoption&#39;).value=&#39;defined&#39;;\&quot;/&gt;&quot;</span>;</div><div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/tr&gt;&quot;</span>;</div><div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;                }</div><div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160;                echo <span class="stringliteral">&quot;&lt;tr&gt;&quot;</span>;</div><div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;                echo <span class="stringliteral">&quot;&lt;td class=&#39;tdheader&#39; style=&#39;text-align:right;&#39; colspan=&#39;6&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160;                echo <span class="stringliteral">&quot;&lt;input type=&#39;submit&#39; value=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;add_flds&#39;</span>].<span class="stringliteral">&quot;&#39; class=&#39;btn&#39;/&gt; &quot;</span>;</div><div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;                echo <span class="stringliteral">&quot;&lt;a href=&#39;?table=&quot;</span>.urlencode($_POST[<span class="stringliteral">&#39;tablename&#39;</span>]).<span class="stringliteral">&quot;&amp;amp;action=column_view&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;cancel&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;                echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;                echo <span class="stringliteral">&quot;&lt;/tr&gt;&quot;</span>;</div><div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160;                echo <span class="stringliteral">&quot;&lt;/table&gt;&quot;</span>;</div><div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;                echo <span class="stringliteral">&quot;&lt;/form&gt;&quot;</span>;</div><div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;            }</div><div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160;</div><div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;        <span class="comment">//- Delete column (=column_confirm)</span></div><div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;        <span class="keywordflow">case</span> <span class="stringliteral">&quot;column_confirm&quot;</span>:</div><div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;            <span class="keywordflow">if</span>(isset($_POST[<span class="stringliteral">&#39;check&#39;</span>]))</div><div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;                $pks = $_POST[<span class="stringliteral">&#39;check&#39;</span>];</div><div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;            elseif(isset($_GET[<span class="stringliteral">&#39;pk&#39;</span>]))</div><div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;                $pks = array($_GET[&#39;pk&#39;]);</div><div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;            else $pks = array();</div><div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;            </div><div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;            if(sizeof($pks)==0) <span class="comment">//nothing was selected so show an error</span></div><div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;            {</div><div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;                echo <span class="stringliteral">&quot;&lt;div class=&#39;confirm&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;                echo $lang[<span class="stringliteral">&#39;err&#39;</span>].<span class="stringliteral">&quot;: &quot;</span>.$lang[<span class="stringliteral">&#39;no_sel&#39;</span>];</div><div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;                echo <span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;                echo <span class="stringliteral">&quot;&lt;br/&gt;&lt;br/&gt;&lt;a href=&#39;?table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&amp;amp;action=column_view&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;return&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;            }</div><div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;            {</div><div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;                $str = $pks[0];</div><div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;                $pkVal = $pks[0];</div><div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;                <span class="keywordflow">for</span>($i=1; $i&lt;<span class="keyword">sizeof</span>($pks); $i++)</div><div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;                {</div><div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;                    $str .= <span class="stringliteral">&quot;, &quot;</span>.$pks[$i];</div><div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;                    $pkVal .= <span class="stringliteral">&quot;:&quot;</span>.$pks[$i];</div><div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;                }</div><div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;                echo <span class="stringliteral">&quot;&lt;form action=&#39;?table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&amp;amp;action=&quot;</span>.$_REQUEST[<span class="stringliteral">&#39;action2&#39;</span>].<span class="stringliteral">&quot;&amp;amp;confirm=1&amp;amp;pk=&quot;</span>.urlencode($pkVal).<span class="stringliteral">&quot;&#39; method=&#39;post&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;                echo <span class="stringliteral">&quot;&lt;div class=&#39;confirm&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;                printf($lang[<span class="stringliteral">&#39;ques_&#39;</span>.$_REQUEST[<span class="stringliteral">&#39;action2&#39;</span>]], htmlencode($str), htmlencode($target_table));</div><div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160;                echo <span class="stringliteral">&quot;&lt;br/&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160;                echo <span class="stringliteral">&quot;&lt;input type=&#39;submit&#39; value=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;confirm&#39;</span>].<span class="stringliteral">&quot;&#39; class=&#39;btn&#39;/&gt; &quot;</span>;</div><div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160;                echo <span class="stringliteral">&quot;&lt;a href=&#39;?table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&amp;amp;action=column_view&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;cancel&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;                echo <span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;            }</div><div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;</div><div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;        <span class="comment">//- Edit column (=column_edit)</span></div><div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160;        <span class="keywordflow">case</span> <span class="stringliteral">&quot;column_edit&quot;</span>:</div><div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;            echo <span class="stringliteral">&quot;&lt;h2&gt;&quot;</span>.sprintf($lang[<span class="stringliteral">&#39;edit_col&#39;</span>], htmlencode($_GET[<span class="stringliteral">&#39;pk&#39;</span>])).<span class="stringliteral">&quot; &quot;</span>.$lang[<span class="stringliteral">&#39;on_tbl&#39;</span>].<span class="stringliteral">&quot; &#39;&quot;</span>.htmlencode($target_table).<span class="stringliteral">&quot;&#39;&lt;/h2&gt;&quot;</span>;</div><div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;            echo $lang[<span class="stringliteral">&#39;sqlite_limit&#39;</span>].<span class="stringliteral">&quot;&lt;br/&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;            <span class="keywordflow">if</span>(!isset($_GET[<span class="stringliteral">&#39;pk&#39;</span>]))</div><div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;                echo $lang[<span class="stringliteral">&#39;specify_col&#39;</span>];</div><div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!$target_table)</div><div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;                echo $lang[<span class="stringliteral">&#39;specify_tbl&#39;</span>];</div><div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160;            {</div><div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160;                $query = <span class="stringliteral">&quot;PRAGMA table_info(&quot;</span>.$db-&gt;quote_id($target_table).<span class="stringliteral">&quot;)&quot;</span>;</div><div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;                $result = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;selectArray($query);</div><div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;</div><div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;                <span class="keywordflow">for</span>($i=0; $i&lt;<span class="keyword">sizeof</span>($result); $i++)</div><div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;                {</div><div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;                    <span class="keywordflow">if</span>($result[$i][1]==$_GET[<span class="stringliteral">&#39;pk&#39;</span>])</div><div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;                    {</div><div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;                        $colVal = $result[$i][0];</div><div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;                        $fieldVal = $result[$i][1];</div><div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160;                        $typeVal = $result[$i][<span class="stringliteral">&#39;type&#39;</span>];</div><div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;                        $notnullVal = $result[$i][3];</div><div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;                        $defaultVal = $result[$i][4];</div><div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;                        $primarykeyVal = $result[$i][5];</div><div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;                    }</div><div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;                }</div><div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;                </div><div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;                $name = $target_table;</div><div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;                echo <span class="stringliteral">&quot;&lt;form action=&#39;?table=&quot;</span>.urlencode($name).<span class="stringliteral">&quot;&amp;amp;action=column_edit&amp;amp;confirm=1&#39; method=&#39;post&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;                echo <span class="stringliteral">&quot;&lt;input type=&#39;hidden&#39; name=&#39;tablename&#39; value=&#39;&quot;</span>.htmlencode($name).<span class="stringliteral">&quot;&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;                echo <span class="stringliteral">&quot;&lt;input type=&#39;hidden&#39; name=&#39;oldvalue&#39; value=&#39;&quot;</span>.htmlencode($_GET[<span class="stringliteral">&#39;pk&#39;</span>]).<span class="stringliteral">&quot;&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;                echo <span class="stringliteral">&quot;&lt;table border=&#39;0&#39; cellpadding=&#39;2&#39; cellspacing=&#39;1&#39; class=&#39;viewTable&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160;                echo <span class="stringliteral">&quot;&lt;tr&gt;&quot;</span>;</div><div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;                <span class="comment">//$headings = array(&quot;Field&quot;, &quot;Type&quot;, &quot;Primary Key&quot;, &quot;Autoincrement&quot;, &quot;Not NULL&quot;, &quot;Default Value&quot;);</span></div><div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;                $headings = array($lang[<span class="stringliteral">&quot;fld&quot;</span>], $lang[<span class="stringliteral">&quot;type&quot;</span>]);</div><div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;                <span class="keywordflow">for</span>($k=0; $k&lt;count($headings); $k++)</div><div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;                    echo <span class="stringliteral">&quot;&lt;td class=&#39;tdheader&#39;&gt;&quot;</span>.$headings[$k].<span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;                echo <span class="stringliteral">&quot;&lt;/tr&gt;&quot;</span>;</div><div class="line"><a name="l03384"></a><span class="lineno"> 3384</span>&#160;            </div><div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;                $i = 0;</div><div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;                $tdWithClass = <span class="stringliteral">&quot;&lt;td class=&#39;td&quot;</span> . ($i%2 ? <span class="stringliteral">&quot;1&quot;</span> : <span class="stringliteral">&quot;2&quot;</span>) . <span class="stringliteral">&quot;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;                echo <span class="stringliteral">&quot;&lt;tr&gt;&quot;</span>;</div><div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;                echo $tdWithClass;</div><div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;                echo <span class="stringliteral">&quot;&lt;input type=&#39;text&#39; name=&#39;&quot;</span>.$i.<span class="stringliteral">&quot;_field&#39; style=&#39;width:200px;&#39; value=&#39;&quot;</span>.htmlencode($fieldVal).<span class="stringliteral">&quot;&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;                echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;                echo $tdWithClass;</div><div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;                echo <span class="stringliteral">&quot;&lt;select name=&#39;&quot;</span>.$i.<span class="stringliteral">&quot;_type&#39; id=&#39;i&quot;</span>.$i.<span class="stringliteral">&quot;_type&#39; onchange=&#39;toggleAutoincrement(&quot;</span>.$i.<span class="stringliteral">&quot;);&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;                <span class="keywordflow">if</span>(!in_array($typeVal, $sqlite_datatypes))</div><div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160;                    echo <span class="stringliteral">&quot;&lt;option value=&#39;&quot;</span>.htmlencode($typeVal).<span class="stringliteral">&quot;&#39; selected=&#39;selected&#39;&gt;&quot;</span>.htmlencode($typeVal).<span class="stringliteral">&quot;&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;                <span class="keywordflow">foreach</span> ($sqlite_datatypes as $t) {</div><div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160;                    <span class="keywordflow">if</span>($t==$typeVal)</div><div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;                        echo <span class="stringliteral">&quot;&lt;option value=&#39;&quot;</span>.htmlencode($t).<span class="stringliteral">&quot;&#39; selected=&#39;selected&#39;&gt;&quot;</span>.htmlencode($t).<span class="stringliteral">&quot;&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;                    <span class="keywordflow">else</span></div><div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;                        echo <span class="stringliteral">&quot;&lt;option value=&#39;&quot;</span>.htmlencode($t).<span class="stringliteral">&quot;&#39;&gt;&quot;</span>.htmlencode($t).<span class="stringliteral">&quot;&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160;                }</div><div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;                echo <span class="stringliteral">&quot;&lt;/select&gt;&quot;</span>;</div><div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;                echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;                <span class="comment">/*</span></div><div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;<span class="comment">                echo $tdWithClass;</span></div><div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>&#160;<span class="comment">                if($primarykeyVal)</span></div><div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;<span class="comment">                    echo &quot;&lt;input type=&#39;checkbox&#39; name=&#39;&quot;.$i.&quot;_primarykey&#39; checked=&#39;checked&#39;/&gt; Yes&quot;;</span></div><div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160;<span class="comment">                else</span></div><div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;<span class="comment">                    echo &quot;&lt;input type=&#39;checkbox&#39; name=&#39;&quot;.$i.&quot;_primarykey&#39;/&gt; Yes&quot;;</span></div><div class="line"><a name="l03409"></a><span class="lineno"> 3409</span>&#160;<span class="comment">                echo &quot;&lt;/td&gt;&quot;;</span></div><div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160;<span class="comment">                echo $tdWithClass;</span></div><div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;<span class="comment">                if(1==2)</span></div><div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;<span class="comment">                    echo &quot;&lt;input type=&#39;checkbox&#39; name=&#39;&quot;.$i.&quot;_autoincrement&#39; id=&#39;&quot;.$i.&quot;_autoincrement&#39; checked=&#39;checked&#39;/&gt; Yes&quot;;</span></div><div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;<span class="comment">                else</span></div><div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;<span class="comment">                    echo &quot;&lt;input type=&#39;checkbox&#39; name=&#39;&quot;.$i.&quot;_autoincrement&#39; id=&#39;&quot;.$i.&quot;_autoincrement&#39;/&gt; Yes&quot;;</span></div><div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;<span class="comment">                echo &quot;&lt;/td&gt;&quot;;</span></div><div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160;<span class="comment">                echo $tdWithClass;</span></div><div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160;<span class="comment">                if($notnullVal)</span></div><div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;<span class="comment">                    echo &quot;&lt;input type=&#39;checkbox&#39; name=&#39;&quot;.$i.&quot;_notnull&#39; checked=&#39;checked&#39;/&gt; Yes&quot;;</span></div><div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160;<span class="comment">                else</span></div><div class="line"><a name="l03420"></a><span class="lineno"> 3420</span>&#160;<span class="comment">                    echo &quot;&lt;input type=&#39;checkbox&#39; name=&#39;&quot;.$i.&quot;_notnull&#39;/&gt; Yes&quot;;</span></div><div class="line"><a name="l03421"></a><span class="lineno"> 3421</span>&#160;<span class="comment">                echo &quot;&lt;/td&gt;&quot;;</span></div><div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160;<span class="comment">                echo $tdWithClass;</span></div><div class="line"><a name="l03423"></a><span class="lineno"> 3423</span>&#160;<span class="comment">                echo &quot;&lt;input type=&#39;text&#39; name=&#39;&quot;.$i.&quot;_defaultvalue&#39; value=&#39;&quot;.$defaultVal.&quot;&#39; style=&#39;width:100px;&#39;/&gt;&quot;;</span></div><div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160;<span class="comment">                echo &quot;&lt;/td&gt;&quot;;</span></div><div class="line"><a name="l03425"></a><span class="lineno"> 3425</span>&#160;<span class="comment">                */</span></div><div class="line"><a name="l03426"></a><span class="lineno"> 3426</span>&#160;                echo <span class="stringliteral">&quot;&lt;/tr&gt;&quot;</span>;</div><div class="line"><a name="l03427"></a><span class="lineno"> 3427</span>&#160;</div><div class="line"><a name="l03428"></a><span class="lineno"> 3428</span>&#160;                echo <span class="stringliteral">&quot;&lt;tr&gt;&quot;</span>;</div><div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160;                echo <span class="stringliteral">&quot;&lt;td class=&#39;tdheader&#39; style=&#39;text-align:right;&#39; colspan=&#39;6&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03430"></a><span class="lineno"> 3430</span>&#160;                echo <span class="stringliteral">&quot;&lt;input type=&#39;submit&#39; value=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;save_ch&#39;</span>].<span class="stringliteral">&quot;&#39; class=&#39;btn&#39;/&gt; &quot;</span>;</div><div class="line"><a name="l03431"></a><span class="lineno"> 3431</span>&#160;                echo <span class="stringliteral">&quot;&lt;a href=&#39;?table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&amp;amp;action=column_view&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;cancel&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l03432"></a><span class="lineno"> 3432</span>&#160;                echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03433"></a><span class="lineno"> 3433</span>&#160;                echo <span class="stringliteral">&quot;&lt;/tr&gt;&quot;</span>;</div><div class="line"><a name="l03434"></a><span class="lineno"> 3434</span>&#160;                echo <span class="stringliteral">&quot;&lt;/table&gt;&quot;</span>;</div><div class="line"><a name="l03435"></a><span class="lineno"> 3435</span>&#160;                echo <span class="stringliteral">&quot;&lt;/form&gt;&quot;</span>;</div><div class="line"><a name="l03436"></a><span class="lineno"> 3436</span>&#160;            }</div><div class="line"><a name="l03437"></a><span class="lineno"> 3437</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l03438"></a><span class="lineno"> 3438</span>&#160;</div><div class="line"><a name="l03439"></a><span class="lineno"> 3439</span>&#160;        <span class="comment">//- Delete index (=index_delete)</span></div><div class="line"><a name="l03440"></a><span class="lineno"> 3440</span>&#160;        <span class="keywordflow">case</span> <span class="stringliteral">&quot;index_delete&quot;</span>:</div><div class="line"><a name="l03441"></a><span class="lineno"> 3441</span>&#160;            echo <span class="stringliteral">&quot;&lt;form action=&#39;?table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&amp;amp;action=index_delete&amp;amp;pk=&quot;</span>.urlencode($_GET[<span class="stringliteral">&#39;pk&#39;</span>]).<span class="stringliteral">&quot;&amp;amp;confirm=1&#39; method=&#39;post&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03442"></a><span class="lineno"> 3442</span>&#160;            echo <span class="stringliteral">&quot;&lt;div class=&#39;confirm&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160;            echo sprintf($lang[<span class="stringliteral">&#39;ques_del_index&#39;</span>], htmlencode($_GET[<span class="stringliteral">&#39;pk&#39;</span>])).<span class="stringliteral">&quot;&lt;br/&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l03444"></a><span class="lineno"> 3444</span>&#160;            echo <span class="stringliteral">&quot;&lt;input type=&#39;submit&#39; value=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;confirm&#39;</span>].<span class="stringliteral">&quot;&#39; class=&#39;btn&#39;/&gt; &quot;</span>;</div><div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160;            echo <span class="stringliteral">&quot;&lt;a href=&#39;?table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&amp;amp;action=column_view&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;cancel&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l03446"></a><span class="lineno"> 3446</span>&#160;            echo <span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;            echo <span class="stringliteral">&quot;&lt;/form&gt;&quot;</span>;</div><div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160;</div><div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160;        <span class="comment">//- Delete trigger (=trigger_delete)</span></div><div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;        <span class="keywordflow">case</span> <span class="stringliteral">&quot;trigger_delete&quot;</span>:</div><div class="line"><a name="l03452"></a><span class="lineno"> 3452</span>&#160;            echo <span class="stringliteral">&quot;&lt;form action=&#39;?table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&amp;amp;action=trigger_delete&amp;amp;pk=&quot;</span>.urlencode($_GET[<span class="stringliteral">&#39;pk&#39;</span>]).<span class="stringliteral">&quot;&amp;amp;confirm=1&#39; method=&#39;post&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;            echo <span class="stringliteral">&quot;&lt;div class=&#39;confirm&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160;            echo sprintf($lang[<span class="stringliteral">&#39;ques_del_trigger&#39;</span>], htmlencode($_GET[<span class="stringliteral">&#39;pk&#39;</span>])).<span class="stringliteral">&quot;&lt;br/&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l03455"></a><span class="lineno"> 3455</span>&#160;            echo <span class="stringliteral">&quot;&lt;input type=&#39;submit&#39; value=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;confirm&#39;</span>].<span class="stringliteral">&quot;&#39; class=&#39;btn&#39;/&gt; &quot;</span>;</div><div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160;            echo <span class="stringliteral">&quot;&lt;a href=&#39;?table=&quot;</span>.urlencode($target_table).<span class="stringliteral">&quot;&amp;amp;action=column_view&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;cancel&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l03457"></a><span class="lineno"> 3457</span>&#160;            echo <span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l03458"></a><span class="lineno"> 3458</span>&#160;            echo <span class="stringliteral">&quot;&lt;/form&gt;&quot;</span>;</div><div class="line"><a name="l03459"></a><span class="lineno"> 3459</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160;</div><div class="line"><a name="l03461"></a><span class="lineno"> 3461</span>&#160;        <span class="comment">//- Create trigger (=trigger_create)</span></div><div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160;        <span class="keywordflow">case</span> <span class="stringliteral">&quot;trigger_create&quot;</span>:</div><div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160;            echo <span class="stringliteral">&quot;&lt;h2&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;create_trigger&#39;</span>].<span class="stringliteral">&quot; &#39;&quot;</span>.htmlencode($_POST[<span class="stringliteral">&#39;tablename&#39;</span>]).<span class="stringliteral">&quot;&#39;&lt;/h2&gt;&quot;</span>;</div><div class="line"><a name="l03464"></a><span class="lineno"> 3464</span>&#160;            <span class="keywordflow">if</span>($_POST[<span class="stringliteral">&#39;tablename&#39;</span>]==<span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160;                echo $lang[<span class="stringliteral">&#39;specify_tbl&#39;</span>];</div><div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;            {</div><div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;                echo <span class="stringliteral">&quot;&lt;form action=&#39;?table=&quot;</span>.urlencode($_POST[<span class="stringliteral">&#39;tablename&#39;</span>]).<span class="stringliteral">&quot;&amp;amp;action=trigger_create&amp;amp;confirm=1&#39; method=&#39;post&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;                echo $lang[<span class="stringliteral">&#39;trigger_name&#39;</span>].<span class="stringliteral">&quot;: &lt;input type=&#39;text&#39; name=&#39;trigger_name&#39;/&gt;&lt;br/&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l03470"></a><span class="lineno"> 3470</span>&#160;                echo <span class="stringliteral">&quot;&lt;fieldset&gt;&lt;legend&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;db_event&#39;</span>].<span class="stringliteral">&quot;&lt;/legend&gt;&quot;</span>;</div><div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;                echo $lang[<span class="stringliteral">&#39;before&#39;</span>].<span class="stringliteral">&quot;/&quot;</span>.$lang[<span class="stringliteral">&#39;after&#39;</span>].<span class="stringliteral">&quot;: &quot;</span>;</div><div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160;                echo <span class="stringliteral">&quot;&lt;select name=&#39;beforeafter&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160;                echo <span class="stringliteral">&quot;&lt;option value=&#39;&#39;&gt;&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160;                echo <span class="stringliteral">&quot;&lt;option value=&#39;BEFORE&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;before&#39;</span>].<span class="stringliteral">&quot;&lt;/option&gt;&quot;</span>; </div><div class="line"><a name="l03475"></a><span class="lineno"> 3475</span>&#160;                echo <span class="stringliteral">&quot;&lt;option value=&#39;AFTER&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;after&#39;</span>].<span class="stringliteral">&quot;&lt;/option&gt;&quot;</span>; </div><div class="line"><a name="l03476"></a><span class="lineno"> 3476</span>&#160;                echo <span class="stringliteral">&quot;&lt;option value=&#39;INSTEAD OF&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;instead&#39;</span>].<span class="stringliteral">&quot;&lt;/option&gt;&quot;</span>; </div><div class="line"><a name="l03477"></a><span class="lineno"> 3477</span>&#160;                echo <span class="stringliteral">&quot;&lt;/select&gt;&quot;</span>;</div><div class="line"><a name="l03478"></a><span class="lineno"> 3478</span>&#160;                echo <span class="stringliteral">&quot;&lt;br/&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l03479"></a><span class="lineno"> 3479</span>&#160;                echo $lang[<span class="stringliteral">&#39;event&#39;</span>].<span class="stringliteral">&quot;: &quot;</span>;</div><div class="line"><a name="l03480"></a><span class="lineno"> 3480</span>&#160;                echo <span class="stringliteral">&quot;&lt;select name=&#39;event&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03481"></a><span class="lineno"> 3481</span>&#160;                echo <span class="stringliteral">&quot;&lt;option value=&#39;DELETE&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;del&#39;</span>].<span class="stringliteral">&quot;&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l03482"></a><span class="lineno"> 3482</span>&#160;                echo <span class="stringliteral">&quot;&lt;option value=&#39;INSERT&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;insert&#39;</span>].<span class="stringliteral">&quot;&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l03483"></a><span class="lineno"> 3483</span>&#160;                echo <span class="stringliteral">&quot;&lt;option value=&#39;UPDATE&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;update&#39;</span>].<span class="stringliteral">&quot;&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;                echo <span class="stringliteral">&quot;&lt;/select&gt;&quot;</span>;</div><div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160;                echo <span class="stringliteral">&quot;&lt;/fieldset&gt;&lt;br/&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160;                echo <span class="stringliteral">&quot;&lt;fieldset&gt;&lt;legend&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;trigger_act&#39;</span>].<span class="stringliteral">&quot;&lt;/legend&gt;&quot;</span>;</div><div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160;                echo <span class="stringliteral">&quot;&lt;label&gt;&lt;input type=&#39;checkbox&#39; name=&#39;foreachrow&#39;/&gt; &quot;</span>.$lang[<span class="stringliteral">&#39;each_row&#39;</span>].<span class="stringliteral">&quot;&lt;/label&gt;&lt;br/&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160;                echo $lang[<span class="stringliteral">&#39;when_exp&#39;</span>].<span class="stringliteral">&quot;:&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160;                echo <span class="stringliteral">&quot;&lt;textarea name=&#39;whenexpression&#39; style=&#39;width:500px; height:100px;&#39; rows=&#39;8&#39; cols=&#39;50&#39;&gt;&lt;/textarea&gt;&quot;</span>;</div><div class="line"><a name="l03490"></a><span class="lineno"> 3490</span>&#160;                echo <span class="stringliteral">&quot;&lt;br/&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l03491"></a><span class="lineno"> 3491</span>&#160;                echo $lang[<span class="stringliteral">&#39;trigger_step&#39;</span>].<span class="stringliteral">&quot;:&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l03492"></a><span class="lineno"> 3492</span>&#160;                echo <span class="stringliteral">&quot;&lt;textarea name=&#39;triggersteps&#39; style=&#39;width:500px; height:100px;&#39; rows=&#39;8&#39; cols=&#39;50&#39;&gt;&lt;/textarea&gt;&quot;</span>;</div><div class="line"><a name="l03493"></a><span class="lineno"> 3493</span>&#160;                echo <span class="stringliteral">&quot;&lt;/fieldset&gt;&lt;br/&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l03494"></a><span class="lineno"> 3494</span>&#160;                echo <span class="stringliteral">&quot;&lt;input type=&#39;submit&#39; value=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;create_trigger2&#39;</span>].<span class="stringliteral">&quot;&#39; class=&#39;btn&#39;/&gt; &quot;</span>;</div><div class="line"><a name="l03495"></a><span class="lineno"> 3495</span>&#160;                echo <span class="stringliteral">&quot;&lt;a href=&#39;?table=&quot;</span>.urlencode($_POST[<span class="stringliteral">&#39;tablename&#39;</span>]).<span class="stringliteral">&quot;&amp;amp;action=column_view&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;cancel&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l03496"></a><span class="lineno"> 3496</span>&#160;                echo <span class="stringliteral">&quot;&lt;/form&gt;&quot;</span>;</div><div class="line"><a name="l03497"></a><span class="lineno"> 3497</span>&#160;            }</div><div class="line"><a name="l03498"></a><span class="lineno"> 3498</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l03499"></a><span class="lineno"> 3499</span>&#160;</div><div class="line"><a name="l03500"></a><span class="lineno"> 3500</span>&#160;        <span class="comment">//- Create index (=index_create)</span></div><div class="line"><a name="l03501"></a><span class="lineno"> 3501</span>&#160;        <span class="keywordflow">case</span> <span class="stringliteral">&quot;index_create&quot;</span>:</div><div class="line"><a name="l03502"></a><span class="lineno"> 3502</span>&#160;            echo <span class="stringliteral">&quot;&lt;h2&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;create_index&#39;</span>].<span class="stringliteral">&quot; &#39;&quot;</span>.htmlencode($_POST[<span class="stringliteral">&#39;tablename&#39;</span>]).<span class="stringliteral">&quot;&#39;&lt;/h2&gt;&quot;</span>;</div><div class="line"><a name="l03503"></a><span class="lineno"> 3503</span>&#160;            <span class="keywordflow">if</span>($_POST[<span class="stringliteral">&#39;numcolumns&#39;</span>]==<span class="stringliteral">&quot;&quot;</span> || intval($_POST[<span class="stringliteral">&#39;numcolumns&#39;</span>])&lt;=0)</div><div class="line"><a name="l03504"></a><span class="lineno"> 3504</span>&#160;                echo $lang[<span class="stringliteral">&#39;specify_fields&#39;</span>];</div><div class="line"><a name="l03505"></a><span class="lineno"> 3505</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span>($_POST[<span class="stringliteral">&#39;tablename&#39;</span>]==<span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l03506"></a><span class="lineno"> 3506</span>&#160;                echo $lang[<span class="stringliteral">&#39;specify_tbl&#39;</span>];</div><div class="line"><a name="l03507"></a><span class="lineno"> 3507</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l03508"></a><span class="lineno"> 3508</span>&#160;            {</div><div class="line"><a name="l03509"></a><span class="lineno"> 3509</span>&#160;                echo <span class="stringliteral">&quot;&lt;form action=&#39;?table=&quot;</span>.urlencode($_POST[<span class="stringliteral">&#39;tablename&#39;</span>]).<span class="stringliteral">&quot;&amp;amp;action=index_create&amp;amp;confirm=1&#39; method=&#39;post&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03510"></a><span class="lineno"> 3510</span>&#160;                $num = intval($_POST[<span class="stringliteral">&#39;numcolumns&#39;</span>]);</div><div class="line"><a name="l03511"></a><span class="lineno"> 3511</span>&#160;                $query = <span class="stringliteral">&quot;PRAGMA table_info(&quot;</span>.$db-&gt;quote_id($_POST[<span class="stringliteral">&#39;tablename&#39;</span>]).<span class="stringliteral">&quot;)&quot;</span>;</div><div class="line"><a name="l03512"></a><span class="lineno"> 3512</span>&#160;</div><div class="line"><a name="l03513"></a><span class="lineno"> 3513</span>&#160;                $result = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;selectArray($query);</div><div class="line"><a name="l03514"></a><span class="lineno"> 3514</span>&#160;                echo <span class="stringliteral">&quot;&lt;fieldset&gt;&lt;legend&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;define_index&#39;</span>].<span class="stringliteral">&quot;&lt;/legend&gt;&quot;</span>;</div><div class="line"><a name="l03515"></a><span class="lineno"> 3515</span>&#160;                echo $lang[<span class="stringliteral">&#39;index_name&#39;</span>].<span class="stringliteral">&quot;: &lt;input type=&#39;text&#39; name=&#39;name&#39;/&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l03516"></a><span class="lineno"> 3516</span>&#160;                echo $lang[<span class="stringliteral">&#39;dup_val&#39;</span>].<span class="stringliteral">&quot;: &quot;</span>;</div><div class="line"><a name="l03517"></a><span class="lineno"> 3517</span>&#160;                echo <span class="stringliteral">&quot;&lt;select name=&#39;duplicate&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03518"></a><span class="lineno"> 3518</span>&#160;                echo <span class="stringliteral">&quot;&lt;option value=&#39;yes&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;allow&#39;</span>].<span class="stringliteral">&quot;&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l03519"></a><span class="lineno"> 3519</span>&#160;                echo <span class="stringliteral">&quot;&lt;option value=&#39;no&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;not_allow&#39;</span>].<span class="stringliteral">&quot;&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l03520"></a><span class="lineno"> 3520</span>&#160;                echo <span class="stringliteral">&quot;&lt;/select&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l03521"></a><span class="lineno"> 3521</span>&#160;                echo <span class="stringliteral">&quot;&lt;/fieldset&gt;&quot;</span>;</div><div class="line"><a name="l03522"></a><span class="lineno"> 3522</span>&#160;                echo <span class="stringliteral">&quot;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l03523"></a><span class="lineno"> 3523</span>&#160;                echo <span class="stringliteral">&quot;&lt;fieldset&gt;&lt;legend&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;define_in_col&#39;</span>].<span class="stringliteral">&quot;&lt;/legend&gt;&quot;</span>;</div><div class="line"><a name="l03524"></a><span class="lineno"> 3524</span>&#160;                <span class="keywordflow">for</span>($i=0; $i&lt;$num; $i++)</div><div class="line"><a name="l03525"></a><span class="lineno"> 3525</span>&#160;                {</div><div class="line"><a name="l03526"></a><span class="lineno"> 3526</span>&#160;                    echo <span class="stringliteral">&quot;&lt;select name=&#39;&quot;</span>.$i.<span class="stringliteral">&quot;_field&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03527"></a><span class="lineno"> 3527</span>&#160;                    echo <span class="stringliteral">&quot;&lt;option value=&#39;&#39;&gt;--&quot;</span>.$lang[<span class="stringliteral">&#39;ignore&#39;</span>].<span class="stringliteral">&quot;--&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l03528"></a><span class="lineno"> 3528</span>&#160;                    <span class="keywordflow">for</span>($j=0; $j&lt;<span class="keyword">sizeof</span>($result); $j++)</div><div class="line"><a name="l03529"></a><span class="lineno"> 3529</span>&#160;                        echo <span class="stringliteral">&quot;&lt;option value=&#39;&quot;</span>.htmlencode($result[$j][1]).<span class="stringliteral">&quot;&#39;&gt;&quot;</span>.htmlencode($result[$j][1]).<span class="stringliteral">&quot;&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l03530"></a><span class="lineno"> 3530</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/select&gt; &quot;</span>;</div><div class="line"><a name="l03531"></a><span class="lineno"> 3531</span>&#160;                    echo <span class="stringliteral">&quot;&lt;select name=&#39;&quot;</span>.$i.<span class="stringliteral">&quot;_order&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03532"></a><span class="lineno"> 3532</span>&#160;                    echo <span class="stringliteral">&quot;&lt;option value=&#39;&#39;&gt;&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l03533"></a><span class="lineno"> 3533</span>&#160;                    echo <span class="stringliteral">&quot;&lt;option value=&#39; ASC&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;asc&#39;</span>].<span class="stringliteral">&quot;&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l03534"></a><span class="lineno"> 3534</span>&#160;                    echo <span class="stringliteral">&quot;&lt;option value=&#39; DESC&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;desc&#39;</span>].<span class="stringliteral">&quot;&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l03535"></a><span class="lineno"> 3535</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/select&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l03536"></a><span class="lineno"> 3536</span>&#160;                }</div><div class="line"><a name="l03537"></a><span class="lineno"> 3537</span>&#160;                echo <span class="stringliteral">&quot;&lt;/fieldset&gt;&quot;</span>;</div><div class="line"><a name="l03538"></a><span class="lineno"> 3538</span>&#160;                echo <span class="stringliteral">&quot;&lt;br/&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l03539"></a><span class="lineno"> 3539</span>&#160;                echo <span class="stringliteral">&quot;&lt;input type=&#39;hidden&#39; name=&#39;num&#39; value=&#39;&quot;</span>.$num.<span class="stringliteral">&quot;&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l03540"></a><span class="lineno"> 3540</span>&#160;                echo <span class="stringliteral">&quot;&lt;input type=&#39;submit&#39; value=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;create_index1&#39;</span>].<span class="stringliteral">&quot;&#39; class=&#39;btn&#39;/&gt; &quot;</span>;</div><div class="line"><a name="l03541"></a><span class="lineno"> 3541</span>&#160;                echo <span class="stringliteral">&quot;&lt;a href=&#39;?table=&quot;</span>.urlencode($_POST[<span class="stringliteral">&#39;tablename&#39;</span>]).<span class="stringliteral">&quot;&amp;amp;action=column_view&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;cancel&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l03542"></a><span class="lineno"> 3542</span>&#160;                echo <span class="stringliteral">&quot;&lt;/form&gt;&quot;</span>;</div><div class="line"><a name="l03543"></a><span class="lineno"> 3543</span>&#160;            }</div><div class="line"><a name="l03544"></a><span class="lineno"> 3544</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l03545"></a><span class="lineno"> 3545</span>&#160;    }</div><div class="line"><a name="l03546"></a><span class="lineno"> 3546</span>&#160;    echo <span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l03547"></a><span class="lineno"> 3547</span>&#160;}</div><div class="line"><a name="l03548"></a><span class="lineno"> 3548</span>&#160;</div><div class="line"><a name="l03549"></a><span class="lineno"> 3549</span>&#160;$view = <span class="stringliteral">&quot;structure&quot;</span>;</div><div class="line"><a name="l03550"></a><span class="lineno"> 3550</span>&#160;</div><div class="line"><a name="l03551"></a><span class="lineno"> 3551</span>&#160;<span class="comment">//- HMTL: tabs for databases    </span></div><div class="line"><a name="l03552"></a><span class="lineno"> 3552</span>&#160;<span class="keywordflow">if</span>(!$target_table &amp;&amp; !isset($_GET[<span class="stringliteral">&#39;confirm&#39;</span>]) &amp;&amp; (!isset($_GET[<span class="stringliteral">&#39;action&#39;</span>]) || (isset($_GET[<span class="stringliteral">&#39;action&#39;</span>]) &amp;&amp; $_GET[<span class="stringliteral">&#39;action&#39;</span>]!=<span class="stringliteral">&quot;table_create&quot;</span>))) <span class="comment">//the absence of these fields means we are viewing the database homepage</span></div><div class="line"><a name="l03553"></a><span class="lineno"> 3553</span>&#160;{</div><div class="line"><a name="l03554"></a><span class="lineno"> 3554</span>&#160;    $view = isset($_GET[<span class="stringliteral">&#39;view&#39;</span>]) ? $_GET[<span class="stringliteral">&#39;view&#39;</span>] : <span class="stringliteral">&#39;structure&#39;</span>;</div><div class="line"><a name="l03555"></a><span class="lineno"> 3555</span>&#160;</div><div class="line"><a name="l03556"></a><span class="lineno"> 3556</span>&#160;    echo <span class="stringliteral">&quot;&lt;a href=&#39;?view=structure&#39; &quot;</span>;</div><div class="line"><a name="l03557"></a><span class="lineno"> 3557</span>&#160;    <span class="keywordflow">if</span>($view==<span class="stringliteral">&quot;structure&quot;</span>)</div><div class="line"><a name="l03558"></a><span class="lineno"> 3558</span>&#160;        echo <span class="stringliteral">&quot;class=&#39;tab_pressed&#39;&quot;</span>;</div><div class="line"><a name="l03559"></a><span class="lineno"> 3559</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l03560"></a><span class="lineno"> 3560</span>&#160;        echo <span class="stringliteral">&quot;class=&#39;tab&#39;&quot;</span>;</div><div class="line"><a name="l03561"></a><span class="lineno"> 3561</span>&#160;    echo <span class="stringliteral">&quot;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;struct&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l03562"></a><span class="lineno"> 3562</span>&#160;    echo <span class="stringliteral">&quot;&lt;a href=&#39;?view=sql&#39; &quot;</span>;</div><div class="line"><a name="l03563"></a><span class="lineno"> 3563</span>&#160;    <span class="keywordflow">if</span>($view==<span class="stringliteral">&quot;sql&quot;</span>)</div><div class="line"><a name="l03564"></a><span class="lineno"> 3564</span>&#160;        echo <span class="stringliteral">&quot;class=&#39;tab_pressed&#39;&quot;</span>;</div><div class="line"><a name="l03565"></a><span class="lineno"> 3565</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l03566"></a><span class="lineno"> 3566</span>&#160;        echo <span class="stringliteral">&quot;class=&#39;tab&#39;&quot;</span>;</div><div class="line"><a name="l03567"></a><span class="lineno"> 3567</span>&#160;    echo <span class="stringliteral">&quot;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;sql&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l03568"></a><span class="lineno"> 3568</span>&#160;    echo <span class="stringliteral">&quot;&lt;a href=&#39;?view=export&#39; &quot;</span>;</div><div class="line"><a name="l03569"></a><span class="lineno"> 3569</span>&#160;    <span class="keywordflow">if</span>($view==<span class="stringliteral">&quot;export&quot;</span>)</div><div class="line"><a name="l03570"></a><span class="lineno"> 3570</span>&#160;        echo <span class="stringliteral">&quot;class=&#39;tab_pressed&#39;&quot;</span>;</div><div class="line"><a name="l03571"></a><span class="lineno"> 3571</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l03572"></a><span class="lineno"> 3572</span>&#160;        echo <span class="stringliteral">&quot;class=&#39;tab&#39;&quot;</span>;</div><div class="line"><a name="l03573"></a><span class="lineno"> 3573</span>&#160;    echo <span class="stringliteral">&quot;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;export&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l03574"></a><span class="lineno"> 3574</span>&#160;    echo <span class="stringliteral">&quot;&lt;a href=&#39;?view=import&#39; &quot;</span>;</div><div class="line"><a name="l03575"></a><span class="lineno"> 3575</span>&#160;    <span class="keywordflow">if</span>($view==<span class="stringliteral">&quot;import&quot;</span>)</div><div class="line"><a name="l03576"></a><span class="lineno"> 3576</span>&#160;        echo <span class="stringliteral">&quot;class=&#39;tab_pressed&#39;&quot;</span>;</div><div class="line"><a name="l03577"></a><span class="lineno"> 3577</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l03578"></a><span class="lineno"> 3578</span>&#160;        echo <span class="stringliteral">&quot;class=&#39;tab&#39;&quot;</span>;</div><div class="line"><a name="l03579"></a><span class="lineno"> 3579</span>&#160;    echo <span class="stringliteral">&quot;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;import&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l03580"></a><span class="lineno"> 3580</span>&#160;    echo <span class="stringliteral">&quot;&lt;a href=&#39;?view=vacuum&#39; &quot;</span>;</div><div class="line"><a name="l03581"></a><span class="lineno"> 3581</span>&#160;    <span class="keywordflow">if</span>($view==<span class="stringliteral">&quot;vacuum&quot;</span>)</div><div class="line"><a name="l03582"></a><span class="lineno"> 3582</span>&#160;        echo <span class="stringliteral">&quot;class=&#39;tab_pressed&#39;&quot;</span>;</div><div class="line"><a name="l03583"></a><span class="lineno"> 3583</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l03584"></a><span class="lineno"> 3584</span>&#160;        echo <span class="stringliteral">&quot;class=&#39;tab&#39;&quot;</span>;</div><div class="line"><a name="l03585"></a><span class="lineno"> 3585</span>&#160;    echo <span class="stringliteral">&quot;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;vac&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l03586"></a><span class="lineno"> 3586</span>&#160;    <span class="keywordflow">if</span>($directory!==<span class="keyword">false</span> &amp;&amp; is_writable($directory))</div><div class="line"><a name="l03587"></a><span class="lineno"> 3587</span>&#160;    {</div><div class="line"><a name="l03588"></a><span class="lineno"> 3588</span>&#160;        echo <span class="stringliteral">&quot;&lt;a href=&#39;?view=rename&#39; &quot;</span>;</div><div class="line"><a name="l03589"></a><span class="lineno"> 3589</span>&#160;        <span class="keywordflow">if</span>($view==<span class="stringliteral">&quot;rename&quot;</span>)</div><div class="line"><a name="l03590"></a><span class="lineno"> 3590</span>&#160;            echo <span class="stringliteral">&quot;class=&#39;tab_pressed&#39;&quot;</span>;</div><div class="line"><a name="l03591"></a><span class="lineno"> 3591</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l03592"></a><span class="lineno"> 3592</span>&#160;            echo <span class="stringliteral">&quot;class=&#39;tab&#39;&quot;</span>;</div><div class="line"><a name="l03593"></a><span class="lineno"> 3593</span>&#160;        echo <span class="stringliteral">&quot;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;db_rename&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l03594"></a><span class="lineno"> 3594</span>&#160;        </div><div class="line"><a name="l03595"></a><span class="lineno"> 3595</span>&#160;        echo <span class="stringliteral">&quot;&lt;a href=&#39;?view=delete&#39; title=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;db_del&#39;</span>].<span class="stringliteral">&quot;&#39; &quot;</span>;</div><div class="line"><a name="l03596"></a><span class="lineno"> 3596</span>&#160;        <span class="keywordflow">if</span>($view==<span class="stringliteral">&quot;delete&quot;</span>)</div><div class="line"><a name="l03597"></a><span class="lineno"> 3597</span>&#160;            echo <span class="stringliteral">&quot;class=&#39;tab_pressed delete_db&#39;&quot;</span>;</div><div class="line"><a name="l03598"></a><span class="lineno"> 3598</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l03599"></a><span class="lineno"> 3599</span>&#160;            echo <span class="stringliteral">&quot;class=&#39;tab delete_db&#39;&quot;</span>;</div><div class="line"><a name="l03600"></a><span class="lineno"> 3600</span>&#160;        echo <span class="stringliteral">&quot;&gt;&lt;span&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;db_del&#39;</span>].<span class="stringliteral">&quot;&lt;/span&gt;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l03601"></a><span class="lineno"> 3601</span>&#160;    }</div><div class="line"><a name="l03602"></a><span class="lineno"> 3602</span>&#160;    echo <span class="stringliteral">&quot;&lt;div style=&#39;clear:both;&#39;&gt;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l03603"></a><span class="lineno"> 3603</span>&#160;    echo <span class="stringliteral">&quot;&lt;div id=&#39;main&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03604"></a><span class="lineno"> 3604</span>&#160;</div><div class="line"><a name="l03605"></a><span class="lineno"> 3605</span>&#160;  <span class="comment">//- Switch on $view (actually a series of if-else)</span></div><div class="line"><a name="l03606"></a><span class="lineno"> 3606</span>&#160;</div><div class="line"><a name="l03607"></a><span class="lineno"> 3607</span>&#160;    <span class="keywordflow">if</span>($view==<span class="stringliteral">&quot;structure&quot;</span>)</div><div class="line"><a name="l03608"></a><span class="lineno"> 3608</span>&#160;    {</div><div class="line"><a name="l03609"></a><span class="lineno"> 3609</span>&#160;        <span class="comment">//- Database structure, shows all the tables (=structure)</span></div><div class="line"><a name="l03610"></a><span class="lineno"> 3610</span>&#160;        $query = <span class="stringliteral">&quot;SELECT sqlite_version() AS sqlite_version&quot;</span>;</div><div class="line"><a name="l03611"></a><span class="lineno"> 3611</span>&#160;        $queryVersion = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;select($query);</div><div class="line"><a name="l03612"></a><span class="lineno"> 3612</span>&#160;        $realVersion = $queryVersion[<span class="stringliteral">&#39;sqlite_version&#39;</span>];</div><div class="line"><a name="l03613"></a><span class="lineno"> 3613</span>&#160;        </div><div class="line"><a name="l03614"></a><span class="lineno"> 3614</span>&#160;        <span class="keywordflow">if</span>(isset($dbexists))</div><div class="line"><a name="l03615"></a><span class="lineno"> 3615</span>&#160;        {</div><div class="line"><a name="l03616"></a><span class="lineno"> 3616</span>&#160;            echo <span class="stringliteral">&quot;&lt;div class=&#39;confirm&#39; style=&#39;margin:10px 20px;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03617"></a><span class="lineno"> 3617</span>&#160;            echo $lang[<span class="stringliteral">&#39;err&#39;</span>].<span class="stringliteral">&#39;: &#39;</span>.sprintf($lang[<span class="stringliteral">&#39;db_exists&#39;</span>], htmlencode($dbname));</div><div class="line"><a name="l03618"></a><span class="lineno"> 3618</span>&#160;            echo <span class="stringliteral">&quot;&lt;/div&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l03619"></a><span class="lineno"> 3619</span>&#160;        }</div><div class="line"><a name="l03620"></a><span class="lineno"> 3620</span>&#160;        </div><div class="line"><a name="l03621"></a><span class="lineno"> 3621</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;isWritable() &amp;&amp; !<a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;isDirWritable())</div><div class="line"><a name="l03622"></a><span class="lineno"> 3622</span>&#160;        {</div><div class="line"><a name="l03623"></a><span class="lineno"> 3623</span>&#160;            echo <span class="stringliteral">&quot;&lt;div class=&#39;confirm&#39; style=&#39;margin:10px 20px;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03624"></a><span class="lineno"> 3624</span>&#160;            echo $lang[<span class="stringliteral">&#39;attention&#39;</span>].<span class="stringliteral">&#39;: &#39;</span>.$lang[<span class="stringliteral">&#39;directory_not_writable&#39;</span>];</div><div class="line"><a name="l03625"></a><span class="lineno"> 3625</span>&#160;            echo <span class="stringliteral">&quot;&lt;/div&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l03626"></a><span class="lineno"> 3626</span>&#160;        }</div><div class="line"><a name="l03627"></a><span class="lineno"> 3627</span>&#160;        </div><div class="line"><a name="l03628"></a><span class="lineno"> 3628</span>&#160;        <span class="keywordflow">if</span>(isset($extension_not_allowed))</div><div class="line"><a name="l03629"></a><span class="lineno"> 3629</span>&#160;        {</div><div class="line"><a name="l03630"></a><span class="lineno"> 3630</span>&#160;            echo <span class="stringliteral">&quot;&lt;div class=&#39;confirm&#39; style=&#39;margin:10px 20px;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03631"></a><span class="lineno"> 3631</span>&#160;            echo $lang[<span class="stringliteral">&#39;extension_not_allowed&#39;</span>].<span class="stringliteral">&#39;: &#39;</span>;</div><div class="line"><a name="l03632"></a><span class="lineno"> 3632</span>&#160;            echo implode(<span class="stringliteral">&#39;, &#39;</span>, array_map(<span class="stringliteral">&#39;htmlencode&#39;</span>, $allowed_extensions));</div><div class="line"><a name="l03633"></a><span class="lineno"> 3633</span>&#160;            echo <span class="stringliteral">&#39;&lt;br /&gt;&#39;</span>.$lang[<span class="stringliteral">&#39;add_allowed_extension&#39;</span>];</div><div class="line"><a name="l03634"></a><span class="lineno"> 3634</span>&#160;            echo <span class="stringliteral">&quot;&lt;/div&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l03635"></a><span class="lineno"> 3635</span>&#160;        }</div><div class="line"><a name="l03636"></a><span class="lineno"> 3636</span>&#160;</div><div class="line"><a name="l03637"></a><span class="lineno"> 3637</span>&#160;        <span class="keywordflow">if</span> ($auth-&gt;isPasswordDefault())</div><div class="line"><a name="l03638"></a><span class="lineno"> 3638</span>&#160;        {</div><div class="line"><a name="l03639"></a><span class="lineno"> 3639</span>&#160;            echo <span class="stringliteral">&quot;&lt;div class=&#39;confirm&#39; style=&#39;margin:20px 0px;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03640"></a><span class="lineno"> 3640</span>&#160;            echo sprintf($lang[<span class="stringliteral">&#39;warn_passwd&#39;</span>],(is_readable(<span class="stringliteral">&#39;phpliteadmin.config.php&#39;</span>)?<span class="stringliteral">&#39;phpliteadmin.config.php&#39;</span>:PAGE)).<span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;warn0&#39;</span>];</div><div class="line"><a name="l03641"></a><span class="lineno"> 3641</span>&#160;            echo <span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l03642"></a><span class="lineno"> 3642</span>&#160;        }</div><div class="line"><a name="l03643"></a><span class="lineno"> 3643</span>&#160;        </div><div class="line"><a name="l03644"></a><span class="lineno"> 3644</span>&#160;        echo <span class="stringliteral">&quot;&lt;b&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;db_name&#39;</span>].<span class="stringliteral">&quot;&lt;/b&gt;: &quot;</span>.htmlencode(<a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;getName()).<span class="stringliteral">&quot;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l03645"></a><span class="lineno"> 3645</span>&#160;        echo <span class="stringliteral">&quot;&lt;b&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;db_path&#39;</span>].<span class="stringliteral">&quot;&lt;/b&gt;: &quot;</span>.htmlencode(<a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;getPath()).<span class="stringliteral">&quot;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l03646"></a><span class="lineno"> 3646</span>&#160;        echo <span class="stringliteral">&quot;&lt;b&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;db_size&#39;</span>].<span class="stringliteral">&quot;&lt;/b&gt;: &quot;</span>.<a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;getSize().<span class="stringliteral">&quot; KB&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l03647"></a><span class="lineno"> 3647</span>&#160;        echo <span class="stringliteral">&quot;&lt;b&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;db_mod&#39;</span>].<span class="stringliteral">&quot;&lt;/b&gt;: &quot;</span>.<a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;getDate().<span class="stringliteral">&quot;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l03648"></a><span class="lineno"> 3648</span>&#160;        echo <span class="stringliteral">&quot;&lt;b&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;sqlite_v&#39;</span>].<span class="stringliteral">&quot;&lt;/b&gt;: &quot;</span>.$realVersion.<span class="stringliteral">&quot;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l03649"></a><span class="lineno"> 3649</span>&#160;        echo <span class="stringliteral">&quot;&lt;b&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;sqlite_ext&#39;</span>].<span class="stringliteral">&quot;&lt;/b&gt; &quot;</span>.helpLink($lang[<span class="stringliteral">&#39;help1&#39;</span>]).<span class="stringliteral">&quot;: &quot;</span>.<a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;getType().<span class="stringliteral">&quot;&lt;br/&gt;&quot;</span>; </div><div class="line"><a name="l03650"></a><span class="lineno"> 3650</span>&#160;        echo <span class="stringliteral">&quot;&lt;b&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;php_v&#39;</span>].<span class="stringliteral">&quot;&lt;/b&gt;: &quot;</span>.phpversion().<span class="stringliteral">&quot;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l03651"></a><span class="lineno"> 3651</span>&#160;        echo <span class="stringliteral">&quot;&lt;b&gt;&quot;</span>.PROJECT.<span class="stringliteral">&quot; &quot;</span>.$lang[<span class="stringliteral">&quot;ver&quot;</span>].<span class="stringliteral">&quot;&lt;/b&gt;: &quot;</span>.VERSION;</div><div class="line"><a name="l03652"></a><span class="lineno"> 3652</span>&#160;        echo <span class="stringliteral">&quot; &lt;a href=&#39;&quot;</span>.PROJECT_URL.<span class="stringliteral">&quot;&#39; target=&#39;_blank&#39; id=&#39;oldVersion&#39; style=&#39;display: none;&#39; class=&#39;warning&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;new_version&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&lt;br/&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l03653"></a><span class="lineno"> 3653</span>&#160;        echo <span class="stringliteral">&quot;&lt;script type=&#39;text/javascript&#39;&gt;checkVersion(&#39;&quot;</span>.VERSION.<span class="stringliteral">&quot;&#39;,&#39;&quot;</span>.VERSION_CHECK_URL.<span class="stringliteral">&quot;&#39;);&lt;/script&gt;&quot;</span>;</div><div class="line"><a name="l03654"></a><span class="lineno"> 3654</span>&#160;        </div><div class="line"><a name="l03655"></a><span class="lineno"> 3655</span>&#160;        <span class="keywordflow">if</span>(isset($_GET[<span class="stringliteral">&#39;sort&#39;</span>]) &amp;&amp; ($_GET[<span class="stringliteral">&#39;sort&#39;</span>]==<span class="stringliteral">&#39;type&#39;</span> || $_GET[<span class="stringliteral">&#39;sort&#39;</span>]==<span class="stringliteral">&#39;name&#39;</span>))</div><div class="line"><a name="l03656"></a><span class="lineno"> 3656</span>&#160;            $_SESSION[COOKIENAME.<span class="stringliteral">&#39;sortTables&#39;</span>] = $_GET[<span class="stringliteral">&#39;sort&#39;</span>];</div><div class="line"><a name="l03657"></a><span class="lineno"> 3657</span>&#160;        <span class="keywordflow">if</span>(isset($_GET[<span class="stringliteral">&#39;order&#39;</span>]) &amp;&amp; ($_GET[<span class="stringliteral">&#39;order&#39;</span>]==<span class="stringliteral">&#39;ASC&#39;</span> || $_GET[<span class="stringliteral">&#39;order&#39;</span>]==<span class="stringliteral">&#39;DESC&#39;</span>))</div><div class="line"><a name="l03658"></a><span class="lineno"> 3658</span>&#160;            $_SESSION[COOKIENAME.<span class="stringliteral">&#39;orderTables&#39;</span>] = $_GET[<span class="stringliteral">&#39;order&#39;</span>];</div><div class="line"><a name="l03659"></a><span class="lineno"> 3659</span>&#160;                </div><div class="line"><a name="l03660"></a><span class="lineno"> 3660</span>&#160;        $query = <span class="stringliteral">&quot;SELECT type, name FROM sqlite_master WHERE (type=&#39;table&#39; OR type=&#39;view&#39;) AND name!=&#39;&#39; AND name NOT LIKE &#39;sqlite_%&#39;&quot;</span>;</div><div class="line"><a name="l03661"></a><span class="lineno"> 3661</span>&#160;        $queryAdd = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l03662"></a><span class="lineno"> 3662</span>&#160;        <span class="keywordflow">if</span>(isset($_SESSION[COOKIENAME.<span class="stringliteral">&#39;sortTables&#39;</span>]))</div><div class="line"><a name="l03663"></a><span class="lineno"> 3663</span>&#160;            $queryAdd .= <span class="stringliteral">&quot; ORDER BY &quot;</span>.$db-&gt;quote_id($_SESSION[COOKIENAME.<span class="stringliteral">&#39;sortTables&#39;</span>]);</div><div class="line"><a name="l03664"></a><span class="lineno"> 3664</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l03665"></a><span class="lineno"> 3665</span>&#160;            $queryAdd .= <span class="stringliteral">&quot; ORDER BY \&quot;name\&quot;&quot;</span>;</div><div class="line"><a name="l03666"></a><span class="lineno"> 3666</span>&#160;        <span class="keywordflow">if</span>(isset($_SESSION[COOKIENAME.<span class="stringliteral">&#39;orderTables&#39;</span>]))</div><div class="line"><a name="l03667"></a><span class="lineno"> 3667</span>&#160;            $queryAdd .= <span class="stringliteral">&quot; &quot;</span>.$_SESSION[COOKIENAME.<span class="stringliteral">&#39;orderTables&#39;</span>];</div><div class="line"><a name="l03668"></a><span class="lineno"> 3668</span>&#160;        $query .= $queryAdd;</div><div class="line"><a name="l03669"></a><span class="lineno"> 3669</span>&#160;        $result = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;selectArray($query);</div><div class="line"><a name="l03670"></a><span class="lineno"> 3670</span>&#160;</div><div class="line"><a name="l03671"></a><span class="lineno"> 3671</span>&#160;        <span class="keywordflow">if</span>(<span class="keyword">sizeof</span>($result)==0)</div><div class="line"><a name="l03672"></a><span class="lineno"> 3672</span>&#160;            echo $lang[<span class="stringliteral">&#39;no_tbl&#39;</span>].<span class="stringliteral">&quot;&lt;br/&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l03673"></a><span class="lineno"> 3673</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l03674"></a><span class="lineno"> 3674</span>&#160;        {</div><div class="line"><a name="l03675"></a><span class="lineno"> 3675</span>&#160;            echo <span class="stringliteral">&quot;&lt;table border=&#39;0&#39; cellpadding=&#39;2&#39; cellspacing=&#39;1&#39; class=&#39;viewTable&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03676"></a><span class="lineno"> 3676</span>&#160;            echo <span class="stringliteral">&quot;&lt;tr&gt;&quot;</span>;</div><div class="line"><a name="l03677"></a><span class="lineno"> 3677</span>&#160;            </div><div class="line"><a name="l03678"></a><span class="lineno"> 3678</span>&#160;            echo <span class="stringliteral">&quot;&lt;td class=&#39;tdheader&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03679"></a><span class="lineno"> 3679</span>&#160;            echo <span class="stringliteral">&quot;&lt;a href=&#39;?sort=type&quot;</span>;</div><div class="line"><a name="l03680"></a><span class="lineno"> 3680</span>&#160;            <span class="keywordflow">if</span>(isset($_SESSION[COOKIENAME.<span class="stringliteral">&#39;sortTables&#39;</span>]))</div><div class="line"><a name="l03681"></a><span class="lineno"> 3681</span>&#160;                $orderTag = ($_SESSION[COOKIENAME.<span class="stringliteral">&#39;sortTables&#39;</span>]==<span class="stringliteral">&quot;type&quot;</span> &amp;&amp; $_SESSION[COOKIENAME.<span class="stringliteral">&#39;orderTables&#39;</span>]==<span class="stringliteral">&quot;ASC&quot;</span>) ? <span class="stringliteral">&quot;DESC&quot;</span> : <span class="stringliteral">&quot;ASC&quot;</span>;</div><div class="line"><a name="l03682"></a><span class="lineno"> 3682</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l03683"></a><span class="lineno"> 3683</span>&#160;                $orderTag = <span class="stringliteral">&quot;ASC&quot;</span>;</div><div class="line"><a name="l03684"></a><span class="lineno"> 3684</span>&#160;            echo <span class="stringliteral">&quot;&amp;amp;order=&quot;</span>.$orderTag;</div><div class="line"><a name="l03685"></a><span class="lineno"> 3685</span>&#160;            echo <span class="stringliteral">&quot;&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;type&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt; &quot;</span>.helpLink($lang[<span class="stringliteral">&#39;help3&#39;</span>]); </div><div class="line"><a name="l03686"></a><span class="lineno"> 3686</span>&#160;            <span class="keywordflow">if</span>(isset($_SESSION[COOKIENAME.<span class="stringliteral">&#39;sortTables&#39;</span>]) &amp;&amp; $_SESSION[COOKIENAME.<span class="stringliteral">&#39;sortTables&#39;</span>]==<span class="stringliteral">&quot;type&quot;</span>)</div><div class="line"><a name="l03687"></a><span class="lineno"> 3687</span>&#160;                echo (($_SESSION[COOKIENAME.<span class="stringliteral">&#39;orderTables&#39;</span>]==<span class="stringliteral">&quot;ASC&quot;</span>) ? <span class="stringliteral">&quot; &lt;b&gt;&amp;uarr;&lt;/b&gt;&quot;</span> : <span class="stringliteral">&quot; &lt;b&gt;&amp;darr;&lt;/b&gt;&quot;</span>);</div><div class="line"><a name="l03688"></a><span class="lineno"> 3688</span>&#160;            echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03689"></a><span class="lineno"> 3689</span>&#160;            </div><div class="line"><a name="l03690"></a><span class="lineno"> 3690</span>&#160;            echo <span class="stringliteral">&quot;&lt;td class=&#39;tdheader&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03691"></a><span class="lineno"> 3691</span>&#160;            echo <span class="stringliteral">&quot;&lt;a href=&#39;?sort=name&quot;</span>;</div><div class="line"><a name="l03692"></a><span class="lineno"> 3692</span>&#160;            <span class="keywordflow">if</span>(isset($_SESSION[COOKIENAME.<span class="stringliteral">&#39;sortTables&#39;</span>]))</div><div class="line"><a name="l03693"></a><span class="lineno"> 3693</span>&#160;                $orderTag = ($_SESSION[COOKIENAME.<span class="stringliteral">&#39;sortTables&#39;</span>]==<span class="stringliteral">&quot;name&quot;</span> &amp;&amp; $_SESSION[COOKIENAME.<span class="stringliteral">&#39;orderTables&#39;</span>]==<span class="stringliteral">&quot;ASC&quot;</span>) ? <span class="stringliteral">&quot;DESC&quot;</span> : <span class="stringliteral">&quot;ASC&quot;</span>;</div><div class="line"><a name="l03694"></a><span class="lineno"> 3694</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l03695"></a><span class="lineno"> 3695</span>&#160;                $orderTag = <span class="stringliteral">&quot;ASC&quot;</span>;</div><div class="line"><a name="l03696"></a><span class="lineno"> 3696</span>&#160;            echo <span class="stringliteral">&quot;&amp;amp;order=&quot;</span>.$orderTag;</div><div class="line"><a name="l03697"></a><span class="lineno"> 3697</span>&#160;            echo <span class="stringliteral">&quot;&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;name&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l03698"></a><span class="lineno"> 3698</span>&#160;            <span class="keywordflow">if</span>(isset($_SESSION[COOKIENAME.<span class="stringliteral">&#39;sortTables&#39;</span>]) &amp;&amp; $_SESSION[COOKIENAME.<span class="stringliteral">&#39;sortTables&#39;</span>]==<span class="stringliteral">&quot;name&quot;</span>)</div><div class="line"><a name="l03699"></a><span class="lineno"> 3699</span>&#160;                echo (($_SESSION[COOKIENAME.<span class="stringliteral">&#39;orderTables&#39;</span>]==<span class="stringliteral">&quot;ASC&quot;</span>) ? <span class="stringliteral">&quot; &lt;b&gt;&amp;uarr;&lt;/b&gt;&quot;</span> : <span class="stringliteral">&quot; &lt;b&gt;&amp;darr;&lt;/b&gt;&quot;</span>);</div><div class="line"><a name="l03700"></a><span class="lineno"> 3700</span>&#160;            echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03701"></a><span class="lineno"> 3701</span>&#160;            </div><div class="line"><a name="l03702"></a><span class="lineno"> 3702</span>&#160;            echo <span class="stringliteral">&quot;&lt;td class=&#39;tdheader&#39; colspan=&#39;10&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;act&#39;</span>].<span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03703"></a><span class="lineno"> 3703</span>&#160;            echo <span class="stringliteral">&quot;&lt;td class=&#39;tdheader&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;rec&#39;</span>].<span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03704"></a><span class="lineno"> 3704</span>&#160;            echo <span class="stringliteral">&quot;&lt;/tr&gt;&quot;</span>;</div><div class="line"><a name="l03705"></a><span class="lineno"> 3705</span>&#160;            </div><div class="line"><a name="l03706"></a><span class="lineno"> 3706</span>&#160;            $totalRecords = 0;</div><div class="line"><a name="l03707"></a><span class="lineno"> 3707</span>&#160;            $skippedTables = <span class="keyword">false</span>;</div><div class="line"><a name="l03708"></a><span class="lineno"> 3708</span>&#160;            <span class="keywordflow">for</span>($i=0; $i&lt;<span class="keyword">sizeof</span>($result); $i++)</div><div class="line"><a name="l03709"></a><span class="lineno"> 3709</span>&#160;            {</div><div class="line"><a name="l03710"></a><span class="lineno"> 3710</span>&#160;                $records = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;numRows($result[$i][<span class="stringliteral">&#39;name&#39;</span>], (!isset($_GET[<span class="stringliteral">&#39;forceCount&#39;</span>])));</div><div class="line"><a name="l03711"></a><span class="lineno"> 3711</span>&#160;                <span class="keywordflow">if</span>($records == <span class="charliteral">&#39;?&#39;</span>)</div><div class="line"><a name="l03712"></a><span class="lineno"> 3712</span>&#160;                {</div><div class="line"><a name="l03713"></a><span class="lineno"> 3713</span>&#160;                    $skippedTables = <span class="keyword">true</span>;</div><div class="line"><a name="l03714"></a><span class="lineno"> 3714</span>&#160;                    $records = <span class="stringliteral">&quot;&lt;a href=&#39;?forceCount=1&#39;&gt;?&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l03715"></a><span class="lineno"> 3715</span>&#160;                }</div><div class="line"><a name="l03716"></a><span class="lineno"> 3716</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l03717"></a><span class="lineno"> 3717</span>&#160;                    $totalRecords += $records;</div><div class="line"><a name="l03718"></a><span class="lineno"> 3718</span>&#160;                $tdWithClass = <span class="stringliteral">&quot;&lt;td class=&#39;td&quot;</span>.($i%2 ? <span class="stringliteral">&quot;1&quot;</span> : <span class="stringliteral">&quot;2&quot;</span>).<span class="stringliteral">&quot;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03719"></a><span class="lineno"> 3719</span>&#160;                $tdWithClassLeft = <span class="stringliteral">&quot;&lt;td class=&#39;td&quot;</span>.($i%2 ? <span class="stringliteral">&quot;1&quot;</span> : <span class="stringliteral">&quot;2&quot;</span>).<span class="stringliteral">&quot;&#39; style=&#39;text-align:left;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03720"></a><span class="lineno"> 3720</span>&#160;                </div><div class="line"><a name="l03721"></a><span class="lineno"> 3721</span>&#160;                <span class="keywordflow">if</span>($result[$i][<span class="stringliteral">&#39;type&#39;</span>]==<span class="stringliteral">&quot;table&quot;</span>)</div><div class="line"><a name="l03722"></a><span class="lineno"> 3722</span>&#160;                {</div><div class="line"><a name="l03723"></a><span class="lineno"> 3723</span>&#160;                    echo <span class="stringliteral">&quot;&lt;tr&gt;&quot;</span>;</div><div class="line"><a name="l03724"></a><span class="lineno"> 3724</span>&#160;                    echo $tdWithClassLeft;</div><div class="line"><a name="l03725"></a><span class="lineno"> 3725</span>&#160;                    echo $lang[<span class="stringliteral">&#39;tbl&#39;</span>];</div><div class="line"><a name="l03726"></a><span class="lineno"> 3726</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03727"></a><span class="lineno"> 3727</span>&#160;                    echo $tdWithClassLeft;</div><div class="line"><a name="l03728"></a><span class="lineno"> 3728</span>&#160;                    echo <span class="stringliteral">&quot;&lt;a href=&#39;?table=&quot;</span>.urlencode($result[$i][<span class="stringliteral">&#39;name&#39;</span>]).<span class="stringliteral">&quot;&amp;amp;action=row_view&#39;&gt;&quot;</span>.htmlencode($result[$i][<span class="stringliteral">&#39;name&#39;</span>]).<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l03729"></a><span class="lineno"> 3729</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03730"></a><span class="lineno"> 3730</span>&#160;                    echo $tdWithClass;</div><div class="line"><a name="l03731"></a><span class="lineno"> 3731</span>&#160;                    echo <span class="stringliteral">&quot;&lt;a href=&#39;?table=&quot;</span>.urlencode($result[$i][<span class="stringliteral">&#39;name&#39;</span>]).<span class="stringliteral">&quot;&amp;amp;action=row_view&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;browse&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l03732"></a><span class="lineno"> 3732</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03733"></a><span class="lineno"> 3733</span>&#160;                    echo $tdWithClass;</div><div class="line"><a name="l03734"></a><span class="lineno"> 3734</span>&#160;                    echo <span class="stringliteral">&quot;&lt;a href=&#39;?table=&quot;</span>.urlencode($result[$i][<span class="stringliteral">&#39;name&#39;</span>]).<span class="stringliteral">&quot;&amp;amp;action=column_view&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;struct&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l03735"></a><span class="lineno"> 3735</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03736"></a><span class="lineno"> 3736</span>&#160;                    echo $tdWithClass;</div><div class="line"><a name="l03737"></a><span class="lineno"> 3737</span>&#160;                    echo <span class="stringliteral">&quot;&lt;a href=&#39;?table=&quot;</span>.urlencode($result[$i][<span class="stringliteral">&#39;name&#39;</span>]).<span class="stringliteral">&quot;&amp;amp;action=table_sql&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;sql&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l03738"></a><span class="lineno"> 3738</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03739"></a><span class="lineno"> 3739</span>&#160;                    echo $tdWithClass;</div><div class="line"><a name="l03740"></a><span class="lineno"> 3740</span>&#160;                    echo <span class="stringliteral">&quot;&lt;a href=&#39;?table=&quot;</span>.urlencode($result[$i][<span class="stringliteral">&#39;name&#39;</span>]).<span class="stringliteral">&quot;&amp;amp;action=table_search&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;srch&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l03741"></a><span class="lineno"> 3741</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03742"></a><span class="lineno"> 3742</span>&#160;                    echo $tdWithClass;</div><div class="line"><a name="l03743"></a><span class="lineno"> 3743</span>&#160;                    echo <span class="stringliteral">&quot;&lt;a href=&#39;?table=&quot;</span>.urlencode($result[$i][<span class="stringliteral">&#39;name&#39;</span>]).<span class="stringliteral">&quot;&amp;amp;action=row_create&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;insert&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l03744"></a><span class="lineno"> 3744</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03745"></a><span class="lineno"> 3745</span>&#160;                    echo $tdWithClass;</div><div class="line"><a name="l03746"></a><span class="lineno"> 3746</span>&#160;                    echo <span class="stringliteral">&quot;&lt;a href=&#39;?table=&quot;</span>.urlencode($result[$i][<span class="stringliteral">&#39;name&#39;</span>]).<span class="stringliteral">&quot;&amp;amp;action=table_export&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;export&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l03747"></a><span class="lineno"> 3747</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03748"></a><span class="lineno"> 3748</span>&#160;                    echo $tdWithClass;</div><div class="line"><a name="l03749"></a><span class="lineno"> 3749</span>&#160;                    echo <span class="stringliteral">&quot;&lt;a href=&#39;?table=&quot;</span>.urlencode($result[$i][<span class="stringliteral">&#39;name&#39;</span>]).<span class="stringliteral">&quot;&amp;amp;action=table_import&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;import&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l03750"></a><span class="lineno"> 3750</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03751"></a><span class="lineno"> 3751</span>&#160;                    echo $tdWithClass;</div><div class="line"><a name="l03752"></a><span class="lineno"> 3752</span>&#160;                    echo <span class="stringliteral">&quot;&lt;a href=&#39;?table=&quot;</span>.urlencode($result[$i][<span class="stringliteral">&#39;name&#39;</span>]).<span class="stringliteral">&quot;&amp;amp;action=table_rename&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;rename&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l03753"></a><span class="lineno"> 3753</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03754"></a><span class="lineno"> 3754</span>&#160;                    echo $tdWithClass;</div><div class="line"><a name="l03755"></a><span class="lineno"> 3755</span>&#160;                    echo <span class="stringliteral">&quot;&lt;a href=&#39;?table=&quot;</span>.urlencode($result[$i][<span class="stringliteral">&#39;name&#39;</span>]).<span class="stringliteral">&quot;&amp;amp;action=table_empty&#39; class=&#39;empty&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;empty&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l03756"></a><span class="lineno"> 3756</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03757"></a><span class="lineno"> 3757</span>&#160;                    echo $tdWithClass;</div><div class="line"><a name="l03758"></a><span class="lineno"> 3758</span>&#160;                    echo <span class="stringliteral">&quot;&lt;a href=&#39;?table=&quot;</span>.urlencode($result[$i][<span class="stringliteral">&#39;name&#39;</span>]).<span class="stringliteral">&quot;&amp;amp;action=table_drop&#39; class=&#39;drop&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;drop&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l03759"></a><span class="lineno"> 3759</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03760"></a><span class="lineno"> 3760</span>&#160;                    echo $tdWithClass;</div><div class="line"><a name="l03761"></a><span class="lineno"> 3761</span>&#160;                    echo $records;</div><div class="line"><a name="l03762"></a><span class="lineno"> 3762</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03763"></a><span class="lineno"> 3763</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/tr&gt;&quot;</span>;</div><div class="line"><a name="l03764"></a><span class="lineno"> 3764</span>&#160;                }</div><div class="line"><a name="l03765"></a><span class="lineno"> 3765</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l03766"></a><span class="lineno"> 3766</span>&#160;                {</div><div class="line"><a name="l03767"></a><span class="lineno"> 3767</span>&#160;                    echo <span class="stringliteral">&quot;&lt;tr&gt;&quot;</span>;</div><div class="line"><a name="l03768"></a><span class="lineno"> 3768</span>&#160;                    echo $tdWithClassLeft;</div><div class="line"><a name="l03769"></a><span class="lineno"> 3769</span>&#160;                    echo <span class="stringliteral">&quot;View&quot;</span>;</div><div class="line"><a name="l03770"></a><span class="lineno"> 3770</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03771"></a><span class="lineno"> 3771</span>&#160;                    echo $tdWithClassLeft;</div><div class="line"><a name="l03772"></a><span class="lineno"> 3772</span>&#160;                    echo <span class="stringliteral">&quot;&lt;a href=&#39;?table=&quot;</span>.urlencode($result[$i][<span class="stringliteral">&#39;name&#39;</span>]).<span class="stringliteral">&quot;&amp;amp;action=row_view&#39;&gt;&quot;</span>.htmlencode($result[$i][<span class="stringliteral">&#39;name&#39;</span>]).<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l03773"></a><span class="lineno"> 3773</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03774"></a><span class="lineno"> 3774</span>&#160;                    echo $tdWithClass;</div><div class="line"><a name="l03775"></a><span class="lineno"> 3775</span>&#160;                    echo <span class="stringliteral">&quot;&lt;a href=&#39;?table=&quot;</span>.urlencode($result[$i][<span class="stringliteral">&#39;name&#39;</span>]).<span class="stringliteral">&quot;&amp;amp;action=row_view&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;browse&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l03776"></a><span class="lineno"> 3776</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03777"></a><span class="lineno"> 3777</span>&#160;                    echo $tdWithClass;</div><div class="line"><a name="l03778"></a><span class="lineno"> 3778</span>&#160;                    echo <span class="stringliteral">&quot;&lt;a href=&#39;?table=&quot;</span>.urlencode($result[$i][<span class="stringliteral">&#39;name&#39;</span>]).<span class="stringliteral">&quot;&amp;amp;action=column_view&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;struct&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l03779"></a><span class="lineno"> 3779</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03780"></a><span class="lineno"> 3780</span>&#160;                    echo $tdWithClass;</div><div class="line"><a name="l03781"></a><span class="lineno"> 3781</span>&#160;                    echo <span class="stringliteral">&quot;&lt;a href=&#39;?table=&quot;</span>.urlencode($result[$i][<span class="stringliteral">&#39;name&#39;</span>]).<span class="stringliteral">&quot;&amp;amp;action=table_sql&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;sql&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l03782"></a><span class="lineno"> 3782</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03783"></a><span class="lineno"> 3783</span>&#160;                    echo $tdWithClass;</div><div class="line"><a name="l03784"></a><span class="lineno"> 3784</span>&#160;                    echo <span class="stringliteral">&quot;&lt;a href=&#39;?table=&quot;</span>.urlencode($result[$i][<span class="stringliteral">&#39;name&#39;</span>]).<span class="stringliteral">&quot;&amp;amp;action=table_search&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;srch&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l03785"></a><span class="lineno"> 3785</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03786"></a><span class="lineno"> 3786</span>&#160;                    echo $tdWithClass;</div><div class="line"><a name="l03787"></a><span class="lineno"> 3787</span>&#160;                    echo <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l03788"></a><span class="lineno"> 3788</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03789"></a><span class="lineno"> 3789</span>&#160;                    echo $tdWithClass;</div><div class="line"><a name="l03790"></a><span class="lineno"> 3790</span>&#160;                    echo <span class="stringliteral">&quot;&lt;a href=&#39;?table=&quot;</span>.urlencode($result[$i][<span class="stringliteral">&#39;name&#39;</span>]).<span class="stringliteral">&quot;&amp;amp;action=table_export&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;export&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l03791"></a><span class="lineno"> 3791</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03792"></a><span class="lineno"> 3792</span>&#160;                    echo $tdWithClass;</div><div class="line"><a name="l03793"></a><span class="lineno"> 3793</span>&#160;                    echo <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l03794"></a><span class="lineno"> 3794</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03795"></a><span class="lineno"> 3795</span>&#160;                    echo $tdWithClass;</div><div class="line"><a name="l03796"></a><span class="lineno"> 3796</span>&#160;                    echo <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l03797"></a><span class="lineno"> 3797</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03798"></a><span class="lineno"> 3798</span>&#160;                    echo $tdWithClass;</div><div class="line"><a name="l03799"></a><span class="lineno"> 3799</span>&#160;                    echo <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l03800"></a><span class="lineno"> 3800</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03801"></a><span class="lineno"> 3801</span>&#160;                    echo $tdWithClass;</div><div class="line"><a name="l03802"></a><span class="lineno"> 3802</span>&#160;                    echo <span class="stringliteral">&quot;&lt;a href=&#39;?table=&quot;</span>.urlencode($result[$i][<span class="stringliteral">&#39;name&#39;</span>]).<span class="stringliteral">&quot;&amp;amp;action=view_drop&#39; class=&#39;drop&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;drop&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l03803"></a><span class="lineno"> 3803</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03804"></a><span class="lineno"> 3804</span>&#160;                    echo $tdWithClass;</div><div class="line"><a name="l03805"></a><span class="lineno"> 3805</span>&#160;                    echo $records;</div><div class="line"><a name="l03806"></a><span class="lineno"> 3806</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03807"></a><span class="lineno"> 3807</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/tr&gt;&quot;</span>;</div><div class="line"><a name="l03808"></a><span class="lineno"> 3808</span>&#160;                }</div><div class="line"><a name="l03809"></a><span class="lineno"> 3809</span>&#160;            }</div><div class="line"><a name="l03810"></a><span class="lineno"> 3810</span>&#160;            echo <span class="stringliteral">&quot;&lt;tr&gt;&quot;</span>;</div><div class="line"><a name="l03811"></a><span class="lineno"> 3811</span>&#160;            echo <span class="stringliteral">&quot;&lt;td class=&#39;tdheader&#39; colspan=&#39;12&#39;&gt;&quot;</span>.sizeof($result).<span class="stringliteral">&quot; &quot;</span>.$lang[<span class="stringliteral">&#39;total&#39;</span>].<span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03812"></a><span class="lineno"> 3812</span>&#160;            echo <span class="stringliteral">&quot;&lt;td class=&#39;tdheader&#39; colspan=&#39;1&#39; style=&#39;text-align:right;&#39;&gt;&quot;</span>.$totalRecords.($skippedTables?<span class="stringliteral">&quot; &lt;a href=&#39;?forceCount=1&#39;&gt;+ ?&lt;/a&gt;&quot;</span>:<span class="stringliteral">&quot;&quot;</span>).<span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03813"></a><span class="lineno"> 3813</span>&#160;            echo <span class="stringliteral">&quot;&lt;/tr&gt;&quot;</span>;</div><div class="line"><a name="l03814"></a><span class="lineno"> 3814</span>&#160;            echo <span class="stringliteral">&quot;&lt;/table&gt;&quot;</span>;</div><div class="line"><a name="l03815"></a><span class="lineno"> 3815</span>&#160;            echo <span class="stringliteral">&quot;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l03816"></a><span class="lineno"> 3816</span>&#160;            <span class="keywordflow">if</span>($skippedTables)</div><div class="line"><a name="l03817"></a><span class="lineno"> 3817</span>&#160;                echo <span class="stringliteral">&quot;&lt;div class=&#39;confirm&#39; style=&#39;margin-bottom:20px;&#39;&gt;&quot;</span>.sprintf($lang[<span class="stringliteral">&quot;counting_skipped&quot;</span>],<span class="stringliteral">&quot;&lt;a href=&#39;?forceCount=1&#39;&gt;&quot;</span>,<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>).<span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l03818"></a><span class="lineno"> 3818</span>&#160;        }</div><div class="line"><a name="l03819"></a><span class="lineno"> 3819</span>&#160;        echo <span class="stringliteral">&quot;&lt;fieldset&gt;&quot;</span>;</div><div class="line"><a name="l03820"></a><span class="lineno"> 3820</span>&#160;        echo <span class="stringliteral">&quot;&lt;legend&gt;&lt;b&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;create_tbl_db&#39;</span>].<span class="stringliteral">&quot; &#39;&quot;</span>.htmlencode(<a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;getName()).<span class="stringliteral">&quot;&#39;&lt;/b&gt;&lt;/legend&gt;&quot;</span>;</div><div class="line"><a name="l03821"></a><span class="lineno"> 3821</span>&#160;        echo <span class="stringliteral">&quot;&lt;form action=&#39;?action=table_create&#39; method=&#39;post&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03822"></a><span class="lineno"> 3822</span>&#160;        echo $lang[<span class="stringliteral">&#39;name&#39;</span>].<span class="stringliteral">&quot;: &lt;input type=&#39;text&#39; name=&#39;tablename&#39; style=&#39;width:200px;&#39;/&gt; &quot;</span>;</div><div class="line"><a name="l03823"></a><span class="lineno"> 3823</span>&#160;        echo $lang[<span class="stringliteral">&#39;fld_num&#39;</span>].<span class="stringliteral">&quot;: &lt;input type=&#39;text&#39; name=&#39;tablefields&#39; style=&#39;width:90px;&#39;/&gt; &quot;</span>;</div><div class="line"><a name="l03824"></a><span class="lineno"> 3824</span>&#160;        echo <span class="stringliteral">&quot;&lt;input type=&#39;submit&#39; name=&#39;createtable&#39; value=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;go&#39;</span>].<span class="stringliteral">&quot;&#39; class=&#39;btn&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l03825"></a><span class="lineno"> 3825</span>&#160;        echo <span class="stringliteral">&quot;&lt;/form&gt;&quot;</span>;</div><div class="line"><a name="l03826"></a><span class="lineno"> 3826</span>&#160;        echo <span class="stringliteral">&quot;&lt;/fieldset&gt;&quot;</span>;</div><div class="line"><a name="l03827"></a><span class="lineno"> 3827</span>&#160;        echo <span class="stringliteral">&quot;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l03828"></a><span class="lineno"> 3828</span>&#160;        echo <span class="stringliteral">&quot;&lt;fieldset&gt;&quot;</span>;</div><div class="line"><a name="l03829"></a><span class="lineno"> 3829</span>&#160;        echo <span class="stringliteral">&quot;&lt;legend&gt;&lt;b&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;create_view&#39;</span>].<span class="stringliteral">&quot; &#39;&quot;</span>.htmlencode(<a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;getName()).<span class="stringliteral">&quot;&#39;&lt;/b&gt;&lt;/legend&gt;&quot;</span>;</div><div class="line"><a name="l03830"></a><span class="lineno"> 3830</span>&#160;        echo <span class="stringliteral">&quot;&lt;form action=&#39;?action=view_create&amp;amp;confirm=1&#39; method=&#39;post&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03831"></a><span class="lineno"> 3831</span>&#160;        echo $lang[<span class="stringliteral">&#39;name&#39;</span>].<span class="stringliteral">&quot;: &lt;input type=&#39;text&#39; name=&#39;viewname&#39; style=&#39;width:200px;&#39;/&gt; &quot;</span>;</div><div class="line"><a name="l03832"></a><span class="lineno"> 3832</span>&#160;        echo $lang[<span class="stringliteral">&#39;sel_state&#39;</span>].<span class="stringliteral">&quot; &quot;</span>.helpLink($lang[<span class="stringliteral">&#39;help4&#39;</span>]).<span class="stringliteral">&quot;: &lt;input type=&#39;text&#39; name=&#39;select&#39; style=&#39;width:400px;&#39;/&gt; &quot;</span>; </div><div class="line"><a name="l03833"></a><span class="lineno"> 3833</span>&#160;        echo <span class="stringliteral">&quot;&lt;input type=&#39;submit&#39; name=&#39;createtable&#39; value=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;go&#39;</span>].<span class="stringliteral">&quot;&#39; class=&#39;btn&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l03834"></a><span class="lineno"> 3834</span>&#160;        echo <span class="stringliteral">&quot;&lt;/form&gt;&quot;</span>;</div><div class="line"><a name="l03835"></a><span class="lineno"> 3835</span>&#160;        echo <span class="stringliteral">&quot;&lt;/fieldset&gt;&quot;</span>;</div><div class="line"><a name="l03836"></a><span class="lineno"> 3836</span>&#160;    }</div><div class="line"><a name="l03837"></a><span class="lineno"> 3837</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>($view==<span class="stringliteral">&quot;sql&quot;</span>)</div><div class="line"><a name="l03838"></a><span class="lineno"> 3838</span>&#160;    {</div><div class="line"><a name="l03839"></a><span class="lineno"> 3839</span>&#160;        <span class="comment">//- Database SQL editor (=sql)</span></div><div class="line"><a name="l03840"></a><span class="lineno"> 3840</span>&#160;        $isSelect = <span class="keyword">false</span>;</div><div class="line"><a name="l03841"></a><span class="lineno"> 3841</span>&#160;        <span class="keywordflow">if</span>(isset($_POST[<span class="stringliteral">&#39;query&#39;</span>]) &amp;&amp; $_POST[<span class="stringliteral">&#39;query&#39;</span>]!=<span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l03842"></a><span class="lineno"> 3842</span>&#160;        {</div><div class="line"><a name="l03843"></a><span class="lineno"> 3843</span>&#160;            $delimiter = $_POST[<span class="stringliteral">&#39;delimiter&#39;</span>];</div><div class="line"><a name="l03844"></a><span class="lineno"> 3844</span>&#160;            $queryStr = $_POST[<span class="stringliteral">&#39;queryval&#39;</span>];</div><div class="line"><a name="l03845"></a><span class="lineno"> 3845</span>&#160;            <span class="comment">//save the queries in history if necessary</span></div><div class="line"><a name="l03846"></a><span class="lineno"> 3846</span>&#160;            <span class="keywordflow">if</span>($maxSavedQueries!=0 &amp;&amp; $maxSavedQueries!=<span class="keyword">false</span>)</div><div class="line"><a name="l03847"></a><span class="lineno"> 3847</span>&#160;            {</div><div class="line"><a name="l03848"></a><span class="lineno"> 3848</span>&#160;                <span class="keywordflow">if</span>(!isset($_SESSION[<span class="stringliteral">&#39;query_history&#39;</span>]))</div><div class="line"><a name="l03849"></a><span class="lineno"> 3849</span>&#160;                    $_SESSION[<span class="stringliteral">&#39;query_history&#39;</span>] = array();</div><div class="line"><a name="l03850"></a><span class="lineno"> 3850</span>&#160;                $_SESSION[<span class="stringliteral">&#39;query_history&#39;</span>][md5(strtolower($queryStr))] = $queryStr;</div><div class="line"><a name="l03851"></a><span class="lineno"> 3851</span>&#160;                <span class="keywordflow">if</span>(<span class="keyword">sizeof</span>($_SESSION[<span class="stringliteral">&#39;query_history&#39;</span>]) &gt; $maxSavedQueries)</div><div class="line"><a name="l03852"></a><span class="lineno"> 3852</span>&#160;                    array_shift($_SESSION[<span class="stringliteral">&#39;query_history&#39;</span>]);</div><div class="line"><a name="l03853"></a><span class="lineno"> 3853</span>&#160;            }</div><div class="line"><a name="l03854"></a><span class="lineno"> 3854</span>&#160;            $query = explode_sql($delimiter, $queryStr); <span class="comment">//explode the query string into individual queries based on the delimiter</span></div><div class="line"><a name="l03855"></a><span class="lineno"> 3855</span>&#160;</div><div class="line"><a name="l03856"></a><span class="lineno"> 3856</span>&#160;            <span class="keywordflow">for</span>($i=0; $i&lt;<span class="keyword">sizeof</span>($query); $i++) <span class="comment">//iterate through the queries exploded by the delimiter</span></div><div class="line"><a name="l03857"></a><span class="lineno"> 3857</span>&#160;            {</div><div class="line"><a name="l03858"></a><span class="lineno"> 3858</span>&#160;                <span class="keywordflow">if</span>(str_replace(<span class="stringliteral">&quot; &quot;</span>, <span class="stringliteral">&quot;&quot;</span>, str_replace(<span class="stringliteral">&quot;\n&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, str_replace(<span class="stringliteral">&quot;\r&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, $query[$i])))!=<span class="stringliteral">&quot;&quot;</span>) <span class="comment">//make sure this query is not an empty string</span></div><div class="line"><a name="l03859"></a><span class="lineno"> 3859</span>&#160;                {</div><div class="line"><a name="l03860"></a><span class="lineno"> 3860</span>&#160;                    $queryTimer = <span class="keyword">new</span> MicroTimer();</div><div class="line"><a name="l03861"></a><span class="lineno"> 3861</span>&#160;                    $result = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;selectArray($query[$i], <span class="stringliteral">&quot;assoc&quot;</span>);</div><div class="line"><a name="l03862"></a><span class="lineno"> 3862</span>&#160;                    $queryTimer-&gt;stop();</div><div class="line"><a name="l03863"></a><span class="lineno"> 3863</span>&#160;</div><div class="line"><a name="l03864"></a><span class="lineno"> 3864</span>&#160;                    echo <span class="stringliteral">&quot;&lt;div class=&#39;confirm&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03865"></a><span class="lineno"> 3865</span>&#160;                    echo <span class="stringliteral">&quot;&lt;b&gt;&quot;</span>;</div><div class="line"><a name="l03866"></a><span class="lineno"> 3866</span>&#160;                    </div><div class="line"><a name="l03867"></a><span class="lineno"> 3867</span>&#160;                    <span class="keywordflow">if</span>($result !== NULL)</div><div class="line"><a name="l03868"></a><span class="lineno"> 3868</span>&#160;                    {</div><div class="line"><a name="l03869"></a><span class="lineno"> 3869</span>&#160;                    </div><div class="line"><a name="l03870"></a><span class="lineno"> 3870</span>&#160;                        <span class="keywordflow">if</span>(<span class="keyword">sizeof</span>($result)&gt;0 || <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;getAffectedRows()==0)</div><div class="line"><a name="l03871"></a><span class="lineno"> 3871</span>&#160;                        {</div><div class="line"><a name="l03872"></a><span class="lineno"> 3872</span>&#160;                            printf($lang[<span class="stringliteral">&#39;show_rows&#39;</span>], <span class="keyword">sizeof</span>($result));</div><div class="line"><a name="l03873"></a><span class="lineno"> 3873</span>&#160;                        }</div><div class="line"><a name="l03874"></a><span class="lineno"> 3874</span>&#160;                        <span class="keywordflow">if</span>(<a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;getAffectedRows()&gt;0 || <span class="keyword">sizeof</span>($result)==0)</div><div class="line"><a name="l03875"></a><span class="lineno"> 3875</span>&#160;                        {</div><div class="line"><a name="l03876"></a><span class="lineno"> 3876</span>&#160;                            echo <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;getAffectedRows().<span class="stringliteral">&quot; &quot;</span>.$lang[<span class="stringliteral">&#39;rows_aff&#39;</span>].<span class="stringliteral">&quot; &quot;</span>;</div><div class="line"><a name="l03877"></a><span class="lineno"> 3877</span>&#160;                        }</div><div class="line"><a name="l03878"></a><span class="lineno"> 3878</span>&#160;                        printf($lang[<span class="stringliteral">&#39;query_time&#39;</span>], $queryTimer);</div><div class="line"><a name="l03879"></a><span class="lineno"> 3879</span>&#160;                        echo <span class="stringliteral">&quot;&lt;/b&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l03880"></a><span class="lineno"> 3880</span>&#160;                    }</div><div class="line"><a name="l03881"></a><span class="lineno"> 3881</span>&#160;                    <span class="keywordflow">else</span></div><div class="line"><a name="l03882"></a><span class="lineno"> 3882</span>&#160;                    {</div><div class="line"><a name="l03883"></a><span class="lineno"> 3883</span>&#160;                        echo $lang[<span class="stringliteral">&#39;err&#39;</span>].<span class="stringliteral">&quot;: &quot;</span>.<a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;getError().<span class="stringliteral">&quot;&lt;/b&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l03884"></a><span class="lineno"> 3884</span>&#160;                    }</div><div class="line"><a name="l03885"></a><span class="lineno"> 3885</span>&#160;                    echo <span class="stringliteral">&quot;&lt;span style=&#39;font-size:11px;&#39;&gt;&quot;</span>.htmlencode($query[$i]).<span class="stringliteral">&quot;&lt;/span&gt;&quot;</span>;</div><div class="line"><a name="l03886"></a><span class="lineno"> 3886</span>&#160;                    echo <span class="stringliteral">&quot;&lt;/div&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l03887"></a><span class="lineno"> 3887</span>&#160;                    <span class="keywordflow">if</span>(<span class="keyword">sizeof</span>($result)&gt;0)</div><div class="line"><a name="l03888"></a><span class="lineno"> 3888</span>&#160;                    {</div><div class="line"><a name="l03889"></a><span class="lineno"> 3889</span>&#160;                        $headers = array_keys($result[0]);</div><div class="line"><a name="l03890"></a><span class="lineno"> 3890</span>&#160;</div><div class="line"><a name="l03891"></a><span class="lineno"> 3891</span>&#160;                        echo <span class="stringliteral">&quot;&lt;table border=&#39;0&#39; cellpadding=&#39;2&#39; cellspacing=&#39;1&#39; class=&#39;viewTable&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03892"></a><span class="lineno"> 3892</span>&#160;                        echo <span class="stringliteral">&quot;&lt;tr&gt;&quot;</span>;</div><div class="line"><a name="l03893"></a><span class="lineno"> 3893</span>&#160;                        <span class="keywordflow">for</span>($j=0; $j&lt;<span class="keyword">sizeof</span>($headers); $j++)</div><div class="line"><a name="l03894"></a><span class="lineno"> 3894</span>&#160;                        {</div><div class="line"><a name="l03895"></a><span class="lineno"> 3895</span>&#160;                            echo <span class="stringliteral">&quot;&lt;td class=&#39;tdheader&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03896"></a><span class="lineno"> 3896</span>&#160;                            echo htmlencode($headers[$j]);</div><div class="line"><a name="l03897"></a><span class="lineno"> 3897</span>&#160;                            echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;</div><div class="line"><a name="l03898"></a><span class="lineno"> 3898</span>&#160;                        }</div><div class="line"><a name="l03899"></a><span class="lineno"> 3899</span>&#160;                        echo <span class="stringliteral">&quot;&lt;/tr&gt;&quot;</span>;</div><div class="line"><a name="l03900"></a><span class="lineno"> 3900</span>&#160;                        <span class="keywordflow">for</span>($j=0; $j&lt;<span class="keyword">sizeof</span>($result); $j++)</div><div class="line"><a name="l03901"></a><span class="lineno"> 3901</span>&#160;                        {</div><div class="line"><a name="l03902"></a><span class="lineno"> 3902</span>&#160;                            $tdWithClass = <span class="stringliteral">&quot;&lt;td class=&#39;td&quot;</span>.($j%2 ? <span class="stringliteral">&quot;1&quot;</span> : <span class="stringliteral">&quot;2&quot;</span>).<span class="stringliteral">&quot;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03903"></a><span class="lineno"> 3903</span>&#160;                            echo <span class="stringliteral">&quot;&lt;tr&gt;&quot;</span>;</div><div class="line"><a name="l03904"></a><span class="lineno"> 3904</span>&#160;                            <span class="keywordflow">for</span>($z=0; $z&lt;<span class="keyword">sizeof</span>($headers); $z++)</div><div class="line"><a name="l03905"></a><span class="lineno"> 3905</span>&#160;                            {</div><div class="line"><a name="l03906"></a><span class="lineno"> 3906</span>&#160;                                echo $tdWithClass;</div><div class="line"><a name="l03907"></a><span class="lineno"> 3907</span>&#160;                                <span class="keywordflow">if</span>($result[$j][$headers[$z]]===<span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l03908"></a><span class="lineno"> 3908</span>&#160;                                    echo <span class="stringliteral">&quot;&amp;nbsp;&quot;</span>;</div><div class="line"><a name="l03909"></a><span class="lineno"> 3909</span>&#160;                                elseif($result[$j][$headers[$z]]===NULL)</div><div class="line"><a name="l03910"></a><span class="lineno"> 3910</span>&#160;                                    echo &quot;&lt;i class=&#39;null&#39;&gt;NULL&lt;/i&gt;&quot;;</div><div class="line"><a name="l03911"></a><span class="lineno"> 3911</span>&#160;                                else</div><div class="line"><a name="l03912"></a><span class="lineno"> 3912</span>&#160;                                    echo htmlencode(subString($result[$j][$headers[$z]]));</div><div class="line"><a name="l03913"></a><span class="lineno"> 3913</span>&#160;                                echo &quot;&lt;/td&gt;&quot;;</div><div class="line"><a name="l03914"></a><span class="lineno"> 3914</span>&#160;                            }</div><div class="line"><a name="l03915"></a><span class="lineno"> 3915</span>&#160;                            echo &quot;&lt;/tr&gt;&quot;;</div><div class="line"><a name="l03916"></a><span class="lineno"> 3916</span>&#160;                        }</div><div class="line"><a name="l03917"></a><span class="lineno"> 3917</span>&#160;                        echo &quot;&lt;/table&gt;&lt;br/&gt;&lt;br/&gt;&quot;;</div><div class="line"><a name="l03918"></a><span class="lineno"> 3918</span>&#160;                    }</div><div class="line"><a name="l03919"></a><span class="lineno"> 3919</span>&#160;            }</div><div class="line"><a name="l03920"></a><span class="lineno"> 3920</span>&#160;            }</div><div class="line"><a name="l03921"></a><span class="lineno"> 3921</span>&#160;        }</div><div class="line"><a name="l03922"></a><span class="lineno"> 3922</span>&#160;        else</div><div class="line"><a name="l03923"></a><span class="lineno"> 3923</span>&#160;        {</div><div class="line"><a name="l03924"></a><span class="lineno"> 3924</span>&#160;            $delimiter = <span class="stringliteral">&quot;;&quot;</span>;</div><div class="line"><a name="l03925"></a><span class="lineno"> 3925</span>&#160;            $queryStr = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l03926"></a><span class="lineno"> 3926</span>&#160;        }</div><div class="line"><a name="l03927"></a><span class="lineno"> 3927</span>&#160;</div><div class="line"><a name="l03928"></a><span class="lineno"> 3928</span>&#160;        echo <span class="stringliteral">&quot;&lt;fieldset&gt;&quot;</span>;</div><div class="line"><a name="l03929"></a><span class="lineno"> 3929</span>&#160;        echo <span class="stringliteral">&quot;&lt;legend&gt;&lt;b&gt;&quot;</span>.sprintf($lang[<span class="stringliteral">&#39;run_sql&#39;</span>],htmlencode(<a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;getName())).<span class="stringliteral">&quot;&lt;/b&gt;&lt;/legend&gt;&quot;</span>;</div><div class="line"><a name="l03930"></a><span class="lineno"> 3930</span>&#160;        echo <span class="stringliteral">&quot;&lt;form action=&#39;?view=sql&#39; method=&#39;post&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03931"></a><span class="lineno"> 3931</span>&#160;        <span class="keywordflow">if</span>(isset($_SESSION[<span class="stringliteral">&#39;query_history&#39;</span>]) &amp;&amp; <span class="keyword">sizeof</span>($_SESSION[<span class="stringliteral">&#39;query_history&#39;</span>])&gt;0)</div><div class="line"><a name="l03932"></a><span class="lineno"> 3932</span>&#160;        {</div><div class="line"><a name="l03933"></a><span class="lineno"> 3933</span>&#160;            echo <span class="stringliteral">&quot;&lt;b&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;recent_queries&#39;</span>].<span class="stringliteral">&quot;&lt;/b&gt;&lt;ul&gt;&quot;</span>;</div><div class="line"><a name="l03934"></a><span class="lineno"> 3934</span>&#160;            <span class="keywordflow">foreach</span>($_SESSION[<span class="stringliteral">&#39;query_history&#39;</span>] as $key =&gt; $value)</div><div class="line"><a name="l03935"></a><span class="lineno"> 3935</span>&#160;            {</div><div class="line"><a name="l03936"></a><span class="lineno"> 3936</span>&#160;                echo <span class="stringliteral">&quot;&lt;li&gt;&lt;a onclick=&#39;document.getElementById(\&quot;queryval\&quot;).value = this.textContent;&#39; href=&#39;#&#39;&gt;&quot;</span>.htmlencode($value).<span class="stringliteral">&quot;&lt;/a&gt;&lt;/li&gt;&quot;</span>;</div><div class="line"><a name="l03937"></a><span class="lineno"> 3937</span>&#160;            }</div><div class="line"><a name="l03938"></a><span class="lineno"> 3938</span>&#160;            echo <span class="stringliteral">&quot;&lt;/ul&gt;&lt;br/&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l03939"></a><span class="lineno"> 3939</span>&#160;        }</div><div class="line"><a name="l03940"></a><span class="lineno"> 3940</span>&#160;        echo <span class="stringliteral">&quot;&lt;textarea style=&#39;width:100%; height:300px;&#39; name=&#39;queryval&#39; id=&#39;queryval&#39; cols=&#39;50&#39; rows=&#39;8&#39;&gt;&quot;</span>.htmlencode($queryStr).<span class="stringliteral">&quot;&lt;/textarea&gt;&quot;</span>;</div><div class="line"><a name="l03941"></a><span class="lineno"> 3941</span>&#160;        echo $lang[<span class="stringliteral">&#39;delimit&#39;</span>].<span class="stringliteral">&quot; &lt;input type=&#39;text&#39; name=&#39;delimiter&#39; value=&#39;&quot;</span>.htmlencode($delimiter).<span class="stringliteral">&quot;&#39; style=&#39;width:50px;&#39;/&gt; &quot;</span>;</div><div class="line"><a name="l03942"></a><span class="lineno"> 3942</span>&#160;        echo <span class="stringliteral">&quot;&lt;input type=&#39;submit&#39; name=&#39;query&#39; value=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;go&#39;</span>].<span class="stringliteral">&quot;&#39; class=&#39;btn&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l03943"></a><span class="lineno"> 3943</span>&#160;        echo <span class="stringliteral">&quot;&lt;/form&gt;&quot;</span>;</div><div class="line"><a name="l03944"></a><span class="lineno"> 3944</span>&#160;        echo <span class="stringliteral">&quot;&lt;/fieldset&gt;&quot;</span>;</div><div class="line"><a name="l03945"></a><span class="lineno"> 3945</span>&#160;    }</div><div class="line"><a name="l03946"></a><span class="lineno"> 3946</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>($view==<span class="stringliteral">&quot;vacuum&quot;</span>)</div><div class="line"><a name="l03947"></a><span class="lineno"> 3947</span>&#160;    {</div><div class="line"><a name="l03948"></a><span class="lineno"> 3948</span>&#160;        <span class="comment">//- Vacuum database confirmation (=vacuum)</span></div><div class="line"><a name="l03949"></a><span class="lineno"> 3949</span>&#160;        <span class="keywordflow">if</span>(isset($_POST[<span class="stringliteral">&#39;vacuum&#39;</span>]))</div><div class="line"><a name="l03950"></a><span class="lineno"> 3950</span>&#160;        {</div><div class="line"><a name="l03951"></a><span class="lineno"> 3951</span>&#160;            $query = <span class="stringliteral">&quot;VACUUM&quot;</span>;</div><div class="line"><a name="l03952"></a><span class="lineno"> 3952</span>&#160;            <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;query($query);</div><div class="line"><a name="l03953"></a><span class="lineno"> 3953</span>&#160;            echo <span class="stringliteral">&quot;&lt;div class=&#39;confirm&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03954"></a><span class="lineno"> 3954</span>&#160;            printf($lang[<span class="stringliteral">&#39;db_vac&#39;</span>], htmlencode(<a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;getName()));</div><div class="line"><a name="l03955"></a><span class="lineno"> 3955</span>&#160;            echo <span class="stringliteral">&quot;&lt;/div&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l03956"></a><span class="lineno"> 3956</span>&#160;        }</div><div class="line"><a name="l03957"></a><span class="lineno"> 3957</span>&#160;        echo <span class="stringliteral">&quot;&lt;form method=&#39;post&#39; action=&#39;?view=vacuum&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03958"></a><span class="lineno"> 3958</span>&#160;        printf($lang[<span class="stringliteral">&#39;vac_desc&#39;</span>],htmlencode(<a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;getName()));</div><div class="line"><a name="l03959"></a><span class="lineno"> 3959</span>&#160;        echo <span class="stringliteral">&quot;&lt;br/&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l03960"></a><span class="lineno"> 3960</span>&#160;        echo <span class="stringliteral">&quot;&lt;input type=&#39;submit&#39; value=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;vac&#39;</span>].<span class="stringliteral">&quot;&#39; name=&#39;vacuum&#39; class=&#39;btn&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l03961"></a><span class="lineno"> 3961</span>&#160;        echo <span class="stringliteral">&quot;&lt;/form&gt;&quot;</span>;</div><div class="line"><a name="l03962"></a><span class="lineno"> 3962</span>&#160;    }</div><div class="line"><a name="l03963"></a><span class="lineno"> 3963</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>($view==<span class="stringliteral">&quot;export&quot;</span>)</div><div class="line"><a name="l03964"></a><span class="lineno"> 3964</span>&#160;    {</div><div class="line"><a name="l03965"></a><span class="lineno"> 3965</span>&#160;        <span class="comment">//- Export view (=export)</span></div><div class="line"><a name="l03966"></a><span class="lineno"> 3966</span>&#160;        echo <span class="stringliteral">&quot;&lt;form method=&#39;post&#39; action=&#39;?view=export&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03967"></a><span class="lineno"> 3967</span>&#160;        echo <span class="stringliteral">&quot;&lt;fieldset style=&#39;float:left; width:260px; margin-right:20px;&#39;&gt;&lt;legend&gt;&lt;b&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;export&#39;</span>].<span class="stringliteral">&quot;&lt;/b&gt;&lt;/legend&gt;&quot;</span>;</div><div class="line"><a name="l03968"></a><span class="lineno"> 3968</span>&#160;        echo <span class="stringliteral">&quot;&lt;select multiple=&#39;multiple&#39; size=&#39;10&#39; style=&#39;width:240px;&#39; name=&#39;tables[]&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03969"></a><span class="lineno"> 3969</span>&#160;        $query = <span class="stringliteral">&quot;SELECT name FROM sqlite_master WHERE type=&#39;table&#39; OR type=&#39;view&#39; ORDER BY name&quot;</span>;</div><div class="line"><a name="l03970"></a><span class="lineno"> 3970</span>&#160;        $result = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;selectArray($query);</div><div class="line"><a name="l03971"></a><span class="lineno"> 3971</span>&#160;        <span class="keywordflow">for</span>($i=0; $i&lt;<span class="keyword">sizeof</span>($result); $i++)</div><div class="line"><a name="l03972"></a><span class="lineno"> 3972</span>&#160;        {</div><div class="line"><a name="l03973"></a><span class="lineno"> 3973</span>&#160;            <span class="keywordflow">if</span>(substr($result[$i][<span class="stringliteral">&#39;name&#39;</span>], 0, 7)!=<span class="stringliteral">&quot;sqlite_&quot;</span> &amp;&amp; $result[$i][<span class="stringliteral">&#39;name&#39;</span>]!=<span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l03974"></a><span class="lineno"> 3974</span>&#160;                echo <span class="stringliteral">&quot;&lt;option value=&#39;&quot;</span>.htmlencode($result[$i][<span class="stringliteral">&#39;name&#39;</span>]).<span class="stringliteral">&quot;&#39; selected=&#39;selected&#39;&gt;&quot;</span>.htmlencode($result[$i][<span class="stringliteral">&#39;name&#39;</span>]).<span class="stringliteral">&quot;&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l03975"></a><span class="lineno"> 3975</span>&#160;        }</div><div class="line"><a name="l03976"></a><span class="lineno"> 3976</span>&#160;        echo <span class="stringliteral">&quot;&lt;/select&gt;&quot;</span>;</div><div class="line"><a name="l03977"></a><span class="lineno"> 3977</span>&#160;        echo <span class="stringliteral">&quot;&lt;br/&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l03978"></a><span class="lineno"> 3978</span>&#160;        echo <span class="stringliteral">&quot;&lt;label&gt;&lt;input type=&#39;radio&#39; name=&#39;export_type&#39; checked=&#39;checked&#39; value=&#39;sql&#39; onclick=&#39;toggleExports(\&quot;sql\&quot;);&#39;/&gt; &quot;</span>.$lang[<span class="stringliteral">&#39;sql&#39;</span>].<span class="stringliteral">&quot;&lt;/label&gt;&quot;</span>;</div><div class="line"><a name="l03979"></a><span class="lineno"> 3979</span>&#160;        echo <span class="stringliteral">&quot;&lt;br/&gt;&lt;label&gt;&lt;input type=&#39;radio&#39; name=&#39;export_type&#39; value=&#39;csv&#39; onclick=&#39;toggleExports(\&quot;csv\&quot;);&#39;/&gt; &quot;</span>.$lang[<span class="stringliteral">&#39;csv&#39;</span>].<span class="stringliteral">&quot;&lt;/label&gt;&quot;</span>;</div><div class="line"><a name="l03980"></a><span class="lineno"> 3980</span>&#160;        echo <span class="stringliteral">&quot;&lt;/fieldset&gt;&quot;</span>;</div><div class="line"><a name="l03981"></a><span class="lineno"> 3981</span>&#160;        </div><div class="line"><a name="l03982"></a><span class="lineno"> 3982</span>&#160;        echo <span class="stringliteral">&quot;&lt;fieldset style=&#39;float:left; max-width:350px;&#39; id=&#39;exportoptions_sql&#39;&gt;&lt;legend&gt;&lt;b&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;options&#39;</span>].<span class="stringliteral">&quot;&lt;/b&gt;&lt;/legend&gt;&quot;</span>;</div><div class="line"><a name="l03983"></a><span class="lineno"> 3983</span>&#160;        echo <span class="stringliteral">&quot;&lt;label&gt;&lt;input type=&#39;checkbox&#39; checked=&#39;checked&#39; name=&#39;structure&#39;/&gt; &quot;</span>.$lang[<span class="stringliteral">&#39;export_struct&#39;</span>].<span class="stringliteral">&quot;&lt;/label&gt; &quot;</span>.helpLink($lang[<span class="stringliteral">&#39;help5&#39;</span>]).<span class="stringliteral">&quot;&lt;br/&gt;&quot;</span>; </div><div class="line"><a name="l03984"></a><span class="lineno"> 3984</span>&#160;        echo <span class="stringliteral">&quot;&lt;label&gt;&lt;input type=&#39;checkbox&#39; checked=&#39;checked&#39; name=&#39;data&#39;/&gt; &quot;</span>.$lang[<span class="stringliteral">&#39;export_data&#39;</span>].<span class="stringliteral">&quot;&lt;/label&gt; &quot;</span>.helpLink($lang[<span class="stringliteral">&#39;help6&#39;</span>]).<span class="stringliteral">&quot;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l03985"></a><span class="lineno"> 3985</span>&#160;        echo <span class="stringliteral">&quot;&lt;label&gt;&lt;input type=&#39;checkbox&#39; name=&#39;drop&#39;/&gt; &quot;</span>.$lang[<span class="stringliteral">&#39;add_drop&#39;</span>].<span class="stringliteral">&quot;&lt;/label&gt; &quot;</span>.helpLink($lang[<span class="stringliteral">&#39;help7&#39;</span>]).<span class="stringliteral">&quot;&lt;br/&gt;&quot;</span>; </div><div class="line"><a name="l03986"></a><span class="lineno"> 3986</span>&#160;        echo <span class="stringliteral">&quot;&lt;label&gt;&lt;input type=&#39;checkbox&#39; checked=&#39;checked&#39; name=&#39;transaction&#39;/&gt; &quot;</span>.$lang[<span class="stringliteral">&#39;add_transact&#39;</span>].<span class="stringliteral">&quot;&lt;/label&gt; &quot;</span>.helpLink($lang[<span class="stringliteral">&#39;help8&#39;</span>]).<span class="stringliteral">&quot;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l03987"></a><span class="lineno"> 3987</span>&#160;        echo <span class="stringliteral">&quot;&lt;label&gt;&lt;input type=&#39;checkbox&#39; checked=&#39;checked&#39; name=&#39;comments&#39;/&gt; &quot;</span>.$lang[<span class="stringliteral">&#39;comments&#39;</span>].<span class="stringliteral">&quot;&lt;/label&gt; &quot;</span>.helpLink($lang[<span class="stringliteral">&#39;help9&#39;</span>]).<span class="stringliteral">&quot;&lt;br/&gt;&quot;</span>; </div><div class="line"><a name="l03988"></a><span class="lineno"> 3988</span>&#160;        echo <span class="stringliteral">&quot;&lt;/fieldset&gt;&quot;</span>;</div><div class="line"><a name="l03989"></a><span class="lineno"> 3989</span>&#160;        </div><div class="line"><a name="l03990"></a><span class="lineno"> 3990</span>&#160;        echo <span class="stringliteral">&quot;&lt;fieldset style=&#39;float:left; max-width:350px; display:none;&#39; id=&#39;exportoptions_csv&#39;&gt;&lt;legend&gt;&lt;b&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;options&#39;</span>].<span class="stringliteral">&quot;&lt;/b&gt;&lt;/legend&gt;&quot;</span>;</div><div class="line"><a name="l03991"></a><span class="lineno"> 3991</span>&#160;        echo <span class="stringliteral">&quot;&lt;div style=&#39;float:left;&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;fld_terminated&#39;</span>].<span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l03992"></a><span class="lineno"> 3992</span>&#160;        echo <span class="stringliteral">&quot;&lt;input type=&#39;text&#39; value=&#39;;&#39; name=&#39;export_csv_fieldsterminated&#39; style=&#39;float:right;&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l03993"></a><span class="lineno"> 3993</span>&#160;        echo <span class="stringliteral">&quot;&lt;div style=&#39;clear:both;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03994"></a><span class="lineno"> 3994</span>&#160;        echo <span class="stringliteral">&quot;&lt;div style=&#39;float:left;&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;fld_enclosed&#39;</span>].<span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l03995"></a><span class="lineno"> 3995</span>&#160;        echo <span class="stringliteral">&quot;&lt;input type=&#39;text&#39; value=&#39;\&quot;&#39; name=&#39;export_csv_fieldsenclosed&#39; style=&#39;float:right;&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l03996"></a><span class="lineno"> 3996</span>&#160;        echo <span class="stringliteral">&quot;&lt;div style=&#39;clear:both;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l03997"></a><span class="lineno"> 3997</span>&#160;        echo <span class="stringliteral">&quot;&lt;div style=&#39;float:left;&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;fld_escaped&#39;</span>].<span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l03998"></a><span class="lineno"> 3998</span>&#160;        echo <span class="stringliteral">&quot;&lt;input type=&#39;text&#39; value=&#39;\&#39; name=&#39;export_csv_fieldsescaped&#39; style=&#39;float:right;&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l03999"></a><span class="lineno"> 3999</span>&#160;        echo <span class="stringliteral">&quot;&lt;div style=&#39;clear:both;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l04000"></a><span class="lineno"> 4000</span>&#160;        echo <span class="stringliteral">&quot;&lt;div style=&#39;float:left;&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;rep_null&#39;</span>].<span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l04001"></a><span class="lineno"> 4001</span>&#160;        echo <span class="stringliteral">&quot;&lt;input type=&#39;text&#39; value=&#39;NULL&#39; name=&#39;export_csv_replacenull&#39; style=&#39;float:right;&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l04002"></a><span class="lineno"> 4002</span>&#160;        echo <span class="stringliteral">&quot;&lt;div style=&#39;clear:both;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l04003"></a><span class="lineno"> 4003</span>&#160;        echo <span class="stringliteral">&quot;&lt;label&gt;&lt;input type=&#39;checkbox&#39; name=&#39;export_csv_crlf&#39;/&gt; &quot;</span>.$lang[<span class="stringliteral">&#39;rem_crlf&#39;</span>].<span class="stringliteral">&quot;&lt;/label&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l04004"></a><span class="lineno"> 4004</span>&#160;        echo <span class="stringliteral">&quot;&lt;label&gt;&lt;input type=&#39;checkbox&#39; checked=&#39;checked&#39; name=&#39;export_csv_fieldnames&#39;/&gt; &quot;</span>.$lang[<span class="stringliteral">&#39;put_fld&#39;</span>].<span class="stringliteral">&quot;&lt;/label&gt;&quot;</span>;</div><div class="line"><a name="l04005"></a><span class="lineno"> 4005</span>&#160;        echo <span class="stringliteral">&quot;&lt;/fieldset&gt;&quot;</span>;</div><div class="line"><a name="l04006"></a><span class="lineno"> 4006</span>&#160;        </div><div class="line"><a name="l04007"></a><span class="lineno"> 4007</span>&#160;        echo <span class="stringliteral">&quot;&lt;div style=&#39;clear:both;&#39;&gt;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l04008"></a><span class="lineno"> 4008</span>&#160;        echo <span class="stringliteral">&quot;&lt;br/&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l04009"></a><span class="lineno"> 4009</span>&#160;        echo <span class="stringliteral">&quot;&lt;fieldset&gt;&lt;legend&gt;&lt;b&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;save_as&#39;</span>].<span class="stringliteral">&quot;&lt;/b&gt;&lt;/legend&gt;&quot;</span>;</div><div class="line"><a name="l04010"></a><span class="lineno"> 4010</span>&#160;        $file = pathinfo(<a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;getPath());</div><div class="line"><a name="l04011"></a><span class="lineno"> 4011</span>&#160;        $name = $file[<span class="stringliteral">&#39;filename&#39;</span>];</div><div class="line"><a name="l04012"></a><span class="lineno"> 4012</span>&#160;        echo <span class="stringliteral">&quot;&lt;input type=&#39;text&#39; name=&#39;filename&#39; value=&#39;&quot;</span>.htmlencode($name).<span class="stringliteral">&quot;_&quot;</span>.date(<span class="stringliteral">&quot;Y-m-d&quot;</span>).<span class="stringliteral">&quot;.dump&#39; style=&#39;width:400px;&#39;/&gt; &lt;input type=&#39;submit&#39; name=&#39;export&#39; value=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;export&#39;</span>].<span class="stringliteral">&quot;&#39; class=&#39;btn&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l04013"></a><span class="lineno"> 4013</span>&#160;        echo <span class="stringliteral">&quot;&lt;/fieldset&gt;&quot;</span>;</div><div class="line"><a name="l04014"></a><span class="lineno"> 4014</span>&#160;        echo <span class="stringliteral">&quot;&lt;/form&gt;&quot;</span>;</div><div class="line"><a name="l04015"></a><span class="lineno"> 4015</span>&#160;        echo <span class="stringliteral">&quot;&lt;div class=&#39;confirm&#39; style=&#39;margin-top: 2em&#39;&gt;&quot;</span>.sprintf($lang[<span class="stringliteral">&#39;backup_hint&#39;</span>], <span class="stringliteral">&quot;&lt;a href=&#39;?download=&quot;</span>.urlencode($currentDB[<span class="stringliteral">&#39;path&#39;</span>]).<span class="stringliteral">&quot;&#39; title=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;backup&#39;</span>].<span class="stringliteral">&quot;&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&quot;backup_hint_linktext&quot;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>).<span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l04016"></a><span class="lineno"> 4016</span>&#160;    }</div><div class="line"><a name="l04017"></a><span class="lineno"> 4017</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>($view==<span class="stringliteral">&quot;import&quot;</span>)</div><div class="line"><a name="l04018"></a><span class="lineno"> 4018</span>&#160;    {</div><div class="line"><a name="l04019"></a><span class="lineno"> 4019</span>&#160;        <span class="comment">//- Import view (=import)</span></div><div class="line"><a name="l04020"></a><span class="lineno"> 4020</span>&#160;        <span class="keywordflow">if</span>(isset($_POST[<span class="stringliteral">&#39;import&#39;</span>]))</div><div class="line"><a name="l04021"></a><span class="lineno"> 4021</span>&#160;        {</div><div class="line"><a name="l04022"></a><span class="lineno"> 4022</span>&#160;            echo <span class="stringliteral">&quot;&lt;div class=&#39;confirm&#39;&gt;&quot;</span>;</div><div class="line"><a name="l04023"></a><span class="lineno"> 4023</span>&#160;            <span class="keywordflow">if</span>($importSuccess===<span class="keyword">true</span>)</div><div class="line"><a name="l04024"></a><span class="lineno"> 4024</span>&#160;                echo $lang[<span class="stringliteral">&#39;import_suc&#39;</span>];</div><div class="line"><a name="l04025"></a><span class="lineno"> 4025</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l04026"></a><span class="lineno"> 4026</span>&#160;                echo $importSuccess;</div><div class="line"><a name="l04027"></a><span class="lineno"> 4027</span>&#160;            echo <span class="stringliteral">&quot;&lt;/div&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l04028"></a><span class="lineno"> 4028</span>&#160;        }</div><div class="line"><a name="l04029"></a><span class="lineno"> 4029</span>&#160;        </div><div class="line"><a name="l04030"></a><span class="lineno"> 4030</span>&#160;        echo <span class="stringliteral">&quot;&lt;form method=&#39;post&#39; action=&#39;?view=import&#39; enctype=&#39;multipart/form-data&#39;&gt;&quot;</span>;</div><div class="line"><a name="l04031"></a><span class="lineno"> 4031</span>&#160;        echo <span class="stringliteral">&quot;&lt;fieldset style=&#39;float:left; width:260px; margin-right:20px;&#39;&gt;&lt;legend&gt;&lt;b&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;import&#39;</span>].<span class="stringliteral">&quot;&lt;/b&gt;&lt;/legend&gt;&quot;</span>;</div><div class="line"><a name="l04032"></a><span class="lineno"> 4032</span>&#160;        echo <span class="stringliteral">&quot;&lt;label&gt;&lt;input type=&#39;radio&#39; name=&#39;import_type&#39; checked=&#39;checked&#39; value=&#39;sql&#39; onclick=&#39;toggleImports(\&quot;sql\&quot;);&#39;/&gt; &quot;</span>.$lang[<span class="stringliteral">&#39;sql&#39;</span>].<span class="stringliteral">&quot;&lt;/label&gt;&quot;</span>;</div><div class="line"><a name="l04033"></a><span class="lineno"> 4033</span>&#160;        echo <span class="stringliteral">&quot;&lt;br/&gt;&lt;label&gt;&lt;input type=&#39;radio&#39; name=&#39;import_type&#39; value=&#39;csv&#39; onclick=&#39;toggleImports(\&quot;csv\&quot;);&#39;/&gt; &quot;</span>.$lang[<span class="stringliteral">&#39;csv&#39;</span>].<span class="stringliteral">&quot;&lt;/label&gt;&quot;</span>;</div><div class="line"><a name="l04034"></a><span class="lineno"> 4034</span>&#160;        echo <span class="stringliteral">&quot;&lt;/fieldset&gt;&quot;</span>;</div><div class="line"><a name="l04035"></a><span class="lineno"> 4035</span>&#160;        </div><div class="line"><a name="l04036"></a><span class="lineno"> 4036</span>&#160;        echo <span class="stringliteral">&quot;&lt;fieldset style=&#39;float:left; max-width:350px;&#39; id=&#39;importoptions_sql&#39;&gt;&lt;legend&gt;&lt;b&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;options&#39;</span>].<span class="stringliteral">&quot;&lt;/b&gt;&lt;/legend&gt;&quot;</span>;</div><div class="line"><a name="l04037"></a><span class="lineno"> 4037</span>&#160;        echo $lang[<span class="stringliteral">&#39;no_opt&#39;</span>];</div><div class="line"><a name="l04038"></a><span class="lineno"> 4038</span>&#160;        echo <span class="stringliteral">&quot;&lt;/fieldset&gt;&quot;</span>;</div><div class="line"><a name="l04039"></a><span class="lineno"> 4039</span>&#160;        </div><div class="line"><a name="l04040"></a><span class="lineno"> 4040</span>&#160;        echo <span class="stringliteral">&quot;&lt;fieldset style=&#39;float:left; max-width:350px; display:none;&#39; id=&#39;importoptions_csv&#39;&gt;&lt;legend&gt;&lt;b&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;options&#39;</span>].<span class="stringliteral">&quot;&lt;/b&gt;&lt;/legend&gt;&quot;</span>;</div><div class="line"><a name="l04041"></a><span class="lineno"> 4041</span>&#160;        echo <span class="stringliteral">&quot;&lt;div style=&#39;float:left;&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;csv_tbl&#39;</span>].<span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l04042"></a><span class="lineno"> 4042</span>&#160;        echo <span class="stringliteral">&quot;&lt;select name=&#39;single_table&#39; style=&#39;float:right;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l04043"></a><span class="lineno"> 4043</span>&#160;        $query = <span class="stringliteral">&quot;SELECT name FROM sqlite_master WHERE type=&#39;table&#39; OR type=&#39;view&#39; ORDER BY name&quot;</span>;</div><div class="line"><a name="l04044"></a><span class="lineno"> 4044</span>&#160;        $result = <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;selectArray($query);</div><div class="line"><a name="l04045"></a><span class="lineno"> 4045</span>&#160;        <span class="keywordflow">for</span>($i=0; $i&lt;<span class="keyword">sizeof</span>($result); $i++)</div><div class="line"><a name="l04046"></a><span class="lineno"> 4046</span>&#160;        {</div><div class="line"><a name="l04047"></a><span class="lineno"> 4047</span>&#160;            <span class="keywordflow">if</span>(substr($result[$i][<span class="stringliteral">&#39;name&#39;</span>], 0, 7)!=<span class="stringliteral">&quot;sqlite_&quot;</span> &amp;&amp; $result[$i][<span class="stringliteral">&#39;name&#39;</span>]!=<span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l04048"></a><span class="lineno"> 4048</span>&#160;                echo <span class="stringliteral">&quot;&lt;option value=&#39;&quot;</span>.htmlencode($result[$i][<span class="stringliteral">&#39;name&#39;</span>]).<span class="stringliteral">&quot;&#39;&gt;&quot;</span>.htmlencode($result[$i][<span class="stringliteral">&#39;name&#39;</span>]).<span class="stringliteral">&quot;&lt;/option&gt;&quot;</span>;</div><div class="line"><a name="l04049"></a><span class="lineno"> 4049</span>&#160;        }</div><div class="line"><a name="l04050"></a><span class="lineno"> 4050</span>&#160;        echo <span class="stringliteral">&quot;&lt;/select&gt;&quot;</span>;</div><div class="line"><a name="l04051"></a><span class="lineno"> 4051</span>&#160;        echo <span class="stringliteral">&quot;&lt;div style=&#39;clear:both;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l04052"></a><span class="lineno"> 4052</span>&#160;        echo <span class="stringliteral">&quot;&lt;div style=&#39;float:left;&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;fld_terminated&#39;</span>].<span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l04053"></a><span class="lineno"> 4053</span>&#160;        echo <span class="stringliteral">&quot;&lt;input type=&#39;text&#39; value=&#39;;&#39; name=&#39;import_csv_fieldsterminated&#39; style=&#39;float:right;&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l04054"></a><span class="lineno"> 4054</span>&#160;        echo <span class="stringliteral">&quot;&lt;div style=&#39;clear:both;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l04055"></a><span class="lineno"> 4055</span>&#160;        echo <span class="stringliteral">&quot;&lt;div style=&#39;float:left;&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;fld_enclosed&#39;</span>].<span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l04056"></a><span class="lineno"> 4056</span>&#160;        echo <span class="stringliteral">&quot;&lt;input type=&#39;text&#39; value=&#39;\&quot;&#39; name=&#39;import_csv_fieldsenclosed&#39; style=&#39;float:right;&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l04057"></a><span class="lineno"> 4057</span>&#160;        echo <span class="stringliteral">&quot;&lt;div style=&#39;clear:both;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l04058"></a><span class="lineno"> 4058</span>&#160;        echo <span class="stringliteral">&quot;&lt;div style=&#39;float:left;&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;fld_escaped&#39;</span>].<span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l04059"></a><span class="lineno"> 4059</span>&#160;        echo <span class="stringliteral">&quot;&lt;input type=&#39;text&#39; value=&#39;\&#39; name=&#39;import_csv_fieldsescaped&#39; style=&#39;float:right;&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l04060"></a><span class="lineno"> 4060</span>&#160;        echo <span class="stringliteral">&quot;&lt;div style=&#39;clear:both;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l04061"></a><span class="lineno"> 4061</span>&#160;        echo <span class="stringliteral">&quot;&lt;div style=&#39;float:left;&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;null_represent&#39;</span>].<span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l04062"></a><span class="lineno"> 4062</span>&#160;        echo <span class="stringliteral">&quot;&lt;input type=&#39;text&#39; value=&#39;NULL&#39; name=&#39;import_csv_replacenull&#39; style=&#39;float:right;&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l04063"></a><span class="lineno"> 4063</span>&#160;        echo <span class="stringliteral">&quot;&lt;div style=&#39;clear:both;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l04064"></a><span class="lineno"> 4064</span>&#160;        echo <span class="stringliteral">&quot;&lt;label&gt;&lt;input type=&#39;checkbox&#39; checked=&#39;checked&#39; name=&#39;import_csv_fieldnames&#39;/&gt; &quot;</span>.$lang[<span class="stringliteral">&#39;fld_names&#39;</span>].<span class="stringliteral">&quot;&lt;/label&gt;&quot;</span>;</div><div class="line"><a name="l04065"></a><span class="lineno"> 4065</span>&#160;        echo <span class="stringliteral">&quot;&lt;/fieldset&gt;&quot;</span>;</div><div class="line"><a name="l04066"></a><span class="lineno"> 4066</span>&#160;        </div><div class="line"><a name="l04067"></a><span class="lineno"> 4067</span>&#160;        echo <span class="stringliteral">&quot;&lt;div style=&#39;clear:both;&#39;&gt;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l04068"></a><span class="lineno"> 4068</span>&#160;        echo <span class="stringliteral">&quot;&lt;br/&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l04069"></a><span class="lineno"> 4069</span>&#160;        </div><div class="line"><a name="l04070"></a><span class="lineno"> 4070</span>&#160;        echo <span class="stringliteral">&quot;&lt;fieldset&gt;&lt;legend&gt;&lt;b&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;import_f&#39;</span>].<span class="stringliteral">&quot;&lt;/b&gt;&lt;/legend&gt;&quot;</span>;</div><div class="line"><a name="l04071"></a><span class="lineno"> 4071</span>&#160;        echo <span class="stringliteral">&quot;&lt;input type=&#39;file&#39; value=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;choose_f&#39;</span>].<span class="stringliteral">&quot;&#39; name=&#39;file&#39; style=&#39;background-color:transparent; border-style:none;&#39;/&gt; &lt;input type=&#39;submit&#39; value=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;import&#39;</span>].<span class="stringliteral">&quot;&#39; name=&#39;import&#39; class=&#39;btn&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l04072"></a><span class="lineno"> 4072</span>&#160;        echo <span class="stringliteral">&quot;&lt;/fieldset&gt;&quot;</span>;</div><div class="line"><a name="l04073"></a><span class="lineno"> 4073</span>&#160;    }</div><div class="line"><a name="l04074"></a><span class="lineno"> 4074</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>($view==<span class="stringliteral">&quot;rename&quot;</span>)</div><div class="line"><a name="l04075"></a><span class="lineno"> 4075</span>&#160;    {</div><div class="line"><a name="l04076"></a><span class="lineno"> 4076</span>&#160;        <span class="comment">//- Rename database confirmation (=rename)</span></div><div class="line"><a name="l04077"></a><span class="lineno"> 4077</span>&#160;        <span class="keywordflow">if</span>(isset($extension_not_allowed))</div><div class="line"><a name="l04078"></a><span class="lineno"> 4078</span>&#160;        {</div><div class="line"><a name="l04079"></a><span class="lineno"> 4079</span>&#160;            echo <span class="stringliteral">&quot;&lt;div class=&#39;confirm&#39;&gt;&quot;</span>;</div><div class="line"><a name="l04080"></a><span class="lineno"> 4080</span>&#160;            echo $lang[<span class="stringliteral">&#39;extension_not_allowed&#39;</span>].<span class="stringliteral">&#39;: &#39;</span>;</div><div class="line"><a name="l04081"></a><span class="lineno"> 4081</span>&#160;            echo implode(<span class="stringliteral">&#39;, &#39;</span>, array_map(<span class="stringliteral">&#39;htmlencode&#39;</span>, $allowed_extensions));</div><div class="line"><a name="l04082"></a><span class="lineno"> 4082</span>&#160;            echo <span class="stringliteral">&#39;&lt;br /&gt;&#39;</span>.$lang[<span class="stringliteral">&#39;add_allowed_extension&#39;</span>];</div><div class="line"><a name="l04083"></a><span class="lineno"> 4083</span>&#160;            echo <span class="stringliteral">&quot;&lt;/div&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l04084"></a><span class="lineno"> 4084</span>&#160;        }</div><div class="line"><a name="l04085"></a><span class="lineno"> 4085</span>&#160;        <span class="keywordflow">if</span>(isset($dbexists))</div><div class="line"><a name="l04086"></a><span class="lineno"> 4086</span>&#160;        {</div><div class="line"><a name="l04087"></a><span class="lineno"> 4087</span>&#160;            echo <span class="stringliteral">&quot;&lt;div class=&#39;confirm&#39;&gt;&quot;</span>;</div><div class="line"><a name="l04088"></a><span class="lineno"> 4088</span>&#160;            <span class="keywordflow">if</span>($oldpath==$newpath)</div><div class="line"><a name="l04089"></a><span class="lineno"> 4089</span>&#160;                echo $lang[<span class="stringliteral">&#39;err&#39;</span>].<span class="stringliteral">&quot;: &quot;</span>.$lang[<span class="stringliteral">&#39;warn_dumbass&#39;</span>];</div><div class="line"><a name="l04090"></a><span class="lineno"> 4090</span>&#160;            <span class="keywordflow">else</span>{</div><div class="line"><a name="l04091"></a><span class="lineno"> 4091</span>&#160;                echo $lang[<span class="stringliteral">&#39;err&#39;</span>].<span class="stringliteral">&quot;: &quot;</span>; </div><div class="line"><a name="l04092"></a><span class="lineno"> 4092</span>&#160;                printf($lang[<span class="stringliteral">&#39;db_exists&#39;</span>], htmlencode($newpath));</div><div class="line"><a name="l04093"></a><span class="lineno"> 4093</span>&#160;            }</div><div class="line"><a name="l04094"></a><span class="lineno"> 4094</span>&#160;            echo <span class="stringliteral">&quot;&lt;/div&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l04095"></a><span class="lineno"> 4095</span>&#160;        }</div><div class="line"><a name="l04096"></a><span class="lineno"> 4096</span>&#160;        <span class="keywordflow">if</span>(isset($justrenamed))</div><div class="line"><a name="l04097"></a><span class="lineno"> 4097</span>&#160;        {</div><div class="line"><a name="l04098"></a><span class="lineno"> 4098</span>&#160;            echo <span class="stringliteral">&quot;&lt;div class=&#39;confirm&#39;&gt;&quot;</span>;</div><div class="line"><a name="l04099"></a><span class="lineno"> 4099</span>&#160;            printf($lang[<span class="stringliteral">&#39;db_renamed&#39;</span>], htmlencode($oldpath));</div><div class="line"><a name="l04100"></a><span class="lineno"> 4100</span>&#160;            echo <span class="stringliteral">&quot; &#39;&quot;</span>.htmlencode($newpath).<span class="stringliteral">&quot;&#39;.&quot;</span>;</div><div class="line"><a name="l04101"></a><span class="lineno"> 4101</span>&#160;            echo <span class="stringliteral">&quot;&lt;/div&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l04102"></a><span class="lineno"> 4102</span>&#160;        }</div><div class="line"><a name="l04103"></a><span class="lineno"> 4103</span>&#160;        echo <span class="stringliteral">&quot;&lt;form action=&#39;?view=rename&amp;amp;database_rename=1&#39; method=&#39;post&#39;&gt;&quot;</span>;</div><div class="line"><a name="l04104"></a><span class="lineno"> 4104</span>&#160;        echo <span class="stringliteral">&quot;&lt;input type=&#39;hidden&#39; name=&#39;oldname&#39; value=&#39;&quot;</span>.htmlencode(<a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;getPath()).<span class="stringliteral">&quot;&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l04105"></a><span class="lineno"> 4105</span>&#160;        echo $lang[<span class="stringliteral">&#39;db_rename&#39;</span>].<span class="stringliteral">&quot; &#39;&quot;</span>.htmlencode(<a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;getPath()).<span class="stringliteral">&quot;&#39; &quot;</span>.$lang[<span class="stringliteral">&#39;to&#39;</span>].<span class="stringliteral">&quot; &lt;input type=&#39;text&#39; name=&#39;newname&#39; style=&#39;width:200px;&#39; value=&#39;&quot;</span>.htmlencode(<a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;getPath()).<span class="stringliteral">&quot;&#39;/&gt; &lt;input type=&#39;submit&#39; value=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;rename&#39;</span>].<span class="stringliteral">&quot;&#39; name=&#39;rename&#39; class=&#39;btn&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l04106"></a><span class="lineno"> 4106</span>&#160;        echo <span class="stringliteral">&quot;&lt;/form&gt;&quot;</span>; </div><div class="line"><a name="l04107"></a><span class="lineno"> 4107</span>&#160;    }</div><div class="line"><a name="l04108"></a><span class="lineno"> 4108</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>($view==<span class="stringliteral">&quot;delete&quot;</span>)</div><div class="line"><a name="l04109"></a><span class="lineno"> 4109</span>&#160;    {</div><div class="line"><a name="l04110"></a><span class="lineno"> 4110</span>&#160;        <span class="comment">//- Delete database confirmation (=delete)</span></div><div class="line"><a name="l04111"></a><span class="lineno"> 4111</span>&#160;        echo <span class="stringliteral">&quot;&lt;form action=&#39;?database_delete=1&#39; method=&#39;post&#39;&gt;&quot;</span>;</div><div class="line"><a name="l04112"></a><span class="lineno"> 4112</span>&#160;        echo <span class="stringliteral">&quot;&lt;div class=&#39;confirm&#39;&gt;&quot;</span>;</div><div class="line"><a name="l04113"></a><span class="lineno"> 4113</span>&#160;        echo sprintf($lang[<span class="stringliteral">&#39;ques_del_db&#39;</span>],htmlencode(<a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;getPath())).<span class="stringliteral">&quot;&lt;br/&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l04114"></a><span class="lineno"> 4114</span>&#160;        echo <span class="stringliteral">&quot;&lt;input name=&#39;database_delete&#39; value=&#39;&quot;</span>.htmlencode(<a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;getPath()).<span class="stringliteral">&quot;&#39; type=&#39;hidden&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l04115"></a><span class="lineno"> 4115</span>&#160;        echo <span class="stringliteral">&quot;&lt;input type=&#39;submit&#39; value=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;confirm&#39;</span>].<span class="stringliteral">&quot;&#39; class=&#39;btn&#39;/&gt; &quot;</span>;</div><div class="line"><a name="l04116"></a><span class="lineno"> 4116</span>&#160;        echo <span class="stringliteral">&quot;&lt;a href=&#39;&quot;</span>.PAGE.<span class="stringliteral">&quot;&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;cancel&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;</div><div class="line"><a name="l04117"></a><span class="lineno"> 4117</span>&#160;        echo <span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l04118"></a><span class="lineno"> 4118</span>&#160;        echo <span class="stringliteral">&quot;&lt;/form&gt;&quot;</span>; </div><div class="line"><a name="l04119"></a><span class="lineno"> 4119</span>&#160;    }</div><div class="line"><a name="l04120"></a><span class="lineno"> 4120</span>&#160;</div><div class="line"><a name="l04121"></a><span class="lineno"> 4121</span>&#160;    echo <span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div><div class="line"><a name="l04122"></a><span class="lineno"> 4122</span>&#160;}</div><div class="line"><a name="l04123"></a><span class="lineno"> 4123</span>&#160;</div><div class="line"><a name="l04124"></a><span class="lineno"> 4124</span>&#160;<span class="comment">//- HTML: page footer</span></div><div class="line"><a name="l04125"></a><span class="lineno"> 4125</span>&#160;echo <span class="stringliteral">&quot;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l04126"></a><span class="lineno"> 4126</span>&#160;echo <span class="stringliteral">&quot;&lt;span style=&#39;font-size:11px;&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;powered&#39;</span>].<span class="stringliteral">&quot; &lt;a href=&#39;&quot;</span>.PROJECT_URL.<span class="stringliteral">&quot;&#39; target=&#39;_blank&#39; style=&#39;font-size:11px;&#39;&gt;&quot;</span>.PROJECT.<span class="stringliteral">&quot;&lt;/a&gt; | &quot;</span>;</div><div class="line"><a name="l04127"></a><span class="lineno"> 4127</span>&#160;echo $lang[<span class="stringliteral">&#39;free_software&#39;</span>].<span class="stringliteral">&quot; &lt;a href=&#39;&quot;</span>.DONATE_URL.<span class="stringliteral">&quot;&#39; target=&#39;_blank&#39; style=&#39;font-size:11px;&#39;&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;please_donate&#39;</span>].<span class="stringliteral">&quot;&lt;/a&gt; | &quot;</span>;</div><div class="line"><a name="l04128"></a><span class="lineno"> 4128</span>&#160;printf($lang[<span class="stringliteral">&#39;page_gen&#39;</span>], $pageTimer);</div><div class="line"><a name="l04129"></a><span class="lineno"> 4129</span>&#160;echo <span class="stringliteral">&quot;&lt;/span&gt;&quot;</span>;</div><div class="line"><a name="l04130"></a><span class="lineno"> 4130</span>&#160;echo <span class="stringliteral">&quot;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&quot;</span>;</div><div class="line"><a name="l04131"></a><span class="lineno"> 4131</span>&#160;<a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;close(); <span class="comment">//close the database</span></div><div class="line"><a name="l04132"></a><span class="lineno"> 4132</span>&#160;echo <span class="stringliteral">&quot;&lt;/body&gt;&quot;</span>;</div><div class="line"><a name="l04133"></a><span class="lineno"> 4133</span>&#160;echo <span class="stringliteral">&quot;&lt;/html&gt;&quot;</span>;</div><div class="line"><a name="l04134"></a><span class="lineno"> 4134</span>&#160;</div><div class="line"><a name="l04135"></a><span class="lineno"> 4135</span>&#160;<span class="comment">//- End of main code</span></div><div class="line"><a name="l04136"></a><span class="lineno"> 4136</span>&#160;</div><div class="line"><a name="l04137"></a><span class="lineno"> 4137</span>&#160;<span class="comment">// Authorization class</span></div><div class="line"><a name="l04138"></a><span class="lineno"> 4138</span>&#160;<span class="comment">// Maintains user&#39;s logged-in state and security of application</span></div><div class="line"><a name="l04139"></a><span class="lineno"> 4139</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l04140"></a><span class="lineno"> 4140</span>&#160;<span class="keyword">class </span>Authorization</div><div class="line"><a name="l04141"></a><span class="lineno"> 4141</span>&#160;{</div><div class="line"><a name="l04142"></a><span class="lineno"> 4142</span>&#160;    <span class="keyword">private</span> $authorized;</div><div class="line"><a name="l04143"></a><span class="lineno"> 4143</span>&#160;    <span class="keyword">private</span> $login_failed;</div><div class="line"><a name="l04144"></a><span class="lineno"> 4144</span>&#160;    <span class="keyword">private</span> $system_password_encrypted;</div><div class="line"><a name="l04145"></a><span class="lineno"> 4145</span>&#160;</div><div class="line"><a name="l04146"></a><span class="lineno"> 4146</span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> __construct()</div><div class="line"><a name="l04147"></a><span class="lineno"> 4147</span>&#160;    {</div><div class="line"><a name="l04148"></a><span class="lineno"> 4148</span>&#160;        <span class="comment">// the salt and password encrypting is probably unnecessary protection but is done just</span></div><div class="line"><a name="l04149"></a><span class="lineno"> 4149</span>&#160;        <span class="comment">// for the sake of being very secure</span></div><div class="line"><a name="l04150"></a><span class="lineno"> 4150</span>&#160;        <span class="keywordflow">if</span>(!isset($_SESSION[COOKIENAME.<span class="stringliteral">&#39;_salt&#39;</span>]) &amp;&amp; !isset($_COOKIE[COOKIENAME.<span class="stringliteral">&#39;_salt&#39;</span>]))</div><div class="line"><a name="l04151"></a><span class="lineno"> 4151</span>&#160;        {</div><div class="line"><a name="l04152"></a><span class="lineno"> 4152</span>&#160;            <span class="comment">// create a random salt for this session if a cookie doesn&#39;t already exist for it</span></div><div class="line"><a name="l04153"></a><span class="lineno"> 4153</span>&#160;            $_SESSION[COOKIENAME.<span class="stringliteral">&#39;_salt&#39;</span>] = self::generateSalt(20);</div><div class="line"><a name="l04154"></a><span class="lineno"> 4154</span>&#160;        }</div><div class="line"><a name="l04155"></a><span class="lineno"> 4155</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!isset($_SESSION[COOKIENAME.<span class="stringliteral">&#39;_salt&#39;</span>]) &amp;&amp; isset($_COOKIE[COOKIENAME.<span class="stringliteral">&#39;_salt&#39;</span>]))</div><div class="line"><a name="l04156"></a><span class="lineno"> 4156</span>&#160;        {</div><div class="line"><a name="l04157"></a><span class="lineno"> 4157</span>&#160;            <span class="comment">// session doesn&#39;t exist, but cookie does so grab it</span></div><div class="line"><a name="l04158"></a><span class="lineno"> 4158</span>&#160;            $_SESSION[COOKIENAME.<span class="stringliteral">&#39;_salt&#39;</span>] = $_COOKIE[COOKIENAME.<span class="stringliteral">&#39;_salt&#39;</span>];</div><div class="line"><a name="l04159"></a><span class="lineno"> 4159</span>&#160;        }</div><div class="line"><a name="l04160"></a><span class="lineno"> 4160</span>&#160;</div><div class="line"><a name="l04161"></a><span class="lineno"> 4161</span>&#160;        <span class="comment">// salted and encrypted password used for checking</span></div><div class="line"><a name="l04162"></a><span class="lineno"> 4162</span>&#160;        $this-&gt;system_password_encrypted = md5(SYSTEMPASSWORD.<span class="stringliteral">&quot;_&quot;</span>.$_SESSION[COOKIENAME.<span class="stringliteral">&#39;_salt&#39;</span>]);</div><div class="line"><a name="l04163"></a><span class="lineno"> 4163</span>&#160;</div><div class="line"><a name="l04164"></a><span class="lineno"> 4164</span>&#160;        $this-&gt;authorized =</div><div class="line"><a name="l04165"></a><span class="lineno"> 4165</span>&#160;            <span class="comment">// no password</span></div><div class="line"><a name="l04166"></a><span class="lineno"> 4166</span>&#160;            SYSTEMPASSWORD == <span class="stringliteral">&#39;&#39;</span></div><div class="line"><a name="l04167"></a><span class="lineno"> 4167</span>&#160;            <span class="comment">// correct password stored in session</span></div><div class="line"><a name="l04168"></a><span class="lineno"> 4168</span>&#160;            || isset($_SESSION[COOKIENAME.<span class="stringliteral">&#39;password&#39;</span>]) &amp;&amp; $_SESSION[COOKIENAME.<span class="stringliteral">&#39;password&#39;</span>] == $this-&gt;system_password_encrypted </div><div class="line"><a name="l04169"></a><span class="lineno"> 4169</span>&#160;            <span class="comment">// correct password stored in cookie</span></div><div class="line"><a name="l04170"></a><span class="lineno"> 4170</span>&#160;            || isset($_COOKIE[COOKIENAME]) &amp;&amp; isset($_COOKIE[COOKIENAME.<span class="stringliteral">&#39;_salt&#39;</span>]) &amp;&amp; md5(SYSTEMPASSWORD.<span class="stringliteral">&quot;_&quot;</span>.$_COOKIE[COOKIENAME.<span class="stringliteral">&#39;_salt&#39;</span>]) == $_COOKIE[COOKIENAME];</div><div class="line"><a name="l04171"></a><span class="lineno"> 4171</span>&#160;    }</div><div class="line"><a name="l04172"></a><span class="lineno"> 4172</span>&#160;</div><div class="line"><a name="l04173"></a><span class="lineno"> 4173</span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> attemptGrant($password, $remember)</div><div class="line"><a name="l04174"></a><span class="lineno"> 4174</span>&#160;    {</div><div class="line"><a name="l04175"></a><span class="lineno"> 4175</span>&#160;        <span class="keywordflow">if</span> ($password == SYSTEMPASSWORD) {</div><div class="line"><a name="l04176"></a><span class="lineno"> 4176</span>&#160;            <span class="keywordflow">if</span> ($remember) {</div><div class="line"><a name="l04177"></a><span class="lineno"> 4177</span>&#160;                <span class="comment">// user wants to be remembered, so set a cookie</span></div><div class="line"><a name="l04178"></a><span class="lineno"> 4178</span>&#160;                $expire = time()+60*60*24*30; <span class="comment">//set expiration to 1 month from now</span></div><div class="line"><a name="l04179"></a><span class="lineno"> 4179</span>&#160;                setcookie(COOKIENAME, $this-&gt;system_password_encrypted, $expire, null, null, null, <span class="keyword">true</span>);</div><div class="line"><a name="l04180"></a><span class="lineno"> 4180</span>&#160;                setcookie(COOKIENAME.<span class="stringliteral">&quot;_salt&quot;</span>, $_SESSION[COOKIENAME.<span class="stringliteral">&#39;_salt&#39;</span>], $expire, null, null, null, <span class="keyword">true</span>);</div><div class="line"><a name="l04181"></a><span class="lineno"> 4181</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04182"></a><span class="lineno"> 4182</span>&#160;                <span class="comment">// user does not want to be remembered, so destroy any potential cookies</span></div><div class="line"><a name="l04183"></a><span class="lineno"> 4183</span>&#160;                setcookie(COOKIENAME, <span class="stringliteral">&quot;&quot;</span>, time()-86400, null, null, null, <span class="keyword">true</span>);</div><div class="line"><a name="l04184"></a><span class="lineno"> 4184</span>&#160;                setcookie(COOKIENAME.<span class="stringliteral">&quot;_salt&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, time()-86400, null, null, null, <span class="keyword">true</span>);</div><div class="line"><a name="l04185"></a><span class="lineno"> 4185</span>&#160;                unset($_COOKIE[COOKIENAME]);</div><div class="line"><a name="l04186"></a><span class="lineno"> 4186</span>&#160;                unset($_COOKIE[COOKIENAME.<span class="stringliteral">&#39;_salt&#39;</span>]);</div><div class="line"><a name="l04187"></a><span class="lineno"> 4187</span>&#160;            }</div><div class="line"><a name="l04188"></a><span class="lineno"> 4188</span>&#160;</div><div class="line"><a name="l04189"></a><span class="lineno"> 4189</span>&#160;            $_SESSION[COOKIENAME.<span class="stringliteral">&#39;password&#39;</span>] = $this-&gt;system_password_encrypted;</div><div class="line"><a name="l04190"></a><span class="lineno"> 4190</span>&#160;            $this-&gt;authorized = <span class="keyword">true</span>;</div><div class="line"><a name="l04191"></a><span class="lineno"> 4191</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l04192"></a><span class="lineno"> 4192</span>&#160;        }</div><div class="line"><a name="l04193"></a><span class="lineno"> 4193</span>&#160;</div><div class="line"><a name="l04194"></a><span class="lineno"> 4194</span>&#160;        $this-&gt;login_failed = <span class="keyword">true</span>;</div><div class="line"><a name="l04195"></a><span class="lineno"> 4195</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l04196"></a><span class="lineno"> 4196</span>&#160;    }</div><div class="line"><a name="l04197"></a><span class="lineno"> 4197</span>&#160;</div><div class="line"><a name="l04198"></a><span class="lineno"> 4198</span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> revoke()</div><div class="line"><a name="l04199"></a><span class="lineno"> 4199</span>&#160;    {</div><div class="line"><a name="l04200"></a><span class="lineno"> 4200</span>&#160;        <span class="comment">//destroy everything - cookies and session vars</span></div><div class="line"><a name="l04201"></a><span class="lineno"> 4201</span>&#160;        setcookie(COOKIENAME, <span class="stringliteral">&quot;&quot;</span>, time()-86400, null, null, null, <span class="keyword">true</span>);</div><div class="line"><a name="l04202"></a><span class="lineno"> 4202</span>&#160;        setcookie(COOKIENAME.<span class="stringliteral">&quot;_salt&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, time()-86400, null, null, null, <span class="keyword">true</span>);</div><div class="line"><a name="l04203"></a><span class="lineno"> 4203</span>&#160;        unset($_COOKIE[COOKIENAME]);</div><div class="line"><a name="l04204"></a><span class="lineno"> 4204</span>&#160;        unset($_COOKIE[COOKIENAME.<span class="stringliteral">&#39;_salt&#39;</span>]);</div><div class="line"><a name="l04205"></a><span class="lineno"> 4205</span>&#160;        session_unset();</div><div class="line"><a name="l04206"></a><span class="lineno"> 4206</span>&#160;        session_destroy();</div><div class="line"><a name="l04207"></a><span class="lineno"> 4207</span>&#160;        $this-&gt;authorized = <span class="keyword">false</span>;</div><div class="line"><a name="l04208"></a><span class="lineno"> 4208</span>&#160;    }</div><div class="line"><a name="l04209"></a><span class="lineno"> 4209</span>&#160;</div><div class="line"><a name="l04210"></a><span class="lineno"> 4210</span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> isAuthorized()</div><div class="line"><a name="l04211"></a><span class="lineno"> 4211</span>&#160;    {</div><div class="line"><a name="l04212"></a><span class="lineno"> 4212</span>&#160;        <span class="keywordflow">return</span> $this-&gt;authorized;      </div><div class="line"><a name="l04213"></a><span class="lineno"> 4213</span>&#160;    }</div><div class="line"><a name="l04214"></a><span class="lineno"> 4214</span>&#160;</div><div class="line"><a name="l04215"></a><span class="lineno"> 4215</span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> isFailedLogin()</div><div class="line"><a name="l04216"></a><span class="lineno"> 4216</span>&#160;    {</div><div class="line"><a name="l04217"></a><span class="lineno"> 4217</span>&#160;        <span class="keywordflow">return</span> $this-&gt;login_failed;</div><div class="line"><a name="l04218"></a><span class="lineno"> 4218</span>&#160;    }</div><div class="line"><a name="l04219"></a><span class="lineno"> 4219</span>&#160;</div><div class="line"><a name="l04220"></a><span class="lineno"> 4220</span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> isPasswordDefault()</div><div class="line"><a name="l04221"></a><span class="lineno"> 4221</span>&#160;    {</div><div class="line"><a name="l04222"></a><span class="lineno"> 4222</span>&#160;        <span class="keywordflow">return</span> SYSTEMPASSWORD == <span class="stringliteral">&#39;admin&#39;</span>;</div><div class="line"><a name="l04223"></a><span class="lineno"> 4223</span>&#160;    }</div><div class="line"><a name="l04224"></a><span class="lineno"> 4224</span>&#160;</div><div class="line"><a name="l04225"></a><span class="lineno"> 4225</span>&#160;    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">function</span> generateSalt($saltSize)</div><div class="line"><a name="l04226"></a><span class="lineno"> 4226</span>&#160;    {</div><div class="line"><a name="l04227"></a><span class="lineno"> 4227</span>&#160;        $set = <span class="stringliteral">&#39;ABCDEFGHiJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789&#39;</span>;</div><div class="line"><a name="l04228"></a><span class="lineno"> 4228</span>&#160;        $setLast = strlen($set) - 1;</div><div class="line"><a name="l04229"></a><span class="lineno"> 4229</span>&#160;        $salt = <span class="stringliteral">&#39;&#39;</span>;</div><div class="line"><a name="l04230"></a><span class="lineno"> 4230</span>&#160;        <span class="keywordflow">while</span> ($saltSize-- &gt; 0) {</div><div class="line"><a name="l04231"></a><span class="lineno"> 4231</span>&#160;            $salt .= $set[mt_rand(0, $setLast)];</div><div class="line"><a name="l04232"></a><span class="lineno"> 4232</span>&#160;        }</div><div class="line"><a name="l04233"></a><span class="lineno"> 4233</span>&#160;        <span class="keywordflow">return</span> $salt;</div><div class="line"><a name="l04234"></a><span class="lineno"> 4234</span>&#160;    }</div><div class="line"><a name="l04235"></a><span class="lineno"> 4235</span>&#160;</div><div class="line"><a name="l04236"></a><span class="lineno"> 4236</span>&#160;}</div><div class="line"><a name="l04237"></a><span class="lineno"> 4237</span>&#160;<span class="comment">// Database class</span></div><div class="line"><a name="l04238"></a><span class="lineno"> 4238</span>&#160;<span class="comment">// Generic database abstraction class to manage interaction with database without worrying about SQLite vs. PHP versions</span></div><div class="line"><a name="l04239"></a><span class="lineno"> 4239</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l04240"></a><span class="lineno"> 4240</span>&#160;<span class="keyword">class </span>Database</div><div class="line"><a name="l04241"></a><span class="lineno"> 4241</span>&#160;{</div><div class="line"><a name="l04242"></a><span class="lineno"> 4242</span>&#160;    <span class="keyword">protected</span> <a class="code" href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>; <span class="comment">//reference to the DB object</span></div><div class="line"><a name="l04243"></a><span class="lineno"> 4243</span>&#160;    <span class="keyword">protected</span> $type; <span class="comment">//the extension for PHP that handles SQLite</span></div><div class="line"><a name="l04244"></a><span class="lineno"> 4244</span>&#160;    <span class="keyword">protected</span> $data;</div><div class="line"><a name="l04245"></a><span class="lineno"> 4245</span>&#160;    <span class="keyword">protected</span> $lastResult;</div><div class="line"><a name="l04246"></a><span class="lineno"> 4246</span>&#160;    <span class="keyword">protected</span> $alterError;</div><div class="line"><a name="l04247"></a><span class="lineno"> 4247</span>&#160;</div><div class="line"><a name="l04248"></a><span class="lineno"> 4248</span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> __construct($data)</div><div class="line"><a name="l04249"></a><span class="lineno"> 4249</span>&#160;    {</div><div class="line"><a name="l04250"></a><span class="lineno"> 4250</span>&#160;        global $lang;</div><div class="line"><a name="l04251"></a><span class="lineno"> 4251</span>&#160;        $this-&gt;data = $data;</div><div class="line"><a name="l04252"></a><span class="lineno"> 4252</span>&#160;        <span class="keywordflow">try</span></div><div class="line"><a name="l04253"></a><span class="lineno"> 4253</span>&#160;        {</div><div class="line"><a name="l04254"></a><span class="lineno"> 4254</span>&#160;            <span class="keywordflow">if</span>(!file_exists($this-&gt;data[<span class="stringliteral">&quot;path&quot;</span>]) &amp;&amp; !is_writable(dirname($this-&gt;data[<span class="stringliteral">&quot;path&quot;</span>]))) <span class="comment">//make sure the containing directory is writable if the database does not exist</span></div><div class="line"><a name="l04255"></a><span class="lineno"> 4255</span>&#160;            {</div><div class="line"><a name="l04256"></a><span class="lineno"> 4256</span>&#160;                echo <span class="stringliteral">&quot;&lt;div class=&#39;confirm&#39; style=&#39;margin:20px;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l04257"></a><span class="lineno"> 4257</span>&#160;                printf($lang[<span class="stringliteral">&#39;db_not_writeable&#39;</span>], htmlencode($this-&gt;data[<span class="stringliteral">&quot;path&quot;</span>]), htmlencode(dirname($this-&gt;data[<span class="stringliteral">&quot;path&quot;</span>])));</div><div class="line"><a name="l04258"></a><span class="lineno"> 4258</span>&#160;                echo <span class="stringliteral">&quot;&lt;form action=&#39;&quot;</span>.PAGE.<span class="stringliteral">&quot;&#39; method=&#39;post&#39;&gt;&quot;</span>;</div><div class="line"><a name="l04259"></a><span class="lineno"> 4259</span>&#160;                echo <span class="stringliteral">&quot;&lt;input type=&#39;submit&#39; value=&#39;Log Out&#39; name=&#39;&quot;</span>.$lang[<span class="stringliteral">&#39;logout&#39;</span>].<span class="stringliteral">&quot;&#39; class=&#39;btn&#39;/&gt;&quot;</span>;</div><div class="line"><a name="l04260"></a><span class="lineno"> 4260</span>&#160;                echo <span class="stringliteral">&quot;&lt;/form&gt;&quot;</span>;</div><div class="line"><a name="l04261"></a><span class="lineno"> 4261</span>&#160;                echo <span class="stringliteral">&quot;&lt;/div&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l04262"></a><span class="lineno"> 4262</span>&#160;                exit();</div><div class="line"><a name="l04263"></a><span class="lineno"> 4263</span>&#160;            }</div><div class="line"><a name="l04264"></a><span class="lineno"> 4264</span>&#160;</div><div class="line"><a name="l04265"></a><span class="lineno"> 4265</span>&#160;            $ver = $this-&gt;getVersion();</div><div class="line"><a name="l04266"></a><span class="lineno"> 4266</span>&#160;</div><div class="line"><a name="l04267"></a><span class="lineno"> 4267</span>&#160;            <span class="keywordflow">switch</span>(<span class="keyword">true</span>)</div><div class="line"><a name="l04268"></a><span class="lineno"> 4268</span>&#160;            {</div><div class="line"><a name="l04269"></a><span class="lineno"> 4269</span>&#160;                <span class="keywordflow">case</span> (FORCETYPE==<span class="stringliteral">&quot;PDO&quot;</span> || ((FORCETYPE==<span class="keyword">false</span> || $ver!=-1) &amp;&amp; class_exists(<span class="stringliteral">&quot;PDO&quot;</span>) &amp;&amp; ($ver==-1 || $ver==3))):</div><div class="line"><a name="l04270"></a><span class="lineno"> 4270</span>&#160;                    $this-&gt;db = <span class="keyword">new</span> PDO(<span class="stringliteral">&quot;sqlite:&quot;</span>.$this-&gt;data[<span class="stringliteral">&#39;path&#39;</span>]);</div><div class="line"><a name="l04271"></a><span class="lineno"> 4271</span>&#160;                    <span class="keywordflow">if</span>($this-&gt;db!=NULL)</div><div class="line"><a name="l04272"></a><span class="lineno"> 4272</span>&#160;                    {</div><div class="line"><a name="l04273"></a><span class="lineno"> 4273</span>&#160;                        $this-&gt;type = <span class="stringliteral">&quot;PDO&quot;</span>;</div><div class="line"><a name="l04274"></a><span class="lineno"> 4274</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l04275"></a><span class="lineno"> 4275</span>&#160;                    }</div><div class="line"><a name="l04276"></a><span class="lineno"> 4276</span>&#160;                <span class="keywordflow">case</span> (FORCETYPE==<span class="stringliteral">&quot;SQLite3&quot;</span> || ((FORCETYPE==<span class="keyword">false</span> || $ver!=-1) &amp;&amp; class_exists(<span class="stringliteral">&quot;SQLite3&quot;</span>) &amp;&amp; ($ver==-1 || $ver==3))):</div><div class="line"><a name="l04277"></a><span class="lineno"> 4277</span>&#160;                    $this-&gt;db = <span class="keyword">new</span> SQLite3($this-&gt;data[<span class="stringliteral">&#39;path&#39;</span>]);</div><div class="line"><a name="l04278"></a><span class="lineno"> 4278</span>&#160;                    <span class="keywordflow">if</span>($this-&gt;db!=NULL)</div><div class="line"><a name="l04279"></a><span class="lineno"> 4279</span>&#160;                    {</div><div class="line"><a name="l04280"></a><span class="lineno"> 4280</span>&#160;                        $this-&gt;type = <span class="stringliteral">&quot;SQLite3&quot;</span>;</div><div class="line"><a name="l04281"></a><span class="lineno"> 4281</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l04282"></a><span class="lineno"> 4282</span>&#160;                    }</div><div class="line"><a name="l04283"></a><span class="lineno"> 4283</span>&#160;                <span class="keywordflow">case</span> (FORCETYPE==<span class="stringliteral">&quot;SQLiteDatabase&quot;</span> || ((FORCETYPE==<span class="keyword">false</span> || $ver!=-1) &amp;&amp; class_exists(<span class="stringliteral">&quot;SQLiteDatabase&quot;</span>) &amp;&amp; ($ver==-1 || $ver==2))):</div><div class="line"><a name="l04284"></a><span class="lineno"> 4284</span>&#160;                    $this-&gt;db = <span class="keyword">new</span> SQLiteDatabase($this-&gt;data[<span class="stringliteral">&#39;path&#39;</span>]);</div><div class="line"><a name="l04285"></a><span class="lineno"> 4285</span>&#160;                    <span class="keywordflow">if</span>($this-&gt;db!=NULL)</div><div class="line"><a name="l04286"></a><span class="lineno"> 4286</span>&#160;                    {</div><div class="line"><a name="l04287"></a><span class="lineno"> 4287</span>&#160;                        $this-&gt;type = <span class="stringliteral">&quot;SQLiteDatabase&quot;</span>;</div><div class="line"><a name="l04288"></a><span class="lineno"> 4288</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l04289"></a><span class="lineno"> 4289</span>&#160;                    }</div><div class="line"><a name="l04290"></a><span class="lineno"> 4290</span>&#160;                <span class="keywordflow">default</span>:</div><div class="line"><a name="l04291"></a><span class="lineno"> 4291</span>&#160;                    $this-&gt;showError();</div><div class="line"><a name="l04292"></a><span class="lineno"> 4292</span>&#160;                    exit();</div><div class="line"><a name="l04293"></a><span class="lineno"> 4293</span>&#160;            }</div><div class="line"><a name="l04294"></a><span class="lineno"> 4294</span>&#160;        }</div><div class="line"><a name="l04295"></a><span class="lineno"> 4295</span>&#160;        <span class="keywordflow">catch</span>(Exception $e)</div><div class="line"><a name="l04296"></a><span class="lineno"> 4296</span>&#160;        {</div><div class="line"><a name="l04297"></a><span class="lineno"> 4297</span>&#160;            $this-&gt;showError();</div><div class="line"><a name="l04298"></a><span class="lineno"> 4298</span>&#160;            exit();</div><div class="line"><a name="l04299"></a><span class="lineno"> 4299</span>&#160;        }</div><div class="line"><a name="l04300"></a><span class="lineno"> 4300</span>&#160;    }</div><div class="line"><a name="l04301"></a><span class="lineno"> 4301</span>&#160;</div><div class="line"><a name="l04302"></a><span class="lineno"> 4302</span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> registerUserFunction($ids)</div><div class="line"><a name="l04303"></a><span class="lineno"> 4303</span>&#160;    {</div><div class="line"><a name="l04304"></a><span class="lineno"> 4304</span>&#160;        <span class="comment">// in case a single function id was passed</span></div><div class="line"><a name="l04305"></a><span class="lineno"> 4305</span>&#160;        <span class="keywordflow">if</span> (is_string($ids))</div><div class="line"><a name="l04306"></a><span class="lineno"> 4306</span>&#160;            $ids = array($ids);</div><div class="line"><a name="l04307"></a><span class="lineno"> 4307</span>&#160;</div><div class="line"><a name="l04308"></a><span class="lineno"> 4308</span>&#160;        <span class="keywordflow">if</span> ($this-&gt;type == <span class="stringliteral">&#39;PDO&#39;</span>) {</div><div class="line"><a name="l04309"></a><span class="lineno"> 4309</span>&#160;            <span class="keywordflow">foreach</span> ($ids as $id) {</div><div class="line"><a name="l04310"></a><span class="lineno"> 4310</span>&#160;                $this-&gt;db-&gt;sqliteCreateFunction($id, $id, 1);</div><div class="line"><a name="l04311"></a><span class="lineno"> 4311</span>&#160;            }</div><div class="line"><a name="l04312"></a><span class="lineno"> 4312</span>&#160;        } <span class="keywordflow">else</span> { <span class="comment">// type is Sqlite3 or SQLiteDatabase</span></div><div class="line"><a name="l04313"></a><span class="lineno"> 4313</span>&#160;            <span class="keywordflow">foreach</span> ($ids as $id) {</div><div class="line"><a name="l04314"></a><span class="lineno"> 4314</span>&#160;                $this-&gt;db-&gt;createFunction($id, $id, 1);</div><div class="line"><a name="l04315"></a><span class="lineno"> 4315</span>&#160;            }</div><div class="line"><a name="l04316"></a><span class="lineno"> 4316</span>&#160;        }</div><div class="line"><a name="l04317"></a><span class="lineno"> 4317</span>&#160;    }</div><div class="line"><a name="l04318"></a><span class="lineno"> 4318</span>&#160;    </div><div class="line"><a name="l04319"></a><span class="lineno"> 4319</span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> getError()</div><div class="line"><a name="l04320"></a><span class="lineno"> 4320</span>&#160;    {</div><div class="line"><a name="l04321"></a><span class="lineno"> 4321</span>&#160;        <span class="keywordflow">if</span>($this-&gt;alterError!=<span class="stringliteral">&#39;&#39;</span>)</div><div class="line"><a name="l04322"></a><span class="lineno"> 4322</span>&#160;        {</div><div class="line"><a name="l04323"></a><span class="lineno"> 4323</span>&#160;            $error = $this-&gt;alterError;</div><div class="line"><a name="l04324"></a><span class="lineno"> 4324</span>&#160;            $this-&gt;alterError = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l04325"></a><span class="lineno"> 4325</span>&#160;            <span class="keywordflow">return</span> $error;</div><div class="line"><a name="l04326"></a><span class="lineno"> 4326</span>&#160;        }</div><div class="line"><a name="l04327"></a><span class="lineno"> 4327</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>($this-&gt;type==<span class="stringliteral">&quot;PDO&quot;</span>)</div><div class="line"><a name="l04328"></a><span class="lineno"> 4328</span>&#160;        {</div><div class="line"><a name="l04329"></a><span class="lineno"> 4329</span>&#160;            $e = $this-&gt;db-&gt;errorInfo();</div><div class="line"><a name="l04330"></a><span class="lineno"> 4330</span>&#160;            <span class="keywordflow">return</span> $e[2];</div><div class="line"><a name="l04331"></a><span class="lineno"> 4331</span>&#160;        }</div><div class="line"><a name="l04332"></a><span class="lineno"> 4332</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>($this-&gt;type==<span class="stringliteral">&quot;SQLite3&quot;</span>)</div><div class="line"><a name="l04333"></a><span class="lineno"> 4333</span>&#160;        {</div><div class="line"><a name="l04334"></a><span class="lineno"> 4334</span>&#160;            <span class="keywordflow">return</span> $this-&gt;db-&gt;lastErrorMsg();</div><div class="line"><a name="l04335"></a><span class="lineno"> 4335</span>&#160;        }</div><div class="line"><a name="l04336"></a><span class="lineno"> 4336</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l04337"></a><span class="lineno"> 4337</span>&#160;        {</div><div class="line"><a name="l04338"></a><span class="lineno"> 4338</span>&#160;            <span class="keywordflow">return</span> sqlite_error_string($this-&gt;db-&gt;lastError());</div><div class="line"><a name="l04339"></a><span class="lineno"> 4339</span>&#160;        }</div><div class="line"><a name="l04340"></a><span class="lineno"> 4340</span>&#160;    }</div><div class="line"><a name="l04341"></a><span class="lineno"> 4341</span>&#160;    </div><div class="line"><a name="l04342"></a><span class="lineno"> 4342</span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> showError()</div><div class="line"><a name="l04343"></a><span class="lineno"> 4343</span>&#160;    {</div><div class="line"><a name="l04344"></a><span class="lineno"> 4344</span>&#160;        global $lang;</div><div class="line"><a name="l04345"></a><span class="lineno"> 4345</span>&#160;        $classPDO = class_exists(<span class="stringliteral">&quot;PDO&quot;</span>);</div><div class="line"><a name="l04346"></a><span class="lineno"> 4346</span>&#160;        $classSQLite3 = class_exists(<span class="stringliteral">&quot;SQLite3&quot;</span>);</div><div class="line"><a name="l04347"></a><span class="lineno"> 4347</span>&#160;        $classSQLiteDatabase = class_exists(<span class="stringliteral">&quot;SQLiteDatabase&quot;</span>);</div><div class="line"><a name="l04348"></a><span class="lineno"> 4348</span>&#160;        <span class="keywordflow">if</span>($classPDO)   <span class="comment">// PDO is there, check if the SQLite driver for PDO is missing</span></div><div class="line"><a name="l04349"></a><span class="lineno"> 4349</span>&#160;            $PDOSqliteDriver = (in_array(<span class="stringliteral">&quot;sqlite&quot;</span>, PDO::getAvailableDrivers() ));</div><div class="line"><a name="l04350"></a><span class="lineno"> 4350</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l04351"></a><span class="lineno"> 4351</span>&#160;            $PDOSqliteDriver = <span class="keyword">false</span>;</div><div class="line"><a name="l04352"></a><span class="lineno"> 4352</span>&#160;        echo <span class="stringliteral">&quot;&lt;div class=&#39;confirm&#39; style=&#39;margin:20px;&#39;&gt;&quot;</span>;</div><div class="line"><a name="l04353"></a><span class="lineno"> 4353</span>&#160;        printf($lang[<span class="stringliteral">&#39;db_setup&#39;</span>], $this-&gt;getPath());</div><div class="line"><a name="l04354"></a><span class="lineno"> 4354</span>&#160;        echo <span class="stringliteral">&quot;.&lt;br/&gt;&lt;br/&gt;&lt;i&gt;&quot;</span>.$lang[<span class="stringliteral">&#39;chk_ext&#39;</span>].<span class="stringliteral">&quot;...&lt;br/&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l04355"></a><span class="lineno"> 4355</span>&#160;        echo <span class="stringliteral">&quot;&lt;b&gt;PDO&lt;/b&gt;: &quot;</span>.($classPDO ? $lang[<span class="stringliteral">&#39;installed&#39;</span>] : $lang[<span class="stringliteral">&#39;not_installed&#39;</span>]).<span class="stringliteral">&quot;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l04356"></a><span class="lineno"> 4356</span>&#160;        echo <span class="stringliteral">&quot;&lt;b&gt;PDO SQLite Driver&lt;/b&gt;: &quot;</span>.($PDOSqliteDriver ? $lang[<span class="stringliteral">&#39;installed&#39;</span>] : $lang[<span class="stringliteral">&#39;not_installed&#39;</span>]).<span class="stringliteral">&quot;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l04357"></a><span class="lineno"> 4357</span>&#160;        echo <span class="stringliteral">&quot;&lt;b&gt;SQLite3&lt;/b&gt;: &quot;</span>.($classSQLite3 ? $lang[<span class="stringliteral">&#39;installed&#39;</span>] : $lang[<span class="stringliteral">&#39;not_installed&#39;</span>]).<span class="stringliteral">&quot;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l04358"></a><span class="lineno"> 4358</span>&#160;        echo <span class="stringliteral">&quot;&lt;b&gt;SQLiteDatabase&lt;/b&gt;: &quot;</span>.($classSQLiteDatabase ? $lang[<span class="stringliteral">&#39;installed&#39;</span>] : $lang[<span class="stringliteral">&#39;not_installed&#39;</span>]).<span class="stringliteral">&quot;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l04359"></a><span class="lineno"> 4359</span>&#160;        echo <span class="stringliteral">&quot;&lt;br/&gt;...&quot;</span>.$lang[<span class="stringliteral">&#39;done&#39;</span>].<span class="stringliteral">&quot;.&lt;/i&gt;&lt;br/&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l04360"></a><span class="lineno"> 4360</span>&#160;        <span class="keywordflow">if</span>(!$classPDO &amp;&amp; !$classSQLite3 &amp;&amp; !$classSQLiteDatabase)</div><div class="line"><a name="l04361"></a><span class="lineno"> 4361</span>&#160;            printf($lang[<span class="stringliteral">&#39;sqlite_ext_support&#39;</span>], PROJECT);</div><div class="line"><a name="l04362"></a><span class="lineno"> 4362</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l04363"></a><span class="lineno"> 4363</span>&#160;        {</div><div class="line"><a name="l04364"></a><span class="lineno"> 4364</span>&#160;            <span class="keywordflow">if</span>(!$classPDO &amp;&amp; !$classSQLite3 &amp;&amp; $this-&gt;getVersion()==3)</div><div class="line"><a name="l04365"></a><span class="lineno"> 4365</span>&#160;                printf($lang[<span class="stringliteral">&#39;sqlite_v_error&#39;</span>], 3, PROJECT, 2);</div><div class="line"><a name="l04366"></a><span class="lineno"> 4366</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!$classSQLiteDatabase &amp;&amp; $this-&gt;getVersion()==2)</div><div class="line"><a name="l04367"></a><span class="lineno"> 4367</span>&#160;                printf($lang[<span class="stringliteral">&#39;sqlite_v_error&#39;</span>], 2, PROJECT, 3);</div><div class="line"><a name="l04368"></a><span class="lineno"> 4368</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l04369"></a><span class="lineno"> 4369</span>&#160;                echo $lang[<span class="stringliteral">&#39;report_issue&#39;</span>].<span class="charliteral">&#39; &#39;</span>.PROJECT_BUGTRACKER_LINK.<span class="charliteral">&#39;.&#39;</span>;</div><div class="line"><a name="l04370"></a><span class="lineno"> 4370</span>&#160;        }</div><div class="line"><a name="l04371"></a><span class="lineno"> 4371</span>&#160;        echo <span class="stringliteral">&quot;&lt;br /&gt;See &quot;</span>.PROJECT_INSTALL_LINK.<span class="stringliteral">&quot; for help.&quot;</span>;</div><div class="line"><a name="l04372"></a><span class="lineno"> 4372</span>&#160;        echo <span class="stringliteral">&quot;&lt;/div&gt;&lt;br/&gt;&quot;</span>;</div><div class="line"><a name="l04373"></a><span class="lineno"> 4373</span>&#160;    }</div><div class="line"><a name="l04374"></a><span class="lineno"> 4374</span>&#160;</div><div class="line"><a name="l04375"></a><span class="lineno"> 4375</span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> __destruct()</div><div class="line"><a name="l04376"></a><span class="lineno"> 4376</span>&#160;    {</div><div class="line"><a name="l04377"></a><span class="lineno"> 4377</span>&#160;        <span class="keywordflow">if</span>($this-&gt;db)</div><div class="line"><a name="l04378"></a><span class="lineno"> 4378</span>&#160;            $this-&gt;close();</div><div class="line"><a name="l04379"></a><span class="lineno"> 4379</span>&#160;    }</div><div class="line"><a name="l04380"></a><span class="lineno"> 4380</span>&#160;</div><div class="line"><a name="l04381"></a><span class="lineno"> 4381</span>&#160;    <span class="comment">//get the exact PHP extension being used for SQLite</span></div><div class="line"><a name="l04382"></a><span class="lineno"> 4382</span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> getType()</div><div class="line"><a name="l04383"></a><span class="lineno"> 4383</span>&#160;    {</div><div class="line"><a name="l04384"></a><span class="lineno"> 4384</span>&#160;        <span class="keywordflow">return</span> $this-&gt;type;</div><div class="line"><a name="l04385"></a><span class="lineno"> 4385</span>&#160;    }</div><div class="line"><a name="l04386"></a><span class="lineno"> 4386</span>&#160;</div><div class="line"><a name="l04387"></a><span class="lineno"> 4387</span>&#160;    <span class="comment">//get the name of the database</span></div><div class="line"><a name="l04388"></a><span class="lineno"> 4388</span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> getName()</div><div class="line"><a name="l04389"></a><span class="lineno"> 4389</span>&#160;    {</div><div class="line"><a name="l04390"></a><span class="lineno"> 4390</span>&#160;        <span class="keywordflow">return</span> $this-&gt;data[<span class="stringliteral">&quot;name&quot;</span>];</div><div class="line"><a name="l04391"></a><span class="lineno"> 4391</span>&#160;    }</div><div class="line"><a name="l04392"></a><span class="lineno"> 4392</span>&#160;</div><div class="line"><a name="l04393"></a><span class="lineno"> 4393</span>&#160;    <span class="comment">//get the filename of the database</span></div><div class="line"><a name="l04394"></a><span class="lineno"> 4394</span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> getPath()</div><div class="line"><a name="l04395"></a><span class="lineno"> 4395</span>&#160;    {</div><div class="line"><a name="l04396"></a><span class="lineno"> 4396</span>&#160;        <span class="keywordflow">return</span> $this-&gt;data[<span class="stringliteral">&quot;path&quot;</span>];</div><div class="line"><a name="l04397"></a><span class="lineno"> 4397</span>&#160;    }</div><div class="line"><a name="l04398"></a><span class="lineno"> 4398</span>&#160;</div><div class="line"><a name="l04399"></a><span class="lineno"> 4399</span>&#160;    <span class="comment">//is the db-file writable?</span></div><div class="line"><a name="l04400"></a><span class="lineno"> 4400</span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> isWritable()</div><div class="line"><a name="l04401"></a><span class="lineno"> 4401</span>&#160;    {</div><div class="line"><a name="l04402"></a><span class="lineno"> 4402</span>&#160;        <span class="keywordflow">return</span> $this-&gt;data[<span class="stringliteral">&quot;writable&quot;</span>];</div><div class="line"><a name="l04403"></a><span class="lineno"> 4403</span>&#160;    }</div><div class="line"><a name="l04404"></a><span class="lineno"> 4404</span>&#160;</div><div class="line"><a name="l04405"></a><span class="lineno"> 4405</span>&#160;    <span class="comment">//is the db-folder writable?</span></div><div class="line"><a name="l04406"></a><span class="lineno"> 4406</span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> isDirWritable()</div><div class="line"><a name="l04407"></a><span class="lineno"> 4407</span>&#160;    {</div><div class="line"><a name="l04408"></a><span class="lineno"> 4408</span>&#160;        <span class="keywordflow">return</span> $this-&gt;data[<span class="stringliteral">&quot;writable_dir&quot;</span>];</div><div class="line"><a name="l04409"></a><span class="lineno"> 4409</span>&#160;    }</div><div class="line"><a name="l04410"></a><span class="lineno"> 4410</span>&#160;</div><div class="line"><a name="l04411"></a><span class="lineno"> 4411</span>&#160;    <span class="comment">//get the version of the database</span></div><div class="line"><a name="l04412"></a><span class="lineno"> 4412</span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> getVersion()</div><div class="line"><a name="l04413"></a><span class="lineno"> 4413</span>&#160;    {</div><div class="line"><a name="l04414"></a><span class="lineno"> 4414</span>&#160;        <span class="keywordflow">if</span>(file_exists($this-&gt;data[<span class="stringliteral">&#39;path&#39;</span>])) <span class="comment">//make sure file exists before getting its contents</span></div><div class="line"><a name="l04415"></a><span class="lineno"> 4415</span>&#160;        {</div><div class="line"><a name="l04416"></a><span class="lineno"> 4416</span>&#160;            $content = strtolower(file_get_contents($this-&gt;data[<span class="stringliteral">&#39;path&#39;</span>], NULL, NULL, 0, 40)); <span class="comment">//get the first 40 characters of the database file</span></div><div class="line"><a name="l04417"></a><span class="lineno"> 4417</span>&#160;            $p = strpos($content, <span class="stringliteral">&quot;** this file contains an sqlite 2&quot;</span>); <span class="comment">//this text is at the beginning of every SQLite2 database</span></div><div class="line"><a name="l04418"></a><span class="lineno"> 4418</span>&#160;            <span class="keywordflow">if</span>($p!==<span class="keyword">false</span>) <span class="comment">//the text is found - this is version 2</span></div><div class="line"><a name="l04419"></a><span class="lineno"> 4419</span>&#160;                <span class="keywordflow">return</span> 2;</div><div class="line"><a name="l04420"></a><span class="lineno"> 4420</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l04421"></a><span class="lineno"> 4421</span>&#160;                <span class="keywordflow">return</span> 3;</div><div class="line"><a name="l04422"></a><span class="lineno"> 4422</span>&#160;        }</div><div class="line"><a name="l04423"></a><span class="lineno"> 4423</span>&#160;        <span class="keywordflow">else</span> <span class="comment">//return -1 to indicate that it does not exist and needs to be created</span></div><div class="line"><a name="l04424"></a><span class="lineno"> 4424</span>&#160;        {</div><div class="line"><a name="l04425"></a><span class="lineno"> 4425</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l04426"></a><span class="lineno"> 4426</span>&#160;        }</div><div class="line"><a name="l04427"></a><span class="lineno"> 4427</span>&#160;    }</div><div class="line"><a name="l04428"></a><span class="lineno"> 4428</span>&#160;</div><div class="line"><a name="l04429"></a><span class="lineno"> 4429</span>&#160;    <span class="comment">//get the size of the database (in KB)</span></div><div class="line"><a name="l04430"></a><span class="lineno"> 4430</span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> getSize()</div><div class="line"><a name="l04431"></a><span class="lineno"> 4431</span>&#160;    {</div><div class="line"><a name="l04432"></a><span class="lineno"> 4432</span>&#160;        <span class="keywordflow">return</span> round(filesize($this-&gt;data[<span class="stringliteral">&quot;path&quot;</span>])*0.0009765625, 1);</div><div class="line"><a name="l04433"></a><span class="lineno"> 4433</span>&#160;    }</div><div class="line"><a name="l04434"></a><span class="lineno"> 4434</span>&#160;</div><div class="line"><a name="l04435"></a><span class="lineno"> 4435</span>&#160;    <span class="comment">//get the last modified time of database</span></div><div class="line"><a name="l04436"></a><span class="lineno"> 4436</span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> getDate()</div><div class="line"><a name="l04437"></a><span class="lineno"> 4437</span>&#160;    {</div><div class="line"><a name="l04438"></a><span class="lineno"> 4438</span>&#160;        global $lang;</div><div class="line"><a name="l04439"></a><span class="lineno"> 4439</span>&#160;        <span class="keywordflow">return</span> date($lang[<span class="stringliteral">&#39;date_format&#39;</span>], filemtime($this-&gt;data[<span class="stringliteral">&#39;path&#39;</span>]));</div><div class="line"><a name="l04440"></a><span class="lineno"> 4440</span>&#160;    }</div><div class="line"><a name="l04441"></a><span class="lineno"> 4441</span>&#160;</div><div class="line"><a name="l04442"></a><span class="lineno"> 4442</span>&#160;    <span class="comment">//get number of affected rows from last query</span></div><div class="line"><a name="l04443"></a><span class="lineno"> 4443</span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> getAffectedRows()</div><div class="line"><a name="l04444"></a><span class="lineno"> 4444</span>&#160;    {</div><div class="line"><a name="l04445"></a><span class="lineno"> 4445</span>&#160;        <span class="keywordflow">if</span>($this-&gt;type==<span class="stringliteral">&quot;PDO&quot;</span>)</div><div class="line"><a name="l04446"></a><span class="lineno"> 4446</span>&#160;            <span class="keywordflow">if</span>(!is_object($this-&gt;lastResult))</div><div class="line"><a name="l04447"></a><span class="lineno"> 4447</span>&#160;                <span class="comment">// in case it was an alter table statement, there is no lastResult object</span></div><div class="line"><a name="l04448"></a><span class="lineno"> 4448</span>&#160;                <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04449"></a><span class="lineno"> 4449</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l04450"></a><span class="lineno"> 4450</span>&#160;                <span class="keywordflow">return</span> $this-&gt;lastResult-&gt;rowCount();</div><div class="line"><a name="l04451"></a><span class="lineno"> 4451</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>($this-&gt;type==<span class="stringliteral">&quot;SQLite3&quot;</span>)</div><div class="line"><a name="l04452"></a><span class="lineno"> 4452</span>&#160;            <span class="keywordflow">return</span> $this-&gt;db-&gt;changes();</div><div class="line"><a name="l04453"></a><span class="lineno"> 4453</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>($this-&gt;type==<span class="stringliteral">&quot;SQLiteDatabase&quot;</span>)</div><div class="line"><a name="l04454"></a><span class="lineno"> 4454</span>&#160;            <span class="keywordflow">return</span> $this-&gt;db-&gt;changes();</div><div class="line"><a name="l04455"></a><span class="lineno"> 4455</span>&#160;    }</div><div class="line"><a name="l04456"></a><span class="lineno"> 4456</span>&#160;</div><div class="line"><a name="l04457"></a><span class="lineno"> 4457</span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> getTypeOfTable($table)</div><div class="line"><a name="l04458"></a><span class="lineno"> 4458</span>&#160;    {</div><div class="line"><a name="l04459"></a><span class="lineno"> 4459</span>&#160;        $result = $this-&gt;select(<span class="stringliteral">&quot;SELECT `type` FROM `sqlite_master` WHERE `name`=&quot;</span> . $this-&gt;quote($table), <span class="stringliteral">&#39;assoc&#39;</span>);</div><div class="line"><a name="l04460"></a><span class="lineno"> 4460</span>&#160;        <span class="keywordflow">return</span> $result[<span class="stringliteral">&#39;type&#39;</span>];</div><div class="line"><a name="l04461"></a><span class="lineno"> 4461</span>&#160;    }</div><div class="line"><a name="l04462"></a><span class="lineno"> 4462</span>&#160;</div><div class="line"><a name="l04463"></a><span class="lineno"> 4463</span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> close()</div><div class="line"><a name="l04464"></a><span class="lineno"> 4464</span>&#160;    {</div><div class="line"><a name="l04465"></a><span class="lineno"> 4465</span>&#160;        <span class="keywordflow">if</span>($this-&gt;type==<span class="stringliteral">&quot;PDO&quot;</span>)</div><div class="line"><a name="l04466"></a><span class="lineno"> 4466</span>&#160;            $this-&gt;db = NULL;</div><div class="line"><a name="l04467"></a><span class="lineno"> 4467</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>($this-&gt;type==<span class="stringliteral">&quot;SQLite3&quot;</span>)</div><div class="line"><a name="l04468"></a><span class="lineno"> 4468</span>&#160;            $this-&gt;db-&gt;close();</div><div class="line"><a name="l04469"></a><span class="lineno"> 4469</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>($this-&gt;type==<span class="stringliteral">&quot;SQLiteDatabase&quot;</span>)</div><div class="line"><a name="l04470"></a><span class="lineno"> 4470</span>&#160;            $this-&gt;db = NULL;</div><div class="line"><a name="l04471"></a><span class="lineno"> 4471</span>&#160;    }</div><div class="line"><a name="l04472"></a><span class="lineno"> 4472</span>&#160;</div><div class="line"><a name="l04473"></a><span class="lineno"> 4473</span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> beginTransaction()</div><div class="line"><a name="l04474"></a><span class="lineno"> 4474</span>&#160;    {</div><div class="line"><a name="l04475"></a><span class="lineno"> 4475</span>&#160;        $this-&gt;query(<span class="stringliteral">&quot;BEGIN&quot;</span>);</div><div class="line"><a name="l04476"></a><span class="lineno"> 4476</span>&#160;    }</div><div class="line"><a name="l04477"></a><span class="lineno"> 4477</span>&#160;</div><div class="line"><a name="l04478"></a><span class="lineno"> 4478</span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> commitTransaction()</div><div class="line"><a name="l04479"></a><span class="lineno"> 4479</span>&#160;    {</div><div class="line"><a name="l04480"></a><span class="lineno"> 4480</span>&#160;        $this-&gt;query(<span class="stringliteral">&quot;COMMIT&quot;</span>);</div><div class="line"><a name="l04481"></a><span class="lineno"> 4481</span>&#160;    }</div><div class="line"><a name="l04482"></a><span class="lineno"> 4482</span>&#160;</div><div class="line"><a name="l04483"></a><span class="lineno"> 4483</span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> rollbackTransaction()</div><div class="line"><a name="l04484"></a><span class="lineno"> 4484</span>&#160;    {</div><div class="line"><a name="l04485"></a><span class="lineno"> 4485</span>&#160;        $this-&gt;query(<span class="stringliteral">&quot;ROLLBACK&quot;</span>);</div><div class="line"><a name="l04486"></a><span class="lineno"> 4486</span>&#160;    }</div><div class="line"><a name="l04487"></a><span class="lineno"> 4487</span>&#160;</div><div class="line"><a name="l04488"></a><span class="lineno"> 4488</span>&#160;    <span class="comment">//generic query wrapper</span></div><div class="line"><a name="l04489"></a><span class="lineno"> 4489</span>&#160;    <span class="comment">//returns false on error and the query result on success</span></div><div class="line"><a name="l04490"></a><span class="lineno"> 4490</span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> query($query, $ignoreAlterCase=<span class="keyword">false</span>)</div><div class="line"><a name="l04491"></a><span class="lineno"> 4491</span>&#160;    {</div><div class="line"><a name="l04492"></a><span class="lineno"> 4492</span>&#160;        global $debug;</div><div class="line"><a name="l04493"></a><span class="lineno"> 4493</span>&#160;        <span class="keywordflow">if</span>(strtolower(substr(ltrim($query),0,5))==<span class="stringliteral">&#39;alter&#39;</span> &amp;&amp; $ignoreAlterCase==<span class="keyword">false</span>) <span class="comment">//this query is an ALTER query - call the necessary function</span></div><div class="line"><a name="l04494"></a><span class="lineno"> 4494</span>&#160;        {</div><div class="line"><a name="l04495"></a><span class="lineno"> 4495</span>&#160;            preg_match(<span class="stringliteral">&quot;/^\s*ALTER\s+TABLE\s+\&quot;((?:[^\&quot;]|\&quot;\&quot;)+)\&quot;\s+(.*)$/i&quot;</span>,$query,$matches);</div><div class="line"><a name="l04496"></a><span class="lineno"> 4496</span>&#160;            <span class="keywordflow">if</span>(!isset($matches[1]) || !isset($matches[2]))</div><div class="line"><a name="l04497"></a><span class="lineno"> 4497</span>&#160;            {</div><div class="line"><a name="l04498"></a><span class="lineno"> 4498</span>&#160;                <span class="keywordflow">if</span>($debug) echo <span class="stringliteral">&quot;&lt;span title=&#39;&quot;</span>.htmlencode($query).<span class="stringliteral">&quot;&#39; onclick=&#39;this.innerHTML=\&quot;&quot;</span>.htmlencode(str_replace(<span class="charliteral">&#39;&quot;&#39;</span>,<span class="charliteral">&#39;\&quot;&#39;</span>,$query)).<span class="stringliteral">&quot;\&quot;&#39; style=&#39;cursor:pointer&#39;&gt;SQL?&lt;/span&gt;&lt;br /&gt;&quot;</span>;</div><div class="line"><a name="l04499"></a><span class="lineno"> 4499</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l04500"></a><span class="lineno"> 4500</span>&#160;            }</div><div class="line"><a name="l04501"></a><span class="lineno"> 4501</span>&#160;            $tablename = str_replace(<span class="stringliteral">&#39;&quot;&quot;&#39;</span>,<span class="charliteral">&#39;&quot;&#39;</span>,$matches[1]);</div><div class="line"><a name="l04502"></a><span class="lineno"> 4502</span>&#160;            $alterdefs = $matches[2];</div><div class="line"><a name="l04503"></a><span class="lineno"> 4503</span>&#160;            <span class="keywordflow">if</span>($debug) echo <span class="stringliteral">&quot;ALTER TABLE QUERY=(&quot;</span>.htmlencode($query).<span class="stringliteral">&quot;), tablename=($tablename), alterdefs=($alterdefs)&lt;hr&gt;&quot;</span>;</div><div class="line"><a name="l04504"></a><span class="lineno"> 4504</span>&#160;            $result = $this-&gt;alterTable($tablename, $alterdefs);</div><div class="line"><a name="l04505"></a><span class="lineno"> 4505</span>&#160;        }</div><div class="line"><a name="l04506"></a><span class="lineno"> 4506</span>&#160;        <span class="keywordflow">else</span> <span class="comment">//this query is normal - proceed as normal</span></div><div class="line"><a name="l04507"></a><span class="lineno"> 4507</span>&#160;        {</div><div class="line"><a name="l04508"></a><span class="lineno"> 4508</span>&#160;            $result = $this-&gt;db-&gt;query($query);</div><div class="line"><a name="l04509"></a><span class="lineno"> 4509</span>&#160;            <span class="keywordflow">if</span>($debug) echo <span class="stringliteral">&quot;&lt;span title=&#39;&quot;</span>.htmlencode($query).<span class="stringliteral">&quot;&#39; onclick=&#39;this.innerHTML=\&quot;&quot;</span>.htmlencode(str_replace(<span class="charliteral">&#39;&quot;&#39;</span>,<span class="charliteral">&#39;\&quot;&#39;</span>,$query)).<span class="stringliteral">&quot;\&quot;&#39; style=&#39;cursor:pointer&#39;&gt;SQL?&lt;/span&gt;&lt;br /&gt;&quot;</span>;</div><div class="line"><a name="l04510"></a><span class="lineno"> 4510</span>&#160;        }</div><div class="line"><a name="l04511"></a><span class="lineno"> 4511</span>&#160;        <span class="keywordflow">if</span>($result===<span class="keyword">false</span>)</div><div class="line"><a name="l04512"></a><span class="lineno"> 4512</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l04513"></a><span class="lineno"> 4513</span>&#160;        $this-&gt;lastResult = $result;</div><div class="line"><a name="l04514"></a><span class="lineno"> 4514</span>&#160;        <span class="keywordflow">return</span> $result;</div><div class="line"><a name="l04515"></a><span class="lineno"> 4515</span>&#160;    }</div><div class="line"><a name="l04516"></a><span class="lineno"> 4516</span>&#160;</div><div class="line"><a name="l04517"></a><span class="lineno"> 4517</span>&#160;    <span class="comment">//wrapper for an INSERT and returns the ID of the inserted row</span></div><div class="line"><a name="l04518"></a><span class="lineno"> 4518</span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> insert($query)</div><div class="line"><a name="l04519"></a><span class="lineno"> 4519</span>&#160;    {</div><div class="line"><a name="l04520"></a><span class="lineno"> 4520</span>&#160;        $result = $this-&gt;query($query);</div><div class="line"><a name="l04521"></a><span class="lineno"> 4521</span>&#160;        <span class="keywordflow">if</span>($this-&gt;type==<span class="stringliteral">&quot;PDO&quot;</span>)</div><div class="line"><a name="l04522"></a><span class="lineno"> 4522</span>&#160;            <span class="keywordflow">return</span> $this-&gt;db-&gt;lastInsertId();</div><div class="line"><a name="l04523"></a><span class="lineno"> 4523</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>($this-&gt;type==<span class="stringliteral">&quot;SQLite3&quot;</span>)</div><div class="line"><a name="l04524"></a><span class="lineno"> 4524</span>&#160;            <span class="keywordflow">return</span> $this-&gt;db-&gt;lastInsertRowID();</div><div class="line"><a name="l04525"></a><span class="lineno"> 4525</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>($this-&gt;type==<span class="stringliteral">&quot;SQLiteDatabase&quot;</span>)</div><div class="line"><a name="l04526"></a><span class="lineno"> 4526</span>&#160;            <span class="keywordflow">return</span> $this-&gt;db-&gt;lastInsertRowid();</div><div class="line"><a name="l04527"></a><span class="lineno"> 4527</span>&#160;    }</div><div class="line"><a name="l04528"></a><span class="lineno"> 4528</span>&#160;</div><div class="line"><a name="l04529"></a><span class="lineno"> 4529</span>&#160;    <span class="comment">//returns an array for SELECT</span></div><div class="line"><a name="l04530"></a><span class="lineno"> 4530</span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> select($query, $mode=<span class="stringliteral">&quot;both&quot;</span>)</div><div class="line"><a name="l04531"></a><span class="lineno"> 4531</span>&#160;    {</div><div class="line"><a name="l04532"></a><span class="lineno"> 4532</span>&#160;        $result = $this-&gt;query($query);</div><div class="line"><a name="l04533"></a><span class="lineno"> 4533</span>&#160;        <span class="keywordflow">if</span>(!$result) <span class="comment">//make sure the result is valid</span></div><div class="line"><a name="l04534"></a><span class="lineno"> 4534</span>&#160;            <span class="keywordflow">return</span> NULL;</div><div class="line"><a name="l04535"></a><span class="lineno"> 4535</span>&#160;        <span class="keywordflow">if</span>($this-&gt;type==<span class="stringliteral">&quot;PDO&quot;</span>)</div><div class="line"><a name="l04536"></a><span class="lineno"> 4536</span>&#160;        {</div><div class="line"><a name="l04537"></a><span class="lineno"> 4537</span>&#160;            <span class="keywordflow">if</span>($mode==<span class="stringliteral">&quot;assoc&quot;</span>)</div><div class="line"><a name="l04538"></a><span class="lineno"> 4538</span>&#160;                $mode = PDO::FETCH_ASSOC;</div><div class="line"><a name="l04539"></a><span class="lineno"> 4539</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span>($mode==<span class="stringliteral">&quot;num&quot;</span>)</div><div class="line"><a name="l04540"></a><span class="lineno"> 4540</span>&#160;                $mode = PDO::FETCH_NUM;</div><div class="line"><a name="l04541"></a><span class="lineno"> 4541</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l04542"></a><span class="lineno"> 4542</span>&#160;                $mode = PDO::FETCH_BOTH;</div><div class="line"><a name="l04543"></a><span class="lineno"> 4543</span>&#160;            <span class="keywordflow">return</span> $result-&gt;fetch($mode);</div><div class="line"><a name="l04544"></a><span class="lineno"> 4544</span>&#160;        }</div><div class="line"><a name="l04545"></a><span class="lineno"> 4545</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>($this-&gt;type==<span class="stringliteral">&quot;SQLite3&quot;</span>)</div><div class="line"><a name="l04546"></a><span class="lineno"> 4546</span>&#160;        {</div><div class="line"><a name="l04547"></a><span class="lineno"> 4547</span>&#160;            <span class="keywordflow">if</span>($mode==<span class="stringliteral">&quot;assoc&quot;</span>)</div><div class="line"><a name="l04548"></a><span class="lineno"> 4548</span>&#160;                $mode = SQLITE3_ASSOC;</div><div class="line"><a name="l04549"></a><span class="lineno"> 4549</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span>($mode==<span class="stringliteral">&quot;num&quot;</span>)</div><div class="line"><a name="l04550"></a><span class="lineno"> 4550</span>&#160;                $mode = SQLITE3_NUM;</div><div class="line"><a name="l04551"></a><span class="lineno"> 4551</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l04552"></a><span class="lineno"> 4552</span>&#160;                $mode = SQLITE3_BOTH;</div><div class="line"><a name="l04553"></a><span class="lineno"> 4553</span>&#160;            <span class="keywordflow">return</span> $result-&gt;fetchArray($mode);</div><div class="line"><a name="l04554"></a><span class="lineno"> 4554</span>&#160;        }</div><div class="line"><a name="l04555"></a><span class="lineno"> 4555</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>($this-&gt;type==<span class="stringliteral">&quot;SQLiteDatabase&quot;</span>)</div><div class="line"><a name="l04556"></a><span class="lineno"> 4556</span>&#160;        {</div><div class="line"><a name="l04557"></a><span class="lineno"> 4557</span>&#160;            <span class="keywordflow">if</span>($mode==<span class="stringliteral">&quot;assoc&quot;</span>)</div><div class="line"><a name="l04558"></a><span class="lineno"> 4558</span>&#160;                $mode = SQLITE_ASSOC;</div><div class="line"><a name="l04559"></a><span class="lineno"> 4559</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span>($mode==<span class="stringliteral">&quot;num&quot;</span>)</div><div class="line"><a name="l04560"></a><span class="lineno"> 4560</span>&#160;                $mode = SQLITE_NUM;</div><div class="line"><a name="l04561"></a><span class="lineno"> 4561</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l04562"></a><span class="lineno"> 4562</span>&#160;                $mode = SQLITE_BOTH;</div><div class="line"><a name="l04563"></a><span class="lineno"> 4563</span>&#160;            <span class="keywordflow">return</span> $result-&gt;fetch($mode);</div><div class="line"><a name="l04564"></a><span class="lineno"> 4564</span>&#160;        }</div><div class="line"><a name="l04565"></a><span class="lineno"> 4565</span>&#160;    }</div><div class="line"><a name="l04566"></a><span class="lineno"> 4566</span>&#160;</div><div class="line"><a name="l04567"></a><span class="lineno"> 4567</span>&#160;    <span class="comment">//returns an array of arrays after doing a SELECT</span></div><div class="line"><a name="l04568"></a><span class="lineno"> 4568</span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> selectArray($query, $mode=<span class="stringliteral">&quot;both&quot;</span>)</div><div class="line"><a name="l04569"></a><span class="lineno"> 4569</span>&#160;    {</div><div class="line"><a name="l04570"></a><span class="lineno"> 4570</span>&#160;        $result = $this-&gt;query($query);</div><div class="line"><a name="l04571"></a><span class="lineno"> 4571</span>&#160;        <span class="comment">//make sure the result is valid</span></div><div class="line"><a name="l04572"></a><span class="lineno"> 4572</span>&#160;        <span class="keywordflow">if</span>($result=== <span class="keyword">false</span> || $result===NULL) </div><div class="line"><a name="l04573"></a><span class="lineno"> 4573</span>&#160;            <span class="keywordflow">return</span> NULL;        <span class="comment">// error</span></div><div class="line"><a name="l04574"></a><span class="lineno"> 4574</span>&#160;        <span class="keywordflow">if</span>(!is_object($result)) <span class="comment">// no rows returned</span></div><div class="line"><a name="l04575"></a><span class="lineno"> 4575</span>&#160;            <span class="keywordflow">return</span> array();</div><div class="line"><a name="l04576"></a><span class="lineno"> 4576</span>&#160;        <span class="keywordflow">if</span>($this-&gt;type==<span class="stringliteral">&quot;PDO&quot;</span>)</div><div class="line"><a name="l04577"></a><span class="lineno"> 4577</span>&#160;        {</div><div class="line"><a name="l04578"></a><span class="lineno"> 4578</span>&#160;            <span class="keywordflow">if</span>($mode==<span class="stringliteral">&quot;assoc&quot;</span>)</div><div class="line"><a name="l04579"></a><span class="lineno"> 4579</span>&#160;                $mode = PDO::FETCH_ASSOC;</div><div class="line"><a name="l04580"></a><span class="lineno"> 4580</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span>($mode==<span class="stringliteral">&quot;num&quot;</span>)</div><div class="line"><a name="l04581"></a><span class="lineno"> 4581</span>&#160;                $mode = PDO::FETCH_NUM;</div><div class="line"><a name="l04582"></a><span class="lineno"> 4582</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l04583"></a><span class="lineno"> 4583</span>&#160;                $mode = PDO::FETCH_BOTH;</div><div class="line"><a name="l04584"></a><span class="lineno"> 4584</span>&#160;            <span class="keywordflow">return</span> $result-&gt;fetchAll($mode);</div><div class="line"><a name="l04585"></a><span class="lineno"> 4585</span>&#160;        }</div><div class="line"><a name="l04586"></a><span class="lineno"> 4586</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>($this-&gt;type==<span class="stringliteral">&quot;SQLite3&quot;</span>)</div><div class="line"><a name="l04587"></a><span class="lineno"> 4587</span>&#160;        {</div><div class="line"><a name="l04588"></a><span class="lineno"> 4588</span>&#160;            <span class="keywordflow">if</span>($mode==<span class="stringliteral">&quot;assoc&quot;</span>)</div><div class="line"><a name="l04589"></a><span class="lineno"> 4589</span>&#160;                $mode = SQLITE3_ASSOC;</div><div class="line"><a name="l04590"></a><span class="lineno"> 4590</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span>($mode==<span class="stringliteral">&quot;num&quot;</span>)</div><div class="line"><a name="l04591"></a><span class="lineno"> 4591</span>&#160;                $mode = SQLITE3_NUM;</div><div class="line"><a name="l04592"></a><span class="lineno"> 4592</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l04593"></a><span class="lineno"> 4593</span>&#160;                $mode = SQLITE3_BOTH;</div><div class="line"><a name="l04594"></a><span class="lineno"> 4594</span>&#160;            $arr = array();</div><div class="line"><a name="l04595"></a><span class="lineno"> 4595</span>&#160;            $i = 0;</div><div class="line"><a name="l04596"></a><span class="lineno"> 4596</span>&#160;            <span class="keywordflow">while</span>($res = $result-&gt;fetchArray($mode))</div><div class="line"><a name="l04597"></a><span class="lineno"> 4597</span>&#160;            {</div><div class="line"><a name="l04598"></a><span class="lineno"> 4598</span>&#160;                $arr[$i] = $res;</div><div class="line"><a name="l04599"></a><span class="lineno"> 4599</span>&#160;                $i++;</div><div class="line"><a name="l04600"></a><span class="lineno"> 4600</span>&#160;            }</div><div class="line"><a name="l04601"></a><span class="lineno"> 4601</span>&#160;            <span class="keywordflow">return</span> $arr;</div><div class="line"><a name="l04602"></a><span class="lineno"> 4602</span>&#160;        }</div><div class="line"><a name="l04603"></a><span class="lineno"> 4603</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>($this-&gt;type==<span class="stringliteral">&quot;SQLiteDatabase&quot;</span>)</div><div class="line"><a name="l04604"></a><span class="lineno"> 4604</span>&#160;        {</div><div class="line"><a name="l04605"></a><span class="lineno"> 4605</span>&#160;            <span class="keywordflow">if</span>($mode==<span class="stringliteral">&quot;assoc&quot;</span>)</div><div class="line"><a name="l04606"></a><span class="lineno"> 4606</span>&#160;                $mode = SQLITE_ASSOC;</div><div class="line"><a name="l04607"></a><span class="lineno"> 4607</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span>($mode==<span class="stringliteral">&quot;num&quot;</span>)</div><div class="line"><a name="l04608"></a><span class="lineno"> 4608</span>&#160;                $mode = SQLITE_NUM;</div><div class="line"><a name="l04609"></a><span class="lineno"> 4609</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l04610"></a><span class="lineno"> 4610</span>&#160;                $mode = SQLITE_BOTH;</div><div class="line"><a name="l04611"></a><span class="lineno"> 4611</span>&#160;            <span class="keywordflow">return</span> $result-&gt;fetchAll($mode);</div><div class="line"><a name="l04612"></a><span class="lineno"> 4612</span>&#160;        }</div><div class="line"><a name="l04613"></a><span class="lineno"> 4613</span>&#160;    }</div><div class="line"><a name="l04614"></a><span class="lineno"> 4614</span>&#160;</div><div class="line"><a name="l04615"></a><span class="lineno"> 4615</span>&#160;    </div><div class="line"><a name="l04616"></a><span class="lineno"> 4616</span>&#160;    <span class="comment">// SQlite supports multiple ways of surrounding names in quotes:</span></div><div class="line"><a name="l04617"></a><span class="lineno"> 4617</span>&#160;    <span class="comment">// single-quotes, double-quotes, backticks, square brackets.</span></div><div class="line"><a name="l04618"></a><span class="lineno"> 4618</span>&#160;    <span class="comment">// As sqlite does not keep this strict, we also need to be flexible here.</span></div><div class="line"><a name="l04619"></a><span class="lineno"> 4619</span>&#160;    <span class="comment">// This function generates a regex that matches any of the possibilities.</span></div><div class="line"><a name="l04620"></a><span class="lineno"> 4620</span>&#160;    <span class="keyword">private</span> <span class="keyword">function</span> sqlite_surroundings_preg($name,$preg_quote=<span class="keyword">true</span>,$notAllowedCharsIfNone=<span class="stringliteral">&quot;&#39;\&quot;&quot;</span>,$notAllowedName=<span class="keyword">false</span>)</div><div class="line"><a name="l04621"></a><span class="lineno"> 4621</span>&#160;    {</div><div class="line"><a name="l04622"></a><span class="lineno"> 4622</span>&#160;        <span class="keywordflow">if</span>($name==<span class="stringliteral">&quot;*&quot;</span> || $name==<span class="stringliteral">&quot;+&quot;</span>)</div><div class="line"><a name="l04623"></a><span class="lineno"> 4623</span>&#160;        {</div><div class="line"><a name="l04624"></a><span class="lineno"> 4624</span>&#160;            <span class="keywordflow">if</span>($notAllowedName!==<span class="keyword">false</span> &amp;&amp; $preg_quote)</div><div class="line"><a name="l04625"></a><span class="lineno"> 4625</span>&#160;                $notAllowedName = preg_quote($notAllowedName,<span class="stringliteral">&quot;/&quot;</span>);</div><div class="line"><a name="l04626"></a><span class="lineno"> 4626</span>&#160;            <span class="comment">// use possesive quantifiers to save memory</span></div><div class="line"><a name="l04627"></a><span class="lineno"> 4627</span>&#160;            $nameSingle   = ($notAllowedName!==<span class="keyword">false</span>?<span class="stringliteral">&quot;(?!&quot;</span>.$notAllowedName.<span class="stringliteral">&quot;&#39;)&quot;</span>:<span class="stringliteral">&quot;&quot;</span>).<span class="stringliteral">&quot;(?:[^&#39;]$name+|&#39;&#39;)$name+&quot;</span>;</div><div class="line"><a name="l04628"></a><span class="lineno"> 4628</span>&#160;            $nameDouble   = ($notAllowedName!==<span class="keyword">false</span>?<span class="stringliteral">&quot;(?!&quot;</span>.$notAllowedName.<span class="stringliteral">&quot;\&quot;)&quot;</span>:<span class="stringliteral">&quot;&quot;</span>).<span class="stringliteral">&quot;(?:[^\&quot;]$name+|\&quot;\&quot;)$name+&quot;</span>;</div><div class="line"><a name="l04629"></a><span class="lineno"> 4629</span>&#160;            $nameBacktick = ($notAllowedName!==<span class="keyword">false</span>?<span class="stringliteral">&quot;(?!&quot;</span>.$notAllowedName.<span class="stringliteral">&quot;`)&quot;</span>:<span class="stringliteral">&quot;&quot;</span>).<span class="stringliteral">&quot;(?:[^`]$name+|``)$name+&quot;</span>;</div><div class="line"><a name="l04630"></a><span class="lineno"> 4630</span>&#160;            $nameSquare   = ($notAllowedName!==<span class="keyword">false</span>?<span class="stringliteral">&quot;(?!&quot;</span>.$notAllowedName.<span class="stringliteral">&quot;\])&quot;</span>:<span class="stringliteral">&quot;&quot;</span>).<span class="stringliteral">&quot;(?:[^\]]$name+|\]\])$name+&quot;</span>;</div><div class="line"><a name="l04631"></a><span class="lineno"> 4631</span>&#160;            $nameNo = ($notAllowedName!==<span class="keyword">false</span>?<span class="stringliteral">&quot;(?!&quot;</span>.$notAllowedName.<span class="stringliteral">&quot;\s)&quot;</span>:<span class="stringliteral">&quot;&quot;</span>).<span class="stringliteral">&quot;[^&quot;</span>.$notAllowedCharsIfNone.<span class="stringliteral">&quot;]$name&quot;</span>;</div><div class="line"><a name="l04632"></a><span class="lineno"> 4632</span>&#160;        }</div><div class="line"><a name="l04633"></a><span class="lineno"> 4633</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l04634"></a><span class="lineno"> 4634</span>&#160;        {</div><div class="line"><a name="l04635"></a><span class="lineno"> 4635</span>&#160;            <span class="keywordflow">if</span>($preg_quote) $name = preg_quote($name,<span class="stringliteral">&quot;/&quot;</span>);</div><div class="line"><a name="l04636"></a><span class="lineno"> 4636</span>&#160;            </div><div class="line"><a name="l04637"></a><span class="lineno"> 4637</span>&#160;            $nameSingle = str_replace(<span class="stringliteral">&quot;&#39;&quot;</span>,<span class="stringliteral">&quot;&#39;&#39;&quot;</span>,$name);</div><div class="line"><a name="l04638"></a><span class="lineno"> 4638</span>&#160;            $nameDouble = str_replace(<span class="charliteral">&#39;&quot;&#39;</span>,<span class="stringliteral">&#39;&quot;&quot;&#39;</span>,$name);</div><div class="line"><a name="l04639"></a><span class="lineno"> 4639</span>&#160;            $nameBacktick = str_replace(<span class="charliteral">&#39;`&#39;</span>,<span class="stringliteral">&#39;``&#39;</span>,$name);</div><div class="line"><a name="l04640"></a><span class="lineno"> 4640</span>&#160;            $nameSquare = str_replace(<span class="charliteral">&#39;]&#39;</span>,<span class="stringliteral">&#39;]]&#39;</span>,$name);</div><div class="line"><a name="l04641"></a><span class="lineno"> 4641</span>&#160;            $nameNo = $name;</div><div class="line"><a name="l04642"></a><span class="lineno"> 4642</span>&#160;        }</div><div class="line"><a name="l04643"></a><span class="lineno"> 4643</span>&#160;        </div><div class="line"><a name="l04644"></a><span class="lineno"> 4644</span>&#160;        $preg = <span class="stringliteral">&quot;(?:&#39;&quot;</span>.$nameSingle.<span class="stringliteral">&quot;&#39;|&quot;</span>.   <span class="comment">// single-quote surrounded or not in quotes (correct SQL for values/new names)</span></div><div class="line"><a name="l04645"></a><span class="lineno"> 4645</span>&#160;                $nameNo.<span class="stringliteral">&quot;|&quot;</span>.               <span class="comment">// not surrounded (correct SQL if not containing reserved words, spaces or some special chars)</span></div><div class="line"><a name="l04646"></a><span class="lineno"> 4646</span>&#160;                <span class="stringliteral">&quot;\&quot;&quot;</span>.$nameDouble.<span class="stringliteral">&quot;\&quot;|&quot;</span>.    <span class="comment">// double-quote surrounded (correct SQL for identifiers)</span></div><div class="line"><a name="l04647"></a><span class="lineno"> 4647</span>&#160;                <span class="stringliteral">&quot;`&quot;</span>.$nameBacktick.<span class="stringliteral">&quot;`|&quot;</span>.    <span class="comment">// backtick surrounded (MySQL-Style)</span></div><div class="line"><a name="l04648"></a><span class="lineno"> 4648</span>&#160;                <span class="stringliteral">&quot;\[&quot;</span>.$nameSquare.<span class="stringliteral">&quot;\])&quot;</span>;    <span class="comment">// square-bracket surrounded (MS Access/SQL server-Style)</span></div><div class="line"><a name="l04649"></a><span class="lineno"> 4649</span>&#160;        <span class="keywordflow">return</span> $preg;</div><div class="line"><a name="l04650"></a><span class="lineno"> 4650</span>&#160;    }</div><div class="line"><a name="l04651"></a><span class="lineno"> 4651</span>&#160;    </div><div class="line"><a name="l04652"></a><span class="lineno"> 4652</span>&#160;    <span class="comment">// Returns the last PREG error as a string, &#39;&#39; if no error occured</span></div><div class="line"><a name="l04653"></a><span class="lineno"> 4653</span>&#160;    <span class="keyword">private</span> <span class="keyword">function</span> getPregError()</div><div class="line"><a name="l04654"></a><span class="lineno"> 4654</span>&#160;    {</div><div class="line"><a name="l04655"></a><span class="lineno"> 4655</span>&#160;        $error = preg_last_error();</div><div class="line"><a name="l04656"></a><span class="lineno"> 4656</span>&#160;        <span class="keywordflow">switch</span> ($error)</div><div class="line"><a name="l04657"></a><span class="lineno"> 4657</span>&#160;        {</div><div class="line"><a name="l04658"></a><span class="lineno"> 4658</span>&#160;            <span class="keywordflow">case</span> PREG_NO_ERROR: <span class="keywordflow">return</span> <span class="stringliteral">&#39;No error&#39;</span>;</div><div class="line"><a name="l04659"></a><span class="lineno"> 4659</span>&#160;            <span class="keywordflow">case</span> PREG_INTERNAL_ERROR: <span class="keywordflow">return</span> <span class="stringliteral">&#39;There is an internal error!&#39;</span>;</div><div class="line"><a name="l04660"></a><span class="lineno"> 4660</span>&#160;            <span class="keywordflow">case</span> PREG_BACKTRACK_LIMIT_ERROR: <span class="keywordflow">return</span> <span class="stringliteral">&#39;Backtrack limit was exhausted!&#39;</span>;</div><div class="line"><a name="l04661"></a><span class="lineno"> 4661</span>&#160;            <span class="keywordflow">case</span> PREG_RECURSION_LIMIT_ERROR: <span class="keywordflow">return</span> <span class="stringliteral">&#39;Recursion limit was exhausted!&#39;</span>;</div><div class="line"><a name="l04662"></a><span class="lineno"> 4662</span>&#160;            <span class="keywordflow">case</span> PREG_BAD_UTF8_ERROR: <span class="keywordflow">return</span> <span class="stringliteral">&#39;Bad UTF8 error!&#39;</span>;</div><div class="line"><a name="l04663"></a><span class="lineno"> 4663</span>&#160;            <span class="keywordflow">case</span> PREG_BAD_UTF8_ERROR: <span class="keywordflow">return</span> <span class="stringliteral">&#39;Bad UTF8 offset error!&#39;</span>;</div><div class="line"><a name="l04664"></a><span class="lineno"> 4664</span>&#160;            <span class="keywordflow">default</span>: <span class="keywordflow">return</span> <span class="stringliteral">&#39;Unknown Error&#39;</span>;</div><div class="line"><a name="l04665"></a><span class="lineno"> 4665</span>&#160;        } </div><div class="line"><a name="l04666"></a><span class="lineno"> 4666</span>&#160;    }</div><div class="line"><a name="l04667"></a><span class="lineno"> 4667</span>&#160;    </div><div class="line"><a name="l04668"></a><span class="lineno"> 4668</span>&#160;    <span class="comment">// function that is called for an alter table statement in a query</span></div><div class="line"><a name="l04669"></a><span class="lineno"> 4669</span>&#160;    <span class="comment">// code borrowed with permission from http://code.jenseng.com/db/</span></div><div class="line"><a name="l04670"></a><span class="lineno"> 4670</span>&#160;    <span class="comment">// this has been completely debugged / rewritten by Christopher Kramer</span></div><div class="line"><a name="l04671"></a><span class="lineno"> 4671</span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> alterTable($table, $alterdefs)</div><div class="line"><a name="l04672"></a><span class="lineno"> 4672</span>&#160;    {</div><div class="line"><a name="l04673"></a><span class="lineno"> 4673</span>&#160;        global $debug, $lang;</div><div class="line"><a name="l04674"></a><span class="lineno"> 4674</span>&#160;        $this-&gt;alterError=<span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l04675"></a><span class="lineno"> 4675</span>&#160;        $errormsg = sprintf($lang[<span class="stringliteral">&#39;alter_failed&#39;</span>],htmlencode($table)).<span class="stringliteral">&#39; - &#39;</span>;</div><div class="line"><a name="l04676"></a><span class="lineno"> 4676</span>&#160;        <span class="keywordflow">if</span>($debug) echo <span class="stringliteral">&quot;ALTER TABLE: table=($table), alterdefs=($alterdefs)&lt;hr&gt;&quot;</span>;</div><div class="line"><a name="l04677"></a><span class="lineno"> 4677</span>&#160;        <span class="keywordflow">if</span>($alterdefs != <span class="stringliteral">&#39;&#39;</span>)</div><div class="line"><a name="l04678"></a><span class="lineno"> 4678</span>&#160;        {</div><div class="line"><a name="l04679"></a><span class="lineno"> 4679</span>&#160;            $recreateQueries = array();</div><div class="line"><a name="l04680"></a><span class="lineno"> 4680</span>&#160;            $resultArr = $this-&gt;selectArray(<span class="stringliteral">&quot;SELECT sql,name,type FROM sqlite_master WHERE tbl_name = &quot;</span>.$this-&gt;quote($table));</div><div class="line"><a name="l04681"></a><span class="lineno"> 4681</span>&#160;            <span class="keywordflow">if</span>(<span class="keyword">sizeof</span>($resultArr)&lt;1)</div><div class="line"><a name="l04682"></a><span class="lineno"> 4682</span>&#160;            {</div><div class="line"><a name="l04683"></a><span class="lineno"> 4683</span>&#160;                $this-&gt;alterError = $errormsg . sprintf($lang[<span class="stringliteral">&#39;tbl_inexistent&#39;</span>], htmlencode($table));</div><div class="line"><a name="l04684"></a><span class="lineno"> 4684</span>&#160;                <span class="keywordflow">if</span>($debug) echo <span class="stringliteral">&quot;ERROR: unknown table&lt;hr&gt;&quot;</span>;</div><div class="line"><a name="l04685"></a><span class="lineno"> 4685</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l04686"></a><span class="lineno"> 4686</span>&#160;            }</div><div class="line"><a name="l04687"></a><span class="lineno"> 4687</span>&#160;            <span class="keywordflow">for</span>($i=0; $i&lt;<span class="keyword">sizeof</span>($resultArr); $i++)</div><div class="line"><a name="l04688"></a><span class="lineno"> 4688</span>&#160;            {</div><div class="line"><a name="l04689"></a><span class="lineno"> 4689</span>&#160;                $row = $resultArr[$i];</div><div class="line"><a name="l04690"></a><span class="lineno"> 4690</span>&#160;                <span class="keywordflow">if</span>($row[<span class="stringliteral">&#39;type&#39;</span>] != <span class="stringliteral">&#39;table&#39;</span>)</div><div class="line"><a name="l04691"></a><span class="lineno"> 4691</span>&#160;                {</div><div class="line"><a name="l04692"></a><span class="lineno"> 4692</span>&#160;                    <span class="keywordflow">if</span>($row[<span class="stringliteral">&#39;sql&#39;</span>]!=<span class="stringliteral">&#39;&#39;</span>)</div><div class="line"><a name="l04693"></a><span class="lineno"> 4693</span>&#160;                    {</div><div class="line"><a name="l04694"></a><span class="lineno"> 4694</span>&#160;                        <span class="comment">// store the CREATE statements of triggers and indexes to recreate them later</span></div><div class="line"><a name="l04695"></a><span class="lineno"> 4695</span>&#160;                        $recreateQueries[] = $row;</div><div class="line"><a name="l04696"></a><span class="lineno"> 4696</span>&#160;                        <span class="keywordflow">if</span>($debug) echo <span class="stringliteral">&quot;recreate=(&quot;</span>.$row[<span class="stringliteral">&#39;sql&#39;</span>].<span class="stringliteral">&quot;;)&lt;hr /&gt;&quot;</span>;</div><div class="line"><a name="l04697"></a><span class="lineno"> 4697</span>&#160;                    }</div><div class="line"><a name="l04698"></a><span class="lineno"> 4698</span>&#160;                }</div><div class="line"><a name="l04699"></a><span class="lineno"> 4699</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l04700"></a><span class="lineno"> 4700</span>&#160;                {</div><div class="line"><a name="l04701"></a><span class="lineno"> 4701</span>&#160;                    <span class="comment">// ALTER the table</span></div><div class="line"><a name="l04702"></a><span class="lineno"> 4702</span>&#160;                    $tmpname = <span class="charliteral">&#39;t&#39;</span>.time();</div><div class="line"><a name="l04703"></a><span class="lineno"> 4703</span>&#160;                    $origsql = $row[<span class="stringliteral">&#39;sql&#39;</span>];</div><div class="line"><a name="l04704"></a><span class="lineno"> 4704</span>&#160;                    $preg_remove_create_table = <span class="stringliteral">&quot;/^\s*+CREATE\s++TABLE\s++&quot;</span>.$this-&gt;sqlite_surroundings_preg($table).<span class="stringliteral">&quot;\s*+(\(.*+)$/is&quot;</span>;</div><div class="line"><a name="l04705"></a><span class="lineno"> 4705</span>&#160;                    $origsql_no_create = preg_replace($preg_remove_create_table, <span class="stringliteral">&#39;$1&#39;</span>, $origsql, 1);</div><div class="line"><a name="l04706"></a><span class="lineno"> 4706</span>&#160;                    <span class="keywordflow">if</span>($debug) echo <span class="stringliteral">&quot;origsql=($origsql)&lt;br /&gt;preg_remove_create_table=($preg_remove_create_table)&lt;hr&gt;&quot;</span>;</div><div class="line"><a name="l04707"></a><span class="lineno"> 4707</span>&#160;                    <span class="keywordflow">if</span>($origsql_no_create == $origsql)</div><div class="line"><a name="l04708"></a><span class="lineno"> 4708</span>&#160;                    {</div><div class="line"><a name="l04709"></a><span class="lineno"> 4709</span>&#160;                        $this-&gt;alterError = $errormsg . $lang[<span class="stringliteral">&#39;alter_tbl_name_not_replacable&#39;</span>];</div><div class="line"><a name="l04710"></a><span class="lineno"> 4710</span>&#160;                        <span class="keywordflow">if</span>($debug) echo <span class="stringliteral">&quot;ERROR: could not get rid of CREATE TABLE&lt;hr /&gt;&quot;</span>;</div><div class="line"><a name="l04711"></a><span class="lineno"> 4711</span>&#160;                        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l04712"></a><span class="lineno"> 4712</span>&#160;                    }</div><div class="line"><a name="l04713"></a><span class="lineno"> 4713</span>&#160;                    $createtemptableSQL = <span class="stringliteral">&quot;CREATE TEMPORARY TABLE &quot;</span>.$this-&gt;quote($tmpname).<span class="stringliteral">&quot; &quot;</span>.$origsql_no_create;</div><div class="line"><a name="l04714"></a><span class="lineno"> 4714</span>&#160;                    <span class="keywordflow">if</span>($debug) echo <span class="stringliteral">&quot;createtemptableSQL=($createtemptableSQL)&lt;hr&gt;&quot;</span>;</div><div class="line"><a name="l04715"></a><span class="lineno"> 4715</span>&#160;                    $createindexsql = array();</div><div class="line"><a name="l04716"></a><span class="lineno"> 4716</span>&#160;                    $preg_alter_part = <span class="stringliteral">&quot;/(?:DROP(?! PRIMARY KEY)|ADD(?! PRIMARY KEY)|CHANGE|RENAME TO|ADD PRIMARY KEY|DROP PRIMARY KEY)&quot;</span> <span class="comment">// the ALTER command</span></div><div class="line"><a name="l04717"></a><span class="lineno"> 4717</span>&#160;                        .<span class="stringliteral">&quot;(?:&quot;</span></div><div class="line"><a name="l04718"></a><span class="lineno"> 4718</span>&#160;                            .<span class="stringliteral">&quot;\s+\(&quot;</span>.$this-&gt;sqlite_surroundings_preg(<span class="stringliteral">&quot;+&quot;</span>,<span class="keyword">false</span>,<span class="stringliteral">&quot;\&quot;&#39;\[`)&quot;</span>).<span class="stringliteral">&quot;+\)&quot;</span> <span class="comment">// stuff in brackets (in case of ADD PRIMARY KEY)</span></div><div class="line"><a name="l04719"></a><span class="lineno"> 4719</span>&#160;                        .<span class="stringliteral">&quot;|&quot;</span>                                                                    <span class="comment">// or</span></div><div class="line"><a name="l04720"></a><span class="lineno"> 4720</span>&#160;                            .<span class="stringliteral">&quot;\s+&quot;</span>.$this-&gt;sqlite_surroundings_preg(<span class="stringliteral">&quot;+&quot;</span>,<span class="keyword">false</span>,<span class="stringliteral">&quot;,&#39;\&quot;\[`&quot;</span>)         <span class="comment">// column names and stuff like this</span></div><div class="line"><a name="l04721"></a><span class="lineno"> 4721</span>&#160;                        .<span class="stringliteral">&quot;)*/i&quot;</span>;</div><div class="line"><a name="l04722"></a><span class="lineno"> 4722</span>&#160;                    <span class="keywordflow">if</span>($debug)</div><div class="line"><a name="l04723"></a><span class="lineno"> 4723</span>&#160;                        echo <span class="stringliteral">&quot;preg_alter_part=(&quot;</span>.$preg_alter_part.<span class="stringliteral">&quot;)&lt;hr /&gt;&quot;</span>;</div><div class="line"><a name="l04724"></a><span class="lineno"> 4724</span>&#160;                    preg_match_all($preg_alter_part,$alterdefs,$matches);</div><div class="line"><a name="l04725"></a><span class="lineno"> 4725</span>&#160;                    $defs = $matches[0];</div><div class="line"><a name="l04726"></a><span class="lineno"> 4726</span>&#160;                    </div><div class="line"><a name="l04727"></a><span class="lineno"> 4727</span>&#160;                    $get_oldcols_query = <span class="stringliteral">&quot;PRAGMA table_info(&quot;</span>.$this-&gt;quote_id($table).<span class="stringliteral">&quot;)&quot;</span>;</div><div class="line"><a name="l04728"></a><span class="lineno"> 4728</span>&#160;                    $result_oldcols = $this-&gt;selectArray($get_oldcols_query);</div><div class="line"><a name="l04729"></a><span class="lineno"> 4729</span>&#160;                    $newcols = array();</div><div class="line"><a name="l04730"></a><span class="lineno"> 4730</span>&#160;                    $coltypes = array();</div><div class="line"><a name="l04731"></a><span class="lineno"> 4731</span>&#160;                    $primarykey = array();</div><div class="line"><a name="l04732"></a><span class="lineno"> 4732</span>&#160;                    <span class="keywordflow">foreach</span>($result_oldcols as $column_info)</div><div class="line"><a name="l04733"></a><span class="lineno"> 4733</span>&#160;                    {</div><div class="line"><a name="l04734"></a><span class="lineno"> 4734</span>&#160;                        $newcols[$column_info[<span class="stringliteral">&#39;name&#39;</span>]] = $column_info[<span class="stringliteral">&#39;name&#39;</span>];</div><div class="line"><a name="l04735"></a><span class="lineno"> 4735</span>&#160;                        $coltypes[$column_info[<span class="stringliteral">&#39;name&#39;</span>]] = $column_info[<span class="stringliteral">&#39;type&#39;</span>];</div><div class="line"><a name="l04736"></a><span class="lineno"> 4736</span>&#160;                        <span class="keywordflow">if</span>($column_info[<span class="stringliteral">&#39;pk&#39;</span>])</div><div class="line"><a name="l04737"></a><span class="lineno"> 4737</span>&#160;                            $primarykey[] = $column_info[<span class="stringliteral">&#39;name&#39;</span>];</div><div class="line"><a name="l04738"></a><span class="lineno"> 4738</span>&#160;                    }</div><div class="line"><a name="l04739"></a><span class="lineno"> 4739</span>&#160;                    $newcolumns = <span class="stringliteral">&#39;&#39;</span>;</div><div class="line"><a name="l04740"></a><span class="lineno"> 4740</span>&#160;                    $oldcolumns = <span class="stringliteral">&#39;&#39;</span>;</div><div class="line"><a name="l04741"></a><span class="lineno"> 4741</span>&#160;                    reset($newcols);</div><div class="line"><a name="l04742"></a><span class="lineno"> 4742</span>&#160;                    <span class="keywordflow">while</span>(list($key, $val) = each($newcols))</div><div class="line"><a name="l04743"></a><span class="lineno"> 4743</span>&#160;                    {</div><div class="line"><a name="l04744"></a><span class="lineno"> 4744</span>&#160;                        $newcolumns .= ($newcolumns?<span class="stringliteral">&#39;, &#39;</span>:<span class="stringliteral">&#39;&#39;</span>).$this-&gt;quote_id($val);</div><div class="line"><a name="l04745"></a><span class="lineno"> 4745</span>&#160;                        $oldcolumns .= ($oldcolumns?<span class="stringliteral">&#39;, &#39;</span>:<span class="stringliteral">&#39;&#39;</span>).$this-&gt;quote_id($key);</div><div class="line"><a name="l04746"></a><span class="lineno"> 4746</span>&#160;                    }</div><div class="line"><a name="l04747"></a><span class="lineno"> 4747</span>&#160;                    $copytotempsql = <span class="stringliteral">&#39;INSERT INTO &#39;</span>.$this-&gt;quote_id($tmpname).<span class="charliteral">&#39;(&#39;</span>.$newcolumns.<span class="stringliteral">&#39;) SELECT &#39;</span>.$oldcolumns.<span class="stringliteral">&#39; FROM &#39;</span>.$this-&gt;quote_id($table);</div><div class="line"><a name="l04748"></a><span class="lineno"> 4748</span>&#160;                    $dropoldsql = <span class="stringliteral">&#39;DROP TABLE &#39;</span>.$this-&gt;quote_id($table);</div><div class="line"><a name="l04749"></a><span class="lineno"> 4749</span>&#160;                    $createtesttableSQL = $createtemptableSQL;</div><div class="line"><a name="l04750"></a><span class="lineno"> 4750</span>&#160;                    <span class="keywordflow">if</span>(count($defs)&lt;1)</div><div class="line"><a name="l04751"></a><span class="lineno"> 4751</span>&#160;                    {</div><div class="line"><a name="l04752"></a><span class="lineno"> 4752</span>&#160;                        $this-&gt;alterError = $errormsg . $lang[<span class="stringliteral">&#39;alter_no_def&#39;</span>];</div><div class="line"><a name="l04753"></a><span class="lineno"> 4753</span>&#160;                        <span class="keywordflow">if</span>($debug) echo <span class="stringliteral">&quot;ERROR: defs&amp;lt;1&lt;hr /&gt;&quot;</span>;</div><div class="line"><a name="l04754"></a><span class="lineno"> 4754</span>&#160;                        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l04755"></a><span class="lineno"> 4755</span>&#160;                    }</div><div class="line"><a name="l04756"></a><span class="lineno"> 4756</span>&#160;                    <span class="keywordflow">foreach</span>($defs as $def)</div><div class="line"><a name="l04757"></a><span class="lineno"> 4757</span>&#160;                    {</div><div class="line"><a name="l04758"></a><span class="lineno"> 4758</span>&#160;                        <span class="keywordflow">if</span>($debug) echo <span class="stringliteral">&quot;def=$def&lt;hr /&gt;&quot;</span>;</div><div class="line"><a name="l04759"></a><span class="lineno"> 4759</span>&#160;                        $preg_parse_def =</div><div class="line"><a name="l04760"></a><span class="lineno"> 4760</span>&#160;                            <span class="stringliteral">&quot;/^(DROP(?! PRIMARY KEY)|ADD(?! PRIMARY KEY)|CHANGE|RENAME TO|ADD PRIMARY KEY|DROP PRIMARY KEY)&quot;</span> <span class="comment">// $matches[1]: command</span></div><div class="line"><a name="l04761"></a><span class="lineno"> 4761</span>&#160;                            .<span class="stringliteral">&quot;(?:&quot;</span>                                              <span class="comment">// this is either</span></div><div class="line"><a name="l04762"></a><span class="lineno"> 4762</span>&#160;                                .<span class="stringliteral">&quot;(?:\s+\((.+)\)\s*$)&quot;</span>                          <span class="comment">// anything in brackets (for ADD PRIMARY KEY)</span></div><div class="line"><a name="l04763"></a><span class="lineno"> 4763</span>&#160;                                                                                <span class="comment">// then $matches[2] is what there is in brackets</span></div><div class="line"><a name="l04764"></a><span class="lineno"> 4764</span>&#160;                            .<span class="stringliteral">&quot;|&quot;</span>                                                <span class="comment">// OR: </span></div><div class="line"><a name="l04765"></a><span class="lineno"> 4765</span>&#160;                                .<span class="stringliteral">&quot;(?:\s+\&quot;((?:[^\&quot;]|\&quot;\&quot;)+)\&quot;|\s+&#39;((?:[^&#39;]|&#39;&#39;)+)&#39;)&quot;</span><span class="comment">// (first) column name, either in single or double quotes</span></div><div class="line"><a name="l04766"></a><span class="lineno"> 4766</span>&#160;                                                                                <span class="comment">// in case of RENAME TO, it is the new a table name</span></div><div class="line"><a name="l04767"></a><span class="lineno"> 4767</span>&#160;                                                                                <span class="comment">// $matches[3] will be the column/table name without the quotes if double quoted</span></div><div class="line"><a name="l04768"></a><span class="lineno"> 4768</span>&#160;                                                                                <span class="comment">// $matches[4] will be the column/table name without the quotes if single quoted</span></div><div class="line"><a name="l04769"></a><span class="lineno"> 4769</span>&#160;                                .<span class="stringliteral">&quot;(&quot;</span>                                            <span class="comment">// $matches[5]: anything after the column name</span></div><div class="line"><a name="l04770"></a><span class="lineno"> 4770</span>&#160;                                    .<span class="stringliteral">&quot;(?:\s+&#39;((?:[^&#39;]|&#39;&#39;)+)&#39;)?&quot;</span>                 <span class="comment">// $matches[6] (optional): a second column name surrounded with single quotes</span></div><div class="line"><a name="l04771"></a><span class="lineno"> 4771</span>&#160;                                                                                <span class="comment">//      (the match does not contain the quotes) </span></div><div class="line"><a name="l04772"></a><span class="lineno"> 4772</span>&#160;                                    .<span class="stringliteral">&quot;\s+&quot;</span></div><div class="line"><a name="l04773"></a><span class="lineno"> 4773</span>&#160;                                    .<span class="stringliteral">&quot;((?:[A-Z]+\s*)+(?:\(\s*[+-]?\s*[0-9]+(?:\s*,\s*[+-]?\s*[0-9]+)?\s*\))?)\s*&quot;</span>   <span class="comment">// $matches[7]: a type name</span></div><div class="line"><a name="l04774"></a><span class="lineno"> 4774</span>&#160;                                    .<span class="stringliteral">&quot;.*&quot;</span>.</div><div class="line"><a name="l04775"></a><span class="lineno"> 4775</span>&#160;                                <span class="stringliteral">&quot;)&quot;</span></div><div class="line"><a name="l04776"></a><span class="lineno"> 4776</span>&#160;                                .<span class="stringliteral">&quot;?\s*$&quot;</span></div><div class="line"><a name="l04777"></a><span class="lineno"> 4777</span>&#160;                            .<span class="stringliteral">&quot;)?\s*$/i&quot;</span>; <span class="comment">// in case of DROP PRIMARY KEY, there is nothing after the command</span></div><div class="line"><a name="l04778"></a><span class="lineno"> 4778</span>&#160;                        <span class="keywordflow">if</span>($debug) echo <span class="stringliteral">&quot;preg_parse_def=$preg_parse_def&lt;hr /&gt;&quot;</span>;</div><div class="line"><a name="l04779"></a><span class="lineno"> 4779</span>&#160;                        $parse_def = preg_match($preg_parse_def,$def,$matches);</div><div class="line"><a name="l04780"></a><span class="lineno"> 4780</span>&#160;                        <span class="keywordflow">if</span>($parse_def===<span class="keyword">false</span>)</div><div class="line"><a name="l04781"></a><span class="lineno"> 4781</span>&#160;                        {</div><div class="line"><a name="l04782"></a><span class="lineno"> 4782</span>&#160;                            $this-&gt;alterError = $errormsg . $lang[<span class="stringliteral">&#39;alter_parse_failed&#39;</span>];</div><div class="line"><a name="l04783"></a><span class="lineno"> 4783</span>&#160;                            <span class="keywordflow">if</span>($debug) echo <span class="stringliteral">&quot;ERROR: !parse_def&lt;hr /&gt;&quot;</span>;</div><div class="line"><a name="l04784"></a><span class="lineno"> 4784</span>&#160;                            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l04785"></a><span class="lineno"> 4785</span>&#160;                        }</div><div class="line"><a name="l04786"></a><span class="lineno"> 4786</span>&#160;                        <span class="keywordflow">if</span>(!isset($matches[1]))</div><div class="line"><a name="l04787"></a><span class="lineno"> 4787</span>&#160;                        {</div><div class="line"><a name="l04788"></a><span class="lineno"> 4788</span>&#160;                            $this-&gt;alterError = $errormsg . $lang[<span class="stringliteral">&#39;alter_action_not_recognized&#39;</span>];</div><div class="line"><a name="l04789"></a><span class="lineno"> 4789</span>&#160;                            <span class="keywordflow">if</span>($debug) echo <span class="stringliteral">&quot;ERROR: !isset(matches[1])&lt;hr /&gt;&quot;</span>;</div><div class="line"><a name="l04790"></a><span class="lineno"> 4790</span>&#160;                            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l04791"></a><span class="lineno"> 4791</span>&#160;                        }</div><div class="line"><a name="l04792"></a><span class="lineno"> 4792</span>&#160;                        $action = strtolower($matches[1]);</div><div class="line"><a name="l04793"></a><span class="lineno"> 4793</span>&#160;                        <span class="keywordflow">if</span>(($action == <span class="stringliteral">&#39;add&#39;</span> || $action == <span class="stringliteral">&#39;rename to&#39;</span>) &amp;&amp; isset($matches[4]) &amp;&amp; $matches[4]!=<span class="stringliteral">&#39;&#39;</span>)   </div><div class="line"><a name="l04794"></a><span class="lineno"> 4794</span>&#160;                            $column = str_replace(<span class="stringliteral">&quot;&#39;&#39;&quot;</span>,<span class="stringliteral">&quot;&#39;&quot;</span>,$matches[4]);        <span class="comment">// enclosed in &#39;&#39;</span></div><div class="line"><a name="l04795"></a><span class="lineno"> 4795</span>&#160;                        elseif($action == <span class="stringliteral">&#39;add primary key&#39;</span> &amp;&amp; isset($matches[2]) &amp;&amp; $matches[2]!=<span class="stringliteral">&#39;&#39;</span>)</div><div class="line"><a name="l04796"></a><span class="lineno"> 4796</span>&#160;                            $column = $matches[2];  </div><div class="line"><a name="l04797"></a><span class="lineno"> 4797</span>&#160;                        elseif($action == &#39;drop primary key&#39;)</div><div class="line"><a name="l04798"></a><span class="lineno"> 4798</span>&#160;                            $column = &#39;&#39;;   <span class="comment">// DROP PRIMARY KEY has no column definition</span></div><div class="line"><a name="l04799"></a><span class="lineno"> 4799</span>&#160;                        elseif(isset($matches[3]) &amp;&amp; $matches[3]!=&#39;&#39;)</div><div class="line"><a name="l04800"></a><span class="lineno"> 4800</span>&#160;                            $column = str_replace(&#39;&quot;&quot;&#39;,&#39;&quot;&#39;,$matches[3]);        <span class="comment">// enclosed in &quot;&quot;</span></div><div class="line"><a name="l04801"></a><span class="lineno"> 4801</span>&#160;                        else</div><div class="line"><a name="l04802"></a><span class="lineno"> 4802</span>&#160;                            $column = &#39;&#39;;</div><div class="line"><a name="l04803"></a><span class="lineno"> 4803</span>&#160;</div><div class="line"><a name="l04804"></a><span class="lineno"> 4804</span>&#160;                        $column_escaped = str_replace(&quot;&#39;&quot;,&quot;&#39;&#39;&quot;,$column);</div><div class="line"><a name="l04805"></a><span class="lineno"> 4805</span>&#160;</div><div class="line"><a name="l04806"></a><span class="lineno"> 4806</span>&#160;                        if($debug) echo &quot;action=($action), column=($column), column_escaped=($column_escaped)&lt;hr /&gt;&quot;;</div><div class="line"><a name="l04807"></a><span class="lineno"> 4807</span>&#160;</div><div class="line"><a name="l04808"></a><span class="lineno"> 4808</span>&#160;                        <span class="comment">/* we build a regex that devides the CREATE TABLE statement parts:</span></div><div class="line"><a name="l04809"></a><span class="lineno"> 4809</span>&#160;<span class="comment">                          Part example                            Group  Explanation</span></div><div class="line"><a name="l04810"></a><span class="lineno"> 4810</span>&#160;<span class="comment">                          1. CREATE TABLE t... (                  $1</span></div><div class="line"><a name="l04811"></a><span class="lineno"> 4811</span>&#160;<span class="comment">                          2. &#39;col1&#39; ..., &#39;col2&#39; ..., &#39;colN&#39; ...,  $3     (with col1-colN being columns that are not changed and listed before the col to change)</span></div><div class="line"><a name="l04812"></a><span class="lineno"> 4812</span>&#160;<span class="comment">                          3. &#39;colX&#39; ...,                                 (with colX being the column to change/drop)</span></div><div class="line"><a name="l04813"></a><span class="lineno"> 4813</span>&#160;<span class="comment">                          4. &#39;colX+1&#39; ..., ..., &#39;colK&#39;)           $5     (with colX+1-colK being columns after the column to change/drop)</span></div><div class="line"><a name="l04814"></a><span class="lineno"> 4814</span>&#160;<span class="comment">                        */</span></div><div class="line"><a name="l04815"></a><span class="lineno"> 4815</span>&#160;                        $preg_create_table = &quot;\s*+(CREATE\s++TEMPORARY\s++TABLE\s++&quot;.preg_quote($this-&gt;quote($tmpname),&quot;/&quot;).&quot;\s*+\()&quot;;   <span class="comment">// This is group $1 (keep unchanged)</span></div><div class="line"><a name="l04816"></a><span class="lineno"> 4816</span>&#160;                        $preg_column_definiton = &quot;\s*+&quot;.$this-&gt;sqlite_surroundings_preg(&quot;+&quot;,true,&quot; &#39;\&quot;\[`,&quot;,$column).&quot;(?:\s*+&quot;.$this-&gt;sqlite_surroundings_preg(&quot;*&quot;,false,&quot;&#39;\&quot;,`\[ &quot;).&quot;)++&quot;;     <span class="comment">// catches a complete column definition, even if it is</span></div><div class="line"><a name="l04817"></a><span class="lineno"> 4817</span>&#160;                                                        <span class="comment">// &#39;column&#39; TEXT NOT NULL DEFAULT &#39;we have a comma, here and a double &#39;&#39;quote!&#39;</span></div><div class="line"><a name="l04818"></a><span class="lineno"> 4818</span>&#160;                                                        <span class="comment">// this definition does NOT match columns with the column name $column</span></div><div class="line"><a name="l04819"></a><span class="lineno"> 4819</span>&#160;                        if($debug) echo &quot;preg_column_definition=(&quot;.$preg_column_definiton.&quot;)&lt;hr /&gt;&quot;;</div><div class="line"><a name="l04820"></a><span class="lineno"> 4820</span>&#160;                        $preg_columns_before =  <span class="comment">// columns before the one changed/dropped (keep)</span></div><div class="line"><a name="l04821"></a><span class="lineno"> 4821</span>&#160;                            &quot;(?:&quot;.</div><div class="line"><a name="l04822"></a><span class="lineno"> 4822</span>&#160;                                &quot;(&quot;.            <span class="comment">// group $2. Keep this one unchanged!</span></div><div class="line"><a name="l04823"></a><span class="lineno"> 4823</span>&#160;                                    &quot;(?:&quot;.</div><div class="line"><a name="l04824"></a><span class="lineno"> 4824</span>&#160;                                        &quot;$preg_column_definiton,\s*+&quot;.      <span class="comment">// column definition + comma</span></div><div class="line"><a name="l04825"></a><span class="lineno"> 4825</span>&#160;                                    &quot;)*&quot;.                               <span class="comment">// there might be any number of such columns here</span></div><div class="line"><a name="l04826"></a><span class="lineno"> 4826</span>&#160;                                    $preg_column_definiton.             <span class="comment">// last column definition </span></div><div class="line"><a name="l04827"></a><span class="lineno"> 4827</span>&#160;                                &quot;)&quot;.            <span class="comment">// end of group $2</span></div><div class="line"><a name="l04828"></a><span class="lineno"> 4828</span>&#160;                                &quot;,\s*+&quot;         <span class="comment">// the last comma of the last column before the column to change. Do not keep it!</span></div><div class="line"><a name="l04829"></a><span class="lineno"> 4829</span>&#160;                            .&quot;)?&quot;;    <span class="comment">// there might be no columns before</span></div><div class="line"><a name="l04830"></a><span class="lineno"> 4830</span>&#160;                        if($debug) echo &quot;preg_columns_before=(&quot;.$preg_columns_before.&quot;)&lt;hr /&gt;&quot;;</div><div class="line"><a name="l04831"></a><span class="lineno"> 4831</span>&#160;                        $preg_columns_after = &quot;(,\s*(.+))?&quot;; <span class="comment">// the columns after the column to drop. This is group $3 (drop) or $4(change) (keep!)</span></div><div class="line"><a name="l04832"></a><span class="lineno"> 4832</span>&#160;                                                <span class="comment">// we could remove the comma using $6 instead of $5, but then we might have no comma at all.</span></div><div class="line"><a name="l04833"></a><span class="lineno"> 4833</span>&#160;                                                <span class="comment">// Keeping it leaves a problem if we drop the first column, so we fix that case in another regex.</span></div><div class="line"><a name="l04834"></a><span class="lineno"> 4834</span>&#160;                        $table_new = $table;</div><div class="line"><a name="l04835"></a><span class="lineno"> 4835</span>&#160;    </div><div class="line"><a name="l04836"></a><span class="lineno"> 4836</span>&#160;                        switch($action)</div><div class="line"><a name="l04837"></a><span class="lineno"> 4837</span>&#160;                        {</div><div class="line"><a name="l04838"></a><span class="lineno"> 4838</span>&#160;                            <span class="keywordflow">case</span> <span class="stringliteral">&#39;add&#39;</span>:</div><div class="line"><a name="l04839"></a><span class="lineno"> 4839</span>&#160;                                <span class="keywordflow">if</span>($column==<span class="stringliteral">&#39;&#39;</span>)</div><div class="line"><a name="l04840"></a><span class="lineno"> 4840</span>&#160;                                {</div><div class="line"><a name="l04841"></a><span class="lineno"> 4841</span>&#160;                                    $this-&gt;alterError = $errormsg . <span class="stringliteral">&#39; (add) - &#39;</span>. $lang[<span class="stringliteral">&#39;alter_no_add_col&#39;</span>];</div><div class="line"><a name="l04842"></a><span class="lineno"> 4842</span>&#160;                                    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l04843"></a><span class="lineno"> 4843</span>&#160;                                }</div><div class="line"><a name="l04844"></a><span class="lineno"> 4844</span>&#160;                                $new_col_definition = <span class="stringliteral">&quot;&#39;$column_escaped&#39; &quot;</span>.(isset($matches[5])?$matches[5]:<span class="stringliteral">&#39;&#39;</span>);</div><div class="line"><a name="l04845"></a><span class="lineno"> 4845</span>&#160;                                $preg_pattern_add = <span class="stringliteral">&quot;/^&quot;</span>.$preg_create_table.   <span class="comment">// the CREATE TABLE statement ($1)</span></div><div class="line"><a name="l04846"></a><span class="lineno"> 4846</span>&#160;                                    <span class="stringliteral">&quot;((?:(?!,\s*(?:PRIMARY\s+KEY\s*\(|CONSTRAINT\s|UNIQUE\s*\(|CHECK\s*\(|FOREIGN\s+KEY\s*\()).)*)&quot;</span>. <span class="comment">// column definitions ($2)</span></div><div class="line"><a name="l04847"></a><span class="lineno"> 4847</span>&#160;                                    <span class="stringliteral">&quot;(.*)\\)\s*$/si&quot;</span>; <span class="comment">// table-constraints like PRIMARY KEY(a,b) ($3) and the closing bracket</span></div><div class="line"><a name="l04848"></a><span class="lineno"> 4848</span>&#160;                                <span class="comment">// append the column definiton in the CREATE TABLE statement</span></div><div class="line"><a name="l04849"></a><span class="lineno"> 4849</span>&#160;                                $newSQL = preg_replace($preg_pattern_add, <span class="stringliteral">&#39;$1$2, &#39;</span>.strtr($new_col_definition, array(<span class="charliteral">&#39;\\&#39;</span> =&gt; <span class="stringliteral">&#39;\\\\&#39;</span>, <span class="charliteral">&#39;$&#39;</span> =&gt; <span class="charliteral">&#39;\$&#39;</span>)).<span class="stringliteral">&#39; $3&#39;</span>, $createtesttableSQL).<span class="charliteral">&#39;)&#39;</span>;</div><div class="line"><a name="l04850"></a><span class="lineno"> 4850</span>&#160;                                $preg_error = $this-&gt;getPregError();</div><div class="line"><a name="l04851"></a><span class="lineno"> 4851</span>&#160;                                <span class="keywordflow">if</span>($debug)</div><div class="line"><a name="l04852"></a><span class="lineno"> 4852</span>&#160;                                {</div><div class="line"><a name="l04853"></a><span class="lineno"> 4853</span>&#160;                                    echo $createtesttableSQL.<span class="stringliteral">&quot;&lt;hr&gt;&quot;</span>;</div><div class="line"><a name="l04854"></a><span class="lineno"> 4854</span>&#160;                                    echo $newSQL.<span class="stringliteral">&quot;&lt;hr&gt;&quot;</span>;</div><div class="line"><a name="l04855"></a><span class="lineno"> 4855</span>&#160;                                    echo $preg_pattern_add.<span class="stringliteral">&quot;&lt;hr&gt;&quot;</span>;</div><div class="line"><a name="l04856"></a><span class="lineno"> 4856</span>&#160;                                }</div><div class="line"><a name="l04857"></a><span class="lineno"> 4857</span>&#160;                                <span class="keywordflow">if</span>($newSQL==$createtesttableSQL) <span class="comment">// pattern did not match, so column adding did not succed</span></div><div class="line"><a name="l04858"></a><span class="lineno"> 4858</span>&#160;                                    {</div><div class="line"><a name="l04859"></a><span class="lineno"> 4859</span>&#160;                                    $this-&gt;alterError = $errormsg . <span class="stringliteral">&#39; (add) - &#39;</span>.$lang[<span class="stringliteral">&#39;alter_pattern_mismatch&#39;</span>].<span class="stringliteral">&#39;. PREG ERROR: &#39;</span>.$preg_error;</div><div class="line"><a name="l04860"></a><span class="lineno"> 4860</span>&#160;                                    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l04861"></a><span class="lineno"> 4861</span>&#160;                                    }</div><div class="line"><a name="l04862"></a><span class="lineno"> 4862</span>&#160;                                $createtesttableSQL = $newSQL;</div><div class="line"><a name="l04863"></a><span class="lineno"> 4863</span>&#160;                                <span class="keywordflow">break</span>;</div><div class="line"><a name="l04864"></a><span class="lineno"> 4864</span>&#160;                            <span class="keywordflow">case</span> <span class="stringliteral">&#39;change&#39;</span>:</div><div class="line"><a name="l04865"></a><span class="lineno"> 4865</span>&#160;                                <span class="keywordflow">if</span>(!isset($matches[6]) || !isset($matches[7]))</div><div class="line"><a name="l04866"></a><span class="lineno"> 4866</span>&#160;                                {</div><div class="line"><a name="l04867"></a><span class="lineno"> 4867</span>&#160;                                    $this-&gt;alterError = $errormsg . <span class="stringliteral">&#39; (change) - &#39;</span>.$lang[<span class="stringliteral">&#39;alter_col_not_recognized&#39;</span>];</div><div class="line"><a name="l04868"></a><span class="lineno"> 4868</span>&#160;                                    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l04869"></a><span class="lineno"> 4869</span>&#160;                                }</div><div class="line"><a name="l04870"></a><span class="lineno"> 4870</span>&#160;                                $new_col_name = $matches[6];</div><div class="line"><a name="l04871"></a><span class="lineno"> 4871</span>&#160;                                $new_col_type = $matches[7];</div><div class="line"><a name="l04872"></a><span class="lineno"> 4872</span>&#160;                                $new_col_definition = <span class="stringliteral">&quot;&#39;$new_col_name&#39; $new_col_type&quot;</span>;</div><div class="line"><a name="l04873"></a><span class="lineno"> 4873</span>&#160;                                $preg_column_to_change = <span class="stringliteral">&quot;\s*&quot;</span>.$this-&gt;sqlite_surroundings_preg($column).<span class="stringliteral">&quot;(?:\s+&quot;</span>.preg_quote($coltypes[$column]).<span class="stringliteral">&quot;)?(\s+(?:&quot;</span>.$this-&gt;sqlite_surroundings_preg(<span class="stringliteral">&quot;*&quot;</span>,<span class="keyword">false</span>,<span class="stringliteral">&quot;,&#39;\&quot;`\[&quot;</span>).<span class="stringliteral">&quot;)+)?&quot;</span>;</div><div class="line"><a name="l04874"></a><span class="lineno"> 4874</span>&#160;                                                <span class="comment">// replace this part (we want to change this column)</span></div><div class="line"><a name="l04875"></a><span class="lineno"> 4875</span>&#160;                                                <span class="comment">// group $3 contains the column constraints (keep!). the name &amp; data type is replaced.</span></div><div class="line"><a name="l04876"></a><span class="lineno"> 4876</span>&#160;                                $preg_pattern_change = <span class="stringliteral">&quot;/^&quot;</span>.$preg_create_table.$preg_columns_before.$preg_column_to_change.$preg_columns_after.<span class="stringliteral">&quot;\s*\\)\s*$/s&quot;</span>;</div><div class="line"><a name="l04877"></a><span class="lineno"> 4877</span>&#160;</div><div class="line"><a name="l04878"></a><span class="lineno"> 4878</span>&#160;                                <span class="comment">// replace the column definiton in the CREATE TABLE statement</span></div><div class="line"><a name="l04879"></a><span class="lineno"> 4879</span>&#160;                                $newSQL = preg_replace($preg_pattern_change, <span class="stringliteral">&#39;$1$2,&#39;</span>.strtr($new_col_definition, array(<span class="charliteral">&#39;\\&#39;</span> =&gt; <span class="stringliteral">&#39;\\\\&#39;</span>, <span class="charliteral">&#39;$&#39;</span> =&gt; <span class="charliteral">&#39;\$&#39;</span>)).<span class="stringliteral">&#39;$3$4)&#39;</span>, $createtesttableSQL);</div><div class="line"><a name="l04880"></a><span class="lineno"> 4880</span>&#160;                                $preg_error = $this-&gt;getPregError();</div><div class="line"><a name="l04881"></a><span class="lineno"> 4881</span>&#160;                                <span class="comment">// remove comma at the beginning if the first column is changed</span></div><div class="line"><a name="l04882"></a><span class="lineno"> 4882</span>&#160;                                <span class="comment">// probably somebody is able to put this into the first regex (using lookahead probably).</span></div><div class="line"><a name="l04883"></a><span class="lineno"> 4883</span>&#160;                                $newSQL = preg_replace(<span class="stringliteral">&quot;/^\s*(CREATE\s+TEMPORARY\s+TABLE\s+&quot;</span>.preg_quote($this-&gt;quote($tmpname),<span class="stringliteral">&quot;/&quot;</span>).<span class="stringliteral">&quot;\s+\(),\s*/&quot;</span>,<span class="stringliteral">&#39;$1&#39;</span>,$newSQL);</div><div class="line"><a name="l04884"></a><span class="lineno"> 4884</span>&#160;                                <span class="keywordflow">if</span>($debug)</div><div class="line"><a name="l04885"></a><span class="lineno"> 4885</span>&#160;                                {</div><div class="line"><a name="l04886"></a><span class="lineno"> 4886</span>&#160;                                    echo <span class="stringliteral">&quot;preg_column_to_change=(&quot;</span>.$preg_column_to_change.<span class="stringliteral">&quot;)&lt;hr /&gt;&quot;</span>;</div><div class="line"><a name="l04887"></a><span class="lineno"> 4887</span>&#160;                                    echo $createtesttableSQL.<span class="stringliteral">&quot;&lt;hr /&gt;&quot;</span>;</div><div class="line"><a name="l04888"></a><span class="lineno"> 4888</span>&#160;                                    echo $newSQL.<span class="stringliteral">&quot;&lt;hr /&gt;&quot;</span>;</div><div class="line"><a name="l04889"></a><span class="lineno"> 4889</span>&#160;</div><div class="line"><a name="l04890"></a><span class="lineno"> 4890</span>&#160;                                    echo $preg_pattern_change.<span class="stringliteral">&quot;&lt;hr /&gt;&quot;</span>;</div><div class="line"><a name="l04891"></a><span class="lineno"> 4891</span>&#160;                                }</div><div class="line"><a name="l04892"></a><span class="lineno"> 4892</span>&#160;                                <span class="keywordflow">if</span>($newSQL==$createtesttableSQL || $newSQL==<span class="stringliteral">&quot;&quot;</span>) <span class="comment">// pattern did not match, so column removal did not succed</span></div><div class="line"><a name="l04893"></a><span class="lineno"> 4893</span>&#160;                                {</div><div class="line"><a name="l04894"></a><span class="lineno"> 4894</span>&#160;                                    $this-&gt;alterError = $errormsg . <span class="stringliteral">&#39; (change) - &#39;</span>.$lang[<span class="stringliteral">&#39;alter_pattern_mismatch&#39;</span>].<span class="stringliteral">&#39;. PREG ERROR: &#39;</span>.$preg_error;</div><div class="line"><a name="l04895"></a><span class="lineno"> 4895</span>&#160;                                    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l04896"></a><span class="lineno"> 4896</span>&#160;                                }</div><div class="line"><a name="l04897"></a><span class="lineno"> 4897</span>&#160;                                $createtesttableSQL = $newSQL;</div><div class="line"><a name="l04898"></a><span class="lineno"> 4898</span>&#160;                                $newcols[$column] = str_replace(<span class="stringliteral">&quot;&#39;&#39;&quot;</span>,<span class="stringliteral">&quot;&#39;&quot;</span>,$new_col_name);</div><div class="line"><a name="l04899"></a><span class="lineno"> 4899</span>&#160;                                <span class="keywordflow">break</span>;</div><div class="line"><a name="l04900"></a><span class="lineno"> 4900</span>&#160;                            <span class="keywordflow">case</span> <span class="stringliteral">&#39;drop&#39;</span>:</div><div class="line"><a name="l04901"></a><span class="lineno"> 4901</span>&#160;                                $preg_column_to_drop = <span class="stringliteral">&quot;\s*&quot;</span>.$this-&gt;sqlite_surroundings_preg($column).<span class="stringliteral">&quot;\s+(?:&quot;</span>.$this-&gt;sqlite_surroundings_preg(<span class="stringliteral">&quot;*&quot;</span>,<span class="keyword">false</span>,<span class="stringliteral">&quot;,&#39;\&quot;\[`&quot;</span>).<span class="stringliteral">&quot;)+&quot;</span>;      <span class="comment">// delete this part (we want to drop this column)</span></div><div class="line"><a name="l04902"></a><span class="lineno"> 4902</span>&#160;                                $preg_pattern_drop = <span class="stringliteral">&quot;/^&quot;</span>.$preg_create_table.$preg_columns_before.$preg_column_to_drop.$preg_columns_after.<span class="stringliteral">&quot;\s*\\)\s*$/s&quot;</span>;</div><div class="line"><a name="l04903"></a><span class="lineno"> 4903</span>&#160;</div><div class="line"><a name="l04904"></a><span class="lineno"> 4904</span>&#160;                                <span class="comment">// remove the column out of the CREATE TABLE statement</span></div><div class="line"><a name="l04905"></a><span class="lineno"> 4905</span>&#160;                                $newSQL = preg_replace($preg_pattern_drop, <span class="stringliteral">&#39;$1$2$3)&#39;</span>, $createtesttableSQL);</div><div class="line"><a name="l04906"></a><span class="lineno"> 4906</span>&#160;                                $preg_error = $this-&gt;getPregError();</div><div class="line"><a name="l04907"></a><span class="lineno"> 4907</span>&#160;                                <span class="comment">// remove comma at the beginning if the first column is removed</span></div><div class="line"><a name="l04908"></a><span class="lineno"> 4908</span>&#160;                                <span class="comment">// probably somebody is able to put this into the first regex (using lookahead probably).</span></div><div class="line"><a name="l04909"></a><span class="lineno"> 4909</span>&#160;                                $newSQL = preg_replace(<span class="stringliteral">&quot;/^\s*(CREATE\s+TEMPORARY\s+TABLE\s+&quot;</span>.preg_quote($this-&gt;quote($tmpname),<span class="stringliteral">&quot;/&quot;</span>).<span class="stringliteral">&quot;\s+\(),\s*/&quot;</span>,<span class="stringliteral">&#39;$1&#39;</span>,$newSQL);</div><div class="line"><a name="l04910"></a><span class="lineno"> 4910</span>&#160;                                <span class="keywordflow">if</span>($debug)</div><div class="line"><a name="l04911"></a><span class="lineno"> 4911</span>&#160;                                {</div><div class="line"><a name="l04912"></a><span class="lineno"> 4912</span>&#160;                                    echo $createtesttableSQL.<span class="stringliteral">&quot;&lt;hr&gt;&quot;</span>;</div><div class="line"><a name="l04913"></a><span class="lineno"> 4913</span>&#160;                                    echo $newSQL.<span class="stringliteral">&quot;&lt;hr&gt;&quot;</span>;</div><div class="line"><a name="l04914"></a><span class="lineno"> 4914</span>&#160;                                    echo $preg_pattern_drop.<span class="stringliteral">&quot;&lt;hr&gt;&quot;</span>;</div><div class="line"><a name="l04915"></a><span class="lineno"> 4915</span>&#160;                                }</div><div class="line"><a name="l04916"></a><span class="lineno"> 4916</span>&#160;                                <span class="keywordflow">if</span>($newSQL==$createtesttableSQL || $newSQL==<span class="stringliteral">&quot;&quot;</span>) <span class="comment">// pattern did not match, so column removal did not succed</span></div><div class="line"><a name="l04917"></a><span class="lineno"> 4917</span>&#160;                                {</div><div class="line"><a name="l04918"></a><span class="lineno"> 4918</span>&#160;                                    $this-&gt;alterError = $errormsg . <span class="stringliteral">&#39; (drop) - &#39;</span>.$lang[<span class="stringliteral">&#39;alter_pattern_mismatch&#39;</span>].<span class="stringliteral">&#39;. PREG ERROR: &#39;</span>.$preg_error;</div><div class="line"><a name="l04919"></a><span class="lineno"> 4919</span>&#160;                                    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l04920"></a><span class="lineno"> 4920</span>&#160;                                }</div><div class="line"><a name="l04921"></a><span class="lineno"> 4921</span>&#160;                                $createtesttableSQL = $newSQL;</div><div class="line"><a name="l04922"></a><span class="lineno"> 4922</span>&#160;                                unset($newcols[$column]);</div><div class="line"><a name="l04923"></a><span class="lineno"> 4923</span>&#160;                                <span class="keywordflow">break</span>;</div><div class="line"><a name="l04924"></a><span class="lineno"> 4924</span>&#160;                            <span class="keywordflow">case</span> <span class="stringliteral">&#39;rename to&#39;</span>:</div><div class="line"><a name="l04925"></a><span class="lineno"> 4925</span>&#160;                                <span class="comment">// don&#39;t change column definition at all</span></div><div class="line"><a name="l04926"></a><span class="lineno"> 4926</span>&#160;                                $newSQL = $createtesttableSQL;</div><div class="line"><a name="l04927"></a><span class="lineno"> 4927</span>&#160;                                <span class="comment">// only change the name of the table</span></div><div class="line"><a name="l04928"></a><span class="lineno"> 4928</span>&#160;                                $table_new = $column;</div><div class="line"><a name="l04929"></a><span class="lineno"> 4929</span>&#160;                                <span class="keywordflow">break</span>;</div><div class="line"><a name="l04930"></a><span class="lineno"> 4930</span>&#160;                            <span class="keywordflow">case</span> <span class="stringliteral">&#39;add primary key&#39;</span>:</div><div class="line"><a name="l04931"></a><span class="lineno"> 4931</span>&#160;                                <span class="comment">// we want to add a primary key for the column(s) stored in $column</span></div><div class="line"><a name="l04932"></a><span class="lineno"> 4932</span>&#160;                                $newSQL = preg_replace(<span class="stringliteral">&quot;/\)\s*$/&quot;</span>, <span class="stringliteral">&quot;, PRIMARY KEY (&quot;</span>.$column.<span class="stringliteral">&quot;) )&quot;</span>, $createtesttableSQL);</div><div class="line"><a name="l04933"></a><span class="lineno"> 4933</span>&#160;                                $createtesttableSQL = $newSQL;</div><div class="line"><a name="l04934"></a><span class="lineno"> 4934</span>&#160;                                <span class="keywordflow">break</span>;</div><div class="line"><a name="l04935"></a><span class="lineno"> 4935</span>&#160;                            <span class="keywordflow">case</span> <span class="stringliteral">&#39;drop primary key&#39;</span>:</div><div class="line"><a name="l04936"></a><span class="lineno"> 4936</span>&#160;                                <span class="comment">// we want to drop the primary key</span></div><div class="line"><a name="l04937"></a><span class="lineno"> 4937</span>&#160;                                <span class="keywordflow">if</span>($debug) echo <span class="stringliteral">&quot;DROP&quot;</span>;</div><div class="line"><a name="l04938"></a><span class="lineno"> 4938</span>&#160;                                <span class="keywordflow">if</span>(<span class="keyword">sizeof</span>($primarykey)==1)</div><div class="line"><a name="l04939"></a><span class="lineno"> 4939</span>&#160;                                {</div><div class="line"><a name="l04940"></a><span class="lineno"> 4940</span>&#160;                                    <span class="comment">// if not compound primary key, might be a column constraint -&gt; try removal</span></div><div class="line"><a name="l04941"></a><span class="lineno"> 4941</span>&#160;                                    $column = $primarykey[0];</div><div class="line"><a name="l04942"></a><span class="lineno"> 4942</span>&#160;                                    <span class="keywordflow">if</span>($debug) echo <span class="stringliteral">&quot;&lt;br&gt;Trying to drop column constraint for column $column &lt;br&gt;&quot;</span>;</div><div class="line"><a name="l04943"></a><span class="lineno"> 4943</span>&#160;                                    <span class="comment">/*</span></div><div class="line"><a name="l04944"></a><span class="lineno"> 4944</span>&#160;<span class="comment">                                    TODO: This does not work yet:</span></div><div class="line"><a name="l04945"></a><span class="lineno"> 4945</span>&#160;<span class="comment">                                    CREATE TABLE &#39;t12&#39; (&#39;t1&#39; INTEGER CONSTRAINT &quot;bla&quot; NOT NULL CONSTRAINT &#39;pk&#39; PRIMARY KEY ); ALTER TABLE &quot;t12&quot; DROP PRIMARY KEY</span></div><div class="line"><a name="l04946"></a><span class="lineno"> 4946</span>&#160;<span class="comment">                                    This does:                                  !   !</span></div><div class="line"><a name="l04947"></a><span class="lineno"> 4947</span>&#160;<span class="comment">                                    CREATE TABLE &#39;t12&#39; (&#39;t1&#39; INTEGER CONSTRAINT  bla  NOT NULL CONSTRAINT &#39;pk&#39; PRIMARY KEY ); ALTER TABLE &quot;t12&quot; DROP PRIMARY KEY</span></div><div class="line"><a name="l04948"></a><span class="lineno"> 4948</span>&#160;<span class="comment">                                    */</span></div><div class="line"><a name="l04949"></a><span class="lineno"> 4949</span>&#160;                                    $preg_column_to_change = <span class="stringliteral">&quot;(\s*&quot;</span>.$this-&gt;sqlite_surroundings_preg($column).<span class="stringliteral">&quot;)&quot;</span>. <span class="comment">// column ($3)</span></div><div class="line"><a name="l04950"></a><span class="lineno"> 4950</span>&#160;                                        <span class="stringliteral">&quot;(?:&quot;</span>.      <span class="comment">// opt. type and column constraints</span></div><div class="line"><a name="l04951"></a><span class="lineno"> 4951</span>&#160;                                            <span class="stringliteral">&quot;(\s+(?:&quot;</span>.$this-&gt;sqlite_surroundings_preg(<span class="stringliteral">&quot;(?:[^PC,&#39;\&quot;`\[]|P(?!RIMARY\s+KEY)|&quot;</span>.</div><div class="line"><a name="l04952"></a><span class="lineno"> 4952</span>&#160;                                            <span class="stringliteral">&quot;C(?!ONSTRAINT\s+&quot;</span>.$this-&gt;sqlite_surroundings_preg(<span class="stringliteral">&quot;+&quot;</span>,<span class="keyword">false</span>,<span class="stringliteral">&quot; ,&#39;\&quot;\[`&quot;</span>).<span class="stringliteral">&quot;\s+PRIMARY\s+KEY))&quot;</span>,<span class="keyword">false</span>,<span class="stringliteral">&quot;,&#39;\&quot;`\[&quot;</span>).<span class="stringliteral">&quot;)*)&quot;</span>. <span class="comment">// column constraints before PRIMARY KEY ($3)</span></div><div class="line"><a name="l04953"></a><span class="lineno"> 4953</span>&#160;                                                <span class="comment">// primary key constraint (remove this!):</span></div><div class="line"><a name="l04954"></a><span class="lineno"> 4954</span>&#160;                                                <span class="stringliteral">&quot;(?:CONSTRAINT\s+&quot;</span>.$this-&gt;sqlite_surroundings_preg(<span class="stringliteral">&quot;+&quot;</span>,<span class="keyword">false</span>,<span class="stringliteral">&quot; ,&#39;\&quot;\[`&quot;</span>).<span class="stringliteral">&quot;\s+)?&quot;</span>.</div><div class="line"><a name="l04955"></a><span class="lineno"> 4955</span>&#160;                                                <span class="stringliteral">&quot;PRIMARY\s+KEY&quot;</span>.</div><div class="line"><a name="l04956"></a><span class="lineno"> 4956</span>&#160;                                                <span class="stringliteral">&quot;(?:\s+(?:ASC|DESC))?&quot;</span>.</div><div class="line"><a name="l04957"></a><span class="lineno"> 4957</span>&#160;                                                <span class="stringliteral">&quot;(?:\s+ON\s+CONFLICT\s+(?:ROLLBACK|ABORT|FAIL|IGNORE|REPLACE))?&quot;</span>.</div><div class="line"><a name="l04958"></a><span class="lineno"> 4958</span>&#160;                                                <span class="stringliteral">&quot;(?:\s+AUTOINCREMENT)?&quot;</span>.</div><div class="line"><a name="l04959"></a><span class="lineno"> 4959</span>&#160;                                            <span class="stringliteral">&quot;((?:&quot;</span>.$this-&gt;sqlite_surroundings_preg(<span class="stringliteral">&quot;*&quot;</span>,<span class="keyword">false</span>,<span class="stringliteral">&quot;,&#39;\&quot;`\[&quot;</span>).<span class="stringliteral">&quot;)*)&quot;</span>. <span class="comment">// column constraints after PRIMARY KEY ($4)</span></div><div class="line"><a name="l04960"></a><span class="lineno"> 4960</span>&#160;                                        <span class="stringliteral">&quot;)&quot;</span>;</div><div class="line"><a name="l04961"></a><span class="lineno"> 4961</span>&#160;                                                    <span class="comment">// replace this part (we want to change this column)</span></div><div class="line"><a name="l04962"></a><span class="lineno"> 4962</span>&#160;                                                    <span class="comment">// group $3 (column) $4  (constraints before) and $5 (constraints after) contain the part to keep</span></div><div class="line"><a name="l04963"></a><span class="lineno"> 4963</span>&#160;                                    $preg_pattern_change = <span class="stringliteral">&quot;/^&quot;</span>.$preg_create_table.$preg_columns_before.$preg_column_to_change.$preg_columns_after.<span class="stringliteral">&quot;\s*\\)\s*$/si&quot;</span>;</div><div class="line"><a name="l04964"></a><span class="lineno"> 4964</span>&#160;        </div><div class="line"><a name="l04965"></a><span class="lineno"> 4965</span>&#160;                                    <span class="comment">// replace the column definiton in the CREATE TABLE statement</span></div><div class="line"><a name="l04966"></a><span class="lineno"> 4966</span>&#160;                                    $newSQL = preg_replace($preg_pattern_change, <span class="stringliteral">&#39;$1$2,$3$4$5$6)&#39;</span>, $createtesttableSQL);</div><div class="line"><a name="l04967"></a><span class="lineno"> 4967</span>&#160;                                    <span class="comment">// remove comma at the beginning if the first column is changed</span></div><div class="line"><a name="l04968"></a><span class="lineno"> 4968</span>&#160;                                    <span class="comment">// probably somebody is able to put this into the first regex (using lookahead probably).</span></div><div class="line"><a name="l04969"></a><span class="lineno"> 4969</span>&#160;                                    $newSQL = preg_replace(<span class="stringliteral">&quot;/^\s*(CREATE\s+TEMPORARY\s+TABLE\s+&quot;</span>.preg_quote($this-&gt;quote($tmpname),<span class="stringliteral">&quot;/&quot;</span>).<span class="stringliteral">&quot;\s+\(),\s*/&quot;</span>,<span class="stringliteral">&#39;$1&#39;</span>,$newSQL);</div><div class="line"><a name="l04970"></a><span class="lineno"> 4970</span>&#160;                                    <span class="keywordflow">if</span>($debug)</div><div class="line"><a name="l04971"></a><span class="lineno"> 4971</span>&#160;                                    {</div><div class="line"><a name="l04972"></a><span class="lineno"> 4972</span>&#160;                                        echo <span class="stringliteral">&quot;preg_column_to_change=(&quot;</span>.$preg_column_to_change.<span class="stringliteral">&quot;)&lt;hr /&gt;&quot;</span>;</div><div class="line"><a name="l04973"></a><span class="lineno"> 4973</span>&#160;                                        echo $createtesttableSQL.<span class="stringliteral">&quot;&lt;hr /&gt;&quot;</span>;</div><div class="line"><a name="l04974"></a><span class="lineno"> 4974</span>&#160;                                        echo $newSQL.<span class="stringliteral">&quot;&lt;hr /&gt;&quot;</span>;</div><div class="line"><a name="l04975"></a><span class="lineno"> 4975</span>&#160;    </div><div class="line"><a name="l04976"></a><span class="lineno"> 4976</span>&#160;                                        echo $preg_pattern_change.<span class="stringliteral">&quot;&lt;hr /&gt;&quot;</span>;</div><div class="line"><a name="l04977"></a><span class="lineno"> 4977</span>&#160;                                    }</div><div class="line"><a name="l04978"></a><span class="lineno"> 4978</span>&#160;                                    <span class="keywordflow">if</span>($newSQL!=$createtesttableSQL &amp;&amp; $newSQL!=<span class="stringliteral">&quot;&quot;</span>) <span class="comment">// pattern did match, so PRIMARY KEY constraint removed :)</span></div><div class="line"><a name="l04979"></a><span class="lineno"> 4979</span>&#160;                                    {</div><div class="line"><a name="l04980"></a><span class="lineno"> 4980</span>&#160;                                        $createtesttableSQL = $newSQL;</div><div class="line"><a name="l04981"></a><span class="lineno"> 4981</span>&#160;                                        <span class="keywordflow">if</span>($debug) echo <span class="stringliteral">&quot;&lt;br&gt;SUCCEEDED&lt;br&gt;&quot;</span>;</div><div class="line"><a name="l04982"></a><span class="lineno"> 4982</span>&#160;                                    }</div><div class="line"><a name="l04983"></a><span class="lineno"> 4983</span>&#160;                                    <span class="keywordflow">else</span></div><div class="line"><a name="l04984"></a><span class="lineno"> 4984</span>&#160;                                    {</div><div class="line"><a name="l04985"></a><span class="lineno"> 4985</span>&#160;                                        <span class="keywordflow">if</span>($debug) echo <span class="stringliteral">&quot;NO LUCK&quot;</span>;</div><div class="line"><a name="l04986"></a><span class="lineno"> 4986</span>&#160;                                        <span class="comment">// TODO: try removing table constraint</span></div><div class="line"><a name="l04987"></a><span class="lineno"> 4987</span>&#160;                                        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l04988"></a><span class="lineno"> 4988</span>&#160;                                    }</div><div class="line"><a name="l04989"></a><span class="lineno"> 4989</span>&#160;                                    $createtesttableSQL = $newSQL;</div><div class="line"><a name="l04990"></a><span class="lineno"> 4990</span>&#160;                                } <span class="keywordflow">else</span></div><div class="line"><a name="l04991"></a><span class="lineno"> 4991</span>&#160;                                    <span class="comment">// TODO: Try removing table constraint</span></div><div class="line"><a name="l04992"></a><span class="lineno"> 4992</span>&#160;                                    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l04993"></a><span class="lineno"> 4993</span>&#160;                                </div><div class="line"><a name="l04994"></a><span class="lineno"> 4994</span>&#160;                                <span class="keywordflow">break</span>;</div><div class="line"><a name="l04995"></a><span class="lineno"> 4995</span>&#160;                            <span class="keywordflow">default</span>:</div><div class="line"><a name="l04996"></a><span class="lineno"> 4996</span>&#160;                                <span class="keywordflow">if</span>($debug) echo <span class="stringliteral">&#39;ERROR: unknown alter operation!&lt;hr /&gt;&#39;</span>;</div><div class="line"><a name="l04997"></a><span class="lineno"> 4997</span>&#160;                                $this-&gt;alterError = $errormsg . $lang[<span class="stringliteral">&#39;alter_unknown_operation&#39;</span>];</div><div class="line"><a name="l04998"></a><span class="lineno"> 4998</span>&#160;                                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l04999"></a><span class="lineno"> 4999</span>&#160;                        }</div><div class="line"><a name="l05000"></a><span class="lineno"> 5000</span>&#160;                    }</div><div class="line"><a name="l05001"></a><span class="lineno"> 5001</span>&#160;                    $droptempsql = <span class="stringliteral">&#39;DROP TABLE &#39;</span>.$this-&gt;quote_id($tmpname);</div><div class="line"><a name="l05002"></a><span class="lineno"> 5002</span>&#160;</div><div class="line"><a name="l05003"></a><span class="lineno"> 5003</span>&#160;                    $createnewtableSQL = <span class="stringliteral">&quot;CREATE TABLE &quot;</span>.$this-&gt;quote($table_new).<span class="stringliteral">&quot; &quot;</span>.preg_replace(<span class="stringliteral">&quot;/^\s*CREATE\s+TEMPORARY\s+TABLE\s+&#39;?&quot;</span>.str_replace(<span class="stringliteral">&quot;&#39;&quot;</span>,<span class="stringliteral">&quot;&#39;&#39;&quot;</span>,preg_quote($tmpname,<span class="stringliteral">&quot;/&quot;</span>)).<span class="stringliteral">&quot;&#39;?\s+(.*)$/is&quot;</span>, <span class="stringliteral">&#39;$1&#39;</span>, $createtesttableSQL, 1);</div><div class="line"><a name="l05004"></a><span class="lineno"> 5004</span>&#160;</div><div class="line"><a name="l05005"></a><span class="lineno"> 5005</span>&#160;                    $newcolumns = <span class="stringliteral">&#39;&#39;</span>;</div><div class="line"><a name="l05006"></a><span class="lineno"> 5006</span>&#160;                    $oldcolumns = <span class="stringliteral">&#39;&#39;</span>;</div><div class="line"><a name="l05007"></a><span class="lineno"> 5007</span>&#160;                    reset($newcols);</div><div class="line"><a name="l05008"></a><span class="lineno"> 5008</span>&#160;                    <span class="keywordflow">while</span>(list($key,$val) = each($newcols))</div><div class="line"><a name="l05009"></a><span class="lineno"> 5009</span>&#160;                    {</div><div class="line"><a name="l05010"></a><span class="lineno"> 5010</span>&#160;                        $newcolumns .= ($newcolumns?<span class="stringliteral">&#39;, &#39;</span>:<span class="stringliteral">&#39;&#39;</span>).$this-&gt;quote_id($val);</div><div class="line"><a name="l05011"></a><span class="lineno"> 5011</span>&#160;                        $oldcolumns .= ($oldcolumns?<span class="stringliteral">&#39;, &#39;</span>:<span class="stringliteral">&#39;&#39;</span>).$this-&gt;quote_id($key);</div><div class="line"><a name="l05012"></a><span class="lineno"> 5012</span>&#160;                    }</div><div class="line"><a name="l05013"></a><span class="lineno"> 5013</span>&#160;                    $copytonewsql = <span class="stringliteral">&#39;INSERT INTO &#39;</span>.$this-&gt;quote_id($table_new).<span class="charliteral">&#39;(&#39;</span>.$newcolumns.<span class="stringliteral">&#39;) SELECT &#39;</span>.$oldcolumns.<span class="stringliteral">&#39; FROM &#39;</span>.$this-&gt;quote_id($tmpname);</div><div class="line"><a name="l05014"></a><span class="lineno"> 5014</span>&#160;                }</div><div class="line"><a name="l05015"></a><span class="lineno"> 5015</span>&#160;            }</div><div class="line"><a name="l05016"></a><span class="lineno"> 5016</span>&#160;            $alter_transaction  = <span class="stringliteral">&#39;BEGIN; &#39;</span>;</div><div class="line"><a name="l05017"></a><span class="lineno"> 5017</span>&#160;            $alter_transaction .= $createtemptableSQL.<span class="stringliteral">&#39;; &#39;</span>;  <span class="comment">//create temp table</span></div><div class="line"><a name="l05018"></a><span class="lineno"> 5018</span>&#160;            $alter_transaction .= $copytotempsql.<span class="stringliteral">&#39;; &#39;</span>;       <span class="comment">//copy to table</span></div><div class="line"><a name="l05019"></a><span class="lineno"> 5019</span>&#160;            $alter_transaction .= $dropoldsql.<span class="stringliteral">&#39;; &#39;</span>;          <span class="comment">//drop old table</span></div><div class="line"><a name="l05020"></a><span class="lineno"> 5020</span>&#160;            $alter_transaction .= $createnewtableSQL.<span class="stringliteral">&#39;; &#39;</span>;   <span class="comment">//recreate original table</span></div><div class="line"><a name="l05021"></a><span class="lineno"> 5021</span>&#160;            $alter_transaction .= $copytonewsql.<span class="stringliteral">&#39;; &#39;</span>;        <span class="comment">//copy back to original table</span></div><div class="line"><a name="l05022"></a><span class="lineno"> 5022</span>&#160;            $alter_transaction .= $droptempsql.<span class="stringliteral">&#39;; &#39;</span>;         <span class="comment">//drop temp table</span></div><div class="line"><a name="l05023"></a><span class="lineno"> 5023</span>&#160;</div><div class="line"><a name="l05024"></a><span class="lineno"> 5024</span>&#160;            $preg_index=<span class="stringliteral">&quot;/^\s*(CREATE\s+(?:UNIQUE\s+)?INDEX\s+(?:&quot;</span>.$this-&gt;sqlite_surroundings_preg(<span class="stringliteral">&quot;+&quot;</span>,<span class="keyword">false</span>,<span class="stringliteral">&quot; &#39;\&quot;\[`&quot;</span>).<span class="stringliteral">&quot;\s*)*ON\s+)(&quot;</span>.$this-&gt;sqlite_surroundings_preg($table).<span class="stringliteral">&quot;)(\s*\((?:&quot;</span>.$this-&gt;sqlite_surroundings_preg(<span class="stringliteral">&quot;+&quot;</span>,<span class="keyword">false</span>,<span class="stringliteral">&quot; &#39;\&quot;\[`&quot;</span>).<span class="stringliteral">&quot;\s*)*\)\s*)\s*$/i&quot;</span>;               </div><div class="line"><a name="l05025"></a><span class="lineno"> 5025</span>&#160;            <span class="keywordflow">foreach</span>($recreateQueries as $recreate_query)</div><div class="line"><a name="l05026"></a><span class="lineno"> 5026</span>&#160;            {</div><div class="line"><a name="l05027"></a><span class="lineno"> 5027</span>&#160;                <span class="keywordflow">if</span>($recreate_query[<span class="stringliteral">&#39;type&#39;</span>]==<span class="stringliteral">&#39;index&#39;</span>)</div><div class="line"><a name="l05028"></a><span class="lineno"> 5028</span>&#160;                {</div><div class="line"><a name="l05029"></a><span class="lineno"> 5029</span>&#160;                    <span class="comment">// this is an index. We need to make sure the index is not on a column that we drop. If it is, we drop the index as well.</span></div><div class="line"><a name="l05030"></a><span class="lineno"> 5030</span>&#160;                    $indexInfos = $this-&gt;selectArray(<span class="stringliteral">&#39;PRAGMA index_info(&#39;</span>.$this-&gt;quote_id($recreate_query[<span class="stringliteral">&#39;name&#39;</span>]).<span class="charliteral">&#39;)&#39;</span>);</div><div class="line"><a name="l05031"></a><span class="lineno"> 5031</span>&#160;                    <span class="keywordflow">foreach</span>($indexInfos as $indexInfo)</div><div class="line"><a name="l05032"></a><span class="lineno"> 5032</span>&#160;                    {</div><div class="line"><a name="l05033"></a><span class="lineno"> 5033</span>&#160;                        <span class="keywordflow">if</span>(!isset($newcols[$indexInfo[<span class="stringliteral">&#39;name&#39;</span>]]))</div><div class="line"><a name="l05034"></a><span class="lineno"> 5034</span>&#160;                        {</div><div class="line"><a name="l05035"></a><span class="lineno"> 5035</span>&#160;                            <span class="keywordflow">if</span>($debug) echo <span class="stringliteral">&#39;Not recreating the following index: &lt;hr /&gt;&#39;</span>.htmlencode($recreate_query[<span class="stringliteral">&#39;sql&#39;</span>]).<span class="stringliteral">&#39;&lt;hr /&gt;&#39;</span>; </div><div class="line"><a name="l05036"></a><span class="lineno"> 5036</span>&#160;                            <span class="comment">// Index on a column that was dropped. Skip recreation.</span></div><div class="line"><a name="l05037"></a><span class="lineno"> 5037</span>&#160;                            <span class="keywordflow">continue</span> 2;</div><div class="line"><a name="l05038"></a><span class="lineno"> 5038</span>&#160;                        }</div><div class="line"><a name="l05039"></a><span class="lineno"> 5039</span>&#160;                    }</div><div class="line"><a name="l05040"></a><span class="lineno"> 5040</span>&#160;                }</div><div class="line"><a name="l05041"></a><span class="lineno"> 5041</span>&#160;                <span class="comment">// TODO: In case we renamed a column on which there is an index, we need to recreate the index with the column name adjusted.</span></div><div class="line"><a name="l05042"></a><span class="lineno"> 5042</span>&#160;                </div><div class="line"><a name="l05043"></a><span class="lineno"> 5043</span>&#160;                <span class="comment">// recreate triggers / indexes</span></div><div class="line"><a name="l05044"></a><span class="lineno"> 5044</span>&#160;                <span class="keywordflow">if</span>($table == $table_new)</div><div class="line"><a name="l05045"></a><span class="lineno"> 5045</span>&#160;                {</div><div class="line"><a name="l05046"></a><span class="lineno"> 5046</span>&#160;                    <span class="comment">// we had no RENAME TO, so we can recreate indexes/triggers just like the original ones</span></div><div class="line"><a name="l05047"></a><span class="lineno"> 5047</span>&#160;                    $alter_transaction .= $recreate_query[<span class="stringliteral">&#39;sql&#39;</span>].<span class="charliteral">&#39;;&#39;</span>;</div><div class="line"><a name="l05048"></a><span class="lineno"> 5048</span>&#160;                } <span class="keywordflow">else</span></div><div class="line"><a name="l05049"></a><span class="lineno"> 5049</span>&#160;                {</div><div class="line"><a name="l05050"></a><span class="lineno"> 5050</span>&#160;                    <span class="comment">// we had a RENAME TO, so we need to exchange the table-name in the CREATE-SQL of triggers &amp; indexes</span></div><div class="line"><a name="l05051"></a><span class="lineno"> 5051</span>&#160;                    <span class="keywordflow">switch</span> ($recreate_query[<span class="stringliteral">&#39;type&#39;</span>])</div><div class="line"><a name="l05052"></a><span class="lineno"> 5052</span>&#160;                    {</div><div class="line"><a name="l05053"></a><span class="lineno"> 5053</span>&#160;                        <span class="keywordflow">case</span> <span class="stringliteral">&#39;index&#39;</span>:</div><div class="line"><a name="l05054"></a><span class="lineno"> 5054</span>&#160;                            $recreate_queryIndex = preg_replace($preg_index, <span class="stringliteral">&#39;$1&#39;</span>.$this-&gt;quote_id(strtr($table_new, array(<span class="charliteral">&#39;\\&#39;</span> =&gt; <span class="stringliteral">&#39;\\\\&#39;</span>, <span class="charliteral">&#39;$&#39;</span> =&gt; <span class="charliteral">&#39;\$&#39;</span>))).<span class="stringliteral">&#39;$3 &#39;</span>, $recreate_query[<span class="stringliteral">&#39;sql&#39;</span>]);</div><div class="line"><a name="l05055"></a><span class="lineno"> 5055</span>&#160;                            <span class="keywordflow">if</span>($recreate_queryIndex!=$recreate_query[<span class="stringliteral">&#39;sql&#39;</span>] &amp;&amp; $recreate_queryIndex != NULL)</div><div class="line"><a name="l05056"></a><span class="lineno"> 5056</span>&#160;                                $alter_transaction .= $recreate_queryIndex.<span class="charliteral">&#39;;&#39;</span>;</div><div class="line"><a name="l05057"></a><span class="lineno"> 5057</span>&#160;                            <span class="keywordflow">else</span></div><div class="line"><a name="l05058"></a><span class="lineno"> 5058</span>&#160;                            {</div><div class="line"><a name="l05059"></a><span class="lineno"> 5059</span>&#160;                                <span class="comment">// the CREATE INDEX regex did not match. this normally should not happen</span></div><div class="line"><a name="l05060"></a><span class="lineno"> 5060</span>&#160;                                <span class="keywordflow">if</span>($debug) echo  <span class="stringliteral">&#39;ERROR: CREATE INDEX regex did not match!?&lt;hr /&gt;&#39;</span>;</div><div class="line"><a name="l05061"></a><span class="lineno"> 5061</span>&#160;                                <span class="comment">// just try to recreate the index originally (will fail most likely)</span></div><div class="line"><a name="l05062"></a><span class="lineno"> 5062</span>&#160;                                $alter_transaction .= $recreate_query[<span class="stringliteral">&#39;sql&#39;</span>].<span class="charliteral">&#39;;&#39;</span>;</div><div class="line"><a name="l05063"></a><span class="lineno"> 5063</span>&#160;                            }</div><div class="line"><a name="l05064"></a><span class="lineno"> 5064</span>&#160;                            <span class="keywordflow">break</span>;</div><div class="line"><a name="l05065"></a><span class="lineno"> 5065</span>&#160;                            </div><div class="line"><a name="l05066"></a><span class="lineno"> 5066</span>&#160;                        <span class="keywordflow">case</span> <span class="stringliteral">&#39;trigger&#39;</span>:</div><div class="line"><a name="l05067"></a><span class="lineno"> 5067</span>&#160;                            <span class="comment">// TODO: IMPLEMENT</span></div><div class="line"><a name="l05068"></a><span class="lineno"> 5068</span>&#160;                            $alter_transaction .= $recreate_query[<span class="stringliteral">&#39;sql&#39;</span>].<span class="charliteral">&#39;;&#39;</span>;</div><div class="line"><a name="l05069"></a><span class="lineno"> 5069</span>&#160;                            <span class="keywordflow">break</span>;</div><div class="line"><a name="l05070"></a><span class="lineno"> 5070</span>&#160;                        <span class="keywordflow">default</span>:</div><div class="line"><a name="l05071"></a><span class="lineno"> 5071</span>&#160;                            <span class="keywordflow">if</span>($debug) echo <span class="stringliteral">&#39;ERROR: Unknown type &#39;</span>.htmlencode($recreate_query[<span class="stringliteral">&#39;type&#39;</span>]).<span class="stringliteral">&#39;&lt;hr /&gt;&#39;</span>;</div><div class="line"><a name="l05072"></a><span class="lineno"> 5072</span>&#160;                            $alter_transaction .= $recreate_query[<span class="stringliteral">&#39;sql&#39;</span>].<span class="charliteral">&#39;;&#39;</span>;</div><div class="line"><a name="l05073"></a><span class="lineno"> 5073</span>&#160;                    }</div><div class="line"><a name="l05074"></a><span class="lineno"> 5074</span>&#160;                }</div><div class="line"><a name="l05075"></a><span class="lineno"> 5075</span>&#160;            }</div><div class="line"><a name="l05076"></a><span class="lineno"> 5076</span>&#160;            $alter_transaction .= <span class="stringliteral">&#39;COMMIT;&#39;</span>;</div><div class="line"><a name="l05077"></a><span class="lineno"> 5077</span>&#160;            <span class="keywordflow">if</span>($debug) echo $alter_transaction;</div><div class="line"><a name="l05078"></a><span class="lineno"> 5078</span>&#160;            <span class="keywordflow">return</span> $this-&gt;multiQuery($alter_transaction);</div><div class="line"><a name="l05079"></a><span class="lineno"> 5079</span>&#160;        }</div><div class="line"><a name="l05080"></a><span class="lineno"> 5080</span>&#160;    }</div><div class="line"><a name="l05081"></a><span class="lineno"> 5081</span>&#160;</div><div class="line"><a name="l05082"></a><span class="lineno"> 5082</span>&#160;    <span class="comment">//multiple query execution</span></div><div class="line"><a name="l05083"></a><span class="lineno"> 5083</span>&#160;    <span class="comment">//returns true on success, false otherwise. Use getError() to fetch the error.</span></div><div class="line"><a name="l05084"></a><span class="lineno"> 5084</span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> multiQuery($query)</div><div class="line"><a name="l05085"></a><span class="lineno"> 5085</span>&#160;    {</div><div class="line"><a name="l05086"></a><span class="lineno"> 5086</span>&#160;        <span class="keywordflow">if</span>($this-&gt;type==<span class="stringliteral">&quot;PDO&quot;</span>)</div><div class="line"><a name="l05087"></a><span class="lineno"> 5087</span>&#160;            $success = $this-&gt;db-&gt;exec($query);</div><div class="line"><a name="l05088"></a><span class="lineno"> 5088</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>($this-&gt;type==<span class="stringliteral">&quot;SQLite3&quot;</span>)</div><div class="line"><a name="l05089"></a><span class="lineno"> 5089</span>&#160;            $success = $this-&gt;db-&gt;exec($query);</div><div class="line"><a name="l05090"></a><span class="lineno"> 5090</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l05091"></a><span class="lineno"> 5091</span>&#160;            $success = $this-&gt;db-&gt;queryExec($query, $error);</div><div class="line"><a name="l05092"></a><span class="lineno"> 5092</span>&#160;        <span class="keywordflow">return</span> $success;</div><div class="line"><a name="l05093"></a><span class="lineno"> 5093</span>&#160;    }</div><div class="line"><a name="l05094"></a><span class="lineno"> 5094</span>&#160;</div><div class="line"><a name="l05095"></a><span class="lineno"> 5095</span>&#160;    </div><div class="line"><a name="l05096"></a><span class="lineno"> 5096</span>&#160;    <span class="comment">// checks whether a table has a primary key</span></div><div class="line"><a name="l05097"></a><span class="lineno"> 5097</span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> hasPrimaryKey($table)</div><div class="line"><a name="l05098"></a><span class="lineno"> 5098</span>&#160;    {</div><div class="line"><a name="l05099"></a><span class="lineno"> 5099</span>&#160;        $query = <span class="stringliteral">&quot;PRAGMA table_info(&quot;</span>.$this-&gt;quote_id($table).<span class="stringliteral">&quot;)&quot;</span>;</div><div class="line"><a name="l05100"></a><span class="lineno"> 5100</span>&#160;        $table_info = $this-&gt;selectArray($query);</div><div class="line"><a name="l05101"></a><span class="lineno"> 5101</span>&#160;        <span class="keywordflow">foreach</span>($table_info as $row_id =&gt; $row_data)</div><div class="line"><a name="l05102"></a><span class="lineno"> 5102</span>&#160;        {</div><div class="line"><a name="l05103"></a><span class="lineno"> 5103</span>&#160;            <span class="keywordflow">if</span>($row_data[<span class="stringliteral">&#39;pk&#39;</span>])</div><div class="line"><a name="l05104"></a><span class="lineno"> 5104</span>&#160;            {</div><div class="line"><a name="l05105"></a><span class="lineno"> 5105</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l05106"></a><span class="lineno"> 5106</span>&#160;            }</div><div class="line"><a name="l05107"></a><span class="lineno"> 5107</span>&#160;         </div><div class="line"><a name="l05108"></a><span class="lineno"> 5108</span>&#160;        }</div><div class="line"><a name="l05109"></a><span class="lineno"> 5109</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l05110"></a><span class="lineno"> 5110</span>&#160;    }</div><div class="line"><a name="l05111"></a><span class="lineno"> 5111</span>&#160;    </div><div class="line"><a name="l05112"></a><span class="lineno"> 5112</span>&#160;    <span class="comment">// Returns an array of columns by which rows can be uniquely adressed.</span></div><div class="line"><a name="l05113"></a><span class="lineno"> 5113</span>&#160;    <span class="comment">// For tables with a rowid column, this is always array(&#39;rowid&#39;)</span></div><div class="line"><a name="l05114"></a><span class="lineno"> 5114</span>&#160;    <span class="comment">// for tables without rowid, this is an array of the primary key columns. </span></div><div class="line"><a name="l05115"></a><span class="lineno"> 5115</span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> getPrimaryKey($table)</div><div class="line"><a name="l05116"></a><span class="lineno"> 5116</span>&#160;    {</div><div class="line"><a name="l05117"></a><span class="lineno"> 5117</span>&#160;        $primary_key = array();</div><div class="line"><a name="l05118"></a><span class="lineno"> 5118</span>&#160;        <span class="comment">// check if this table has a rowid</span></div><div class="line"><a name="l05119"></a><span class="lineno"> 5119</span>&#160;        $getRowID = $this-&gt;select(<span class="stringliteral">&#39;SELECT ROWID FROM &#39;</span>.$this-&gt;quote_id($table).<span class="stringliteral">&#39; LIMIT 0,1&#39;</span>);</div><div class="line"><a name="l05120"></a><span class="lineno"> 5120</span>&#160;        <span class="keywordflow">if</span>(isset($getRowID[0]))</div><div class="line"><a name="l05121"></a><span class="lineno"> 5121</span>&#160;            <span class="comment">// it has, so we prefer addressing rows by rowid            </span></div><div class="line"><a name="l05122"></a><span class="lineno"> 5122</span>&#160;            <span class="keywordflow">return</span> array(<span class="stringliteral">&#39;rowid&#39;</span>);</div><div class="line"><a name="l05123"></a><span class="lineno"> 5123</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l05124"></a><span class="lineno"> 5124</span>&#160;        {</div><div class="line"><a name="l05125"></a><span class="lineno"> 5125</span>&#160;            <span class="comment">// the table is without rowid, so use the primary key</span></div><div class="line"><a name="l05126"></a><span class="lineno"> 5126</span>&#160;            $query = <span class="stringliteral">&quot;PRAGMA table_info(&quot;</span>.$this-&gt;quote_id($table).<span class="stringliteral">&quot;)&quot;</span>;</div><div class="line"><a name="l05127"></a><span class="lineno"> 5127</span>&#160;            $table_info = $this-&gt;selectArray($query);</div><div class="line"><a name="l05128"></a><span class="lineno"> 5128</span>&#160;            <span class="keywordflow">foreach</span>($table_info as $row_id =&gt; $row_data)</div><div class="line"><a name="l05129"></a><span class="lineno"> 5129</span>&#160;            {</div><div class="line"><a name="l05130"></a><span class="lineno"> 5130</span>&#160;                <span class="keywordflow">if</span>($row_data[<span class="stringliteral">&#39;pk&#39;</span>])</div><div class="line"><a name="l05131"></a><span class="lineno"> 5131</span>&#160;                    $primary_key[] = $row_data[<span class="stringliteral">&#39;name&#39;</span>];</div><div class="line"><a name="l05132"></a><span class="lineno"> 5132</span>&#160;            }</div><div class="line"><a name="l05133"></a><span class="lineno"> 5133</span>&#160;        }</div><div class="line"><a name="l05134"></a><span class="lineno"> 5134</span>&#160;        <span class="keywordflow">return</span> $primary_key;</div><div class="line"><a name="l05135"></a><span class="lineno"> 5135</span>&#160;    }</div><div class="line"><a name="l05136"></a><span class="lineno"> 5136</span>&#160;    </div><div class="line"><a name="l05137"></a><span class="lineno"> 5137</span>&#160;    <span class="comment">// selects a row by a given key $pk, which is an array of values</span></div><div class="line"><a name="l05138"></a><span class="lineno"> 5138</span>&#160;    <span class="comment">// for the columns by which a row can be adressed (rowid or primary key)</span></div><div class="line"><a name="l05139"></a><span class="lineno"> 5139</span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> wherePK($table, $pk)</div><div class="line"><a name="l05140"></a><span class="lineno"> 5140</span>&#160;    {</div><div class="line"><a name="l05141"></a><span class="lineno"> 5141</span>&#160;        $where = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l05142"></a><span class="lineno"> 5142</span>&#160;        $primary_key = $this-&gt;getPrimaryKey($table);</div><div class="line"><a name="l05143"></a><span class="lineno"> 5143</span>&#160;        <span class="keywordflow">foreach</span>($primary_key as $pk_index =&gt; $column)</div><div class="line"><a name="l05144"></a><span class="lineno"> 5144</span>&#160;        {</div><div class="line"><a name="l05145"></a><span class="lineno"> 5145</span>&#160;            <span class="keywordflow">if</span>($where!=<span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l05146"></a><span class="lineno"> 5146</span>&#160;                $where .= <span class="stringliteral">&quot; AND &quot;</span>;</div><div class="line"><a name="l05147"></a><span class="lineno"> 5147</span>&#160;            $where .= $this-&gt;quote_id($column) . <span class="stringliteral">&#39; = &#39;</span>;</div><div class="line"><a name="l05148"></a><span class="lineno"> 5148</span>&#160;            <span class="keywordflow">if</span>(is_int($pk[$pk_index]) || is_float($pk[$pk_index]))</div><div class="line"><a name="l05149"></a><span class="lineno"> 5149</span>&#160;                $where .= $pk[$pk_index];</div><div class="line"><a name="l05150"></a><span class="lineno"> 5150</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l05151"></a><span class="lineno"> 5151</span>&#160;                $where .= $this-&gt;quote($pk[$pk_index]);</div><div class="line"><a name="l05152"></a><span class="lineno"> 5152</span>&#160;        }</div><div class="line"><a name="l05153"></a><span class="lineno"> 5153</span>&#160;        <span class="keywordflow">return</span> $where;</div><div class="line"><a name="l05154"></a><span class="lineno"> 5154</span>&#160;    }</div><div class="line"><a name="l05155"></a><span class="lineno"> 5155</span>&#160;</div><div class="line"><a name="l05156"></a><span class="lineno"> 5156</span>&#160;    <span class="comment">//get number of rows in table</span></div><div class="line"><a name="l05157"></a><span class="lineno"> 5157</span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> numRows($table, $dontTakeLong = <span class="keyword">false</span>)</div><div class="line"><a name="l05158"></a><span class="lineno"> 5158</span>&#160;    {</div><div class="line"><a name="l05159"></a><span class="lineno"> 5159</span>&#160;        <span class="comment">// as Count(*) can be slow on huge tables without PK,</span></div><div class="line"><a name="l05160"></a><span class="lineno"> 5160</span>&#160;        <span class="comment">// if $dontTakeLong is set and the size is &gt; 2MB only count() if there is a PK</span></div><div class="line"><a name="l05161"></a><span class="lineno"> 5161</span>&#160;        <span class="keywordflow">if</span>(!$dontTakeLong || $this-&gt;getSize() &lt;= 2000 || $this-&gt;hasPrimaryKey($table))</div><div class="line"><a name="l05162"></a><span class="lineno"> 5162</span>&#160;        {</div><div class="line"><a name="l05163"></a><span class="lineno"> 5163</span>&#160;            $result = $this-&gt;select(<span class="stringliteral">&quot;SELECT Count(*) FROM &quot;</span>.$this-&gt;quote_id($table));</div><div class="line"><a name="l05164"></a><span class="lineno"> 5164</span>&#160;            <span class="keywordflow">return</span> $result[0];</div><div class="line"><a name="l05165"></a><span class="lineno"> 5165</span>&#160;        } <span class="keywordflow">else</span></div><div class="line"><a name="l05166"></a><span class="lineno"> 5166</span>&#160;        {</div><div class="line"><a name="l05167"></a><span class="lineno"> 5167</span>&#160;            <span class="keywordflow">return</span> <span class="charliteral">&#39;?&#39;</span>;</div><div class="line"><a name="l05168"></a><span class="lineno"> 5168</span>&#160;        }</div><div class="line"><a name="l05169"></a><span class="lineno"> 5169</span>&#160;    }</div><div class="line"><a name="l05170"></a><span class="lineno"> 5170</span>&#160;</div><div class="line"><a name="l05171"></a><span class="lineno"> 5171</span>&#160;    <span class="comment">//correctly escape a string to be injected into an SQL query</span></div><div class="line"><a name="l05172"></a><span class="lineno"> 5172</span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> quote($value)</div><div class="line"><a name="l05173"></a><span class="lineno"> 5173</span>&#160;    {</div><div class="line"><a name="l05174"></a><span class="lineno"> 5174</span>&#160;        <span class="keywordflow">if</span>($this-&gt;type==<span class="stringliteral">&quot;PDO&quot;</span>)</div><div class="line"><a name="l05175"></a><span class="lineno"> 5175</span>&#160;        {</div><div class="line"><a name="l05176"></a><span class="lineno"> 5176</span>&#160;            <span class="comment">// PDO quote() escapes and adds quotes</span></div><div class="line"><a name="l05177"></a><span class="lineno"> 5177</span>&#160;            <span class="keywordflow">return</span> $this-&gt;db-&gt;quote($value);</div><div class="line"><a name="l05178"></a><span class="lineno"> 5178</span>&#160;        }</div><div class="line"><a name="l05179"></a><span class="lineno"> 5179</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>($this-&gt;type==<span class="stringliteral">&quot;SQLite3&quot;</span>)</div><div class="line"><a name="l05180"></a><span class="lineno"> 5180</span>&#160;        {</div><div class="line"><a name="l05181"></a><span class="lineno"> 5181</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;&#39;&quot;</span>.$this-&gt;db-&gt;escapeString($value).<span class="stringliteral">&quot;&#39;&quot;</span>;</div><div class="line"><a name="l05182"></a><span class="lineno"> 5182</span>&#160;        }</div><div class="line"><a name="l05183"></a><span class="lineno"> 5183</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l05184"></a><span class="lineno"> 5184</span>&#160;        {</div><div class="line"><a name="l05185"></a><span class="lineno"> 5185</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;&#39;&quot;</span>.sqlite_escape_string($value).<span class="stringliteral">&quot;&#39;&quot;</span>;</div><div class="line"><a name="l05186"></a><span class="lineno"> 5186</span>&#160;        }</div><div class="line"><a name="l05187"></a><span class="lineno"> 5187</span>&#160;    }</div><div class="line"><a name="l05188"></a><span class="lineno"> 5188</span>&#160;</div><div class="line"><a name="l05189"></a><span class="lineno"> 5189</span>&#160;    <span class="comment">//correctly escape an identifier (column / table / trigger / index name) to be injected into an SQL query</span></div><div class="line"><a name="l05190"></a><span class="lineno"> 5190</span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> quote_id($value)</div><div class="line"><a name="l05191"></a><span class="lineno"> 5191</span>&#160;    {</div><div class="line"><a name="l05192"></a><span class="lineno"> 5192</span>&#160;        <span class="comment">// double-quotes need to be escaped by doubling them</span></div><div class="line"><a name="l05193"></a><span class="lineno"> 5193</span>&#160;        $value = str_replace(<span class="charliteral">&#39;&quot;&#39;</span>,<span class="stringliteral">&#39;&quot;&quot;&#39;</span>,$value);</div><div class="line"><a name="l05194"></a><span class="lineno"> 5194</span>&#160;        <span class="keywordflow">return</span> <span class="charliteral">&#39;&quot;&#39;</span>.$value.<span class="charliteral">&#39;&quot;&#39;</span>;</div><div class="line"><a name="l05195"></a><span class="lineno"> 5195</span>&#160;    }</div><div class="line"><a name="l05196"></a><span class="lineno"> 5196</span>&#160;</div><div class="line"><a name="l05197"></a><span class="lineno"> 5197</span>&#160;</div><div class="line"><a name="l05198"></a><span class="lineno"> 5198</span>&#160;    <span class="comment">//import sql</span></div><div class="line"><a name="l05199"></a><span class="lineno"> 5199</span>&#160;    <span class="comment">//returns true on success, error message otherwise</span></div><div class="line"><a name="l05200"></a><span class="lineno"> 5200</span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> import_sql($query)</div><div class="line"><a name="l05201"></a><span class="lineno"> 5201</span>&#160;    {</div><div class="line"><a name="l05202"></a><span class="lineno"> 5202</span>&#160;        $import = $this-&gt;multiQuery($query);</div><div class="line"><a name="l05203"></a><span class="lineno"> 5203</span>&#160;        <span class="keywordflow">if</span>(!$import)</div><div class="line"><a name="l05204"></a><span class="lineno"> 5204</span>&#160;            <span class="keywordflow">return</span> $this-&gt;getError();</div><div class="line"><a name="l05205"></a><span class="lineno"> 5205</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l05206"></a><span class="lineno"> 5206</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l05207"></a><span class="lineno"> 5207</span>&#160;    }</div><div class="line"><a name="l05208"></a><span class="lineno"> 5208</span>&#160;    </div><div class="line"><a name="l05209"></a><span class="lineno"> 5209</span>&#160;    <span class="comment">//import csv</span></div><div class="line"><a name="l05210"></a><span class="lineno"> 5210</span>&#160;    <span class="comment">//returns true on success, error message otherwise</span></div><div class="line"><a name="l05211"></a><span class="lineno"> 5211</span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> import_csv($filename, $table, $field_terminate, $field_enclosed, $field_escaped, $null, $fields_in_first_row)</div><div class="line"><a name="l05212"></a><span class="lineno"> 5212</span>&#160;    {</div><div class="line"><a name="l05213"></a><span class="lineno"> 5213</span>&#160;        <span class="comment">// CSV import implemented by Christopher Kramer - http://www.christosoft.de</span></div><div class="line"><a name="l05214"></a><span class="lineno"> 5214</span>&#160;        $csv_handle = fopen($filename,<span class="charliteral">&#39;r&#39;</span>);</div><div class="line"><a name="l05215"></a><span class="lineno"> 5215</span>&#160;        $csv_insert = <span class="stringliteral">&quot;BEGIN;\n&quot;</span>;</div><div class="line"><a name="l05216"></a><span class="lineno"> 5216</span>&#160;        $csv_number_of_rows = 0;</div><div class="line"><a name="l05217"></a><span class="lineno"> 5217</span>&#160;        <span class="comment">// PHP requires enclosure defined, but has no problem if it was not used</span></div><div class="line"><a name="l05218"></a><span class="lineno"> 5218</span>&#160;        <span class="keywordflow">if</span>($field_enclosed==<span class="stringliteral">&quot;&quot;</span>) $field_enclosed=<span class="charliteral">&#39;&quot;&#39;</span>;</div><div class="line"><a name="l05219"></a><span class="lineno"> 5219</span>&#160;        <span class="comment">// PHP requires escaper defined</span></div><div class="line"><a name="l05220"></a><span class="lineno"> 5220</span>&#160;        <span class="keywordflow">if</span>($field_escaped==<span class="stringliteral">&quot;&quot;</span>) $field_escaped=<span class="charliteral">&#39;\\&#39;</span>;</div><div class="line"><a name="l05221"></a><span class="lineno"> 5221</span>&#160;        <span class="keywordflow">while</span>(!feof($csv_handle))</div><div class="line"><a name="l05222"></a><span class="lineno"> 5222</span>&#160;        {</div><div class="line"><a name="l05223"></a><span class="lineno"> 5223</span>&#160;            $csv_data = fgetcsv($csv_handle, 0, $field_terminate, $field_enclosed, $field_escaped); </div><div class="line"><a name="l05224"></a><span class="lineno"> 5224</span>&#160;            <span class="keywordflow">if</span>($csv_data[0] != NULL || count($csv_data)&gt;1)</div><div class="line"><a name="l05225"></a><span class="lineno"> 5225</span>&#160;            {</div><div class="line"><a name="l05226"></a><span class="lineno"> 5226</span>&#160;                $csv_number_of_rows++;</div><div class="line"><a name="l05227"></a><span class="lineno"> 5227</span>&#160;                <span class="keywordflow">if</span>($fields_in_first_row &amp;&amp; $csv_number_of_rows==1)</div><div class="line"><a name="l05228"></a><span class="lineno"> 5228</span>&#160;                {</div><div class="line"><a name="l05229"></a><span class="lineno"> 5229</span>&#160;                    $fields_in_first_row = <span class="keyword">false</span>;</div><div class="line"><a name="l05230"></a><span class="lineno"> 5230</span>&#160;                    <span class="keywordflow">continue</span>; </div><div class="line"><a name="l05231"></a><span class="lineno"> 5231</span>&#160;                }</div><div class="line"><a name="l05232"></a><span class="lineno"> 5232</span>&#160;                $csv_col_number = count($csv_data);</div><div class="line"><a name="l05233"></a><span class="lineno"> 5233</span>&#160;                $csv_insert .= <span class="stringliteral">&quot;INSERT INTO &quot;</span>.$this-&gt;quote_id($table).<span class="stringliteral">&quot; VALUES (&quot;</span>;</div><div class="line"><a name="l05234"></a><span class="lineno"> 5234</span>&#160;                <span class="keywordflow">foreach</span>($csv_data as $csv_col =&gt; $csv_cell)</div><div class="line"><a name="l05235"></a><span class="lineno"> 5235</span>&#160;                {</div><div class="line"><a name="l05236"></a><span class="lineno"> 5236</span>&#160;                    <span class="keywordflow">if</span>($csv_cell == $null) $csv_insert .= <span class="stringliteral">&quot;NULL&quot;</span>;</div><div class="line"><a name="l05237"></a><span class="lineno"> 5237</span>&#160;                    <span class="keywordflow">else</span></div><div class="line"><a name="l05238"></a><span class="lineno"> 5238</span>&#160;                    {</div><div class="line"><a name="l05239"></a><span class="lineno"> 5239</span>&#160;                        $csv_insert.= $this-&gt;quote($csv_cell);</div><div class="line"><a name="l05240"></a><span class="lineno"> 5240</span>&#160;                    }</div><div class="line"><a name="l05241"></a><span class="lineno"> 5241</span>&#160;                    <span class="keywordflow">if</span>($csv_col == $csv_col_number-2 &amp;&amp; $csv_data[$csv_col+1]==<span class="stringliteral">&#39;&#39;</span>)</div><div class="line"><a name="l05242"></a><span class="lineno"> 5242</span>&#160;                    {</div><div class="line"><a name="l05243"></a><span class="lineno"> 5243</span>&#160;                        <span class="comment">// the CSV row ends with the separator (like old phpliteadmin exported)</span></div><div class="line"><a name="l05244"></a><span class="lineno"> 5244</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l05245"></a><span class="lineno"> 5245</span>&#160;                    } </div><div class="line"><a name="l05246"></a><span class="lineno"> 5246</span>&#160;                    <span class="keywordflow">if</span>($csv_col &lt; $csv_col_number-1) $csv_insert .= <span class="stringliteral">&quot;,&quot;</span>;</div><div class="line"><a name="l05247"></a><span class="lineno"> 5247</span>&#160;                }</div><div class="line"><a name="l05248"></a><span class="lineno"> 5248</span>&#160;                $csv_insert .= <span class="stringliteral">&quot;);\n&quot;</span>;</div><div class="line"><a name="l05249"></a><span class="lineno"> 5249</span>&#160;                </div><div class="line"><a name="l05250"></a><span class="lineno"> 5250</span>&#160;                <span class="keywordflow">if</span>($csv_number_of_rows &gt; 5000)</div><div class="line"><a name="l05251"></a><span class="lineno"> 5251</span>&#160;                {</div><div class="line"><a name="l05252"></a><span class="lineno"> 5252</span>&#160;                    $csv_insert .= <span class="stringliteral">&quot;COMMIT;\nBEGIN;\n&quot;</span>;</div><div class="line"><a name="l05253"></a><span class="lineno"> 5253</span>&#160;                    $csv_number_of_rows = 0;</div><div class="line"><a name="l05254"></a><span class="lineno"> 5254</span>&#160;                }</div><div class="line"><a name="l05255"></a><span class="lineno"> 5255</span>&#160;            }</div><div class="line"><a name="l05256"></a><span class="lineno"> 5256</span>&#160;        }</div><div class="line"><a name="l05257"></a><span class="lineno"> 5257</span>&#160;        $csv_insert .= <span class="stringliteral">&quot;COMMIT;&quot;</span>;</div><div class="line"><a name="l05258"></a><span class="lineno"> 5258</span>&#160;        fclose($csv_handle);</div><div class="line"><a name="l05259"></a><span class="lineno"> 5259</span>&#160;        $import = $this-&gt;multiQuery($csv_insert);</div><div class="line"><a name="l05260"></a><span class="lineno"> 5260</span>&#160;        <span class="keywordflow">if</span>(!$import)</div><div class="line"><a name="l05261"></a><span class="lineno"> 5261</span>&#160;            <span class="keywordflow">return</span> $this-&gt;getError();</div><div class="line"><a name="l05262"></a><span class="lineno"> 5262</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l05263"></a><span class="lineno"> 5263</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l05264"></a><span class="lineno"> 5264</span>&#160;    }</div><div class="line"><a name="l05265"></a><span class="lineno"> 5265</span>&#160;    </div><div class="line"><a name="l05266"></a><span class="lineno"> 5266</span>&#160;    <span class="comment">//export csv</span></div><div class="line"><a name="l05267"></a><span class="lineno"> 5267</span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> export_csv($tables, $field_terminate, $field_enclosed, $field_escaped, $null, $crlf, $fields_in_first_row)</div><div class="line"><a name="l05268"></a><span class="lineno"> 5268</span>&#160;    {</div><div class="line"><a name="l05269"></a><span class="lineno"> 5269</span>&#160;        $field_enclosed = $field_enclosed;</div><div class="line"><a name="l05270"></a><span class="lineno"> 5270</span>&#160;        $query = <span class="stringliteral">&quot;SELECT * FROM sqlite_master WHERE type=&#39;table&#39; or type=&#39;view&#39; ORDER BY type DESC&quot;</span>;</div><div class="line"><a name="l05271"></a><span class="lineno"> 5271</span>&#160;        $result = $this-&gt;selectArray($query);</div><div class="line"><a name="l05272"></a><span class="lineno"> 5272</span>&#160;        <span class="keywordflow">for</span>($i=0; $i&lt;<span class="keyword">sizeof</span>($result); $i++)</div><div class="line"><a name="l05273"></a><span class="lineno"> 5273</span>&#160;        {</div><div class="line"><a name="l05274"></a><span class="lineno"> 5274</span>&#160;            $valid = <span class="keyword">false</span>;</div><div class="line"><a name="l05275"></a><span class="lineno"> 5275</span>&#160;            <span class="keywordflow">for</span>($j=0; $j&lt;<span class="keyword">sizeof</span>($tables); $j++)</div><div class="line"><a name="l05276"></a><span class="lineno"> 5276</span>&#160;            {</div><div class="line"><a name="l05277"></a><span class="lineno"> 5277</span>&#160;                <span class="keywordflow">if</span>($result[$i][<span class="stringliteral">&#39;tbl_name&#39;</span>]==$tables[$j])</div><div class="line"><a name="l05278"></a><span class="lineno"> 5278</span>&#160;                    $valid = <span class="keyword">true</span>;</div><div class="line"><a name="l05279"></a><span class="lineno"> 5279</span>&#160;            }</div><div class="line"><a name="l05280"></a><span class="lineno"> 5280</span>&#160;            <span class="keywordflow">if</span>($valid)</div><div class="line"><a name="l05281"></a><span class="lineno"> 5281</span>&#160;            {</div><div class="line"><a name="l05282"></a><span class="lineno"> 5282</span>&#160;                $query = <span class="stringliteral">&quot;PRAGMA table_info(&quot;</span>.$this-&gt;quote_id($result[$i][<span class="stringliteral">&#39;tbl_name&#39;</span>]).<span class="stringliteral">&quot;)&quot;</span>;</div><div class="line"><a name="l05283"></a><span class="lineno"> 5283</span>&#160;                $temp = $this-&gt;selectArray($query);</div><div class="line"><a name="l05284"></a><span class="lineno"> 5284</span>&#160;                $cols = array();</div><div class="line"><a name="l05285"></a><span class="lineno"> 5285</span>&#160;                <span class="keywordflow">for</span>($z=0; $z&lt;<span class="keyword">sizeof</span>($temp); $z++)</div><div class="line"><a name="l05286"></a><span class="lineno"> 5286</span>&#160;                    $cols[$z] = $temp[$z][1];</div><div class="line"><a name="l05287"></a><span class="lineno"> 5287</span>&#160;                <span class="keywordflow">if</span>($fields_in_first_row)</div><div class="line"><a name="l05288"></a><span class="lineno"> 5288</span>&#160;                {</div><div class="line"><a name="l05289"></a><span class="lineno"> 5289</span>&#160;                    <span class="keywordflow">for</span>($z=0; $z&lt;<span class="keyword">sizeof</span>($cols); $z++)</div><div class="line"><a name="l05290"></a><span class="lineno"> 5290</span>&#160;                    {</div><div class="line"><a name="l05291"></a><span class="lineno"> 5291</span>&#160;                        echo $field_enclosed.$cols[$z].$field_enclosed;</div><div class="line"><a name="l05292"></a><span class="lineno"> 5292</span>&#160;                        <span class="comment">// do not terminate the last column!</span></div><div class="line"><a name="l05293"></a><span class="lineno"> 5293</span>&#160;                        <span class="keywordflow">if</span>($z &lt; <span class="keyword">sizeof</span>($cols)-1)</div><div class="line"><a name="l05294"></a><span class="lineno"> 5294</span>&#160;                            echo $field_terminate;</div><div class="line"><a name="l05295"></a><span class="lineno"> 5295</span>&#160;                    }</div><div class="line"><a name="l05296"></a><span class="lineno"> 5296</span>&#160;                    echo <span class="stringliteral">&quot;\r\n&quot;</span>;    </div><div class="line"><a name="l05297"></a><span class="lineno"> 5297</span>&#160;                }</div><div class="line"><a name="l05298"></a><span class="lineno"> 5298</span>&#160;                $query = <span class="stringliteral">&quot;SELECT * FROM &quot;</span>.$this-&gt;quote_id($result[$i][<span class="stringliteral">&#39;tbl_name&#39;</span>]);</div><div class="line"><a name="l05299"></a><span class="lineno"> 5299</span>&#160;                $arr = $this-&gt;selectArray($query, <span class="stringliteral">&quot;assoc&quot;</span>);</div><div class="line"><a name="l05300"></a><span class="lineno"> 5300</span>&#160;                <span class="keywordflow">for</span>($z=0; $z&lt;<span class="keyword">sizeof</span>($arr); $z++)</div><div class="line"><a name="l05301"></a><span class="lineno"> 5301</span>&#160;                {</div><div class="line"><a name="l05302"></a><span class="lineno"> 5302</span>&#160;                    <span class="keywordflow">for</span>($y=0; $y&lt;<span class="keyword">sizeof</span>($cols); $y++)</div><div class="line"><a name="l05303"></a><span class="lineno"> 5303</span>&#160;                    {</div><div class="line"><a name="l05304"></a><span class="lineno"> 5304</span>&#160;                        $cell = $arr[$z][$cols[$y]];</div><div class="line"><a name="l05305"></a><span class="lineno"> 5305</span>&#160;                        <span class="keywordflow">if</span>($crlf)</div><div class="line"><a name="l05306"></a><span class="lineno"> 5306</span>&#160;                        {</div><div class="line"><a name="l05307"></a><span class="lineno"> 5307</span>&#160;                            $cell = str_replace(<span class="stringliteral">&quot;\n&quot;</span>,<span class="stringliteral">&quot;&quot;</span>, $cell);</div><div class="line"><a name="l05308"></a><span class="lineno"> 5308</span>&#160;                            $cell = str_replace(<span class="stringliteral">&quot;\r&quot;</span>,<span class="stringliteral">&quot;&quot;</span>, $cell);</div><div class="line"><a name="l05309"></a><span class="lineno"> 5309</span>&#160;                        }</div><div class="line"><a name="l05310"></a><span class="lineno"> 5310</span>&#160;                        $cell = str_replace($field_terminate,$field_escaped.$field_terminate,$cell);</div><div class="line"><a name="l05311"></a><span class="lineno"> 5311</span>&#160;                        $cell = str_replace($field_enclosed,$field_escaped.$field_enclosed,$cell);</div><div class="line"><a name="l05312"></a><span class="lineno"> 5312</span>&#160;                        <span class="comment">// do not enclose NULLs</span></div><div class="line"><a name="l05313"></a><span class="lineno"> 5313</span>&#160;                        <span class="keywordflow">if</span>($cell == NULL)</div><div class="line"><a name="l05314"></a><span class="lineno"> 5314</span>&#160;                            echo $null;  </div><div class="line"><a name="l05315"></a><span class="lineno"> 5315</span>&#160;                        <span class="keywordflow">else</span></div><div class="line"><a name="l05316"></a><span class="lineno"> 5316</span>&#160;                            echo $field_enclosed.$cell.$field_enclosed;</div><div class="line"><a name="l05317"></a><span class="lineno"> 5317</span>&#160;                        <span class="comment">// do not terminate the last column!</span></div><div class="line"><a name="l05318"></a><span class="lineno"> 5318</span>&#160;                        <span class="keywordflow">if</span>($y &lt; <span class="keyword">sizeof</span>($cols)-1)</div><div class="line"><a name="l05319"></a><span class="lineno"> 5319</span>&#160;                            echo $field_terminate;</div><div class="line"><a name="l05320"></a><span class="lineno"> 5320</span>&#160;                    }</div><div class="line"><a name="l05321"></a><span class="lineno"> 5321</span>&#160;                    <span class="keywordflow">if</span>($z&lt;<span class="keyword">sizeof</span>($arr)-1)</div><div class="line"><a name="l05322"></a><span class="lineno"> 5322</span>&#160;                        echo <span class="stringliteral">&quot;\r\n&quot;</span>;    </div><div class="line"><a name="l05323"></a><span class="lineno"> 5323</span>&#160;                }</div><div class="line"><a name="l05324"></a><span class="lineno"> 5324</span>&#160;                <span class="keywordflow">if</span>($i&lt;<span class="keyword">sizeof</span>($result)-1)</div><div class="line"><a name="l05325"></a><span class="lineno"> 5325</span>&#160;                    echo <span class="stringliteral">&quot;\r\n&quot;</span>;</div><div class="line"><a name="l05326"></a><span class="lineno"> 5326</span>&#160;            }</div><div class="line"><a name="l05327"></a><span class="lineno"> 5327</span>&#160;        }</div><div class="line"><a name="l05328"></a><span class="lineno"> 5328</span>&#160;    }</div><div class="line"><a name="l05329"></a><span class="lineno"> 5329</span>&#160;    </div><div class="line"><a name="l05330"></a><span class="lineno"> 5330</span>&#160;    <span class="comment">//export sql</span></div><div class="line"><a name="l05331"></a><span class="lineno"> 5331</span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> export_sql($tables, $drop, $structure, $data, $transaction, $comments)</div><div class="line"><a name="l05332"></a><span class="lineno"> 5332</span>&#160;    {</div><div class="line"><a name="l05333"></a><span class="lineno"> 5333</span>&#160;        global $lang;</div><div class="line"><a name="l05334"></a><span class="lineno"> 5334</span>&#160;        <span class="keywordflow">if</span>($comments)</div><div class="line"><a name="l05335"></a><span class="lineno"> 5335</span>&#160;        {</div><div class="line"><a name="l05336"></a><span class="lineno"> 5336</span>&#160;            echo <span class="stringliteral">&quot;----\r\n&quot;</span>;</div><div class="line"><a name="l05337"></a><span class="lineno"> 5337</span>&#160;            echo <span class="stringliteral">&quot;-- &quot;</span>.PROJECT.<span class="stringliteral">&quot; &quot;</span>.$lang[<span class="stringliteral">&#39;db_dump&#39;</span>].<span class="stringliteral">&quot; (&quot;</span>.PROJECT_URL.<span class="stringliteral">&quot;)\r\n&quot;</span>;</div><div class="line"><a name="l05338"></a><span class="lineno"> 5338</span>&#160;            echo <span class="stringliteral">&quot;-- &quot;</span>.PROJECT.<span class="stringliteral">&quot; &quot;</span>.$lang[<span class="stringliteral">&#39;ver&#39;</span>].<span class="stringliteral">&quot;: &quot;</span>.VERSION.<span class="stringliteral">&quot;\r\n&quot;</span>;</div><div class="line"><a name="l05339"></a><span class="lineno"> 5339</span>&#160;            echo <span class="stringliteral">&quot;-- &quot;</span>.$lang[<span class="stringliteral">&#39;exported&#39;</span>].<span class="stringliteral">&quot;: &quot;</span>.date($lang[<span class="stringliteral">&#39;date_format&#39;</span>]).<span class="stringliteral">&quot;\r\n&quot;</span>;</div><div class="line"><a name="l05340"></a><span class="lineno"> 5340</span>&#160;            echo <span class="stringliteral">&quot;-- &quot;</span>.$lang[<span class="stringliteral">&#39;db_f&#39;</span>].<span class="stringliteral">&quot;: &quot;</span>.$this-&gt;getPath().<span class="stringliteral">&quot;\r\n&quot;</span>;</div><div class="line"><a name="l05341"></a><span class="lineno"> 5341</span>&#160;            echo <span class="stringliteral">&quot;----\r\n&quot;</span>;</div><div class="line"><a name="l05342"></a><span class="lineno"> 5342</span>&#160;        }</div><div class="line"><a name="l05343"></a><span class="lineno"> 5343</span>&#160;        $query = <span class="stringliteral">&quot;SELECT * FROM sqlite_master WHERE type=&#39;table&#39; OR type=&#39;index&#39; OR type=&#39;view&#39; OR type=&#39;trigger&#39; ORDER BY type=&#39;trigger&#39;, type=&#39;index&#39;, type=&#39;view&#39;, type=&#39;table&#39;&quot;</span>;</div><div class="line"><a name="l05344"></a><span class="lineno"> 5344</span>&#160;        $result = $this-&gt;selectArray($query);</div><div class="line"><a name="l05345"></a><span class="lineno"> 5345</span>&#160;</div><div class="line"><a name="l05346"></a><span class="lineno"> 5346</span>&#160;        <span class="keywordflow">if</span>($transaction)</div><div class="line"><a name="l05347"></a><span class="lineno"> 5347</span>&#160;            echo <span class="stringliteral">&quot;BEGIN TRANSACTION;\r\n&quot;</span>;</div><div class="line"><a name="l05348"></a><span class="lineno"> 5348</span>&#160;</div><div class="line"><a name="l05349"></a><span class="lineno"> 5349</span>&#160;        <span class="comment">//iterate through each table</span></div><div class="line"><a name="l05350"></a><span class="lineno"> 5350</span>&#160;        <span class="keywordflow">for</span>($i=0; $i&lt;<span class="keyword">sizeof</span>($result); $i++)</div><div class="line"><a name="l05351"></a><span class="lineno"> 5351</span>&#160;        {</div><div class="line"><a name="l05352"></a><span class="lineno"> 5352</span>&#160;            $valid = <span class="keyword">false</span>;</div><div class="line"><a name="l05353"></a><span class="lineno"> 5353</span>&#160;            <span class="keywordflow">for</span>($j=0; $j&lt;<span class="keyword">sizeof</span>($tables); $j++)</div><div class="line"><a name="l05354"></a><span class="lineno"> 5354</span>&#160;            {</div><div class="line"><a name="l05355"></a><span class="lineno"> 5355</span>&#160;                <span class="keywordflow">if</span>($result[$i][<span class="stringliteral">&#39;tbl_name&#39;</span>]==$tables[$j])</div><div class="line"><a name="l05356"></a><span class="lineno"> 5356</span>&#160;                    $valid = <span class="keyword">true</span>;</div><div class="line"><a name="l05357"></a><span class="lineno"> 5357</span>&#160;            }</div><div class="line"><a name="l05358"></a><span class="lineno"> 5358</span>&#160;            <span class="keywordflow">if</span>($valid)</div><div class="line"><a name="l05359"></a><span class="lineno"> 5359</span>&#160;            {</div><div class="line"><a name="l05360"></a><span class="lineno"> 5360</span>&#160;                <span class="keywordflow">if</span>($drop)</div><div class="line"><a name="l05361"></a><span class="lineno"> 5361</span>&#160;                {</div><div class="line"><a name="l05362"></a><span class="lineno"> 5362</span>&#160;                    <span class="keywordflow">if</span>($comments)</div><div class="line"><a name="l05363"></a><span class="lineno"> 5363</span>&#160;                    {</div><div class="line"><a name="l05364"></a><span class="lineno"> 5364</span>&#160;                        echo <span class="stringliteral">&quot;\r\n----\r\n&quot;</span>;</div><div class="line"><a name="l05365"></a><span class="lineno"> 5365</span>&#160;                        echo <span class="stringliteral">&quot;-- &quot;</span>.$lang[<span class="stringliteral">&#39;drop&#39;</span>].<span class="stringliteral">&quot; &quot;</span>.$result[$i][<span class="stringliteral">&#39;type&#39;</span>].<span class="stringliteral">&quot; &quot;</span>.$lang[<span class="stringliteral">&#39;for&#39;</span>].<span class="stringliteral">&quot; &quot;</span>.$result[$i][<span class="stringliteral">&#39;name&#39;</span>].<span class="stringliteral">&quot;\r\n&quot;</span>;</div><div class="line"><a name="l05366"></a><span class="lineno"> 5366</span>&#160;                        echo <span class="stringliteral">&quot;----\r\n&quot;</span>;</div><div class="line"><a name="l05367"></a><span class="lineno"> 5367</span>&#160;                    }</div><div class="line"><a name="l05368"></a><span class="lineno"> 5368</span>&#160;                    echo <span class="stringliteral">&quot;DROP &quot;</span>.strtoupper($result[$i][<span class="stringliteral">&#39;type&#39;</span>]).<span class="stringliteral">&quot; &quot;</span>.$this-&gt;quote_id($result[$i][<span class="stringliteral">&#39;name&#39;</span>]).<span class="stringliteral">&quot;;\r\n&quot;</span>;</div><div class="line"><a name="l05369"></a><span class="lineno"> 5369</span>&#160;                }</div><div class="line"><a name="l05370"></a><span class="lineno"> 5370</span>&#160;                <span class="keywordflow">if</span>($structure)</div><div class="line"><a name="l05371"></a><span class="lineno"> 5371</span>&#160;                {</div><div class="line"><a name="l05372"></a><span class="lineno"> 5372</span>&#160;                    <span class="keywordflow">if</span>($comments)</div><div class="line"><a name="l05373"></a><span class="lineno"> 5373</span>&#160;                    {</div><div class="line"><a name="l05374"></a><span class="lineno"> 5374</span>&#160;                        echo <span class="stringliteral">&quot;\r\n----\r\n&quot;</span>;</div><div class="line"><a name="l05375"></a><span class="lineno"> 5375</span>&#160;                        <span class="keywordflow">if</span>($result[$i][<span class="stringliteral">&#39;type&#39;</span>]==<span class="stringliteral">&quot;table&quot;</span> || $result[$i][<span class="stringliteral">&#39;type&#39;</span>]==<span class="stringliteral">&quot;view&quot;</span>)</div><div class="line"><a name="l05376"></a><span class="lineno"> 5376</span>&#160;                            echo <span class="stringliteral">&quot;-- &quot;</span>.ucfirst($result[$i][<span class="stringliteral">&#39;type&#39;</span>]).<span class="stringliteral">&quot; &quot;</span>.$lang[<span class="stringliteral">&#39;struct_for&#39;</span>].<span class="stringliteral">&quot; &quot;</span>.$result[$i][<span class="stringliteral">&#39;tbl_name&#39;</span>].<span class="stringliteral">&quot;\r\n&quot;</span>;</div><div class="line"><a name="l05377"></a><span class="lineno"> 5377</span>&#160;                        <span class="keywordflow">else</span> <span class="comment">// index or trigger</span></div><div class="line"><a name="l05378"></a><span class="lineno"> 5378</span>&#160;                            echo <span class="stringliteral">&quot;-- &quot;</span>.$lang[<span class="stringliteral">&#39;struct_for&#39;</span>].<span class="stringliteral">&quot; &quot;</span>.$result[$i][<span class="stringliteral">&#39;type&#39;</span>].<span class="stringliteral">&quot; &quot;</span>.$result[$i][<span class="stringliteral">&#39;name&#39;</span>].<span class="stringliteral">&quot; &quot;</span>.$lang[<span class="stringliteral">&#39;on_tbl&#39;</span>].<span class="stringliteral">&quot; &quot;</span>.$result[$i][<span class="stringliteral">&#39;tbl_name&#39;</span>].<span class="stringliteral">&quot;\r\n&quot;</span>;</div><div class="line"><a name="l05379"></a><span class="lineno"> 5379</span>&#160;                        echo <span class="stringliteral">&quot;----\r\n&quot;</span>;</div><div class="line"><a name="l05380"></a><span class="lineno"> 5380</span>&#160;                    }</div><div class="line"><a name="l05381"></a><span class="lineno"> 5381</span>&#160;                    echo $result[$i][<span class="stringliteral">&#39;sql&#39;</span>].<span class="stringliteral">&quot;;\r\n&quot;</span>;</div><div class="line"><a name="l05382"></a><span class="lineno"> 5382</span>&#160;                }</div><div class="line"><a name="l05383"></a><span class="lineno"> 5383</span>&#160;                <span class="keywordflow">if</span>($data &amp;&amp; $result[$i][<span class="stringliteral">&#39;type&#39;</span>]==<span class="stringliteral">&quot;table&quot;</span>)</div><div class="line"><a name="l05384"></a><span class="lineno"> 5384</span>&#160;                {</div><div class="line"><a name="l05385"></a><span class="lineno"> 5385</span>&#160;                    $query = <span class="stringliteral">&quot;SELECT * FROM &quot;</span>.$this-&gt;quote_id($result[$i][<span class="stringliteral">&#39;tbl_name&#39;</span>]);</div><div class="line"><a name="l05386"></a><span class="lineno"> 5386</span>&#160;                    $arr = $this-&gt;selectArray($query, <span class="stringliteral">&quot;assoc&quot;</span>);</div><div class="line"><a name="l05387"></a><span class="lineno"> 5387</span>&#160;</div><div class="line"><a name="l05388"></a><span class="lineno"> 5388</span>&#160;                    <span class="keywordflow">if</span>($comments)</div><div class="line"><a name="l05389"></a><span class="lineno"> 5389</span>&#160;                    {</div><div class="line"><a name="l05390"></a><span class="lineno"> 5390</span>&#160;                        echo <span class="stringliteral">&quot;\r\n----\r\n&quot;</span>;</div><div class="line"><a name="l05391"></a><span class="lineno"> 5391</span>&#160;                        echo <span class="stringliteral">&quot;-- &quot;</span>.$lang[<span class="stringliteral">&#39;data_dump&#39;</span>].<span class="stringliteral">&quot; &quot;</span>.$result[$i][<span class="stringliteral">&#39;tbl_name&#39;</span>].<span class="stringliteral">&quot;, &quot;</span>.sprintf($lang[<span class="stringliteral">&#39;total_rows&#39;</span>], <span class="keyword">sizeof</span>($arr)).<span class="stringliteral">&quot;\r\n&quot;</span>;</div><div class="line"><a name="l05392"></a><span class="lineno"> 5392</span>&#160;                        echo <span class="stringliteral">&quot;----\r\n&quot;</span>;</div><div class="line"><a name="l05393"></a><span class="lineno"> 5393</span>&#160;                    }</div><div class="line"><a name="l05394"></a><span class="lineno"> 5394</span>&#160;                    $query = <span class="stringliteral">&quot;PRAGMA table_info(&quot;</span>.$this-&gt;quote_id($result[$i][<span class="stringliteral">&#39;tbl_name&#39;</span>]).<span class="stringliteral">&quot;)&quot;</span>;</div><div class="line"><a name="l05395"></a><span class="lineno"> 5395</span>&#160;                    $temp = $this-&gt;selectArray($query);</div><div class="line"><a name="l05396"></a><span class="lineno"> 5396</span>&#160;                    $cols = array();</div><div class="line"><a name="l05397"></a><span class="lineno"> 5397</span>&#160;                    $cols_quoted = array();</div><div class="line"><a name="l05398"></a><span class="lineno"> 5398</span>&#160;                    $vals = array();</div><div class="line"><a name="l05399"></a><span class="lineno"> 5399</span>&#160;                    <span class="keywordflow">for</span>($z=0; $z&lt;<span class="keyword">sizeof</span>($temp); $z++)</div><div class="line"><a name="l05400"></a><span class="lineno"> 5400</span>&#160;                    {</div><div class="line"><a name="l05401"></a><span class="lineno"> 5401</span>&#160;                        $cols[$z] = $temp[$z][1];</div><div class="line"><a name="l05402"></a><span class="lineno"> 5402</span>&#160;                        $cols_quoted[$z] = $this-&gt;quote_id($temp[$z][1]);</div><div class="line"><a name="l05403"></a><span class="lineno"> 5403</span>&#160;                    }</div><div class="line"><a name="l05404"></a><span class="lineno"> 5404</span>&#160;                    <span class="keywordflow">for</span>($z=0; $z&lt;<span class="keyword">sizeof</span>($arr); $z++)</div><div class="line"><a name="l05405"></a><span class="lineno"> 5405</span>&#160;                    {</div><div class="line"><a name="l05406"></a><span class="lineno"> 5406</span>&#160;                        <span class="keywordflow">for</span>($y=0; $y&lt;<span class="keyword">sizeof</span>($cols); $y++)</div><div class="line"><a name="l05407"></a><span class="lineno"> 5407</span>&#160;                        {</div><div class="line"><a name="l05408"></a><span class="lineno"> 5408</span>&#160;                            <span class="keywordflow">if</span>(!isset($vals[$z]))</div><div class="line"><a name="l05409"></a><span class="lineno"> 5409</span>&#160;                                $vals[$z] = array();</div><div class="line"><a name="l05410"></a><span class="lineno"> 5410</span>&#160;                            <span class="keywordflow">if</span>($arr[$z][$cols[$y]] === NULL)</div><div class="line"><a name="l05411"></a><span class="lineno"> 5411</span>&#160;                                $vals[$z][$cols[$y]] = <span class="stringliteral">&#39;NULL&#39;</span>;</div><div class="line"><a name="l05412"></a><span class="lineno"> 5412</span>&#160;                            <span class="keywordflow">else</span></div><div class="line"><a name="l05413"></a><span class="lineno"> 5413</span>&#160;                                $vals[$z][$cols[$y]] = $this-&gt;quote($arr[$z][$cols[$y]]);</div><div class="line"><a name="l05414"></a><span class="lineno"> 5414</span>&#160;                        }</div><div class="line"><a name="l05415"></a><span class="lineno"> 5415</span>&#160;                    }</div><div class="line"><a name="l05416"></a><span class="lineno"> 5416</span>&#160;                    <span class="keywordflow">for</span>($j=0; $j&lt;<span class="keyword">sizeof</span>($vals); $j++)</div><div class="line"><a name="l05417"></a><span class="lineno"> 5417</span>&#160;                        echo <span class="stringliteral">&quot;INSERT INTO &quot;</span>.$this-&gt;quote_id($result[$i][<span class="stringliteral">&#39;tbl_name&#39;</span>]).<span class="stringliteral">&quot; (&quot;</span>.implode(<span class="stringliteral">&quot;,&quot;</span>, $cols_quoted).<span class="stringliteral">&quot;) VALUES (&quot;</span>.implode(<span class="stringliteral">&quot;,&quot;</span>, $vals[$j]).<span class="stringliteral">&quot;);\r\n&quot;</span>;</div><div class="line"><a name="l05418"></a><span class="lineno"> 5418</span>&#160;                }</div><div class="line"><a name="l05419"></a><span class="lineno"> 5419</span>&#160;            }</div><div class="line"><a name="l05420"></a><span class="lineno"> 5420</span>&#160;        }</div><div class="line"><a name="l05421"></a><span class="lineno"> 5421</span>&#160;        <span class="keywordflow">if</span>($transaction)</div><div class="line"><a name="l05422"></a><span class="lineno"> 5422</span>&#160;            echo <span class="stringliteral">&quot;COMMIT;\r\n&quot;</span>;</div><div class="line"><a name="l05423"></a><span class="lineno"> 5423</span>&#160;    }</div><div class="line"><a name="l05424"></a><span class="lineno"> 5424</span>&#160;}</div><div class="line"><a name="l05425"></a><span class="lineno"> 5425</span>&#160;<span class="comment">//  class MicroTimer (issue #146)</span></div><div class="line"><a name="l05426"></a><span class="lineno"> 5426</span>&#160;<span class="comment">//  wraps calls to microtime(), calculating the elapsed time and rounding output</span></div><div class="line"><a name="l05427"></a><span class="lineno"> 5427</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l05428"></a><span class="lineno"> 5428</span>&#160;<span class="keyword">class </span>MicroTimer {</div><div class="line"><a name="l05429"></a><span class="lineno"> 5429</span>&#160;</div><div class="line"><a name="l05430"></a><span class="lineno"> 5430</span>&#160;    <span class="keyword">private</span> $startTime, $stopTime;</div><div class="line"><a name="l05431"></a><span class="lineno"> 5431</span>&#160;</div><div class="line"><a name="l05432"></a><span class="lineno"> 5432</span>&#160;    <span class="comment">// creates and starts a timer</span></div><div class="line"><a name="l05433"></a><span class="lineno"> 5433</span>&#160;    <span class="keyword">function</span> __construct()</div><div class="line"><a name="l05434"></a><span class="lineno"> 5434</span>&#160;    {</div><div class="line"><a name="l05435"></a><span class="lineno"> 5435</span>&#160;        $this-&gt;startTime = microtime(<span class="keyword">true</span>);</div><div class="line"><a name="l05436"></a><span class="lineno"> 5436</span>&#160;    }</div><div class="line"><a name="l05437"></a><span class="lineno"> 5437</span>&#160;</div><div class="line"><a name="l05438"></a><span class="lineno"> 5438</span>&#160;    <span class="comment">// stops a timer</span></div><div class="line"><a name="l05439"></a><span class="lineno"> 5439</span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> stop()</div><div class="line"><a name="l05440"></a><span class="lineno"> 5440</span>&#160;    {</div><div class="line"><a name="l05441"></a><span class="lineno"> 5441</span>&#160;        $this-&gt;stopTime = microtime(<span class="keyword">true</span>);</div><div class="line"><a name="l05442"></a><span class="lineno"> 5442</span>&#160;    }</div><div class="line"><a name="l05443"></a><span class="lineno"> 5443</span>&#160;</div><div class="line"><a name="l05444"></a><span class="lineno"> 5444</span>&#160;    <span class="comment">// returns the number of seconds from the timer&#39;s creation, or elapsed</span></div><div class="line"><a name="l05445"></a><span class="lineno"> 5445</span>&#160;    <span class="comment">// between creation and call to -&gt;stop()</span></div><div class="line"><a name="l05446"></a><span class="lineno"> 5446</span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> elapsed()</div><div class="line"><a name="l05447"></a><span class="lineno"> 5447</span>&#160;    {</div><div class="line"><a name="l05448"></a><span class="lineno"> 5448</span>&#160;        <span class="keywordflow">if</span> ($this-&gt;stopTime)</div><div class="line"><a name="l05449"></a><span class="lineno"> 5449</span>&#160;            <span class="keywordflow">return</span> round($this-&gt;stopTime - $this-&gt;startTime, 4);</div><div class="line"><a name="l05450"></a><span class="lineno"> 5450</span>&#160;</div><div class="line"><a name="l05451"></a><span class="lineno"> 5451</span>&#160;        <span class="keywordflow">return</span> round(microtime(<span class="keyword">true</span>) - $this-&gt;startTime, 4);</div><div class="line"><a name="l05452"></a><span class="lineno"> 5452</span>&#160;    }</div><div class="line"><a name="l05453"></a><span class="lineno"> 5453</span>&#160;</div><div class="line"><a name="l05454"></a><span class="lineno"> 5454</span>&#160;    <span class="comment">// called when using a MicroTimer object as a string</span></div><div class="line"><a name="l05455"></a><span class="lineno"> 5455</span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> __toString()</div><div class="line"><a name="l05456"></a><span class="lineno"> 5456</span>&#160;    {</div><div class="line"><a name="l05457"></a><span class="lineno"> 5457</span>&#160;        <span class="keywordflow">return</span> (<span class="keywordtype">string</span>) $this-&gt;elapsed();</div><div class="line"><a name="l05458"></a><span class="lineno"> 5458</span>&#160;    }</div><div class="line"><a name="l05459"></a><span class="lineno"> 5459</span>&#160;</div><div class="line"><a name="l05460"></a><span class="lineno"> 5460</span>&#160;}</div><div class="line"><a name="l05461"></a><span class="lineno"> 5461</span>&#160;<span class="comment">//  class Resources (issue #157)</span></div><div class="line"><a name="l05462"></a><span class="lineno"> 5462</span>&#160;<span class="comment">//  outputs secondary files, such as css and javascript</span></div><div class="line"><a name="l05463"></a><span class="lineno"> 5463</span>&#160;<span class="comment">//  data is stored gzipped (gzencode) and encoded (base64_encode)</span></div><div class="line"><a name="l05464"></a><span class="lineno"> 5464</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l05465"></a><span class="lineno"> 5465</span>&#160;<span class="keyword">class </span>Resources {</div><div class="line"><a name="l05466"></a><span class="lineno"> 5466</span>&#160;</div><div class="line"><a name="l05467"></a><span class="lineno"> 5467</span>&#160;    <span class="comment">// set this to the file containing getInternalResource;</span></div><div class="line"><a name="l05468"></a><span class="lineno"> 5468</span>&#160;    <span class="comment">// currently unused in split mode; set to __FILE__ for built PLA.</span></div><div class="line"><a name="l05469"></a><span class="lineno"> 5469</span>&#160;    <span class="keyword">public</span> <span class="keyword">static</span> $embedding_file = __FILE__;</div><div class="line"><a name="l05470"></a><span class="lineno"> 5470</span>&#160;</div><div class="line"><a name="l05471"></a><span class="lineno"> 5471</span>&#160;    <span class="keyword">private</span> <span class="keyword">static</span> $_resources = array(</div><div class="line"><a name="l05472"></a><span class="lineno"> 5472</span>&#160;        <span class="stringliteral">&#39;css&#39;</span> =&gt; array(</div><div class="line"><a name="l05473"></a><span class="lineno"> 5473</span>&#160;            <span class="stringliteral">&#39;mime&#39;</span> =&gt; <span class="stringliteral">&#39;text/css&#39;</span>,</div><div class="line"><a name="l05474"></a><span class="lineno"> 5474</span>&#160;            <span class="stringliteral">&#39;data&#39;</span> =&gt; <span class="stringliteral">&#39;resources/phpliteadmin.css&#39;</span>,</div><div class="line"><a name="l05475"></a><span class="lineno"> 5475</span>&#160;        ),</div><div class="line"><a name="l05476"></a><span class="lineno"> 5476</span>&#160;        <span class="stringliteral">&#39;javascript&#39;</span> =&gt; array(</div><div class="line"><a name="l05477"></a><span class="lineno"> 5477</span>&#160;            <span class="stringliteral">&#39;mime&#39;</span> =&gt; <span class="stringliteral">&#39;text/javascript&#39;</span>,</div><div class="line"><a name="l05478"></a><span class="lineno"> 5478</span>&#160;            <span class="stringliteral">&#39;data&#39;</span> =&gt; <span class="stringliteral">&#39;resources/phpliteadmin.js&#39;</span>,</div><div class="line"><a name="l05479"></a><span class="lineno"> 5479</span>&#160;        ),</div><div class="line"><a name="l05480"></a><span class="lineno"> 5480</span>&#160;        <span class="stringliteral">&#39;favicon&#39;</span> =&gt; array(</div><div class="line"><a name="l05481"></a><span class="lineno"> 5481</span>&#160;            <span class="stringliteral">&#39;mime&#39;</span> =&gt; <span class="stringliteral">&#39;image/x-icon&#39;</span>,</div><div class="line"><a name="l05482"></a><span class="lineno"> 5482</span>&#160;            <span class="stringliteral">&#39;data&#39;</span> =&gt; <span class="stringliteral">&#39;resources/favicon.ico&#39;</span>,</div><div class="line"><a name="l05483"></a><span class="lineno"> 5483</span>&#160;            <span class="stringliteral">&#39;base64&#39;</span> =&gt; <span class="stringliteral">&#39;true&#39;</span>,</div><div class="line"><a name="l05484"></a><span class="lineno"> 5484</span>&#160;        ),</div><div class="line"><a name="l05485"></a><span class="lineno"> 5485</span>&#160;    );</div><div class="line"><a name="l05486"></a><span class="lineno"> 5486</span>&#160;</div><div class="line"><a name="l05487"></a><span class="lineno"> 5487</span>&#160;    <span class="comment">// outputs the specified resource, if defined in this class.</span></div><div class="line"><a name="l05488"></a><span class="lineno"> 5488</span>&#160;    <span class="comment">// the main script should do no further output after calling this function.</span></div><div class="line"><a name="l05489"></a><span class="lineno"> 5489</span>&#160;    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">function</span> output($resource)</div><div class="line"><a name="l05490"></a><span class="lineno"> 5490</span>&#160;    {</div><div class="line"><a name="l05491"></a><span class="lineno"> 5491</span>&#160;        <span class="keywordflow">if</span> (isset(self::$_resources[$resource])) {</div><div class="line"><a name="l05492"></a><span class="lineno"> 5492</span>&#160;            $res =&amp; self::$_resources[$resource];</div><div class="line"><a name="l05493"></a><span class="lineno"> 5493</span>&#160;</div><div class="line"><a name="l05494"></a><span class="lineno"> 5494</span>&#160;            <span class="keywordflow">if</span> (function_exists(<span class="stringliteral">&#39;getInternalResource&#39;</span>) &amp;&amp; $data = getInternalResource($res[<span class="stringliteral">&#39;data&#39;</span>])) {</div><div class="line"><a name="l05495"></a><span class="lineno"> 5495</span>&#160;                $filename = self::$embedding_file;</div><div class="line"><a name="l05496"></a><span class="lineno"> 5496</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l05497"></a><span class="lineno"> 5497</span>&#160;                $filename = $res[<span class="stringliteral">&#39;data&#39;</span>];</div><div class="line"><a name="l05498"></a><span class="lineno"> 5498</span>&#160;            }</div><div class="line"><a name="l05499"></a><span class="lineno"> 5499</span>&#160;</div><div class="line"><a name="l05500"></a><span class="lineno"> 5500</span>&#160;            <span class="comment">// use last-modified time as etag; etag must be quoted</span></div><div class="line"><a name="l05501"></a><span class="lineno"> 5501</span>&#160;            $etag = <span class="charliteral">&#39;&quot;&#39;</span> . filemtime($filename) . <span class="charliteral">&#39;&quot;&#39;</span>;</div><div class="line"><a name="l05502"></a><span class="lineno"> 5502</span>&#160;</div><div class="line"><a name="l05503"></a><span class="lineno"> 5503</span>&#160;            <span class="comment">// check headers for matching etag; if etag hasn&#39;t changed, use the cached version</span></div><div class="line"><a name="l05504"></a><span class="lineno"> 5504</span>&#160;            <span class="keywordflow">if</span> (isset($_SERVER[<span class="stringliteral">&#39;HTTP_IF_NONE_MATCH&#39;</span>]) &amp;&amp; $_SERVER[<span class="stringliteral">&#39;HTTP_IF_NONE_MATCH&#39;</span>] == $etag) {</div><div class="line"><a name="l05505"></a><span class="lineno"> 5505</span>&#160;                header(<span class="stringliteral">&#39;HTTP/1.0 304 Not Modified&#39;</span>);</div><div class="line"><a name="l05506"></a><span class="lineno"> 5506</span>&#160;                <span class="keywordflow">return</span>;</div><div class="line"><a name="l05507"></a><span class="lineno"> 5507</span>&#160;            }</div><div class="line"><a name="l05508"></a><span class="lineno"> 5508</span>&#160;</div><div class="line"><a name="l05509"></a><span class="lineno"> 5509</span>&#160;            header(<span class="stringliteral">&#39;Etag: &#39;</span> . $etag);</div><div class="line"><a name="l05510"></a><span class="lineno"> 5510</span>&#160;</div><div class="line"><a name="l05511"></a><span class="lineno"> 5511</span>&#160;            <span class="comment">// cache file for at most 30 days</span></div><div class="line"><a name="l05512"></a><span class="lineno"> 5512</span>&#160;            header(<span class="stringliteral">&#39;Cache-control: max-age=2592000&#39;</span>);</div><div class="line"><a name="l05513"></a><span class="lineno"> 5513</span>&#160;</div><div class="line"><a name="l05514"></a><span class="lineno"> 5514</span>&#160;            <span class="comment">// output resource</span></div><div class="line"><a name="l05515"></a><span class="lineno"> 5515</span>&#160;            header(<span class="stringliteral">&#39;Content-type: &#39;</span> . $res[<span class="stringliteral">&#39;mime&#39;</span>]);</div><div class="line"><a name="l05516"></a><span class="lineno"> 5516</span>&#160;</div><div class="line"><a name="l05517"></a><span class="lineno"> 5517</span>&#160;            <span class="keywordflow">if</span> (isset($data)) {</div><div class="line"><a name="l05518"></a><span class="lineno"> 5518</span>&#160;                <span class="keywordflow">if</span> (isset($res[<span class="stringliteral">&#39;base64&#39;</span>])) {</div><div class="line"><a name="l05519"></a><span class="lineno"> 5519</span>&#160;                    echo base64_decode($data);</div><div class="line"><a name="l05520"></a><span class="lineno"> 5520</span>&#160;                } <span class="keywordflow">else</span> {</div><div class="line"><a name="l05521"></a><span class="lineno"> 5521</span>&#160;                    echo $data;</div><div class="line"><a name="l05522"></a><span class="lineno"> 5522</span>&#160;                }</div><div class="line"><a name="l05523"></a><span class="lineno"> 5523</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l05524"></a><span class="lineno"> 5524</span>&#160;                readfile($filename);</div><div class="line"><a name="l05525"></a><span class="lineno"> 5525</span>&#160;            }</div><div class="line"><a name="l05526"></a><span class="lineno"> 5526</span>&#160;        }</div><div class="line"><a name="l05527"></a><span class="lineno"> 5527</span>&#160;    }</div><div class="line"><a name="l05528"></a><span class="lineno"> 5528</span>&#160;</div><div class="line"><a name="l05529"></a><span class="lineno"> 5529</span>&#160;}</div><div class="line"><a name="l05530"></a><span class="lineno"> 5530</span>&#160;</div><div class="line"><a name="l05531"></a><span class="lineno"> 5531</span>&#160;</div><div class="line"><a name="l05532"></a><span class="lineno"> 5532</span>&#160;<span class="comment">// returns data from internal resources, available in single-file mode</span></div><div class="line"><a name="l05533"></a><span class="lineno"> 5533</span>&#160;<span class="keyword">function</span> getInternalResource($res) {</div><div class="line"><a name="l05534"></a><span class="lineno"> 5534</span>&#160;    $resources = array(<span class="stringliteral">&#39;resources/phpliteadmin.css&#39;</span>=&gt;array(0=&gt;0,1=&gt;3954,),<span class="stringliteral">&#39;resources/phpliteadmin.js&#39;</span>=&gt;array(0=&gt;3954,1=&gt;4178,),<span class="stringliteral">&#39;resources/favicon.ico&#39;</span>=&gt;array(0=&gt;8132,1=&gt;1448,),);</div><div class="line"><a name="l05535"></a><span class="lineno"> 5535</span>&#160;</div><div class="line"><a name="l05536"></a><span class="lineno"> 5536</span>&#160;    <span class="keywordflow">if</span> (isset($resources[$res]) &amp;&amp; $f = fopen(__FILE__, <span class="charliteral">&#39;r&#39;</span>)) {</div><div class="line"><a name="l05537"></a><span class="lineno"> 5537</span>&#160;        fseek($f, __COMPILER_HALT_OFFSET__ + $resources[$res][0]);</div><div class="line"><a name="l05538"></a><span class="lineno"> 5538</span>&#160;        $data = fread($f, $resources[$res][1]);</div><div class="line"><a name="l05539"></a><span class="lineno"> 5539</span>&#160;        fclose($f);</div><div class="line"><a name="l05540"></a><span class="lineno"> 5540</span>&#160;        <span class="keywordflow">return</span> $data;</div><div class="line"><a name="l05541"></a><span class="lineno"> 5541</span>&#160;    }</div><div class="line"><a name="l05542"></a><span class="lineno"> 5542</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;  </div><div class="line"><a name="l05543"></a><span class="lineno"> 5543</span>&#160;}</div><div class="line"><a name="l05544"></a><span class="lineno"> 5544</span>&#160;</div><div class="line"><a name="l05545"></a><span class="lineno"> 5545</span>&#160;<span class="comment">// resources embedded below, do not edit!</span></div><div class="line"><a name="l05546"></a><span class="lineno"> 5546</span>&#160;__halt_compiler() ?&gt;body{margin:0px;padding:0px;font-family:Arial,Helvetica,sans-serif;font-size:14px;color:#000;background-color:#e0ebf6;overflow:<span class="keyword">auto</span>}.body_tbl td{padding:9px 2px 9px 9px}.left_td{width:100px}a{color:#03F;text-decoration:none;cursor:pointer}a:hover{color:#06F}hr{height:1px;border:0;color:#bbb;background-color:#bbb;width:100%}h1{margin:0px;padding:5px;font-size:24px;background-color:#f3cece;text-align:center;color:#000;border-top-left-radius:5px;border-top-right-radius:5px;-moz-border-radius-topleft:5px;-moz-border-radius-topright:5px}#headerlinks{text-align:center;margin-bottom:10px;padding:5px 15px;border-color:#03F;border-width:1px;border-style:solid;border-left-style:none;border-right-style:none;font-size:12px;background-color:#e0ebf6;font-weight:bold}h1 #version{color:#000;font-size:16px}h1 #logo{color:#000}h2{margin:0px;padding:0px;font-size:14px;margin-bottom:20px}input,select,textarea{font-family:Arial,Helvetica,sans-serif;background-color:#eaeaea;color:#03F;border-color:#03F;border-style:solid;border-width:1px;margin:5px;border-radius:5px;-moz-border-radius:5px;padding:3px}input.btn{cursor:pointer}input.btn:hover{background-color:#ccc}fieldset{padding:15px;border-color:#03F;border-width:1px;border-style:solid;border-radius:5px;-moz-border-radius:5px;background-color:#f9f9f9}#container{padding:10px}#leftNav{min-width:250px;padding:0px;border-color:#03F;border-width:1px;border-style:solid;background-color:#FFF;padding-bottom:15px;border-radius:5px;-moz-border-radius:5px}.viewTable tr td{padding:1px}#loginBox{width:500px;margin-left:<span class="keyword">auto</span>;margin-right:<span class="keyword">auto</span>;margin-top:50px;border-color:#03F;border-width:1px;border-style:solid;background-color:#FFF;border-radius:5px;-moz-border-radius:5px}#main{border-color:#03F;border-width:1px;border-style:solid;padding:15px;background-color:#FFF;border-bottom-left-radius:5px;border-bottom-right-radius:5px;border-top-right-radius:5px;-moz-border-radius-bottomleft:5px;-moz-border-radius-bottomright:5px;-moz-border-radius-topright:5px}.td1{background-color:#f9e3e3;text-align:right;font-size:12px;padding-left:10px;padding-right:10px}.td2{background-color:#f3cece;text-align:right;font-size:12px;padding-left:10px;padding-right:10px}.tdheader{border-color:#03F;border-width:1px;border-style:solid;font-weight:bold;font-size:12px;padding-left:10px;padding-right:10px;background-color:#e0ebf6;border-radius:5px;-moz-border-radius:5px}.confirm{border-color:#03F;border-width:1px;border-style:dashed;padding:15px;background-color:#e0ebf6}.tab{display:block;padding:5px;padding-right:8px;padding-left:8px;border-color:#03F;border-width:1px;border-style:solid;margin-right:5px;<span class="keywordtype">float</span>:left;border-bottom-style:none;position:relative;top:1px;padding-bottom:4px;background-color:#eaeaea;border-top-left-radius:5px;border-top-right-radius:5px;-moz-border-radius-topleft:5px;-moz-border-radius-topright:5px}.tab_pressed{display:block;padding:5px;padding-right:8px;padding-left:8px;border-color:#03F;border-width:1px;border-style:solid;margin-right:5px;<span class="keywordtype">float</span>:left;border-bottom-style:none;position:relative;top:1px;background-color:#FFF;cursor:<span class="keywordflow">default</span>;border-top-left-radius:5px;border-top-right-radius:5px;-moz-border-radius-topleft:5px;-moz-border-radius-topright:5px}.helpq{font-size:11px;font-weight:normal}#help_container{padding:0px;font-size:12px;margin-left:<span class="keyword">auto</span>;margin-right:<span class="keyword">auto</span>;background-color:#fff}.help_outer{background-color:#FFF;padding:0px;height:300px;position:relative}.help_list{padding:10px;height:<span class="keyword">auto</span>}.headd{font-size:14px;font-weight:bold;display:block;padding:10px;background-color:#e0ebf6;border-color:#03F;border-width:1px;border-style:solid;border-left-style:none;border-right-style:none}.help_inner{padding:10px}.help_top{display:block;position:absolute;right:10px;bottom:10px}.warning,.delete,.empty,.drop,.delete_db{color:red}.sidebar_table{font-size:11px}.active_table,.active_db{text-decoration:underline}.null{color:#888}.found{background:#FF0;text-decoration:none}</div><div class="line"><a name="l05547"></a><span class="lineno"> 5547</span>&#160;<span class="keyword">function</span> initAutoincrement()</div><div class="line"><a name="l05548"></a><span class="lineno"> 5548</span>&#160;{var i=0;<span class="keywordflow">while</span>(document.getElementById(<span class="charliteral">&#39;i&#39;</span>+i+<span class="stringliteral">&#39;_autoincrement&#39;</span>)!=undefined)</div><div class="line"><a name="l05549"></a><span class="lineno"> 5549</span>&#160;{document.getElementById(<span class="charliteral">&#39;i&#39;</span>+i+<span class="stringliteral">&#39;_autoincrement&#39;</span>).disabled=<span class="keyword">true</span>;i++;}}</div><div class="line"><a name="l05550"></a><span class="lineno"> 5550</span>&#160;<span class="keyword">function</span> toggleAutoincrement(i)</div><div class="line"><a name="l05551"></a><span class="lineno"> 5551</span>&#160;{var type=document.getElementById(<span class="charliteral">&#39;i&#39;</span>+i+<span class="stringliteral">&#39;_type&#39;</span>);var primarykey=document.getElementById(<span class="charliteral">&#39;i&#39;</span>+i+<span class="stringliteral">&#39;_primarykey&#39;</span>);var autoincrement=document.getElementById(<span class="charliteral">&#39;i&#39;</span>+i+<span class="stringliteral">&#39;_autoincrement&#39;</span>);<span class="keywordflow">if</span>(!autoincrement)<span class="keywordflow">return</span> <span class="keyword">false</span>;<span class="keywordflow">if</span>(type.value==<span class="stringliteral">&#39;INTEGER&#39;</span>&amp;&amp;primarykey.checked)</div><div class="line"><a name="l05552"></a><span class="lineno"> 5552</span>&#160;autoincrement.disabled=<span class="keyword">false</span>;<span class="keywordflow">else</span></div><div class="line"><a name="l05553"></a><span class="lineno"> 5553</span>&#160;{autoincrement.disabled=<span class="keyword">true</span>;autoincrement.checked=<span class="keyword">false</span>;}}</div><div class="line"><a name="l05554"></a><span class="lineno"> 5554</span>&#160;<span class="keyword">function</span> toggleNull(i)</div><div class="line"><a name="l05555"></a><span class="lineno"> 5555</span>&#160;{var pk=document.getElementById(<span class="charliteral">&#39;i&#39;</span>+i+<span class="stringliteral">&#39;_primarykey&#39;</span>);var notnull=document.getElementById(<span class="charliteral">&#39;i&#39;</span>+i+<span class="stringliteral">&#39;_notnull&#39;</span>);<span class="keywordflow">if</span>(pk.checked)</div><div class="line"><a name="l05556"></a><span class="lineno"> 5556</span>&#160;{notnull.disabled=<span class="keyword">true</span>;notnull.checked=<span class="keyword">true</span>;}</div><div class="line"><a name="l05557"></a><span class="lineno"> 5557</span>&#160;<span class="keywordflow">else</span></div><div class="line"><a name="l05558"></a><span class="lineno"> 5558</span>&#160;{notnull.disabled=<span class="keyword">false</span>;}}</div><div class="line"><a name="l05559"></a><span class="lineno"> 5559</span>&#160;<span class="keyword">function</span> checkAll(field)</div><div class="line"><a name="l05560"></a><span class="lineno"> 5560</span>&#160;{var i=0;<span class="keywordflow">while</span>(document.getElementById(<span class="stringliteral">&#39;check_&#39;</span>+i)!=undefined)</div><div class="line"><a name="l05561"></a><span class="lineno"> 5561</span>&#160;{document.getElementById(<span class="stringliteral">&#39;check_&#39;</span>+i).checked=<span class="keyword">true</span>;i++;}}</div><div class="line"><a name="l05562"></a><span class="lineno"> 5562</span>&#160;<span class="keyword">function</span> uncheckAll(field)</div><div class="line"><a name="l05563"></a><span class="lineno"> 5563</span>&#160;{var i=0;<span class="keywordflow">while</span>(document.getElementById(<span class="stringliteral">&#39;check_&#39;</span>+i)!=undefined)</div><div class="line"><a name="l05564"></a><span class="lineno"> 5564</span>&#160;{document.getElementById(<span class="stringliteral">&#39;check_&#39;</span>+i).checked=<span class="keyword">false</span>;i++;}}</div><div class="line"><a name="l05565"></a><span class="lineno"> 5565</span>&#160;<span class="keyword">function</span> changeIgnore(area,e,u)</div><div class="line"><a name="l05566"></a><span class="lineno"> 5566</span>&#160;{<span class="keywordflow">if</span>(area.value!=<span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l05567"></a><span class="lineno"> 5567</span>&#160;{<span class="keywordflow">if</span>(document.getElementById(e)!=undefined)</div><div class="line"><a name="l05568"></a><span class="lineno"> 5568</span>&#160;document.getElementById(e).checked=<span class="keyword">false</span>;<span class="keywordflow">if</span>(document.getElementById(u)!=undefined)</div><div class="line"><a name="l05569"></a><span class="lineno"> 5569</span>&#160;document.getElementById(u).checked=<span class="keyword">false</span>;}}</div><div class="line"><a name="l05570"></a><span class="lineno"> 5570</span>&#160;<span class="keyword">function</span> moveFields()</div><div class="line"><a name="l05571"></a><span class="lineno"> 5571</span>&#160;{var fields=document.getElementById(<span class="stringliteral">&quot;fieldcontainer&quot;</span>);var selected=<span class="keyword">new</span> Array();<span class="keywordflow">for</span>(var i=0;i&lt;fields.options.length;i++)</div><div class="line"><a name="l05572"></a><span class="lineno"> 5572</span>&#160;<span class="keywordflow">if</span>(fields.options[i].selected)</div><div class="line"><a name="l05573"></a><span class="lineno"> 5573</span>&#160;selected.push(fields.options[i].value);<span class="keywordflow">for</span>(var i=0;i&lt;selected.length;i++)</div><div class="line"><a name="l05574"></a><span class="lineno"> 5574</span>&#160;insertAtCaret(<span class="stringliteral">&quot;queryval&quot;</span>,<span class="charliteral">&#39;&quot;&#39;</span>+selected[i].replace(/<span class="stringliteral">&quot;/g,&#39;&quot;</span><span class="stringliteral">&quot;&#39;)+&#39;&quot;</span><span class="stringliteral">&#39;);}</span></div><div class="line"><a name="l05575"></a><span class="lineno"> 5575</span>&#160;<span class="stringliteral">function insertAtCaret(areaId,text)</span></div><div class="line"><a name="l05576"></a><span class="lineno"> 5576</span>&#160;<span class="stringliteral">{var txtarea=document.getElementById(areaId);var scrollPos=txtarea.scrollTop;var strPos=0;var br=((txtarea.selectionStart||txtarea.selectionStart==&#39;</span>0<span class="stringliteral">&#39;)?&quot;ff&quot;:(document.selection?&quot;ie&quot;:false));if(br==&quot;ie&quot;)</span></div><div class="line"><a name="l05577"></a><span class="lineno"> 5577</span>&#160;<span class="stringliteral">{txtarea.focus();var range=document.selection.createRange();range.moveStart(&#39;</span>character<span class="stringliteral">&#39;,-txtarea.value.length);strPos=range.text.length;}</span></div><div class="line"><a name="l05578"></a><span class="lineno"> 5578</span>&#160;<span class="stringliteral">else if(br==&quot;ff&quot;)</span></div><div class="line"><a name="l05579"></a><span class="lineno"> 5579</span>&#160;<span class="stringliteral">strPos=txtarea.selectionStart;var front=(txtarea.value).substring(0,strPos);var back=(txtarea.value).substring(strPos,txtarea.value.length);txtarea.value=front+text+back;strPos=strPos+text.length;if(br==&quot;ie&quot;)</span></div><div class="line"><a name="l05580"></a><span class="lineno"> 5580</span>&#160;<span class="stringliteral">{txtarea.focus();var range=document.selection.createRange();range.moveStart(&#39;</span>character<span class="stringliteral">&#39;,-txtarea.value.length);range.moveStart(&#39;</span>character<span class="stringliteral">&#39;,strPos);range.moveEnd(&#39;</span>character<span class="stringliteral">&#39;,0);range.select();}</span></div><div class="line"><a name="l05581"></a><span class="lineno"> 5581</span>&#160;<span class="stringliteral">else if(br==&quot;ff&quot;)</span></div><div class="line"><a name="l05582"></a><span class="lineno"> 5582</span>&#160;<span class="stringliteral">{txtarea.selectionStart=strPos;txtarea.selectionEnd=strPos;txtarea.focus();}</span></div><div class="line"><a name="l05583"></a><span class="lineno"> 5583</span>&#160;<span class="stringliteral">txtarea.scrollTop=scrollPos;}</span></div><div class="line"><a name="l05584"></a><span class="lineno"> 5584</span>&#160;<span class="stringliteral">function notNull(checker)</span></div><div class="line"><a name="l05585"></a><span class="lineno"> 5585</span>&#160;<span class="stringliteral">{document.getElementById(checker).checked=false;}</span></div><div class="line"><a name="l05586"></a><span class="lineno"> 5586</span>&#160;<span class="stringliteral">function disableText(checker,textie)</span></div><div class="line"><a name="l05587"></a><span class="lineno"> 5587</span>&#160;<span class="stringliteral">{if(checker.checked)</span></div><div class="line"><a name="l05588"></a><span class="lineno"> 5588</span>&#160;<span class="stringliteral">{document.getElementById(textie).value=&quot;&quot;;document.getElementById(textie).disabled=true;}</span></div><div class="line"><a name="l05589"></a><span class="lineno"> 5589</span>&#160;<span class="stringliteral">else</span></div><div class="line"><a name="l05590"></a><span class="lineno"> 5590</span>&#160;<span class="stringliteral">{document.getElementById(textie).disabled=false;}}</span></div><div class="line"><a name="l05591"></a><span class="lineno"> 5591</span>&#160;<span class="stringliteral">function toggleExports(val)</span></div><div class="line"><a name="l05592"></a><span class="lineno"> 5592</span>&#160;<span class="stringliteral">{document.getElementById(&quot;exportoptions_sql&quot;).style.display=&quot;none&quot;;document.getElementById(&quot;exportoptions_csv&quot;).style.display=&quot;none&quot;;document.getElementById(&quot;exportoptions_&quot;+val).style.display=&quot;block&quot;;}</span></div><div class="line"><a name="l05593"></a><span class="lineno"> 5593</span>&#160;<span class="stringliteral">function toggleImports(val)</span></div><div class="line"><a name="l05594"></a><span class="lineno"> 5594</span>&#160;<span class="stringliteral">{document.getElementById(&quot;importoptions_sql&quot;).style.display=&quot;none&quot;;document.getElementById(&quot;importoptions_csv&quot;).style.display=&quot;none&quot;;document.getElementById(&quot;importoptions_&quot;+val).style.display=&quot;block&quot;;}</span></div><div class="line"><a name="l05595"></a><span class="lineno"> 5595</span>&#160;<span class="stringliteral">function openHelp(section)</span></div><div class="line"><a name="l05596"></a><span class="lineno"> 5596</span>&#160;<span class="stringliteral">{PopupCenter(&#39;</span>?help=1#<span class="stringliteral">&#39;+section,&quot;Help Section&quot;);}</span></div><div class="line"><a name="l05597"></a><span class="lineno"> 5597</span>&#160;<span class="stringliteral">var helpsec=false;function PopupCenter(pageURL,title)</span></div><div class="line"><a name="l05598"></a><span class="lineno"> 5598</span>&#160;<span class="stringliteral">{helpsec=window.open(pageURL,title,&quot;toolbar=0,scrollbars=1,location=0,statusbar=0,menubar=0,resizable=0,width=400,height=300&quot;);}</span></div><div class="line"><a name="l05599"></a><span class="lineno"> 5599</span>&#160;<span class="stringliteral">function checkLike(srchField,selOpt)</span></div><div class="line"><a name="l05600"></a><span class="lineno"> 5600</span>&#160;<span class="stringliteral">{if(selOpt==&quot;LIKE%&quot;){var textArea=document.getElementById(srchField);textArea.value=&quot;%&quot;+textArea.value+&quot;%&quot;;}}</span></div><div class="line"><a name="l05601"></a><span class="lineno"> 5601</span>&#160;<span class="stringliteral">function createCORSRequest(method,url)</span></div><div class="line"><a name="l05602"></a><span class="lineno"> 5602</span>&#160;<span class="stringliteral">{var xhr=new XMLHttpRequest();if(&quot;withCredentials&quot;in xhr)</span></div><div class="line"><a name="l05603"></a><span class="lineno"> 5603</span>&#160;<span class="stringliteral">{xhr.open(method,url,true);}</span></div><div class="line"><a name="l05604"></a><span class="lineno"> 5604</span>&#160;<span class="stringliteral">else if(typeof XDomainRequest!=&quot;undefined&quot;)</span></div><div class="line"><a name="l05605"></a><span class="lineno"> 5605</span>&#160;<span class="stringliteral">{xhr=new XDomainRequest();xhr.open(method,url);}</span></div><div class="line"><a name="l05606"></a><span class="lineno"> 5606</span>&#160;<span class="stringliteral">else</span></div><div class="line"><a name="l05607"></a><span class="lineno"> 5607</span>&#160;<span class="stringliteral">{xhr=null;}</span></div><div class="line"><a name="l05608"></a><span class="lineno"> 5608</span>&#160;<span class="stringliteral">return xhr;}</span></div><div class="line"><a name="l05609"></a><span class="lineno"> 5609</span>&#160;<span class="stringliteral">function checkVersion(installed,url)</span></div><div class="line"><a name="l05610"></a><span class="lineno"> 5610</span>&#160;<span class="stringliteral">{var xhr=createCORSRequest(&#39;</span>GET<span class="stringliteral">&#39;,url);if(!xhr)</span></div><div class="line"><a name="l05611"></a><span class="lineno"> 5611</span>&#160;<span class="stringliteral">return false;xhr.onload=function()</span></div><div class="line"><a name="l05612"></a><span class="lineno"> 5612</span>&#160;<span class="stringliteral">{if(xhr.responseText.split(&quot;\n&quot;).indexOf(installed)==-1)</span></div><div class="line"><a name="l05613"></a><span class="lineno"> 5613</span>&#160;<span class="stringliteral">{document.getElementById(&#39;</span>oldVersion<span class="stringliteral">&#39;).style.display=&#39;</span><span class="keyword">inline</span><span class="stringliteral">&#39;;}};xhr.send();}AAABAAEAEBAAAAEAIAAoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADwoKZQAAABMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABEMDJMAAAAdAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASDg7BAAAASAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAETDw9CCQkJ1QUFBb4AAABjAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgsLVgAAAO8YExP/AAAA7QAAALEAAAARAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQNDUsAAADJGBMT/xgTE/8AAAD/AAAAuAAAAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAZERE8DQoKwhgTE/8QDQ2sGBMT/xgTE/8AAAA/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwICHkAAAD/EQwMzQAAAMIAAAD/AAAA7gAAAGEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOCwtWAAAA8RgTE/8IBQW1AAAA/wAAAP8AAADlAAAAHQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA0KCsEAAAD/EQ8PzAAAAMkAAAD/AAAA/wAAAHoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABDAAAA/xgTE/8TDw/FAAAA8gAAAP8AAADqAAAAJgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAALUAAAD/GBMT/wAAALkAAAD/AAAA/wAAAIkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAfAAAA4wAAAP8GBgbFAAAA2QAAAP8AAADGAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAF4AAAD5AAAA/RgTE/8AAAD/AAAA0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQQAAAOIAAAD/AAAA/wAAAHYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAjAAAArgAAAG4AAAAAAAAAAAAAAAAAAAAA</span></div><div class="ttc" id="namespace_bms_html_a1fa3127fc82f96b1436d871ef02be319"><div class="ttname"><a href="namespace_bms.html#a1fa3127fc82f96b1436d871ef02be319">Bms\$db</a></div><div class="ttdeci">$db</div><div class="ttdef"><b>Definition:</b> <a href="config_8sample_8php_source.html#l00082">config.sample.php:82</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
